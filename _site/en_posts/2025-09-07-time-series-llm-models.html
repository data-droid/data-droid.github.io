<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Explore innovative time series forecasting models using large language models and implement them in practice.">



<title>Part 4: Latest Generative AI Models - TimeGPT, Lag-Llama, Moirai, Chronos - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 4: Latest Generative AI Models - TimeGPT, Lag-Llama, Moirai, Chronos">
<meta property="og:description" content="Explore innovative time series forecasting models using large language models and implement them in practice.">
<meta property="og:url" content="http://localhost:4000/en_posts/2025-09-07-time-series-llm-models.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 4: Latest Generative AI Models - TimeGPT, Lag-Llama, Moirai, Chronos">
<meta name="twitter:description" content="Explore innovative time series forecasting models using large language models and implement them in practice.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="Î©îÎâ¥ Ïó¥Í∏∞/Îã´Í∏∞">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">Home</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">Categories</a>
            <ul class="dropdown-menu">

              <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
              <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
              <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
              <li><a href="/en/categories/data-quality/">Data Quality</a></li>
              <li><a href="/en/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/en/blog/">Blog</a></li>
        <li><a href="/en/about/">About</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- Ìè¨Ïä§Ìä∏Ïö© Ïñ∏Ïñ¥ Ï†ÑÌôò -->
        
          
          <a href="/data-ai/2025/09/07/time-series-llm-models.html" class="lang-btn">ÌïúÍµ≠Ïñ¥</a>
          <a href="/en_posts/2025-09-07-time-series-llm-models.html" class="lang-btn active">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data ai</span>
      <span class="post-date">2025ÎÖÑ 09Ïõî 07Ïùº</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 4: Latest Generative AI Models - TimeGPT, Lag-Llama, Moirai, Chronos</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">time-series-forecasting</span>
      
        <span class="tag">LLM</span>
      
        <span class="tag">TimeGPT</span>
      
        <span class="tag">Lag-Llama</span>
      
        <span class="tag">Moirai</span>
      
        <span class="tag">Chronos</span>
      
        <span class="tag">generative-AI</span>
      
        <span class="tag">large-language-models</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">üìö Time series forecasting ÏãúÎ¶¨Ï¶à</span>
      <span class="series-order">Part 5</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">‚è±Ô∏è 20 min</span>
      
      
        <span class="difficulty">üìä Advanced</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-4-latest-generative-ai-models---timegpt-lag-llama-moirai-chronos">Part 4: Latest Generative AI Models - TimeGPT, Lag-Llama, Moirai, Chronos</h1>

<blockquote>
  <p>Explore innovative time series forecasting models using large language models and implement them in practice.</p>
</blockquote>

<h2 id="-table-of-contents">üìñ Table of Contents</h2>

<ol>
  <li><a href="#the-rise-of-llm-based-time-series-forecasting">The Rise of LLM-based Time Series Forecasting</a></li>
  <li><a href="#timegpt-openais-time-series-model">TimeGPT: OpenAI‚Äôs Time Series Model</a></li>
  <li><a href="#lag-llama-open-source-alternative">Lag-Llama: Open Source Alternative</a></li>
  <li><a href="#moirai-multi-series-forecasting">Moirai: Multi-series Forecasting</a></li>
  <li><a href="#chronos-metas-time-series-model">Chronos: Meta‚Äôs Time Series Model</a></li>
  <li><a href="#hands-on-lag-llama-implementation">Hands-on: Lag-Llama Implementation</a></li>
  <li><a href="#model-comparison-and-selection-guide">Model Comparison and Selection Guide</a></li>
  <li><a href="#next-steps-and-future-outlook">Next Steps and Future Outlook</a></li>
  <li><a href="#learning-summary">Learning Summary</a></li>
</ol>

<h2 id="-the-rise-of-llm-based-time-series-forecasting">üöÄ The Rise of LLM-based Time Series Forecasting</h2>

<h3 id="limitations-of-previous-models">Limitations of Previous Models</h3>

<p>The models we learned in Parts 1-3 each had their strengths, but shared common limitations:</p>

<ol>
  <li><strong>Domain Specialization</strong>: Optimized for specific time series patterns</li>
  <li><strong>Data Dependency</strong>: Requires large amounts of domain-specific training data</li>
  <li><strong>Generalization Limits</strong>: Difficulty adapting to new time series types</li>
  <li><strong>Limited Multi-tasking</strong>: Hard to perform various prediction tasks simultaneously</li>
</ol>

<h3 id="llms-revolutionary-approach">LLM‚Äôs Revolutionary Approach</h3>

<p>Large Language Models (LLMs) presented a new paradigm to overcome these limitations:</p>

<ul>
  <li><strong>Universality</strong>: Learning from diverse domain time series data</li>
  <li><strong>Few-shot Learning</strong>: Excellent performance with minimal data</li>
  <li><strong>Multi-tasking</strong>: Performing multiple prediction tasks simultaneously</li>
  <li><strong>Natural Language Interface</strong>: Intuitive querying and explainability</li>
</ul>

<h3 id="core-technical-innovations">Core Technical Innovations</h3>

<ol>
  <li><strong>Tokenization</strong>: Converting time series data into tokens</li>
  <li><strong>Causal Attention</strong>: Modeling temporal dependencies in time series</li>
  <li><strong>Multi-scale Learning</strong>: Learning patterns at various time scales</li>
  <li><strong>Instruction Following</strong>: Prediction based on natural language instructions</li>
</ol>

<h2 id="-timegpt-openais-time-series-model">ü§ñ TimeGPT: OpenAI‚Äôs Time Series Model</h2>

<h3 id="core-features-of-timegpt">Core Features of TimeGPT</h3>

<p>TimeGPT is the first large-scale time series forecasting model developed by OpenAI.</p>

<h4 id="1-large-scale-pre-training"><strong>1. Large-scale Pre-training</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Training Data: 100+ billion time series data points
Domains: Finance, Retail, Manufacturing, Energy, Healthcare, etc.
Geographic Scope: Worldwide
Time Range: 2020-2024
</code></pre></div></div>

<h4 id="2-zero-shot-prediction-capability"><strong>2. Zero-shot Prediction Capability</strong></h4>

<p>TimeGPT can predict new time series without additional training based on pre-trained knowledge:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Example: Immediate prediction for new time series
</span><span class="n">forecast</span> <span class="o">=</span> <span class="n">timegpt</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">unseen_timeseries</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>  <span class="c1"># 30-day prediction
</span>    <span class="n">freq</span><span class="o">=</span><span class="sh">"</span><span class="s">D</span><span class="sh">"</span>     <span class="c1"># Daily data
</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="3-natural-language-interface"><strong>3. Natural Language Interface</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Request prediction in natural language
</span><span class="n">result</span> <span class="o">=</span> <span class="n">timegpt</span><span class="p">.</span><span class="nf">predict_with_context</span><span class="p">(</span>
    <span class="n">series</span><span class="o">=</span><span class="n">stock_prices</span><span class="p">,</span>
    <span class="n">context</span><span class="o">=</span><span class="sh">"</span><span class="s">Please predict stock prices for the next week, considering market volatility.</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">horizon</span><span class="o">=</span><span class="mi">7</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="timegpt-architecture">TimeGPT Architecture</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input Time Series ‚Üí Tokenization ‚Üí Transformer Encoder ‚Üí Decoder ‚Üí Predictions
     ‚Üì                ‚Üì                ‚Üì              ‚Üì
  Raw Data      Time Tokens    Attention      Forecast
</code></pre></div></div>

<h4 id="tokenization-strategy"><strong>Tokenization Strategy</strong></h4>

<ol>
  <li><strong>Value Binning</strong>: Converting continuous values to discrete tokens</li>
  <li><strong>Temporal Encoding</strong>: Including time information in tokens</li>
  <li><strong>Context Tokens</strong>: Expressing metadata as tokens</li>
</ol>

<h2 id="-lag-llama-open-source-alternative">ü¶ô Lag-Llama: Open Source Alternative</h2>

<h3 id="background-of-lag-llama">Background of Lag-Llama</h3>

<p>Lag-Llama was developed by Hugging Face as an open-source alternative to overcome the limitations of TimeGPT being a commercial model available only through API.</p>

<h4 id="1-open-source-accessibility"><strong>1. Open Source Accessibility</strong></h4>

<ul>
  <li><strong>Fully Open Source</strong>: Model weights and code publicly available</li>
  <li><strong>Local Execution</strong>: Run locally without API dependencies</li>
  <li><strong>Customization</strong>: Modify models according to needs</li>
</ul>

<h4 id="2-llama-based-architecture"><strong>2. LLaMA-based Architecture</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Time Series Input ‚Üí Lag Features ‚Üí LLaMA-7B ‚Üí Predictions
     ‚Üì                ‚Üì            ‚Üì
  Raw Data        Lag Tokens   Transformer
</code></pre></div></div>

<h4 id="3-innovation-of-lag-features"><strong>3. Innovation of Lag Features</strong></h4>

<p>Lag-Llama converts lag values of time series into tokens:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Lag Features creation example
</span><span class="k">def</span> <span class="nf">create_lag_features</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">max_lags</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create lag features from time series</span><span class="sh">"""</span>
    <span class="n">lags</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">lags</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">series</span><span class="p">.</span><span class="nf">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="advantages-of-lag-llama">Advantages of Lag-Llama</h3>

<ol>
  <li><strong>Transparency</strong>: Public model structure and training process</li>
  <li><strong>Cost Efficiency</strong>: No API costs</li>
  <li><strong>Privacy</strong>: Data doesn‚Äôt leave local environment</li>
  <li><strong>Scalability</strong>: Customizable for various domains</li>
</ol>

<h2 id="-moirai-multi-series-forecasting">üåä Moirai: Multi-series Forecasting</h2>

<h3 id="core-concept-of-moirai">Core Concept of Moirai</h3>

<p>Moirai is a multi-tasking model that predicts multiple time series simultaneously.</p>

<h4 id="1-multi-tasking-architecture"><strong>1. Multi-tasking Architecture</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Time Series 1 ‚îê
Time Series 2 ‚îú‚îÄ‚Üí Shared Encoder ‚Üí Task-specific Heads ‚Üí Predictions
Time Series 3 ‚îò
</code></pre></div></div>

<h4 id="2-cross-series-learning"><strong>2. Cross-series Learning</strong></h4>

<ul>
  <li><strong>Common Pattern Learning</strong>: Discovering shared patterns across time series</li>
  <li><strong>Knowledge Transfer</strong>: Learning from one time series helps others</li>
  <li><strong>Efficiency</strong>: Processing multiple time series with a single model</li>
</ul>

<h4 id="3-hierarchical-forecasting"><strong>3. Hierarchical Forecasting</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Country Level ‚îê
Region Level  ‚îú‚îÄ‚Üí Hierarchical Prediction
City Level    ‚îò
</code></pre></div></div>

<h2 id="-chronos-metas-time-series-model">‚è∞ Chronos: Meta‚Äôs Time Series Model</h2>

<h3 id="chronoss-innovative-approach">Chronos‚Äôs Innovative Approach</h3>

<p>Chronos is a token-based time series forecasting model developed by Meta.</p>

<h4 id="1-token-based-forecasting"><strong>1. Token-based Forecasting</strong></h4>

<p>Converting time series to tokens and processing like language models:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Chronos tokenization example
</span><span class="k">def</span> <span class="nf">tokenize_timeseries</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="mi">512</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Convert time series to tokens</span><span class="sh">"""</span>
    <span class="c1"># Value normalization
</span>    <span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">series</span> <span class="o">-</span> <span class="n">series</span><span class="p">.</span><span class="nf">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">series</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span>
    
    <span class="c1"># Quantization
</span>    <span class="n">quantized</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">digitize</span><span class="p">(</span><span class="n">normalized</span><span class="p">,</span> 
                          <span class="n">np</span><span class="p">.</span><span class="nf">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">quantized</span>
</code></pre></div></div>

<h4 id="2-multi-scale-learning"><strong>2. Multi-scale Learning</strong></h4>

<ul>
  <li><strong>Short-term Patterns</strong>: Daily, weekly variations</li>
  <li><strong>Medium-term Patterns</strong>: Monthly, quarterly trends</li>
  <li><strong>Long-term Patterns</strong>: Annual seasonality, structural changes</li>
</ul>

<h4 id="3-instruction-tuning"><strong>3. Instruction Tuning</strong></h4>

<p>Performing various prediction tasks based on natural language instructions:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Chronos instruction examples
</span><span class="n">instructions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">Predict sales for the next 7 days</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Provide monthly prediction considering seasonality</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">Make stable prediction excluding outliers</span><span class="sh">"</span>
<span class="p">]</span>
</code></pre></div></div>

<h2 id="Ô∏è-hands-on-lag-llama-implementation">üõ†Ô∏è Hands-on: Lag-Llama Implementation</h2>

<h3 id="1-environment-setup">1. Environment Setup</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Install required libraries
# pip install transformers torch datasets evaluate
# pip install pandas numpy matplotlib seaborn
# pip install scikit-learn
</span>
<span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">from</span> <span class="n">transformers</span> <span class="kn">import</span> <span class="n">AutoModel</span><span class="p">,</span> <span class="n">AutoTokenizer</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="n">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Visualization settings
</span><span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">'</span><span class="s">seaborn-v0_8</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="sh">"</span><span class="s">husl</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-load-lag-llama-model">2. Load Lag-Llama Model</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Load Lag-Llama model
</span><span class="n">model_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">time-series-foundation-models/Lag-Llama</span><span class="sh">"</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="p">.</span><span class="nf">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModel</span><span class="p">.</span><span class="nf">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Model parameters: </span><span class="si">{</span><span class="nf">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">())</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Model structure: </span><span class="si">{</span><span class="n">model</span><span class="p">.</span><span class="n">config</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-prepare-time-series-data">3. Prepare Time Series Data</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_complex_multivariate_timeseries</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">n_series</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Generate complex multivariate time series data</span><span class="sh">"""</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="c1"># Time index
</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
    <span class="c1"># Common trend
</span>    <span class="n">common_trend</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># Series-specific characteristics
</span>    <span class="n">series_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_series</span><span class="p">):</span>
        <span class="c1"># Series-specific unique patterns
</span>        <span class="n">series_trend</span> <span class="o">=</span> <span class="n">common_trend</span> <span class="o">+</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">t</span>
        <span class="n">series_seasonal</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">365</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">series_noise</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        
        <span class="c1"># Cross-series correlation
</span>        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">correlation</span> <span class="o">=</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">100</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">series_data</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">series_trend</span> <span class="o">+</span> <span class="n">series_seasonal</span> <span class="o">+</span> <span class="n">series_noise</span> <span class="o">+</span> <span class="n">correlation</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">series_data</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">series_trend</span> <span class="o">+</span> <span class="n">series_seasonal</span> <span class="o">+</span> <span class="n">series_noise</span><span class="p">)</span>
    
    <span class="c1"># Create DataFrame
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">series_data</span><span class="p">).</span><span class="n">T</span><span class="p">,</span> 
                     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="sh">'</span><span class="s">series_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">'</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">n_series</span><span class="p">)],</span>
                     <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2020-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">))</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Generate multivariate time series
</span><span class="n">multivariate_ts</span> <span class="o">=</span> <span class="nf">generate_complex_multivariate_timeseries</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Visualization
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">multivariate_ts</span><span class="p">.</span><span class="n">columns</span><span class="p">):</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">multivariate_ts</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">multivariate_ts</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s"> Time Series</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Number of series: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">multivariate_ts</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Data length: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">multivariate_ts</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Value range: </span><span class="si">{</span><span class="n">multivariate_ts</span><span class="p">.</span><span class="nf">min</span><span class="p">().</span><span class="nf">min</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> ~ </span><span class="si">{</span><span class="n">multivariate_ts</span><span class="p">.</span><span class="nf">max</span><span class="p">().</span><span class="nf">max</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-create-lag-features">4. Create Lag Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_lag_features</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">max_lags</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Create lag features for Lag-Llama</span><span class="sh">"""</span>
    <span class="n">lag_features</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span>
        
        <span class="c1"># Create lag features
</span>        <span class="n">lags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_lags</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">lag_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">roll</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">lag</span><span class="p">)</span>
            <span class="n">lag_values</span><span class="p">[:</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">nan</span>  <span class="c1"># First lag values are NaN
</span>            <span class="n">lags</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">lag_values</span><span class="p">)</span>
        
        <span class="n">lag_features</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">column_stack</span><span class="p">(</span><span class="n">lags</span><span class="p">)</span>
        
        <span class="c1"># Create targets (future values)
</span>        <span class="n">targets</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="n">forecast_horizon</span><span class="p">:]</span>
    
    <span class="k">return</span> <span class="n">lag_features</span><span class="p">,</span> <span class="n">targets</span>

<span class="c1"># Create lag features
</span><span class="n">max_lags</span> <span class="o">=</span> <span class="mi">24</span>
<span class="n">forecast_horizon</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">lag_features</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="nf">create_lag_features</span><span class="p">(</span><span class="n">multivariate_ts</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lag features shape: </span><span class="si">{</span><span class="n">lag_features</span><span class="p">[</span><span class="sh">'</span><span class="s">series_1</span><span class="sh">'</span><span class="p">].</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Targets shape: </span><span class="si">{</span><span class="n">targets</span><span class="p">[</span><span class="sh">'</span><span class="s">series_1</span><span class="sh">'</span><span class="p">].</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="5-implement-lag-llama-model">5. Implement Lag-Llama Model</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">LagLlamaPredictor</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Lag-Llama based time series prediction model</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">LagLlamaPredictor</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">input_dim</span> <span class="o">=</span> <span class="n">input_dim</span>
        <span class="n">self</span><span class="p">.</span><span class="n">hidden_dim</span> <span class="o">=</span> <span class="n">hidden_dim</span>
        <span class="n">self</span><span class="p">.</span><span class="n">output_dim</span> <span class="o">=</span> <span class="n">output_dim</span>
        
        <span class="c1"># Input embedding
</span>        <span class="n">self</span><span class="p">.</span><span class="n">input_embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        
        <span class="c1"># Transformer layers
</span>        <span class="n">encoder_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">TransformerEncoderLayer</span><span class="p">(</span>
            <span class="n">d_model</span><span class="o">=</span><span class="n">hidden_dim</span><span class="p">,</span>
            <span class="n">nhead</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
            <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">hidden_dim</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">batch_first</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">transformer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">TransformerEncoder</span><span class="p">(</span><span class="n">encoder_layer</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">)</span>
        
        <span class="c1"># Output layer
</span>        <span class="n">self</span><span class="p">.</span><span class="n">output_projection</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
        
        <span class="c1"># Dropout
</span>        <span class="n">self</span><span class="p">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># Input embedding
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">input_embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Transformer encoder
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">transformer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="c1"># Use last time step output
</span>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># (batch_size, hidden_dim)
</span>        
        <span class="c1"># Output prediction
</span>        <span class="n">output</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">output_projection</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output</span>

<span class="c1"># Create model
</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="sh">'</span><span class="s">cuda</span><span class="sh">'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="sh">'</span><span class="s">cpu</span><span class="sh">'</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="nc">LagLlamaPredictor</span><span class="p">(</span>
    <span class="n">input_dim</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span>
    <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">output_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_layers</span><span class="o">=</span><span class="mi">6</span>
<span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Lag-Llama model parameters: </span><span class="si">{</span><span class="nf">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">())</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="6-data-preprocessing-and-training">6. Data Preprocessing and Training</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prepare_training_data</span><span class="p">(</span><span class="n">lag_features</span><span class="p">,</span> <span class="n">targets</span><span class="p">,</span> <span class="n">train_ratio</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Prepare training data</span><span class="sh">"""</span>
    <span class="n">all_X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_y</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">lag_features</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">lag_features</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">targets</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        
        <span class="c1"># Remove NaN
</span>        <span class="n">valid_indices</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="p">.</span><span class="nf">isnan</span><span class="p">(</span><span class="n">X</span><span class="p">).</span><span class="nf">any</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">valid_indices</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">valid_indices</span><span class="p">]</span>
        
        <span class="c1"># Match lengths
</span>        <span class="n">min_len</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="nf">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
        
        <span class="n">all_X</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">all_y</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Combine all time series
</span>    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">vstack</span><span class="p">(</span><span class="n">all_X</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">hstack</span><span class="p">(</span><span class="n">all_y</span><span class="p">)</span>
    
    <span class="c1"># Train/validation split
</span>    <span class="n">split_idx</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">train_ratio</span><span class="p">)</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
    <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">split_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">split_idx</span><span class="p">:]</span>
    
    <span class="k">return</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span>

<span class="c1"># Prepare data
</span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="nf">prepare_training_data</span><span class="p">(</span><span class="n">lag_features</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>

<span class="c1"># Convert to PyTorch tensors
</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">X_train</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">X_val</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">y_train</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">y_val</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">y_val</span><span class="p">).</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Training data: </span><span class="si">{</span><span class="n">X_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">y_train</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Validation data: </span><span class="si">{</span><span class="n">X_val</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="s">, </span><span class="si">{</span><span class="n">y_val</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Training function
</span><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Train model</span><span class="sh">"""</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">MSELoss</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">optim</span><span class="p">.</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="nc">ReduceLROnPlateau</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="c1"># Training
</span>        <span class="n">model</span><span class="p">.</span><span class="nf">train</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>
        
        <span class="n">train_pred</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
        <span class="n">train_loss</span> <span class="o">=</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">train_pred</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">train_loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
        
        <span class="c1"># Validation
</span>        <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
            <span class="n">val_pred</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
            <span class="n">val_loss</span> <span class="o">=</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">val_pred</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)</span>
        
        <span class="n">train_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">.</span><span class="nf">item</span><span class="p">())</span>
        <span class="n">val_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">val_loss</span><span class="p">.</span><span class="nf">item</span><span class="p">())</span>
        
        <span class="c1"># Learning rate scheduling
</span>        <span class="n">scheduler</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
        
        <span class="nf">if </span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">20</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s">] - Train Loss: </span><span class="si">{</span><span class="n">train_loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s">, Val Loss: </span><span class="si">{</span><span class="n">val_loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span>

<span class="c1"># Train model
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Starting Lag-Llama Model Training ===</span><span class="sh">"</span><span class="p">)</span>
<span class="n">train_losses</span><span class="p">,</span> <span class="n">val_losses</span> <span class="o">=</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># Visualize training process
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Training Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Validation Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Lag-Llama Model Training Process</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Epoch</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Loss (MSE)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="7-prediction-and-performance-evaluation">7. Prediction and Performance Evaluation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">model_name</span><span class="o">=</span><span class="sh">"</span><span class="s">Lag-Llama</span><span class="sh">"</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Evaluate model performance</span><span class="sh">"""</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">().</span><span class="nf">flatten</span><span class="p">()</span>
        <span class="n">y_test</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">().</span><span class="nf">flatten</span><span class="p">()</span>
    
    <span class="c1"># Calculate performance metrics
</span>    <span class="n">mse</span> <span class="o">=</span> <span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="nf">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s"> Performance:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">predictions</span><span class="p">,</span> <span class="p">(</span><span class="n">mse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">)</span>

<span class="c1"># Evaluate performance
</span><span class="n">predictions</span><span class="p">,</span> <span class="n">metrics</span> <span class="o">=</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">)</span>

<span class="c1"># Visualize prediction results
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># First 200 samples: prediction vs actual
</span><span class="n">sample_size</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">y_val</span><span class="p">[:</span><span class="n">sample_size</span><span class="p">].</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">(),</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Actual</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">predictions</span><span class="p">[:</span><span class="n">sample_size</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Lag-Llama Prediction</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Lag-Llama: Prediction vs Actual (First 200 Samples)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Sample</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Scatter plot
</span><span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">scatter</span><span class="p">(</span><span class="n">y_val</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">(),</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">([</span><span class="n">y_val</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">y_val</span><span class="p">.</span><span class="nf">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">y_val</span><span class="p">.</span><span class="nf">min</span><span class="p">(),</span> <span class="n">y_val</span><span class="p">.</span><span class="nf">max</span><span class="p">()],</span> <span class="sh">'</span><span class="s">r--</span><span class="sh">'</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Actual Value</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Predicted Value</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Actual vs Predicted Scatter Plot</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="8-multi-series-prediction">8. Multi-series Prediction</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">predict_multiple_series</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">multivariate_ts</span><span class="p">,</span> <span class="n">max_lags</span><span class="o">=</span><span class="mi">24</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">Predict multiple time series</span><span class="sh">"""</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">multivariate_ts</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">series</span> <span class="o">=</span> <span class="n">multivariate_ts</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">values</span>
        
        <span class="c1"># Create lag features from recent data
</span>        <span class="n">recent_data</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="o">-</span><span class="n">max_lags</span><span class="p">:]</span>
        <span class="n">recent_data</span> <span class="o">=</span> <span class="n">recent_data</span><span class="p">.</span><span class="nf">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Prediction
</span>        <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
            <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">recent_data</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="n">predictions</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pred</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">().</span><span class="nf">flatten</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">predictions</span>

<span class="c1"># Multi-series prediction
</span><span class="n">forecast_predictions</span> <span class="o">=</span> <span class="nf">predict_multiple_series</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">multivariate_ts</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Multi-series Prediction Results ===</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">pred</span> <span class="ow">in</span> <span class="n">forecast_predictions</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">pred</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Visualize prediction results
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">forecast_predictions</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Recent 100 days data
</span>    <span class="n">recent_data</span> <span class="o">=</span> <span class="n">multivariate_ts</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">tail</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">recent_data</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">recent_data</span><span class="p">.</span><span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Past Data</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
    <span class="c1"># Prediction
</span>    <span class="n">last_date</span> <span class="o">=</span> <span class="n">recent_data</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">next_date</span> <span class="o">=</span> <span class="n">last_date</span> <span class="o">+</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="sh">'</span><span class="s">--</span><span class="sh">'</span><span class="p">,</span> 
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="s">Prediction: </span><span class="si">{</span><span class="n">pred</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s"> - Next Prediction: </span><span class="si">{</span><span class="n">pred</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="-model-comparison-and-selection-guide">üìä Model Comparison and Selection Guide</h2>

<h3 id="performance-comparison">Performance Comparison</h3>

<table>
  <thead>
    <tr>
      <th>Model</th>
      <th>Advantages</th>
      <th>Disadvantages</th>
      <th>Use Cases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>TimeGPT</strong></td>
      <td>Best performance, natural language interface</td>
      <td>API dependency, cost</td>
      <td>Commercial services, prototyping</td>
    </tr>
    <tr>
      <td><strong>Lag-Llama</strong></td>
      <td>Open source, local execution</td>
      <td>Performance limitations, complex setup</td>
      <td>Research, personal projects</td>
    </tr>
    <tr>
      <td><strong>Moirai</strong></td>
      <td>Multi-series, efficiency</td>
      <td>Complex architecture</td>
      <td>Large-scale multivariate prediction</td>
    </tr>
    <tr>
      <td><strong>Chronos</strong></td>
      <td>Token-based, flexibility</td>
      <td>Meta dependency</td>
      <td>Experimental research</td>
    </tr>
  </tbody>
</table>

<h3 id="selection-guide">Selection Guide</h3>

<h4 id="1-by-project-scale"><strong>1. By Project Scale</strong></h4>

<ul>
  <li><strong>Small Scale</strong>: Lag-Llama (open source, free)</li>
  <li><strong>Medium Scale</strong>: TimeGPT (API, fast implementation)</li>
  <li><strong>Large Scale</strong>: Moirai (multi-series, efficiency)</li>
</ul>

<h4 id="2-by-requirements"><strong>2. By Requirements</strong></h4>

<ul>
  <li><strong>Accuracy Priority</strong>: TimeGPT</li>
  <li><strong>Cost Efficiency</strong>: Lag-Llama</li>
  <li><strong>Multi-series</strong>: Moirai</li>
  <li><strong>Experimental Research</strong>: Chronos</li>
</ul>

<h4 id="3-technical-considerations"><strong>3. Technical Considerations</strong></h4>

<ul>
  <li><strong>Data Privacy</strong>: Lag-Llama (local execution)</li>
  <li><strong>Rapid Prototyping</strong>: TimeGPT (API)</li>
  <li><strong>Customization</strong>: Lag-Llama (open source)</li>
  <li><strong>Scalability</strong>: Moirai (multi-tasking)</li>
</ul>

<h2 id="-next-steps-and-future-outlook">üöÄ Next Steps and Future Outlook</h2>

<h3 id="technology-development-directions">Technology Development Directions</h3>

<ol>
  <li><strong>Larger Models</strong>: Time series models with trillions of parameters</li>
  <li><strong>Multimodal</strong>: Integration of text, images, and time series</li>
  <li><strong>Real-time Learning</strong>: Continuous learning from streaming data</li>
  <li><strong>Explainability</strong>: Natural language explanations of predictions</li>
</ol>

<h3 id="practical-application-considerations">Practical Application Considerations</h3>

<ol>
  <li><strong>Data Quality</strong>: LLMs also need high-quality data</li>
  <li><strong>Cost Management</strong>: Monitor API usage</li>
  <li><strong>Model Updates</strong>: Regular retraining needed</li>
  <li><strong>Performance Monitoring</strong>: Continuous performance tracking</li>
</ol>

<h3 id="future-research-directions">Future Research Directions</h3>

<ol>
  <li><strong>Few-shot Learning</strong>: Learning with even less data</li>
  <li><strong>Transfer Learning</strong>: Knowledge transfer across domains</li>
  <li><strong>Causal Learning</strong>: Causality-based prediction</li>
  <li><strong>Uncertainty Quantification</strong>: Quantifying uncertainty</li>
</ol>

<h2 id="-learning-summary">üìö Learning Summary</h2>

<h3 id="what-we-learned-in-this-part">What We Learned in This Part</h3>

<ol>
  <li><strong>The Rise of LLM-based Time Series Forecasting</strong>
    <ul>
      <li>Limitations of previous models</li>
      <li>LLM‚Äôs revolutionary approach</li>
      <li>Core technical innovations</li>
    </ul>
  </li>
  <li><strong>Key Models</strong>
    <ul>
      <li><strong>TimeGPT</strong>: OpenAI‚Äôs commercial model</li>
      <li><strong>Lag-Llama</strong>: Open source alternative</li>
      <li><strong>Moirai</strong>: Multi-series forecasting</li>
      <li><strong>Chronos</strong>: Meta‚Äôs token-based model</li>
    </ul>
  </li>
  <li><strong>Practical Implementation</strong>
    <ul>
      <li>Lag-Llama model implementation</li>
      <li>Multi-series prediction</li>
      <li>Performance evaluation and comparison</li>
    </ul>
  </li>
</ol>

<h3 id="key-concepts-summary">Key Concepts Summary</h3>

<table>
  <thead>
    <tr>
      <th>Concept</th>
      <th>Description</th>
      <th>Importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Tokenization</strong></td>
      <td>Converting time series to tokens</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>Few-shot Learning</strong></td>
      <td>Learning with minimal data</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>Multi-task Learning</strong></td>
      <td>Performing multiple tasks simultaneously</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>Zero-shot Prediction</strong></td>
      <td>Prediction without additional training</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
  </tbody>
</table>

<h3 id="practical-application-considerations-1">Practical Application Considerations</h3>

<ol>
  <li><strong>Model Selection</strong>: Choose appropriate model based on requirements</li>
  <li><strong>Cost Management</strong>: Balance API costs and performance</li>
  <li><strong>Data Preparation</strong>: Importance of high-quality data</li>
  <li><strong>Performance Monitoring</strong>: Continuous model performance tracking</li>
</ol>

<hr />

<h2 id="-series-navigation">üîó Series Navigation</h2>

<p><strong>‚Üê Previous</strong>: <a href="/en_posts/2025-09-06-time-series-transformers.html">Part 3: Transformer-Based Time Series Forecasting Models</a></p>

<p><strong>Next ‚Üí</strong>: Series Complete! üéâ</p>

<hr />

<p><strong>Series Complete</strong>: We have systematically learned the evolution of time series forecasting from ARIMA to the latest LLM models. Now you can build powerful time series forecasting systems in practice using various tools and techniques! üöÄ</p>

<p><em>Through this series, we experienced the past, present, and future of time series forecasting. Understanding the characteristics and pros/cons of each model, we developed practical capabilities to apply them to real data!</em> üéØ</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
      
        
      
        
      
      
      
      
      
        
        
        <a href="/data-ai/2025/09/07/time-series-llm-models.html" class="nav-link next">
          Îã§Ïùå: Part 4: ÏµúÏã† ÏÉùÏÑ±Ìòï AI Î™®Îç∏Îì§ - TimeGPT, Lag-Llama, Moirai, Chronos ‚Üí
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-ai/" class="btn btn-secondary">
        üìö ÏãúÎ¶¨Ï¶à Ï†ÑÏ≤¥ Î≥¥Í∏∞
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>Îç∞Ïù¥ÌÑ∞ ÏóîÏßÄÎãàÏñ¥Í∞Ä Îã§Î£®Îäî Í∏∞Ïà† Î∏îÎ°úÍ∑∏</p>
      </div>
      
      <div class="footer-section">
        <h4>Categories</h4>
        <ul>
          <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
          <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
          <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
          <li><a href="/en/categories/data-quality/">Data Quality</a></li>
          <li><a href="/en/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Links</h4>
        <ul>
          <li><a href="/en/">Home</a></li>
          <li><a href="/en/blog/">Blog</a></li>
          <li><a href="/en/about/">About</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Social</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. All rights reserved</p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
