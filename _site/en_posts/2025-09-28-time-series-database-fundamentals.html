<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Complete guide to Time Series Database fundamentals, architecture, and optimization principles. Learn about InfluxDB, TimescaleDB, Prometheus, and practical implementation strategies.">



<title>Part 1: Time Series Database Fundamentals and Architecture - Complete Guide to Modern TDB - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 1: Time Series Database Fundamentals and Architecture - Complete Guide to Modern TDB">
<meta property="og:description" content="Complete guide to Time Series Database fundamentals, architecture, and optimization principles. Learn about InfluxDB, TimescaleDB, Prometheus, and practical implementation strategies.">
<meta property="og:url" content="http://localhost:4000/en_posts/2025-09-28-time-series-database-fundamentals.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 1: Time Series Database Fundamentals and Architecture - Complete Guide to Modern TDB">
<meta name="twitter:description" content="Complete guide to Time Series Database fundamentals, architecture, and optimization principles. Learn about InfluxDB, TimescaleDB, Prometheus, and practical implementation strategies.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="Î©îÎâ¥ Ïó¥Í∏∞/Îã´Í∏∞">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">Home</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">Categories</a>
            <ul class="dropdown-menu">

              <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
              <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
              <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
              <li><a href="/en/categories/data-quality/">Data Quality</a></li>
              <li><a href="/en/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/en/blog/">Blog</a></li>
        <li><a href="/en/about/">About</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- Ìè¨Ïä§Ìä∏Ïö© Ïñ∏Ïñ¥ Ï†ÑÌôò -->
        
          
          <a href="/data-engineering/2025/09/28/time-series-database-fundamentals.html" class="lang-btn">ÌïúÍµ≠Ïñ¥</a>
          <a href="/en_posts/2025-09-28-time-series-database-fundamentals.html" class="lang-btn active">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ÎÖÑ 09Ïõî 28Ïùº</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 1: Time Series Database Fundamentals and Architecture - Complete Guide to Modern TDB</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Time-Series-Database</span>
      
        <span class="tag">TDB</span>
      
        <span class="tag">InfluxDB</span>
      
        <span class="tag">TimescaleDB</span>
      
        <span class="tag">Prometheus</span>
      
        <span class="tag">IoT</span>
      
        <span class="tag">Real-time-Analytics</span>
      
        <span class="tag">Data-Architecture</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">üìö Time series database master ÏãúÎ¶¨Ï¶à</span>
      <span class="series-order">Part 2</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">‚è±Ô∏è 50 min</span>
      
      
        <span class="difficulty">üìä Intermediate</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h2 id="-introduction">üåü Introduction</h2>

<p>Time Series Database (TDB) is a specialized database optimized for time-stamped data, designed to handle high-frequency data generation and time-based queries efficiently. In today‚Äôs era of IoT, real-time monitoring, and big data analytics, TDB has become an essential technology for modern data engineering.</p>

<h3 id="what-youll-learn">What You‚Äôll Learn</h3>

<ul>
  <li><strong>TDB Fundamentals</strong>: Core concepts and characteristics of time series data</li>
  <li><strong>Architecture Analysis</strong>: Single-node vs distributed architecture comparison</li>
  <li><strong>Performance Optimization</strong>: Write/read optimization and compression strategies</li>
  <li><strong>Practical Implementation</strong>: Real-world IoT sensor data collection system</li>
  <li><strong>Solution Selection</strong>: How to choose the right TDB for your use case</li>
</ul>

<hr />

<h2 id="tdb-fundamentals-and-characteristics">üìä TDB Fundamentals and Characteristics</h2>

<h3 id="what-is-time-series-data">What is Time Series Data?</h3>

<p>Time series data is data that changes over time, where each data point has a timestamp. This type of data has unique characteristics that require specialized storage and processing approaches.</p>

<h4 id="core-characteristics-of-time-series-data">Core Characteristics of Time Series Data</h4>

<table>
  <thead>
    <tr>
      <th>Characteristic</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time-based Ordering</strong></td>
      <td>Data points are naturally ordered by time</td>
      <td>Sensor readings, stock prices, web traffic</td>
    </tr>
    <tr>
      <td><strong>High Frequency Generation</strong></td>
      <td>Large volumes of data generated continuously</td>
      <td>IoT sensors, application metrics, user activities</td>
    </tr>
    <tr>
      <td><strong>Immutable Nature</strong></td>
      <td>Historical data doesn‚Äôt change once recorded</td>
      <td>Temperature readings, log entries, transaction records</td>
    </tr>
    <tr>
      <td><strong>Compressibility</strong></td>
      <td>Similar values in time sequences can be compressed</td>
      <td>Temperature sensors with slow changes</td>
    </tr>
    <tr>
      <td><strong>Retention Policy</strong></td>
      <td>Automatic data lifecycle management needed</td>
      <td>Raw data: 30 days, Aggregated data: 1 year</td>
    </tr>
  </tbody>
</table>

<h4 id="performance-comparison-analysis">Performance Comparison Analysis</h4>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Traditional DB</th>
      <th>TDB</th>
      <th>Improvement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Write Throughput</strong></td>
      <td>1K-10K writes/sec</td>
      <td>100K-1M writes/sec</td>
      <td><strong>10-100x</strong></td>
    </tr>
    <tr>
      <td><strong>Compression Ratio</strong></td>
      <td>2:1 ~ 3:1</td>
      <td>10:1 ~ 100:1</td>
      <td><strong>5-30x</strong></td>
    </tr>
    <tr>
      <td><strong>Query Response Time</strong></td>
      <td>Complex SQL, slow response</td>
      <td>Simple time range queries, fast response</td>
      <td><strong>10-100x</strong></td>
    </tr>
    <tr>
      <td><strong>Storage Cost</strong></td>
      <td>High storage costs</td>
      <td>Cost savings through compression</td>
      <td><strong>50-90% savings</strong></td>
    </tr>
    <tr>
      <td><strong>Operational Complexity</strong></td>
      <td>Manual management required</td>
      <td>Automated management</td>
      <td><strong>Significantly improved operational efficiency</strong></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="tdb-architecture-and-core-components">üèóÔ∏è TDB Architecture and Core Components</h2>

<h3 id="single-node-architecture">Single Node Architecture</h3>

<h4 id="architecture-components">Architecture Components</h4>

<table>
  <thead>
    <tr>
      <th>Layer</th>
      <th>Component</th>
      <th>Technology Stack</th>
      <th>Features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Data Collection</strong></td>
      <td>MQTT Broker, Message Queue, Data Ingestion</td>
      <td>Eclipse Mosquitto, Apache Kafka, InfluxDB</td>
      <td>Horizontal scalability</td>
    </tr>
    <tr>
      <td><strong>Data Storage</strong></td>
      <td>Time Series DB, Data Compression, Retention Policy</td>
      <td>InfluxDB Cluster, TSM Compression, Automated Cleanup</td>
      <td>50:1 compression ratio</td>
    </tr>
    <tr>
      <td><strong>Data Processing</strong></td>
      <td>Real-time Analytics, Alert Engine, Data Aggregation</td>
      <td>Apache Flink, Custom Alert Rules, Time Window Functions</td>
      <td>&lt; 100ms response time</td>
    </tr>
    <tr>
      <td><strong>Data Visualization</strong></td>
      <td>Dashboard, Real-time Charts, Alert Management</td>
      <td>Grafana, WebSocket, Push Notifications</td>
      <td>Real-time monitoring</td>
    </tr>
  </tbody>
</table>

<h4 id="single-node-tdb-components">Single Node TDB Components</h4>

<table>
  <thead>
    <tr>
      <th>Layer</th>
      <th>Component</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Ingestion</strong></td>
      <td>HTTP API</td>
      <td>REST API for data ingestion</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Message Queue</td>
      <td>Kafka, RabbitMQ integration</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Batch Processing</td>
      <td>Bulk data import</td>
    </tr>
    <tr>
      <td><strong>Storage</strong></td>
      <td>WAL</td>
      <td>Write-Ahead Logging</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Compression</td>
      <td>Columnar compression</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Indexing</td>
      <td>Time-based indexing</td>
    </tr>
    <tr>
      <td><strong>Query</strong></td>
      <td>Optimization</td>
      <td>Time range query optimization</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Aggregation</td>
      <td>Built-in aggregation functions</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Caching</td>
      <td>Query result caching</td>
    </tr>
  </tbody>
</table>

<h4 id="data-processing-flow">Data Processing Flow</h4>

<table>
  <thead>
    <tr>
      <th>Step</th>
      <th>Process</th>
      <th>Description</th>
      <th>Optimization Elements</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Step 1</strong></td>
      <td>Data Reception (Ingestion Layer)</td>
      <td>Data collection via HTTP API, message queues</td>
      <td>Batch processing, connection pooling</td>
    </tr>
    <tr>
      <td><strong>Step 2</strong></td>
      <td>Format Validation &amp; Preprocessing</td>
      <td>Data validation, format conversion</td>
      <td>Fast validation algorithms</td>
    </tr>
    <tr>
      <td><strong>Step 3</strong></td>
      <td>WAL Write Log Recording</td>
      <td>Durability guarantee through Write-Ahead Logging</td>
      <td>Sequential write optimization</td>
    </tr>
    <tr>
      <td><strong>Step 4</strong></td>
      <td>Temporary Storage in Memory Buffer</td>
      <td>Memory caching for fast response</td>
      <td>Buffer size optimization</td>
    </tr>
    <tr>
      <td><strong>Step 5</strong></td>
      <td>Batch Flush to Disk</td>
      <td>Efficient disk I/O</td>
      <td>Batch size adjustment</td>
    </tr>
    <tr>
      <td><strong>Step 6</strong></td>
      <td>Compression &amp; Indexing</td>
      <td>Storage space saving and query optimization</td>
      <td>Compression algorithm selection</td>
    </tr>
    <tr>
      <td><strong>Step 7</strong></td>
      <td>Query Engine Access</td>
      <td>Ready for user query processing</td>
      <td>Index optimization</td>
    </tr>
  </tbody>
</table>

<h3 id="distributed-architecture">Distributed Architecture</h3>

<h4 id="distributed-architecture-components">Distributed Architecture Components</h4>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Role</th>
      <th>Features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Load Balancer</strong></td>
      <td>Request Distribution</td>
      <td>Load distribution across multiple nodes</td>
    </tr>
    <tr>
      <td><strong>Coordinator</strong></td>
      <td>Cluster Management</td>
      <td>Metadata, routing</td>
    </tr>
    <tr>
      <td><strong>Storage Nodes</strong></td>
      <td>Data Storage</td>
      <td>Sharded data storage</td>
    </tr>
    <tr>
      <td><strong>Query Coordinator</strong></td>
      <td>Distributed Queries</td>
      <td>Merging results from multiple nodes</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="storage-formats-and-compression-strategies">üóÑÔ∏è Storage Formats and Compression Strategies</h2>

<h3 id="row-based-vs-column-based-storage">Row-based vs Column-based Storage</h3>

<h4 id="storage-structure-comparison">Storage Structure Comparison</h4>

<table>
  <thead>
    <tr>
      <th>Storage Method</th>
      <th>Data Structure</th>
      <th>Compression Ratio</th>
      <th>Query Performance</th>
      <th>Features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Row-based</strong></td>
      <td><code class="language-plaintext highlighter-rouge">[timestamp1, sensor_id1, temp1, humidity1]</code><br /><code class="language-plaintext highlighter-rouge">[timestamp2, sensor_id2, temp2, humidity2]</code><br /><code class="language-plaintext highlighter-rouge">[timestamp3, sensor_id3, temp3, humidity3]</code></td>
      <td>2:1 ~ 5:1</td>
      <td>Single record: Fast<br />Aggregation: Slow</td>
      <td>Each row stored contiguously</td>
    </tr>
    <tr>
      <td><strong>Column-based</strong></td>
      <td><code class="language-plaintext highlighter-rouge">timestamps: [timestamp1, timestamp2, timestamp3]</code><br /><code class="language-plaintext highlighter-rouge">sensor_ids: [sensor_id1, sensor_id2, sensor_id3]</code><br /><code class="language-plaintext highlighter-rouge">temperatures: [temp1, temp2, temp3]</code><br /><code class="language-plaintext highlighter-rouge">humidities: [humidity1, humidity2, humidity3]</code></td>
      <td>10:1 ~ 100:1</td>
      <td>Single record: Slow<br />Aggregation: Fast</td>
      <td>Each column stored contiguously</td>
    </tr>
  </tbody>
</table>

<h3 id="compression-algorithms">Compression Algorithms</h3>

<h4 id="compression-algorithm-comparison">Compression Algorithm Comparison</h4>

<table>
  <thead>
    <tr>
      <th>Algorithm</th>
      <th>Compression Ratio</th>
      <th>Speed</th>
      <th>Use Case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>RLE</strong></td>
      <td>High</td>
      <td>Very Fast</td>
      <td>Constant values</td>
    </tr>
    <tr>
      <td><strong>LZ4</strong></td>
      <td>Medium</td>
      <td>Very Fast</td>
      <td>Real-time compression</td>
    </tr>
    <tr>
      <td><strong>ZSTD</strong></td>
      <td>High</td>
      <td>Fast</td>
      <td>Balanced performance</td>
    </tr>
    <tr>
      <td><strong>GZIP</strong></td>
      <td>High</td>
      <td>Slow</td>
      <td>High compression ratio needed</td>
    </tr>
    <tr>
      <td><strong>Delta Compression</strong></td>
      <td>Very High</td>
      <td>Fast</td>
      <td>Time series specific</td>
    </tr>
  </tbody>
</table>

<h4 id="detailed-compression-algorithm-comparison">Detailed Compression Algorithm Comparison</h4>

<table>
  <thead>
    <tr>
      <th>Algorithm</th>
      <th>Principle</th>
      <th>Example</th>
      <th>Compression Ratio</th>
      <th>Speed</th>
      <th>Optimal Use</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Compression</strong></td>
      <td>Store only differences between consecutive values</td>
      <td>Original: [100, 102, 101, 103, 102]<br />Compressed: [100, +2, -1, +2, -1]</td>
      <td>50:1 ~ 1000:1</td>
      <td>Fast</td>
      <td>Time series data</td>
    </tr>
    <tr>
      <td><strong>LZ4</strong></td>
      <td>Duplicate pattern compression</td>
      <td>General compression algorithm</td>
      <td>3:1 ~ 10:1</td>
      <td>Very Fast</td>
      <td>Real-time compression</td>
    </tr>
  </tbody>
</table>

<h4 id="time-series-specific-compression-strategies">Time Series Specific Compression Strategies</h4>

<table>
  <thead>
    <tr>
      <th>Compression Technique</th>
      <th>Description</th>
      <th>Application Scenario</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Encoding</strong></td>
      <td>Store differences between consecutive values</td>
      <td>Slowly changing sensor data</td>
    </tr>
    <tr>
      <td><strong>Run Length Encoding</strong></td>
      <td>Compress consecutive identical values</td>
      <td>Data with many constant values</td>
    </tr>
    <tr>
      <td><strong>Dictionary Compression</strong></td>
      <td>Dictionary compression for repeated values</td>
      <td>Data with repetitive patterns</td>
    </tr>
  </tbody>
</table>

<h4 id="compression-efficiency-analysis">Compression Efficiency Analysis</h4>

<table>
  <thead>
    <tr>
      <th>Data Characteristic</th>
      <th>Impact on Compression Ratio</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Volatility</strong></td>
      <td>Lower volatility = higher compression ratio</td>
      <td>Similar consecutive values improve compression efficiency</td>
    </tr>
    <tr>
      <td><strong>Pattern</strong></td>
      <td>Repetitive patterns = higher compression ratio</td>
      <td>Periodic or predictable patterns</td>
    </tr>
    <tr>
      <td><strong>Precision</strong></td>
      <td>Lower precision = higher compression ratio</td>
      <td>Fewer decimal places improve compression efficiency</td>
    </tr>
  </tbody>
</table>

<h4 id="recommended-compression-algorithms">Recommended Compression Algorithms</h4>

<table>
  <thead>
    <tr>
      <th>Data Characteristic</th>
      <th>Recommended Algorithm</th>
      <th>Reason</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Low Volatility</strong></td>
      <td>Delta Compression</td>
      <td>Small differences between consecutive values achieve highest compression</td>
    </tr>
    <tr>
      <td><strong>High Volatility</strong></td>
      <td>LZ4 or ZSTD</td>
      <td>General compression with appropriate efficiency</td>
    </tr>
    <tr>
      <td><strong>Real-time Processing</strong></td>
      <td>LZ4</td>
      <td>Fast compression/decompression speed</td>
    </tr>
    <tr>
      <td><strong>Storage Optimization</strong></td>
      <td>ZSTD or GZIP</td>
      <td>High compression ratio for storage space saving</td>
    </tr>
  </tbody>
</table>

<h4 id="compression-effect-analysis">Compression Effect Analysis</h4>

<table>
  <thead>
    <tr>
      <th>Data Pattern</th>
      <th>Optimal Compression Technique</th>
      <th>Effect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Constant Values</strong></td>
      <td>RLE (Run Length Encoding)</td>
      <td>Compress consecutive identical values</td>
    </tr>
    <tr>
      <td><strong>Linear Trends</strong></td>
      <td>Delta Encoding</td>
      <td>Store differences between consecutive values</td>
    </tr>
    <tr>
      <td><strong>Repetitive Patterns</strong></td>
      <td>Dictionary Compression</td>
      <td>Dictionary compression for repeated values</td>
    </tr>
    <tr>
      <td><strong>Random Values</strong></td>
      <td>General Compression (LZ4, ZSTD)</td>
      <td>General compression algorithms</td>
    </tr>
  </tbody>
</table>

<h4 id="actual-data-type-compression-ratios">Actual Data Type Compression Ratios</h4>

<table>
  <thead>
    <tr>
      <th>Data Type</th>
      <th>Compression Ratio</th>
      <th>Characteristics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Temperature Sensor</strong></td>
      <td>20:1 ~ 50:1</td>
      <td>Slowly changing, high compression ratio</td>
    </tr>
    <tr>
      <td><strong>CPU Usage</strong></td>
      <td>10:1 ~ 30:1</td>
      <td>Medium volatility, moderate compression ratio</td>
    </tr>
    <tr>
      <td><strong>Network Traffic</strong></td>
      <td>5:1 ~ 15:1</td>
      <td>High volatility, low compression ratio</td>
    </tr>
    <tr>
      <td><strong>Error Logs</strong></td>
      <td>2:1 ~ 5:1</td>
      <td>High randomness, low compression ratio</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="tdb-performance-characteristics-and-optimization-principles">‚ö° TDB Performance Characteristics and Optimization Principles</h2>

<h3 id="write-performance-optimization">Write Performance Optimization</h3>

<h4 id="batch-writing">Batch Writing</h4>

<table>
  <thead>
    <tr>
      <th>Method</th>
      <th>Description</th>
      <th>Performance Improvement</th>
      <th>Implementation Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Memory Buffer</strong></td>
      <td>Temporary storage in memory buffer</td>
      <td>10-100x</td>
      <td>WAL + memory queue</td>
    </tr>
    <tr>
      <td><strong>Compression Batch</strong></td>
      <td>Compress multiple points then store</td>
      <td>5-20x</td>
      <td>Apply compression algorithms</td>
    </tr>
    <tr>
      <td><strong>Index Delay</strong></td>
      <td>Batch index updates</td>
      <td>3-10x</td>
      <td>Batch indexing</td>
    </tr>
  </tbody>
</table>

<h4 id="optimized-write-processing-strategies">Optimized Write Processing Strategies</h4>

<table>
  <thead>
    <tr>
      <th>Optimization Method</th>
      <th>Description</th>
      <th>Benefits</th>
      <th>Performance Improvement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Memory Buffering</strong></td>
      <td>Store in memory buffer in batches</td>
      <td>Reduced disk I/O, improved compression efficiency, optimized index updates</td>
      <td>10-100x</td>
    </tr>
    <tr>
      <td><strong>Compression Batching</strong></td>
      <td>Compress multiple points together</td>
      <td>Improved compression ratio, reduced compression overhead, storage space saving</td>
      <td>5-20x</td>
    </tr>
    <tr>
      <td><strong>Index Delay</strong></td>
      <td>Delay index updates</td>
      <td>Reduced write latency, prevent index fragmentation, batch processing efficiency</td>
      <td>3-10x</td>
    </tr>
  </tbody>
</table>

<h3 id="compression-optimization">Compression Optimization</h3>

<h4 id="compression-effect-analysis-1">Compression Effect Analysis</h4>

<table>
  <thead>
    <tr>
      <th>Data Pattern</th>
      <th>Optimal Compression Technique</th>
      <th>Effect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Constant Values</strong></td>
      <td>RLE (Run Length Encoding)</td>
      <td>Compress consecutive identical values</td>
    </tr>
    <tr>
      <td><strong>Linear Trends</strong></td>
      <td>Delta Encoding</td>
      <td>Store differences between consecutive values</td>
    </tr>
    <tr>
      <td><strong>Repetitive Patterns</strong></td>
      <td>Dictionary Compression</td>
      <td>Dictionary compression for repeated values</td>
    </tr>
    <tr>
      <td><strong>Random Values</strong></td>
      <td>General Compression (LZ4, ZSTD)</td>
      <td>General compression algorithms</td>
    </tr>
  </tbody>
</table>

<h4 id="actual-data-type-compression-ratios-1">Actual Data Type Compression Ratios</h4>

<table>
  <thead>
    <tr>
      <th>Data Type</th>
      <th>Compression Ratio</th>
      <th>Characteristics</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Temperature Sensor</strong></td>
      <td>20:1 ~ 50:1</td>
      <td>Slowly changing, high compression ratio</td>
    </tr>
    <tr>
      <td><strong>CPU Usage</strong></td>
      <td>10:1 ~ 30:1</td>
      <td>Medium volatility, moderate compression ratio</td>
    </tr>
    <tr>
      <td><strong>Network Traffic</strong></td>
      <td>5:1 ~ 15:1</td>
      <td>High volatility, low compression ratio</td>
    </tr>
    <tr>
      <td><strong>Error Logs</strong></td>
      <td>2:1 ~ 5:1</td>
      <td>High randomness, low compression ratio</td>
    </tr>
  </tbody>
</table>

<h3 id="read-performance-optimization">Read Performance Optimization</h3>

<h4 id="indexing-strategies">Indexing Strategies</h4>

<table>
  <thead>
    <tr>
      <th>Index Type</th>
      <th>Description</th>
      <th>Performance Characteristics</th>
      <th>Use Cases</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time Index</strong></td>
      <td>Time range based</td>
      <td>Time query optimization</td>
      <td>Range queries</td>
    </tr>
    <tr>
      <td><strong>Tag Index</strong></td>
      <td>Metadata based</td>
      <td>Filtering optimization</td>
      <td>Multi-dimensional queries</td>
    </tr>
    <tr>
      <td><strong>Composite Index</strong></td>
      <td>Time + tags</td>
      <td>Complex condition optimization</td>
      <td>Complex queries</td>
    </tr>
  </tbody>
</table>

<h4 id="index-type-characteristics">Index Type Characteristics</h4>

<table>
  <thead>
    <tr>
      <th>Index Type</th>
      <th>Structure</th>
      <th>Benefits</th>
      <th>Memory Usage</th>
      <th>Maintenance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time Index</strong></td>
      <td>B+ Tree on timestamp</td>
      <td>Time range queries O(log n)</td>
      <td>Medium</td>
      <td>Low</td>
    </tr>
    <tr>
      <td><strong>Tag Index</strong></td>
      <td>Inverted index on tags</td>
      <td>Tag filtering O(1)</td>
      <td>High</td>
      <td>High</td>
    </tr>
    <tr>
      <td><strong>Composite Index</strong></td>
      <td>Multi-column index</td>
      <td>Complex condition optimization</td>
      <td>Very High</td>
      <td>Very High</td>
    </tr>
  </tbody>
</table>

<h4 id="query-pattern-based-indexing-recommendations">Query Pattern Based Indexing Recommendations</h4>

<table>
  <thead>
    <tr>
      <th>Query Pattern</th>
      <th>Primary Index</th>
      <th>Secondary Index</th>
      <th>Optimization Strategy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time Range Queries</strong></td>
      <td>Time index</td>
      <td>Tag index for filtering</td>
      <td>Partitioning + time index</td>
    </tr>
    <tr>
      <td><strong>Tag Filtering</strong></td>
      <td>Tag index</td>
      <td>Time index for range</td>
      <td>Consider tag cardinality</td>
    </tr>
    <tr>
      <td><strong>Aggregation Queries</strong></td>
      <td>Time index + pre-aggregation</td>
      <td>Materialized views</td>
      <td>Time window based aggregation</td>
    </tr>
  </tbody>
</table>

<h4 id="query-optimization">Query Optimization</h4>

<h4 id="query-optimization-techniques">Query Optimization Techniques</h4>

<table>
  <thead>
    <tr>
      <th>Optimization Technique</th>
      <th>Description</th>
      <th>Effect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Predicate Pushdown</strong></td>
      <td>Push conditions to storage layer</td>
      <td>Prevent unnecessary data scanning</td>
    </tr>
    <tr>
      <td><strong>Column Pruning</strong></td>
      <td>Read only necessary columns</td>
      <td>I/O optimization</td>
    </tr>
    <tr>
      <td><strong>Time Range Optimization</strong></td>
      <td>Time range based partition pruning</td>
      <td>Scan only relevant partitions</td>
    </tr>
    <tr>
      <td><strong>Parallel Execution</strong></td>
      <td>Parallel processing of multiple partitions</td>
      <td>Improved processing speed</td>
    </tr>
  </tbody>
</table>

<h4 id="query-optimization-strategies">Query Optimization Strategies</h4>

<table>
  <thead>
    <tr>
      <th>Query Type</th>
      <th>Optimization Strategy</th>
      <th>Example Query</th>
      <th>Performance Improvement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Time Range Queries</strong></td>
      <td>Partition pruning + index utilization</td>
      <td><code class="language-plaintext highlighter-rouge">SELECT avg(temperature) FROM sensor_data WHERE time &gt;= '2025-01-01' AND time &lt; '2025-01-02'</code></td>
      <td><strong>10-100x</strong></td>
    </tr>
    <tr>
      <td><strong>Aggregation Queries</strong></td>
      <td>Pre-aggregation + caching</td>
      <td><code class="language-plaintext highlighter-rouge">SELECT time_bucket('1h', time), avg(temperature) FROM sensor_data GROUP BY time_bucket('1h', time)</code></td>
      <td><strong>5-50x</strong></td>
    </tr>
  </tbody>
</table>

<h4 id="optimization-technique-descriptions">Optimization Technique Descriptions</h4>

<table>
  <thead>
    <tr>
      <th>Technique</th>
      <th>Description</th>
      <th>Effect</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Partition Pruning</strong></td>
      <td>Scan only relevant date partitions</td>
      <td>Remove unnecessary data scanning</td>
    </tr>
    <tr>
      <td><strong>Pre-aggregation</strong></td>
      <td>Pre-calculate based on time windows</td>
      <td>Minimize real-time aggregation operations</td>
    </tr>
    <tr>
      <td><strong>Caching</strong></td>
      <td>Store frequently used results</td>
      <td>Reduce repeated query response time</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="practical-project-iot-sensor-data-collection-system">üöÄ Practical Project: IoT Sensor Data Collection System</h2>

<h3 id="hands-on-influxdb-installation-and-basic-setup">Hands-on: InfluxDB Installation and Basic Setup</h3>

<h4 id="1-influxdb-installation-and-initial-configuration">1. InfluxDB Installation and Initial Configuration</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>
<span class="c"># influxdb-setup.sh</span>

<span class="nb">echo</span> <span class="s2">"üöÄ Starting InfluxDB installation and setup..."</span>

<span class="c"># Install InfluxDB using Docker</span>
docker run <span class="nt">-d</span> <span class="se">\</span>
  <span class="nt">--name</span> influxdb <span class="se">\</span>
  <span class="nt">-p</span> 8086:8086 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">DOCKER_INFLUXDB_INIT_MODE</span><span class="o">=</span>setup <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">DOCKER_INFLUXDB_INIT_USERNAME</span><span class="o">=</span>admin <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">DOCKER_INFLUXDB_INIT_PASSWORD</span><span class="o">=</span>admin123 <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">DOCKER_INFLUXDB_INIT_ORG</span><span class="o">=</span>myorg <span class="se">\</span>
  <span class="nt">-e</span> <span class="nv">DOCKER_INFLUXDB_INIT_BUCKET</span><span class="o">=</span>mybucket <span class="se">\</span>
  influxdb:2.7-alpine

<span class="c"># Wait for service startup</span>
<span class="nb">echo</span> <span class="s2">"‚è≥ Waiting for InfluxDB to start..."</span>
<span class="nb">sleep </span>10

<span class="c"># Health check</span>
<span class="nb">echo</span> <span class="s2">"üîç Checking InfluxDB status..."</span>
curl <span class="nt">-f</span> http://localhost:8086/health

<span class="k">if</span> <span class="o">[</span> <span class="nv">$?</span> <span class="nt">-eq</span> 0 <span class="o">]</span><span class="p">;</span> <span class="k">then
    </span><span class="nb">echo</span> <span class="s2">"‚úÖ InfluxDB started successfully!"</span>
    <span class="nb">echo</span> <span class="s2">"üåê Web UI: http://localhost:8086"</span>
    <span class="nb">echo</span> <span class="s2">"üë§ Username: admin"</span>
    <span class="nb">echo</span> <span class="s2">"üîë Password: admin123"</span>
<span class="k">else
    </span><span class="nb">echo</span> <span class="s2">"‚ùå Failed to start InfluxDB."</span>
    <span class="nb">exit </span>1
<span class="k">fi</span>
</code></pre></div></div>

<h4 id="2-data-collection-using-python-client">2. Data Collection using Python Client</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># sensor_data_collector.py
</span><span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">random</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="n">influxdb_client</span> <span class="kn">import</span> <span class="n">InfluxDBClient</span><span class="p">,</span> <span class="n">Point</span>
<span class="kn">from</span> <span class="n">influxdb_client.client.write_api</span> <span class="kn">import</span> <span class="n">SYNCHRONOUS</span>
<span class="kn">import</span> <span class="n">logging</span>

<span class="k">class</span> <span class="nc">SensorDataCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># InfluxDB client configuration
</span>        <span class="n">self</span><span class="p">.</span><span class="n">client</span> <span class="o">=</span> <span class="nc">InfluxDBClient</span><span class="p">(</span>
            <span class="n">url</span><span class="o">=</span><span class="sh">"</span><span class="s">http://localhost:8086</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">token</span><span class="o">=</span><span class="sh">"</span><span class="s">admin-token</span><span class="sh">"</span><span class="p">,</span>  <span class="c1"># Replace with actual token
</span>            <span class="n">org</span><span class="o">=</span><span class="sh">"</span><span class="s">myorg</span><span class="sh">"</span>
        <span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">write_api</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">write_api</span><span class="p">(</span><span class="n">write_options</span><span class="o">=</span><span class="n">SYNCHRONOUS</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">query_api</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">client</span><span class="p">.</span><span class="nf">query_api</span><span class="p">()</span>
        
        <span class="c1"># Logging configuration
</span>        <span class="n">logging</span><span class="p">.</span><span class="nf">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_sensor_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensor_id</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">sensor_type</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Sensor data generation simulator</span><span class="sh">"""</span>
        
        <span class="c1"># Data ranges by sensor type
</span>        <span class="n">ranges</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span>    <span class="c1"># Temperature (Celsius)
</span>            <span class="sh">'</span><span class="s">humidity</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">),</span>       <span class="c1"># Humidity (%)
</span>            <span class="sh">'</span><span class="s">pressure</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1030</span><span class="p">),</span>   <span class="c1"># Pressure (hPa)
</span>            <span class="sh">'</span><span class="s">vibration</span><span class="sh">'</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>        <span class="c1"># Vibration (mm/s)
</span>        <span class="p">}</span>
        
        <span class="n">base_value</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">ranges</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">sensor_type</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)))</span>
        
        <span class="c1"># Simulate time-based variation (sine wave)
</span>        <span class="n">time_factor</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">/</span> <span class="mi">3600</span>  <span class="c1"># Hour units
</span>        <span class="n">variation</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="nf">abs</span><span class="p">(</span><span class="n">base_value</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        
        <span class="n">value</span> <span class="o">=</span> <span class="n">base_value</span> <span class="o">+</span> <span class="n">variation</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">measurement</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_data</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">tags</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">sensor_id</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="n">location</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">sensor_type</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">active</span><span class="sh">'</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">fields</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="nf">round</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">quality</span><span class="sh">'</span><span class="p">:</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">85</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">battery_level</span><span class="sh">'</span><span class="p">:</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">signal_strength</span><span class="sh">'</span><span class="p">:</span> <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">write_sensor_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_points</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Store sensor data to InfluxDB</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">data_points</span><span class="p">:</span>
                <span class="n">point</span> <span class="o">=</span> <span class="nc">Point</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">measurement</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">tag</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">tags</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">tag</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">tags</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">tag</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">tags</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">tag</span><span class="p">(</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">tags</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">fields</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">'</span><span class="s">quality</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">fields</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">quality</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">'</span><span class="s">battery_level</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">fields</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">battery_level</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">field</span><span class="p">(</span><span class="sh">'</span><span class="s">signal_strength</span><span class="sh">'</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">fields</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">signal_strength</span><span class="sh">'</span><span class="p">])</span> \
                    <span class="p">.</span><span class="nf">time</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">])</span>
                
                <span class="n">points</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
            
            <span class="c1"># Batch write
</span>            <span class="n">self</span><span class="p">.</span><span class="n">write_api</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">bucket</span><span class="o">=</span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
            
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="si">}</span><span class="s"> data points successfully stored.</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Data storage failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">query_sensor_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensor_type</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Query sensor data</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Build Flux query
</span>            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s">h)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            </span><span class="sh">'''</span>
            
            <span class="k">if</span> <span class="n">sensor_type</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">|&gt; filter(fn: (r) =&gt; r.sensor_type == </span><span class="sh">"</span><span class="si">{</span><span class="n">sensor_type</span><span class="si">}</span><span class="sh">"</span><span class="s">)</span><span class="se">\n</span><span class="sh">'</span>
            
            <span class="k">if</span> <span class="n">location</span><span class="p">:</span>
                <span class="n">query</span> <span class="o">+=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">|&gt; filter(fn: (r) =&gt; r.location == </span><span class="sh">"</span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="sh">"</span><span class="s">)</span><span class="se">\n</span><span class="sh">'</span>
            
            <span class="n">query</span> <span class="o">+=</span> <span class="sh">'</span><span class="s">|&gt; sort(columns: [</span><span class="sh">"</span><span class="s">_time</span><span class="sh">"</span><span class="s">], desc: true)</span><span class="se">\n</span><span class="sh">'</span>
            <span class="n">query</span> <span class="o">+=</span> <span class="sh">'</span><span class="s">|&gt; limit(n: 100)</span><span class="sh">'</span>
            
            <span class="c1"># Execute query
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">query_api</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            
            <span class="c1"># Convert results
</span>            <span class="n">data_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">table</span><span class="p">.</span><span class="n">records</span><span class="p">:</span>
                    <span class="n">data_points</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="nf">get_time</span><span class="p">(),</span>
                        <span class="sh">'</span><span class="s">measurement</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="nf">get_measurement</span><span class="p">(),</span>
                        <span class="sh">'</span><span class="s">field</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="nf">get_field</span><span class="p">(),</span>
                        <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="nf">get_value</span><span class="p">(),</span>
                        <span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">),</span>
                        <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">),</span>
                        <span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">record</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">)</span>
                    <span class="p">})</span>
            
            <span class="k">return</span> <span class="n">data_points</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Data query failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">get_statistics</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">sensor_type</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Get sensor data statistics</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'''</span><span class="s">
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s">h)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r.sensor_type == </span><span class="sh">"</span><span class="si">{</span><span class="n">sensor_type</span><span class="si">}</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r._field == </span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="s">)
            |&gt; group(columns: [</span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="s">])
            |&gt; mean()
            |&gt; yield(name: </span><span class="sh">"</span><span class="s">mean</span><span class="sh">"</span><span class="s">)
            
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s">h)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r.sensor_type == </span><span class="sh">"</span><span class="si">{</span><span class="n">sensor_type</span><span class="si">}</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r._field == </span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="s">)
            |&gt; group(columns: [</span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="s">])
            |&gt; max()
            |&gt; yield(name: </span><span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="s">)
            
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -</span><span class="si">{</span><span class="n">hours</span><span class="si">}</span><span class="s">h)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r.sensor_type == </span><span class="sh">"</span><span class="si">{</span><span class="n">sensor_type</span><span class="si">}</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r._field == </span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="s">)
            |&gt; group(columns: [</span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="s">])
            |&gt; min()
            |&gt; yield(name: </span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="s">)
            </span><span class="sh">'''</span>
            
            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">query_api</span><span class="p">.</span><span class="nf">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            
            <span class="n">stats</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">table_name</span> <span class="o">=</span> <span class="n">table</span><span class="p">.</span><span class="n">name</span>
                <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">table</span><span class="p">.</span><span class="n">records</span><span class="p">:</span>
                    <span class="n">location</span> <span class="o">=</span> <span class="n">record</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">location</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">:</span>
                        <span class="n">stats</span><span class="p">[</span><span class="n">location</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="n">stats</span><span class="p">[</span><span class="n">location</span><span class="p">][</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="p">.</span><span class="nf">get_value</span><span class="p">()</span>
            
            <span class="k">return</span> <span class="n">stats</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Statistics query failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">run_data_collection</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">duration_minutes</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run data collection</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">üîÑ Starting </span><span class="si">{</span><span class="n">duration_minutes</span><span class="si">}</span><span class="s">-minute sensor data collection...</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Sensor configuration
</span>        <span class="n">sensors</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_001</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">seoul</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_002</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">seoul</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">humidity</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_003</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">busan</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_004</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">busan</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">pressure</span><span class="sh">'</span><span class="p">},</span>
            <span class="p">{</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">sensor_005</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">daegu</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">vibration</span><span class="sh">'</span><span class="p">},</span>
        <span class="p">]</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="p">(</span><span class="n">duration_minutes</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="c1"># Generate data from each sensor
</span>            <span class="n">data_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sensor</span> <span class="ow">in</span> <span class="n">sensors</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_sensor_data</span><span class="p">(</span>
                    <span class="n">sensor</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">],</span> 
                    <span class="n">sensor</span><span class="p">[</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">],</span> 
                    <span class="n">sensor</span><span class="p">[</span><span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">data_points</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            
            <span class="c1"># Store data
</span>            <span class="n">self</span><span class="p">.</span><span class="nf">write_sensor_data</span><span class="p">(</span><span class="n">data_points</span><span class="p">)</span>
            
            <span class="c1"># Wait 5 seconds
</span>            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ Data collection completed!</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Print collection summary
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">print_collection_summary</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">print_collection_summary</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Print collection summary information</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">üìä Data Collection Summary</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        
        <span class="n">sensor_types</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">humidity</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pressure</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">vibration</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">sensor_type</span> <span class="ow">in</span> <span class="n">sensor_types</span><span class="p">:</span>
            <span class="n">stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_statistics</span><span class="p">(</span><span class="n">sensor_type</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">stats</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">üìà </span><span class="si">{</span><span class="n">sensor_type</span><span class="p">.</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s"> Sensor Statistics (Last 1 hour):</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">location</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">stats</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
                    <span class="n">mean_val</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">mean</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">max_val</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">max</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">min_val</span> <span class="o">=</span> <span class="n">values</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s">: avg=</span><span class="si">{</span><span class="n">mean_val</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">, max=</span><span class="si">{</span><span class="n">max_val</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">, min=</span><span class="si">{</span><span class="n">min_val</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Execution example
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">collector</span> <span class="o">=</span> <span class="nc">SensorDataCollector</span><span class="p">()</span>
    
    <span class="c1"># Run data collection (5 minutes)
</span>    <span class="n">collector</span><span class="p">.</span><span class="nf">run_data_collection</span><span class="p">(</span><span class="n">duration_minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># Query recent data
</span>    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">üîç Recent Temperature Sensor Data:</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">recent_data</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">query_sensor_data</span><span class="p">(</span><span class="n">sensor_type</span><span class="o">=</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">,</span> <span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">recent_data</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>  <span class="c1"># Print only recent 5
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="3-timescaledb-comparison-practice">3. TimescaleDB Comparison Practice</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># timescale_comparison.py
</span><span class="kn">import</span> <span class="n">psycopg2</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">class</span> <span class="nc">TimescaleComparison</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># TimescaleDB connection
</span>        <span class="n">self</span><span class="p">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span>
            <span class="n">host</span><span class="o">=</span><span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">database</span><span class="o">=</span><span class="sh">"</span><span class="s">timeseries</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">user</span><span class="o">=</span><span class="sh">"</span><span class="s">postgres</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">password</span><span class="o">=</span><span class="sh">"</span><span class="s">postgres</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cur</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">cursor</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="nf">setup_timescale</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">setup_timescale</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">TimescaleDB initial setup</span><span class="sh">"""</span>
        <span class="c1"># Enable TimescaleDB extension
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Create sensor data table
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            CREATE TABLE IF NOT EXISTS sensor_data (
                time TIMESTAMPTZ NOT NULL,
                sensor_id TEXT NOT NULL,
                location TEXT NOT NULL,
                sensor_type TEXT NOT NULL,
                value DOUBLE PRECISION NOT NULL,
                quality INTEGER NOT NULL,
                battery_level INTEGER NOT NULL,
                signal_strength INTEGER NOT NULL
            );
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="c1"># Convert to hypertable
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            SELECT create_hypertable(</span><span class="sh">'</span><span class="s">sensor_data</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">time</span><span class="sh">'</span><span class="s">, 
                                   if_not_exists =&gt; TRUE);
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="c1"># Create indexes
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            CREATE INDEX IF NOT EXISTS idx_sensor_data_sensor_type 
            ON sensor_data (sensor_type, time DESC);
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">‚úÖ TimescaleDB setup completed</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">insert_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">num_records</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Bulk data insertion test</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">üìù Testing </span><span class="si">{</span><span class="n">num_records</span><span class="si">}</span><span class="s"> record insertion...</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># Batch insert
</span>        <span class="n">insert_query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
            INSERT INTO sensor_data 
            (time, sensor_id, location, sensor_type, value, quality, battery_level, signal_strength)
            VALUES (%s, %s, %s, %s, %s, %s, %s, %s);
        </span><span class="sh">"""</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_records</span><span class="p">):</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">utcnow</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span>
                <span class="n">timestamp</span><span class="p">,</span>
                <span class="sa">f</span><span class="sh">'</span><span class="s">sensor_</span><span class="si">{</span><span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="si">:</span><span class="mi">03</span><span class="n">d</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">seoul</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">busan</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">daegu</span><span class="sh">'</span><span class="p">]),</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">([</span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">humidity</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">pressure</span><span class="sh">'</span><span class="p">]),</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                <span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">)</span>
            <span class="p">))</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">executemany</span><span class="p">(</span><span class="n">insert_query</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Insertion completed: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds (</span><span class="si">{</span><span class="n">num_records</span><span class="o">/</span><span class="n">duration</span><span class="si">:</span><span class="p">.</span><span class="mi">0</span><span class="n">f</span><span class="si">}</span><span class="s"> records/sec)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">duration</span>
    
    <span class="k">def</span> <span class="nf">query_performance_test</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Query performance test</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">üîç Query performance test...</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="n">queries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Recent 1 hour data</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">"""</span><span class="s">
                    SELECT * FROM sensor_data 
                    WHERE time &gt;= NOW() - INTERVAL </span><span class="sh">'</span><span class="s">1 hour</span><span class="sh">'</span><span class="s"> 
                    ORDER BY time DESC 
                    LIMIT 100;
                </span><span class="sh">"""</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Temperature sensor average</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">"""</span><span class="s">
                    SELECT location, AVG(value) as avg_temp
                    FROM sensor_data 
                    WHERE sensor_type = </span><span class="sh">'</span><span class="s">temperature</span><span class="sh">'</span><span class="s"> 
                    AND time &gt;= NOW() - INTERVAL </span><span class="sh">'</span><span class="s">1 hour</span><span class="sh">'</span><span class="s">
                    GROUP BY location;
                </span><span class="sh">"""</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Time window aggregation</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">"""</span><span class="s">
                    SELECT time_bucket(</span><span class="sh">'</span><span class="s">5 minutes</span><span class="sh">'</span><span class="s">, time) as bucket,
                           AVG(value) as avg_value
                    FROM sensor_data 
                    WHERE time &gt;= NOW() - INTERVAL </span><span class="sh">'</span><span class="s">1 hour</span><span class="sh">'</span><span class="s">
                    GROUP BY bucket
                    ORDER BY bucket;
                </span><span class="sh">"""</span>
            <span class="p">}</span>
        <span class="p">]</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">for</span> <span class="n">query_info</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            
            <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="n">query_info</span><span class="p">[</span><span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">])</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">fetchall</span><span class="p">()</span>
            
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            
            <span class="n">results</span><span class="p">[</span><span class="n">query_info</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">rows</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   </span><span class="si">{</span><span class="n">query_info</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds (</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="si">}</span><span class="s"> rows)</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">results</span>
    
    <span class="k">def</span> <span class="nf">compression_test</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Compression test</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">üóúÔ∏è Compression test...</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># Enable compression
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            ALTER TABLE sensor_data SET (
                timescaledb.compress,
                timescaledb.compress_segmentby = </span><span class="sh">'</span><span class="s">sensor_type, location</span><span class="sh">'</span><span class="s">
            );
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="c1"># Set compression policy
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            SELECT add_compression_policy(</span><span class="sh">'</span><span class="s">sensor_data</span><span class="sh">'</span><span class="s">, INTERVAL </span><span class="sh">'</span><span class="s">7 days</span><span class="sh">'</span><span class="s">);
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">commit</span><span class="p">()</span>
        
        <span class="c1"># Query compression statistics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"""</span><span class="s">
            SELECT 
                schemaname, tablename, 
                pg_size_pretty(pg_total_relation_size(schemaname||</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="s">||tablename)) as size
            FROM pg_tables 
            WHERE tablename = </span><span class="sh">'</span><span class="s">sensor_data</span><span class="sh">'</span><span class="s">;
        </span><span class="sh">"""</span><span class="p">)</span>
        
        <span class="n">size_info</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">fetchone</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   Table size: </span><span class="si">{</span><span class="n">size_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">size_info</span>
    
    <span class="k">def</span> <span class="nf">cleanup</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Cleanup</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cur</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">conn</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

<span class="c1"># Performance comparison execution
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">üöÄ TimescaleDB vs InfluxDB Performance Comparison</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="c1"># TimescaleDB test
</span>    <span class="n">tsdb</span> <span class="o">=</span> <span class="nc">TimescaleComparison</span><span class="p">()</span>
    
    <span class="c1"># Data insertion performance
</span>    <span class="n">insert_time</span> <span class="o">=</span> <span class="n">tsdb</span><span class="p">.</span><span class="nf">insert_data</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
    
    <span class="c1"># Query performance
</span>    <span class="n">query_results</span> <span class="o">=</span> <span class="n">tsdb</span><span class="p">.</span><span class="nf">query_performance_test</span><span class="p">()</span>
    
    <span class="c1"># Compression test
</span>    <span class="n">compression_info</span> <span class="o">=</span> <span class="n">tsdb</span><span class="p">.</span><span class="nf">compression_test</span><span class="p">()</span>
    
    <span class="n">tsdb</span><span class="p">.</span><span class="nf">cleanup</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">üìä Performance Comparison Results:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">   TimescaleDB insertion: </span><span class="si">{</span><span class="n">insert_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">   Query performance:</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">query_results</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">     </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">result</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">3</span><span class="n">f</span><span class="si">}</span><span class="s"> seconds</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="4-prometheus-metrics-collection-practice">4. Prometheus Metrics Collection Practice</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># prometheus_metrics.py
</span><span class="kn">from</span> <span class="n">prometheus_client</span> <span class="kn">import</span> <span class="n">Counter</span><span class="p">,</span> <span class="n">Histogram</span><span class="p">,</span> <span class="n">Gauge</span><span class="p">,</span> <span class="n">start_http_server</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="c1"># Prometheus metrics definition
</span><span class="n">sensor_data_total</span> <span class="o">=</span> <span class="nc">Counter</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_data_points_total</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Total sensor data points collected</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">])</span>
<span class="n">data_quality_gauge</span> <span class="o">=</span> <span class="nc">Gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_data_quality</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sensor data quality score</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">sensor_type</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">])</span>
<span class="n">battery_level_gauge</span> <span class="o">=</span> <span class="nc">Gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">sensor_battery_level</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Sensor battery level</span><span class="sh">'</span><span class="p">,</span> <span class="p">[</span><span class="sh">'</span><span class="s">sensor_id</span><span class="sh">'</span><span class="p">])</span>
<span class="n">collection_duration</span> <span class="o">=</span> <span class="nc">Histogram</span><span class="p">(</span><span class="sh">'</span><span class="s">data_collection_duration_seconds</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Time spent collecting data</span><span class="sh">'</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">PrometheusMetricsCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">influxdb_url</span><span class="o">=</span><span class="sh">"</span><span class="s">http://localhost:8086</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">influxdb_url</span> <span class="o">=</span> <span class="n">influxdb_url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">Authorization</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Token admin-token</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Content-Type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">application/json</span><span class="sh">'</span>
        <span class="p">}</span>
    
    <span class="nd">@collection_duration.time</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">collect_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Collect metrics from InfluxDB</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Query data from last 5 minutes
</span>            <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'''</span><span class="s">
                from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
                |&gt; range(start: -5m)
                |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
                |&gt; group(columns: [</span><span class="sh">"</span><span class="s">sensor_type</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="s">])
                |&gt; count()
                </span><span class="sh">'''</span>
            <span class="p">}</span>
            
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">influxdb_url</span><span class="si">}</span><span class="s">/api/v2/query</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">query</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
                
                <span class="c1"># Update metrics
</span>                <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">series</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">values</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">sensor_type</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># sensor_type tag
</span>                        <span class="n">location</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>     <span class="c1"># location tag
</span>                        <span class="n">count</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>        <span class="c1"># count value
</span>                        
                        <span class="n">sensor_data_total</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span>
                            <span class="n">sensor_type</span><span class="o">=</span><span class="n">sensor_type</span><span class="p">,</span>
                            <span class="n">location</span><span class="o">=</span><span class="n">location</span>
                        <span class="p">).</span><span class="nf">inc</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
                
                <span class="c1"># Quality score metrics
</span>                <span class="n">self</span><span class="p">.</span><span class="nf">collect_quality_metrics</span><span class="p">()</span>
                
                <span class="c1"># Battery level metrics
</span>                <span class="n">self</span><span class="p">.</span><span class="nf">collect_battery_metrics</span><span class="p">()</span>
                
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚úÖ Metrics collection completed: </span><span class="si">{</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Metrics collection failed: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">‚ùå Metrics collection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">collect_quality_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Collect quality score metrics</span><span class="sh">"""</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'''</span><span class="s">
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -5m)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r._field == </span><span class="sh">"</span><span class="s">quality</span><span class="sh">"</span><span class="s">)
            |&gt; group(columns: [</span><span class="sh">"</span><span class="s">sensor_type</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="s">])
            |&gt; mean()
            </span><span class="sh">'''</span>
        <span class="p">}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">influxdb_url</span><span class="si">}</span><span class="s">/api/v2/query</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">query</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
                
                <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">series</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">values</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">sensor_type</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">location</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">quality</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        
                        <span class="n">data_quality_gauge</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span>
                            <span class="n">sensor_type</span><span class="o">=</span><span class="n">sensor_type</span><span class="p">,</span>
                            <span class="n">location</span><span class="o">=</span><span class="n">location</span>
                        <span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="n">quality</span><span class="p">)</span>
                        
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Quality metrics collection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">collect_battery_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Collect battery level metrics</span><span class="sh">"""</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'''</span><span class="s">
            from(bucket: </span><span class="sh">"</span><span class="s">mybucket</span><span class="sh">"</span><span class="s">)
            |&gt; range(start: -5m)
            |&gt; filter(fn: (r) =&gt; r._measurement == </span><span class="sh">"</span><span class="s">sensor_data</span><span class="sh">"</span><span class="s">)
            |&gt; filter(fn: (r) =&gt; r._field == </span><span class="sh">"</span><span class="s">battery_level</span><span class="sh">"</span><span class="s">)
            |&gt; group(columns: [</span><span class="sh">"</span><span class="s">sensor_id</span><span class="sh">"</span><span class="s">])
            |&gt; last()
            </span><span class="sh">'''</span>
        <span class="p">}</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
                <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">influxdb_url</span><span class="si">}</span><span class="s">/api/v2/query</span><span class="sh">"</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">query</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
                
                <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">result</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">results</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">series</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">values</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
                        <span class="n">sensor_id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">battery_level</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                        
                        <span class="n">battery_level_gauge</span><span class="p">.</span><span class="nf">labels</span><span class="p">(</span>
                            <span class="n">sensor_id</span><span class="o">=</span><span class="n">sensor_id</span>
                        <span class="p">).</span><span class="nf">set</span><span class="p">(</span><span class="n">battery_level</span><span class="p">)</span>
                        
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Battery metrics collection error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">run_metrics_server</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Run metrics server</span><span class="sh">"""</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">üåê Starting Prometheus metrics server: http://localhost:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">/metrics</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">start_http_server</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">collect_metrics</span><span class="p">()</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>  <span class="c1"># Collect every 30 seconds
</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">collector</span> <span class="o">=</span> <span class="nc">PrometheusMetricsCollector</span><span class="p">()</span>
    <span class="n">collector</span><span class="p">.</span><span class="nf">run_metrics_server</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="project-overview">Project Overview</h3>

<p>Build a system that collects, stores, and analyzes data in real-time from a large-scale IoT sensor network.</p>

<h4 id="system-requirements">System Requirements</h4>

<table>
  <thead>
    <tr>
      <th>Requirement</th>
      <th>Specification</th>
      <th>Target</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Sensor Count</strong></td>
      <td>10,000+ sensors</td>
      <td>Scalable architecture</td>
    </tr>
    <tr>
      <td><strong>Data Volume</strong></td>
      <td>1M+ points/second</td>
      <td>High throughput</td>
    </tr>
    <tr>
      <td><strong>Response Time</strong></td>
      <td>&lt; 100ms</td>
      <td>Real-time processing</td>
    </tr>
    <tr>
      <td><strong>Availability</strong></td>
      <td>99.9%</td>
      <td>High reliability</td>
    </tr>
    <tr>
      <td><strong>Data Retention</strong></td>
      <td>30 days raw, 1 year aggregated</td>
      <td>Efficient storage</td>
    </tr>
  </tbody>
</table>

<h4 id="system-architecture-components">System Architecture Components</h4>

<table>
  <thead>
    <tr>
      <th>Layer</th>
      <th>Component</th>
      <th>Technology Stack</th>
      <th>Features</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Data Collection</strong></td>
      <td>MQTT Broker, Message Queue, Data Ingestion</td>
      <td>Eclipse Mosquitto, Apache Kafka, InfluxDB</td>
      <td>Horizontal scalability</td>
    </tr>
    <tr>
      <td><strong>Data Storage</strong></td>
      <td>Time Series DB, Data Compression, Retention Policy</td>
      <td>InfluxDB Cluster, TSM Compression, Automated Cleanup</td>
      <td>50:1 compression ratio</td>
    </tr>
    <tr>
      <td><strong>Data Processing</strong></td>
      <td>Real-time Analytics, Alert Engine, Data Aggregation</td>
      <td>Apache Flink, Custom Alert Rules, Time Window Functions</td>
      <td>&lt; 100ms response time</td>
    </tr>
    <tr>
      <td><strong>Data Visualization</strong></td>
      <td>Dashboard, Real-time Charts, Alert Management</td>
      <td>Grafana, WebSocket, Push Notifications</td>
      <td>Real-time monitoring</td>
    </tr>
  </tbody>
</table>

<h4 id="data-model-design">Data Model Design</h4>

<p><strong>Measurement</strong>: <code class="language-plaintext highlighter-rouge">sensor_data</code></p>

<table>
  <thead>
    <tr>
      <th>Category</th>
      <th>Field Name</th>
      <th>Description</th>
      <th>Data Type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Tags</strong></td>
      <td>sensor_id</td>
      <td>Unique sensor identifier</td>
      <td>String</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>location</td>
      <td>Sensor location (building, floor, zone)</td>
      <td>String</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>sensor_type</td>
      <td>Sensor type (temperature, humidity, pressure)</td>
      <td>String</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>manufacturer</td>
      <td>Manufacturer</td>
      <td>String</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>firmware_version</td>
      <td>Firmware version</td>
      <td>String</td>
    </tr>
    <tr>
      <td><strong>Fields</strong></td>
      <td>value</td>
      <td>Measurement value</td>
      <td>Float</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>quality</td>
      <td>Data quality score (0-100)</td>
      <td>Integer</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>battery_level</td>
      <td>Battery remaining (%)</td>
      <td>Float</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>signal_strength</td>
      <td>Signal strength (dBm)</td>
      <td>Float</td>
    </tr>
  </tbody>
</table>

<h4 id="data-retention-policy">Data Retention Policy</h4>

<table>
  <thead>
    <tr>
      <th>Data Type</th>
      <th>Retention Period</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Raw Data</strong></td>
      <td>30 days</td>
      <td>Real-time analysis, debugging</td>
    </tr>
    <tr>
      <td><strong>Hourly Aggregates</strong></td>
      <td>1 year</td>
      <td>Trend analysis, performance monitoring</td>
    </tr>
    <tr>
      <td><strong>Daily Aggregates</strong></td>
      <td>5 years</td>
      <td>Long-term trends, business intelligence</td>
    </tr>
  </tbody>
</table>

<h3 id="data-ingestion-pipeline-implementation">Data Ingestion Pipeline Implementation</h3>

<h4 id="pipeline-components">Pipeline Components</h4>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Role</th>
      <th>Technology Stack</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>MQTT Broker</strong></td>
      <td>Sensor data collection</td>
      <td>Eclipse Mosquitto</td>
    </tr>
    <tr>
      <td><strong>Kafka Producer</strong></td>
      <td>Message queuing</td>
      <td>Apache Kafka</td>
    </tr>
    <tr>
      <td><strong>InfluxDB Client</strong></td>
      <td>Time series data storage</td>
      <td>InfluxDB</td>
    </tr>
  </tbody>
</table>

<h4 id="pipeline-configuration">Pipeline Configuration</h4>

<table>
  <thead>
    <tr>
      <th>Component</th>
      <th>Setting</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>MQTT</strong></td>
      <td>Broker Host</td>
      <td>mqtt-broker.company.com:1883</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Topics</td>
      <td>sensors/+/temperature, sensors/+/humidity, sensors/+/pressure</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>QoS</td>
      <td>1</td>
    </tr>
    <tr>
      <td><strong>Kafka</strong></td>
      <td>Bootstrap Servers</td>
      <td>kafka1:9092, kafka2:9092</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Topic</td>
      <td>sensor-data-raw</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Partitions</td>
      <td>10</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Replication Factor</td>
      <td>3</td>
    </tr>
    <tr>
      <td><strong>InfluxDB</strong></td>
      <td>Host</td>
      <td>influxdb-cluster.company.com:8086</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Database</td>
      <td>iot_sensors</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Retention Policy</td>
      <td>30_days</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Batch Size</td>
      <td>5000</td>
    </tr>
    <tr>
      <td>¬†</td>
      <td>Flush Interval</td>
      <td>1000ms</td>
    </tr>
  </tbody>
</table>

<h4 id="sensor-data-validation-rules">Sensor Data Validation Rules</h4>

<table>
  <thead>
    <tr>
      <th>Validation Item</th>
      <th>Rule</th>
      <th>Threshold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Temperature Sensor</strong></td>
      <td>Value range</td>
      <td>-50¬∞C ~ 100¬∞C</td>
    </tr>
    <tr>
      <td><strong>Humidity Sensor</strong></td>
      <td>Value range</td>
      <td>0% ~ 100%</td>
    </tr>
    <tr>
      <td><strong>Pressure Sensor</strong></td>
      <td>Value range</td>
      <td>800hPa ~ 1200hPa</td>
    </tr>
    <tr>
      <td><strong>Data Quality</strong></td>
      <td>Quality score</td>
      <td>‚â• 80</td>
    </tr>
    <tr>
      <td><strong>Battery Level</strong></td>
      <td>Battery remaining</td>
      <td>‚â• 10%</td>
    </tr>
    <tr>
      <td><strong>Signal Strength</strong></td>
      <td>Signal strength</td>
      <td>‚â• -80dBm</td>
    </tr>
  </tbody>
</table>

<h3 id="real-time-analytics-and-alert-system">Real-time Analytics and Alert System</h3>

<h4 id="aggregation-window-settings">Aggregation Window Settings</h4>

<table>
  <thead>
    <tr>
      <th>Window Size</th>
      <th>Time (seconds)</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>1 minute</strong></td>
      <td>60</td>
      <td>Real-time monitoring</td>
    </tr>
    <tr>
      <td><strong>5 minutes</strong></td>
      <td>300</td>
      <td>Short-term trend analysis</td>
    </tr>
    <tr>
      <td><strong>1 hour</strong></td>
      <td>3600</td>
      <td>Medium-term pattern analysis</td>
    </tr>
    <tr>
      <td><strong>1 day</strong></td>
      <td>86400</td>
      <td>Long-term trend analysis</td>
    </tr>
  </tbody>
</table>

<h4 id="alert-rule-settings">Alert Rule Settings</h4>

<table>
  <thead>
    <tr>
      <th>Rule Name</th>
      <th>Condition</th>
      <th>Severity</th>
      <th>Notification Channel</th>
      <th>Cooldown</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Temperature Anomaly</strong></td>
      <td>temperature &gt; 35 OR temperature &lt; -10</td>
      <td>CRITICAL</td>
      <td>email, sms, slack</td>
      <td>5 minutes</td>
    </tr>
    <tr>
      <td><strong>Low Battery</strong></td>
      <td>battery_level &lt; 20</td>
      <td>WARNING</td>
      <td>email</td>
      <td>1 hour</td>
    </tr>
    <tr>
      <td><strong>Data Quality Issue</strong></td>
      <td>quality &lt; 80</td>
      <td>WARNING</td>
      <td>slack</td>
      <td>30 minutes</td>
    </tr>
    <tr>
      <td><strong>Sensor Offline</strong></td>
      <td>no_data_received &gt; 300 seconds</td>
      <td>CRITICAL</td>
      <td>email, sms</td>
      <td>10 minutes</td>
    </tr>
  </tbody>
</table>

<h4 id="real-time-analytics-processing-flow">Real-time Analytics Processing Flow</h4>

<table>
  <thead>
    <tr>
      <th>Processing Step</th>
      <th>Description</th>
      <th>Output</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Immediate Alerts</strong></td>
      <td>Real-time condition checking</td>
      <td>Alert events</td>
    </tr>
    <tr>
      <td><strong>Aggregated Metrics</strong></td>
      <td>Time window based calculations</td>
      <td>Average, max/min, variance</td>
    </tr>
    <tr>
      <td><strong>Trend Analysis</strong></td>
      <td>Pattern and anomaly detection</td>
      <td>Trend indicators</td>
    </tr>
  </tbody>
</table>

<h4 id="aggregation-metric-types">Aggregation Metric Types</h4>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Calculation Method</th>
      <th>Window Size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Moving Average</strong></td>
      <td>Average of consecutive values</td>
      <td>1 minute, 5 minutes</td>
    </tr>
    <tr>
      <td><strong>Max/Min</strong></td>
      <td>Extreme values within time range</td>
      <td>1 hour</td>
    </tr>
    <tr>
      <td><strong>Variance</strong></td>
      <td>Value variability</td>
      <td>5 minutes</td>
    </tr>
  </tbody>
</table>

<h3 id="performance-monitoring-and-optimization">Performance Monitoring and Optimization</h3>

<h4 id="performance-threshold-settings">Performance Threshold Settings</h4>

<table>
  <thead>
    <tr>
      <th>Metric</th>
      <th>Threshold</th>
      <th>Unit</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Ingestion Rate</strong></td>
      <td>1,000,000</td>
      <td>points/second</td>
      <td>Data collection throughput</td>
    </tr>
    <tr>
      <td><strong>Query Response Time</strong></td>
      <td>0.1</td>
      <td>seconds</td>
      <td>Query response time</td>
    </tr>
    <tr>
      <td><strong>Storage Utilization</strong></td>
      <td>0.8</td>
      <td>80%</td>
      <td>Storage space usage</td>
    </tr>
    <tr>
      <td><strong>Memory Usage</strong></td>
      <td>0.85</td>
      <td>85%</td>
      <td>Memory usage</td>
    </tr>
    <tr>
      <td><strong>CPU Usage</strong></td>
      <td>0.8</td>
      <td>80%</td>
      <td>CPU usage</td>
    </tr>
  </tbody>
</table>

<h4 id="performance-monitoring-metrics">Performance Monitoring Metrics</h4>

<table>
  <thead>
    <tr>
      <th>Monitoring Area</th>
      <th>Metrics</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Ingestion</strong></td>
      <td>Current Rate, Peak Rate, Failed Writes, Queue Depth</td>
      <td>Data collection performance</td>
    </tr>
    <tr>
      <td><strong>Query</strong></td>
      <td>Response Time, Throughput, Slow Queries, Cache Hit Rate</td>
      <td>Query performance</td>
    </tr>
    <tr>
      <td><strong>Storage</strong></td>
      <td>Disk Usage, Compression Ratio, Retention Effectiveness, Index Size</td>
      <td>Storage efficiency</td>
    </tr>
    <tr>
      <td><strong>Resource</strong></td>
      <td>Memory Usage, CPU Usage, Network I/O, Disk I/O</td>
      <td>System resources</td>
    </tr>
  </tbody>
</table>

<h4 id="automated-optimization-strategies">Automated Optimization Strategies</h4>

<table>
  <thead>
    <tr>
      <th>Optimization Type</th>
      <th>Condition</th>
      <th>Action</th>
      <th>Expected Improvement</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Write Optimization</strong></td>
      <td>Throughput threshold exceeded</td>
      <td>Increase batch size and compression</td>
      <td>20-30% throughput improvement</td>
    </tr>
    <tr>
      <td><strong>Query Optimization</strong></td>
      <td>Response time threshold exceeded</td>
      <td>Add indexes and pre-aggregation</td>
      <td>50-70% response time reduction</td>
    </tr>
    <tr>
      <td><strong>Storage Optimization</strong></td>
      <td>Storage space threshold exceeded</td>
      <td>Adjust retention policy and compression</td>
      <td>30-50% storage space saving</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="learning-summary">üìö Learning Summary</h2>

<h3 id="key-concepts-review">Key Concepts Review</h3>

<ol>
  <li><strong>Time Series Data Characteristics</strong>
    <ul>
      <li>Time-based ordering, high frequency generation, immutability</li>
      <li>Compressibility, retention policy necessity</li>
      <li>Overcoming limitations of traditional databases</li>
    </ul>
  </li>
  <li><strong>Major TDB Solutions</strong>
    <ul>
      <li><strong>InfluxDB</strong>: Time series dedicated, high performance</li>
      <li><strong>TimescaleDB</strong>: PostgreSQL based, SQL compatible</li>
      <li><strong>Prometheus</strong>: Metric focused, monitoring optimized</li>
      <li><strong>Cloud Services</strong>: Managed solutions</li>
    </ul>
  </li>
  <li><strong>TDB Architecture</strong>
    <ul>
      <li>Single node vs distributed architecture</li>
      <li>Row-based vs column-based storage</li>
      <li>Compression algorithms and indexing strategies</li>
    </ul>
  </li>
  <li><strong>Performance Optimization</strong>
    <ul>
      <li>Batch writing and compression optimization</li>
      <li>Time-based indexing and query optimization</li>
      <li>Real-time analytics and alert systems</li>
    </ul>
  </li>
  <li><strong>Practical Application</strong>
    <ul>
      <li>IoT sensor data collection system</li>
      <li>Real-time analytics and dashboards</li>
      <li>Performance monitoring and automated optimization</li>
    </ul>
  </li>
</ol>

<h3 id="next-steps">Next Steps</h3>

<p><strong>What we‚Äôll cover in Part 2:</strong></p>
<ul>
  <li>TDB advanced features and optimization techniques</li>
  <li>Distributed TDB cluster construction</li>
  <li>High availability and disaster recovery</li>
  <li>Advanced query optimization and performance tuning</li>
  <li>Integration with modern data platforms</li>
</ul>

<hr />

<h2 id="-key-takeaways">üéØ Key Takeaways</h2>

<ol>
  <li><strong>TDB is Essential</strong>: For modern IoT, monitoring, and real-time analytics applications</li>
  <li><strong>Architecture Matters</strong>: Choose between single-node and distributed based on scale requirements</li>
  <li><strong>Optimization is Key</strong>: Proper indexing, compression, and query optimization are crucial</li>
  <li><strong>Real-world Application</strong>: Practical implementation requires comprehensive system design</li>
  <li><strong>Continuous Monitoring</strong>: Performance monitoring and automated optimization ensure system reliability</li>
</ol>

<p>Time Series Database is not just a storage solution, but a comprehensive platform for time-based data processing. Understanding its fundamentals and optimization principles is essential for building efficient real-time data systems.</p>

<p><strong>Ready for Part 2?</strong> We‚Äôll dive deeper into advanced TDB features, distributed architecture, and production-ready optimization techniques! üöÄ</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
      
      
      
      
        
        
        <a href="/data-engineering/2025/09/29/time-series-database-integration-deployment.html" class="nav-link next">
          Îã§Ïùå: Part 3: Time Series Database ÌÜµÌï©Í≥º Î∞∞Ìè¨ - ÌòÑÎåÄÏ†Å TDB ÏÉùÌÉúÍ≥Ñ ÏôÑÏÑ± ‚Üí
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        üìö ÏãúÎ¶¨Ï¶à Ï†ÑÏ≤¥ Î≥¥Í∏∞
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>Îç∞Ïù¥ÌÑ∞ ÏóîÏßÄÎãàÏñ¥Í∞Ä Îã§Î£®Îäî Í∏∞Ïà† Î∏îÎ°úÍ∑∏</p>
      </div>
      
      <div class="footer-section">
        <h4>Categories</h4>
        <ul>
          <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
          <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
          <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
          <li><a href="/en/categories/data-quality/">Data Quality</a></li>
          <li><a href="/en/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Links</h4>
        <ul>
          <li><a href="/en/">Home</a></li>
          <li><a href="/en/blog/">Blog</a></li>
          <li><a href="/en/about/">About</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Social</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. All rights reserved</p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
