<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Learn Apache Spark's basic structure and core concepts including RDD, DataFrame, and Spark SQL through hands-on practice.">



<title>Part 1: Apache Spark Basics and Core Concepts - From RDD to DataFrame - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 1: Apache Spark Basics and Core Concepts - From RDD to DataFrame">
<meta property="og:description" content="Learn Apache Spark's basic structure and core concepts including RDD, DataFrame, and Spark SQL through hands-on practice.">
<meta property="og:url" content="http://localhost:4000/en_posts/2025-09-11-apache-spark-basics.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 1: Apache Spark Basics and Core Concepts - From RDD to DataFrame">
<meta name="twitter:description" content="Learn Apache Spark's basic structure and core concepts including RDD, DataFrame, and Spark SQL through hands-on practice.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="Î©îÎâ¥ Ïó¥Í∏∞/Îã´Í∏∞">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">Home</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">Categories</a>
            <ul class="dropdown-menu">

              <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
              <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
              <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
              <li><a href="/en/categories/data-quality/">Data Quality</a></li>
              <li><a href="/en/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/en/blog/">Blog</a></li>
        <li><a href="/en/about/">About</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- Ìè¨Ïä§Ìä∏Ïö© Ïñ∏Ïñ¥ Ï†ÑÌôò -->
        
          
          <a href="/data-engineering/2025/09/11/apache-spark-basics.html" class="lang-btn">ÌïúÍµ≠Ïñ¥</a>
          <a href="/en_posts/2025-09-11-apache-spark-basics.html" class="lang-btn active">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ÎÖÑ 09Ïõî 11Ïùº</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 1: Apache Spark Basics and Core Concepts - From RDD to DataFrame</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Spark</span>
      
        <span class="tag">RDD</span>
      
        <span class="tag">DataFrame</span>
      
        <span class="tag">Spark-SQL</span>
      
        <span class="tag">Big-Data-Processing</span>
      
        <span class="tag">Python</span>
      
        <span class="tag">PySpark</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">üìö Apache spark complete guide ÏãúÎ¶¨Ï¶à</span>
      <span class="series-order">Part 2</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">‚è±Ô∏è 30 min</span>
      
      
        <span class="difficulty">üìä Intermediate</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-1-apache-spark-basics-and-core-concepts---from-rdd-to-dataframe">Part 1: Apache Spark Basics and Core Concepts - From RDD to DataFrame</h1>

<blockquote>
  <p>Learn Apache Spark‚Äôs basic structure and core concepts including RDD, DataFrame, and Spark SQL through hands-on practice.</p>
</blockquote>

<h2 id="-table-of-contents">üìñ Table of Contents</h2>

<ol>
  <li><a href="#understanding-spark-architecture">Understanding Spark Architecture</a></li>
  <li><a href="#rdd-resilient-distributed-dataset">RDD (Resilient Distributed Dataset)</a></li>
  <li><a href="#dataframe-and-dataset">DataFrame and Dataset</a></li>
  <li><a href="#spark-sql">Spark SQL</a></li>
  <li><a href="#hands-on-basic-data-processing">Hands-on: Basic Data Processing</a></li>
  <li><a href="#learning-summary">Learning Summary</a></li>
</ol>

<h2 id="Ô∏è-understanding-spark-architecture">üèóÔ∏è Understanding Spark Architecture</h2>

<h3 id="core-components">Core Components</h3>

<p>Apache Spark is a unified analytics engine for large-scale data processing. It consists of the following core components:</p>

<h4 id="1-driver-program"><strong>1. Driver Program</strong></h4>
<ul>
  <li><strong>Role</strong>: Executes the main function of the application</li>
  <li><strong>Function</strong>: Creates SparkContext, schedules tasks, collects results</li>
  <li><strong>Location</strong>: Runs on client node</li>
</ul>

<h4 id="2-cluster-manager"><strong>2. Cluster Manager</strong></h4>
<ul>
  <li><strong>Standalone</strong>: Spark‚Äôs own cluster manager</li>
  <li><strong>YARN</strong>: Resource manager in Hadoop ecosystem</li>
  <li><strong>Mesos</strong>: General-purpose cluster manager</li>
  <li><strong>Kubernetes</strong>: Container orchestration</li>
</ul>

<h4 id="3-worker-node"><strong>3. Worker Node</strong></h4>
<ul>
  <li><strong>Executor</strong>: JVM process that performs actual work</li>
  <li><strong>Task</strong>: Individual work unit executed in executor</li>
  <li><strong>Cache</strong>: Memory-based data storage</li>
</ul>

<h3 id="sparkcontext-and-sparksession">SparkContext and SparkSession</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">SparkContext</span><span class="p">,</span> <span class="n">SparkConf</span>
<span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="c1"># Create SparkContext (for RDD)
</span><span class="n">conf</span> <span class="o">=</span> <span class="nc">SparkConf</span><span class="p">().</span><span class="nf">setAppName</span><span class="p">(</span><span class="sh">"</span><span class="s">MyApp</span><span class="sh">"</span><span class="p">).</span><span class="nf">setMaster</span><span class="p">(</span><span class="sh">"</span><span class="s">local[*]</span><span class="sh">"</span><span class="p">)</span>
<span class="n">sc</span> <span class="o">=</span> <span class="nc">SparkContext</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>

<span class="c1"># Create SparkSession (for DataFrame/SQL)
</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">MyApp</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">master</span><span class="p">(</span><span class="sh">"</span><span class="s">local[*]</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Access SparkContext
</span><span class="n">sc_from_session</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span>
</code></pre></div></div>

<h2 id="-rdd-resilient-distributed-dataset">üîÑ RDD (Resilient Distributed Dataset)</h2>

<h3 id="what-is-rdd">What is RDD?</h3>

<p>RDD is Spark‚Äôs fundamental data abstraction. It is an <strong>immutable</strong>, <strong>distributed</strong>, and <strong>resilient</strong> dataset.</p>

<h4 id="rdd-characteristics"><strong>RDD Characteristics</strong></h4>
<ol>
  <li><strong>Immutability</strong>: Cannot be modified after creation, creates new RDDs through transformations</li>
  <li><strong>Distributed</strong>: Stored across multiple nodes</li>
  <li><strong>Resilient</strong>: Automatic recovery from failures (based on Lineage)</li>
  <li><strong>Lazy Evaluation</strong>: Delays actual computation until Action is called</li>
</ol>

<h3 id="rdd-creation-methods">RDD Creation Methods</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Create RDD from collection
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">numSlices</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Split into 4 partitions
</span>
<span class="c1"># 2. Create RDD from external files
</span><span class="n">rdd_text</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">textFile</span><span class="p">(</span><span class="sh">"</span><span class="s">hdfs://path/to/file.txt</span><span class="sh">"</span><span class="p">)</span>
<span class="n">rdd_csv</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">textFile</span><span class="p">(</span><span class="sh">"</span><span class="s">hdfs://path/to/file.csv</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. Transform from another RDD
</span><span class="n">rdd_transformed</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="basic-rdd-operations">Basic RDD Operations</h3>

<h4 id="transformation"><strong>Transformation</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Map: Apply function to each element
</span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">doubled</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">doubled</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>  <span class="c1"># [2, 4, 6, 8, 10]
</span>
<span class="c1"># Filter: Select elements that meet condition
</span><span class="n">evens</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">evens</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>  <span class="c1"># [2, 4]
</span>
<span class="c1"># FlatMap: Expand each element to multiple elements
</span><span class="n">words</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">([</span><span class="sh">"</span><span class="s">hello world</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">spark tutorial</span><span class="sh">"</span><span class="p">])</span>
<span class="n">word_list</span> <span class="o">=</span> <span class="n">words</span><span class="p">.</span><span class="nf">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">word_list</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>  <span class="c1"># ['hello', 'world', 'spark', 'tutorial']
</span>
<span class="c1"># Distinct: Remove duplicates
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">unique</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">distinct</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">unique</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>  <span class="c1"># [1, 2, 3]
</span></code></pre></div></div>

<h4 id="action"><strong>Action</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Collect: Collect all data to driver
</span><span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">collect</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># [1, 2, 3, 4, 5]
</span>
<span class="c1"># Count: Return number of elements
</span><span class="n">count</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>  <span class="c1"># 5
</span>
<span class="c1"># First: Return first element
</span><span class="n">first</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">first</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">first</span><span class="p">)</span>  <span class="c1"># 1
</span>
<span class="c1"># Take: Return first n elements
</span><span class="n">first_three</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">take</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">first_three</span><span class="p">)</span>  <span class="c1"># [1, 2, 3]
</span>
<span class="c1"># Reduce: Reduce elements to one
</span><span class="n">sum_result</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">reduce</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sum_result</span><span class="p">)</span>  <span class="c1"># 15
</span>
<span class="c1"># Fold: Reduce with initial value
</span><span class="n">sum_with_zero</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">fold</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">sum_with_zero</span><span class="p">)</span>  <span class="c1"># 15
</span></code></pre></div></div>

<h3 id="advanced-rdd-operations">Advanced RDD Operations</h3>

<h4 id="grouping-and-aggregation"><strong>Grouping and Aggregation</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># GroupByKey: Group by key
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="sh">"</span><span class="s">apple</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">banana</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">apple</span><span class="sh">"</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">banana</span><span class="sh">"</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">groupByKey</span><span class="p">()</span>
<span class="nf">print</span><span class="p">(</span><span class="n">grouped</span><span class="p">.</span><span class="nf">mapValues</span><span class="p">(</span><span class="nb">list</span><span class="p">).</span><span class="nf">collect</span><span class="p">())</span>
<span class="c1"># [('apple', [1, 3]), ('banana', [2, 4])]
</span>
<span class="c1"># ReduceByKey: Reduce values by key
</span><span class="n">reduced</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">reduced</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>  <span class="c1"># [('apple', 4), ('banana', 6)]
</span>
<span class="c1"># AggregateByKey: Complex aggregation
# Initial value, sequence function, combine function
</span><span class="n">aggregated</span> <span class="o">=</span> <span class="n">rdd</span><span class="p">.</span><span class="nf">aggregateByKey</span><span class="p">(</span>
    <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># Initial value: (sum, count)
</span>    <span class="k">lambda</span> <span class="n">acc</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="p">(</span><span class="n">acc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">val</span><span class="p">,</span> <span class="n">acc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># Sequence function
</span>    <span class="k">lambda</span> <span class="n">acc1</span><span class="p">,</span> <span class="n">acc2</span><span class="p">:</span> <span class="p">(</span><span class="n">acc1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">acc1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">acc2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Combine function
</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">aggregated</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>
<span class="c1"># [('apple', (4, 2)), ('banana', (6, 2))]
</span></code></pre></div></div>

<h4 id="join-operations"><strong>Join Operations</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create two RDDs
</span><span class="n">rdd1</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">([(</span><span class="sh">"</span><span class="s">apple</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">banana</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="n">rdd2</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">([(</span><span class="sh">"</span><span class="s">apple</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">banana</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">yellow</span><span class="sh">"</span><span class="p">)])</span>

<span class="c1"># Inner Join
</span><span class="n">inner_join</span> <span class="o">=</span> <span class="n">rdd1</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">inner_join</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>
<span class="c1"># [('apple', (1, 'red')), ('banana', (2, 'yellow'))]
</span>
<span class="c1"># Left Outer Join
</span><span class="n">left_join</span> <span class="o">=</span> <span class="n">rdd1</span><span class="p">.</span><span class="nf">leftOuterJoin</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">left_join</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>
<span class="c1"># [('apple', (1, 'red')), ('banana', (2, 'yellow'))]
</span>
<span class="c1"># Cartesian Product
</span><span class="n">cartesian</span> <span class="o">=</span> <span class="n">rdd1</span><span class="p">.</span><span class="nf">cartesian</span><span class="p">(</span><span class="n">rdd2</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">cartesian</span><span class="p">.</span><span class="nf">collect</span><span class="p">())</span>
<span class="c1"># [('apple', ('apple', 'red')), ('apple', ('banana', 'yellow')), ...]
</span></code></pre></div></div>

<h2 id="-dataframe-and-dataset">üìä DataFrame and Dataset</h2>

<h3 id="dataframe-introduction">DataFrame Introduction</h3>

<p>DataFrame is an evolved form of RDD that can efficiently process <strong>structured data</strong>.</p>

<h4 id="dataframe-advantages"><strong>DataFrame Advantages</strong></h4>
<ol>
  <li><strong>Optimized Execution</strong>: Catalyst Optimizer optimizes queries</li>
  <li><strong>Schema Information</strong>: Includes column type and name information</li>
  <li><strong>Rich API</strong>: Supports SQL, Python, Scala, R</li>
  <li><strong>Memory Efficiency</strong>: Memory optimization with Tungsten engine</li>
</ol>

<h3 id="dataframe-creation">DataFrame Creation</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Create DataFrame from RDD
</span><span class="kn">from</span> <span class="n">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">StructType</span><span class="p">,</span> <span class="n">StructField</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">IntegerType</span>

<span class="c1"># Define schema
</span><span class="n">schema</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Create data
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="sh">"</span><span class="s">Busan</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="sh">"</span><span class="s">Charlie</span><span class="sh">"</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">)]</span>
<span class="n">rdd</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">rdd</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># 2. Create DataFrame directly
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">([</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="sh">"</span><span class="s">Busan</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">Charlie</span><span class="sh">"</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">)</span>
<span class="p">],</span> <span class="p">[</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">])</span>

<span class="c1"># 3. Load from external files
</span><span class="n">df_csv</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">csv</span><span class="p">(</span><span class="sh">"</span><span class="s">path/to/file.csv</span><span class="sh">"</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">inferSchema</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">df_json</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="sh">"</span><span class="s">path/to/file.json</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df_parquet</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">path/to/file.parquet</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="basic-dataframe-operations">Basic DataFrame Operations</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Basic information
</span><span class="n">df</span><span class="p">.</span><span class="nf">printSchema</span><span class="p">()</span>  <span class="c1"># Print schema
</span><span class="n">df</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>  <span class="c1"># Show data
</span><span class="n">df</span><span class="p">.</span><span class="nf">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># Show first 5 rows
</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>  <span class="c1"># Row count
</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span>  <span class="c1"># Column list
</span><span class="n">df</span><span class="p">.</span><span class="n">dtypes</span>  <span class="c1"># Column types
</span>
<span class="c1"># Column selection
</span><span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">df</span><span class="p">.</span><span class="n">age</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Conditional filtering
</span><span class="n">df</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">age</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="sh">"</span><span class="s">age &gt; 25</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>  <span class="c1"># SQL style
</span>
<span class="c1"># Sorting
</span><span class="n">df</span><span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">age</span><span class="p">.</span><span class="nf">desc</span><span class="p">()).</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Grouping and aggregation
</span><span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">).</span><span class="nf">count</span><span class="p">().</span><span class="nf">show</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">avg</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">}).</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="advanced-dataframe-operations">Advanced DataFrame Operations</h3>

<h4 id="window-functions"><strong>Window Functions</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">dense_rank</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="n">lead</span>

<span class="c1"># Define window
</span><span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">).</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Apply window functions
</span><span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">row_num</span><span class="sh">"</span><span class="p">,</span> <span class="nf">row_number</span><span class="p">().</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
  <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">rank</span><span class="sh">"</span><span class="p">,</span> <span class="nf">rank</span><span class="p">().</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
  <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">dense_rank</span><span class="sh">"</span><span class="p">,</span> <span class="nf">dense_rank</span><span class="p">().</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
  <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">prev_age</span><span class="sh">"</span><span class="p">,</span> <span class="nf">lag</span><span class="p">(</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
  <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">next_age</span><span class="sh">"</span><span class="p">,</span> <span class="nf">lead</span><span class="p">(</span><span class="sh">"</span><span class="s">age</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
  <span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="join-operations-1"><strong>Join Operations</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create two DataFrames
</span><span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">)],</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">])</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">Engineer</span><span class="sh">"</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sh">"</span><span class="s">Manager</span><span class="sh">"</span><span class="p">)],</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">job</span><span class="sh">"</span><span class="p">])</span>

<span class="c1"># Inner Join
</span><span class="n">df1</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Left Join
</span><span class="n">df1</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Cross Join
</span><span class="n">df1</span><span class="p">.</span><span class="nf">crossJoin</span><span class="p">(</span><span class="n">df2</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="-spark-sql">üîç Spark SQL</h2>

<h3 id="spark-sql-introduction">Spark SQL Introduction</h3>

<p>Spark SQL is a Spark module for structured data processing. It integrates SQL queries with DataFrame API.</p>

<h3 id="creating-table-views">Creating Table Views</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Register DataFrame as temporary view
</span><span class="n">df</span><span class="p">.</span><span class="nf">createOrReplaceTempView</span><span class="p">(</span><span class="sh">"</span><span class="s">people</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Execute SQL query
</span><span class="n">result</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    SELECT city, COUNT(*) as count, AVG(age) as avg_age
    FROM people
    WHERE age &gt; 25
    GROUP BY city
    ORDER BY count DESC
</span><span class="sh">"""</span><span class="p">)</span>
<span class="n">result</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="advanced-sql-features">Advanced SQL Features</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Complex query example
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    SELECT 
        name,
        age,
        city,
        ROW_NUMBER() OVER (PARTITION BY city ORDER BY age DESC) as rank_in_city,
        AVG(age) OVER (PARTITION BY city) as avg_age_in_city
    FROM people
    WHERE age &gt; 20
</span><span class="sh">"""</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Using CTE (Common Table Expression)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    WITH city_stats AS (
        SELECT city, COUNT(*) as count, AVG(age) as avg_age
        FROM people
        GROUP BY city
    )
    SELECT p.name, p.age, p.city, cs.avg_age
    FROM people p
    JOIN city_stats cs ON p.city = cs.city
    WHERE p.age &gt; cs.avg_age
</span><span class="sh">"""</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="Ô∏è-hands-on-basic-data-processing">üõ†Ô∏è Hands-on: Basic Data Processing</h2>

<h3 id="practice-1-log-data-analysis">Practice 1: Log Data Analysis</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create log data
</span><span class="n">log_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sh">"</span><span class="s">2025-09-11 10:30:45 INFO User login successful user_id=12345</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">2025-09-11 10:31:12 ERROR Database connection failed</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">2025-09-11 10:31:45 INFO User login successful user_id=67890</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">2025-09-11 10:32:01 WARN High memory usage detected</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">2025-09-11 10:32:15 INFO User logout user_id=12345</span><span class="sh">"</span>
<span class="p">]</span>

<span class="c1"># Analyze logs with RDD
</span><span class="n">rdd_logs</span> <span class="o">=</span> <span class="n">sc</span><span class="p">.</span><span class="nf">parallelize</span><span class="p">(</span><span class="n">log_data</span><span class="p">)</span>

<span class="c1"># Statistics by log level
</span><span class="n">log_levels</span> <span class="o">=</span> <span class="n">rdd_logs</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">()[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># Extract log level
</span><span class="n">level_counts</span> <span class="o">=</span> <span class="n">log_levels</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">level</span><span class="p">:</span> <span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="mi">1</span><span class="p">)).</span><span class="nf">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Statistics by log level:</span><span class="sh">"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">level_counts</span><span class="p">.</span><span class="nf">collect</span><span class="p">():</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">level</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Filter only error logs
</span><span class="n">error_logs</span> <span class="o">=</span> <span class="n">rdd_logs</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="sh">"</span><span class="s">ERROR</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Error logs:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">error_logs</span><span class="p">.</span><span class="nf">foreach</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="practice-2-structured-data-processing">Practice 2: Structured Data Processing</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Create sales data
</span><span class="n">sales_data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-11</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Laptop</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-11</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Mouse</span><span class="sh">"</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="sh">"</span><span class="s">Busan</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-11</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Charlie</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Keyboard</span><span class="sh">"</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-12</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Monitor</span><span class="sh">"</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="sh">"</span><span class="s">Seoul</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-12</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Laptop</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="sh">"</span><span class="s">Busan</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="sh">"</span><span class="s">2025-09-12</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">David</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Headphone</span><span class="sh">"</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="sh">"</span><span class="s">Daegu</span><span class="sh">"</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Create DataFrame
</span><span class="n">df_sales</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">sales_data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">customer</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">product</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">])</span>
<span class="n">df_sales</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Calculate total purchase amount by customer
</span><span class="n">customer_total</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">customer</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">})</span> \
    <span class="p">.</span><span class="nf">withColumnRenamed</span><span class="p">(</span><span class="sh">"</span><span class="s">sum(price)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">total_spent</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">total_spent</span><span class="sh">"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">customer_total</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Average purchase amount by city
</span><span class="n">city_avg</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">avg</span><span class="sh">"</span><span class="p">})</span> \
    <span class="p">.</span><span class="nf">withColumnRenamed</span><span class="p">(</span><span class="sh">"</span><span class="s">avg(price)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">avg_price</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_price</span><span class="sh">"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">city_avg</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># High-value product customers (1000 or more)
</span><span class="n">high_value_customers</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="n">df_sales</span><span class="p">.</span><span class="n">price</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">customer</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">product</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">distinct</span><span class="p">()</span>
<span class="n">high_value_customers</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="practice-3-complex-analysis">Practice 3: Complex Analysis</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Advanced analysis using window functions
</span><span class="kn">from</span> <span class="n">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">row_number</span><span class="p">,</span> <span class="n">rank</span><span class="p">,</span> <span class="n">lag</span><span class="p">,</span> <span class="nb">sum</span> <span class="k">as</span> <span class="n">spark_sum</span>

<span class="c1"># Purchase ranking by customer (by city)
</span><span class="n">window_spec</span> <span class="o">=</span> <span class="n">Window</span><span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">city</span><span class="sh">"</span><span class="p">).</span><span class="nf">orderBy</span><span class="p">(</span><span class="n">df_sales</span><span class="p">.</span><span class="n">price</span><span class="p">.</span><span class="nf">desc</span><span class="p">())</span>

<span class="n">df_ranked</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">rank_in_city</span><span class="sh">"</span><span class="p">,</span> <span class="nf">rank</span><span class="p">().</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">row_number_in_city</span><span class="sh">"</span><span class="p">,</span> <span class="nf">row_number</span><span class="p">().</span><span class="nf">over</span><span class="p">(</span><span class="n">window_spec</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Purchase ranking by city:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df_ranked</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Calculate cumulative purchase amount by customer
</span><span class="n">window_cumulative</span> <span class="o">=</span> <span class="n">Window</span><span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">customer</span><span class="sh">"</span><span class="p">).</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span>

<span class="n">df_cumulative</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">cumulative_spent</span><span class="sh">"</span><span class="p">,</span> 
    <span class="nf">spark_sum</span><span class="p">(</span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_cumulative</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Cumulative purchase amount by customer:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df_cumulative</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># Purchase amount change compared to previous day
</span><span class="n">window_lag</span> <span class="o">=</span> <span class="n">Window</span><span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">customer</span><span class="sh">"</span><span class="p">).</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span>

<span class="n">df_with_lag</span> <span class="o">=</span> <span class="n">df_sales</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">prev_day_total</span><span class="sh">"</span><span class="p">,</span> 
    <span class="nf">lag</span><span class="p">(</span><span class="nf">spark_sum</span><span class="p">(</span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_lag</span><span class="p">),</span> <span class="mi">1</span><span class="p">).</span><span class="nf">over</span><span class="p">(</span><span class="n">window_lag</span><span class="p">))</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Purchase amount change compared to previous day:</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df_with_lag</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="-learning-summary">üìö Learning Summary</h2>

<h3 id="what-we-learned-in-this-part">What We Learned in This Part</h3>

<ol>
  <li><strong>Understanding Spark Architecture</strong>
    <ul>
      <li>Driver, Cluster Manager, Worker Node</li>
      <li>SparkContext and SparkSession</li>
    </ul>
  </li>
  <li><strong>RDD (Resilient Distributed Dataset)</strong>
    <ul>
      <li>RDD characteristics and creation methods</li>
      <li>Transformation and Action operations</li>
      <li>Advanced operations (grouping, joins)</li>
    </ul>
  </li>
  <li><strong>DataFrame and Dataset</strong>
    <ul>
      <li>Structured data processing</li>
      <li>Window functions and join operations</li>
      <li>Optimized execution engine</li>
    </ul>
  </li>
  <li><strong>Spark SQL</strong>
    <ul>
      <li>Integration of SQL queries and DataFrame API</li>
      <li>Writing complex analysis queries</li>
    </ul>
  </li>
  <li><strong>Practice Projects</strong>
    <ul>
      <li>Log data analysis</li>
      <li>Structured data processing</li>
      <li>Advanced analysis techniques</li>
    </ul>
  </li>
</ol>

<h3 id="key-concepts-summary">Key Concepts Summary</h3>

<table>
  <thead>
    <tr>
      <th>Concept</th>
      <th>Description</th>
      <th>Importance</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>RDD</strong></td>
      <td>Basic abstraction of distributed dataset</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>DataFrame</strong></td>
      <td>Structured data processing</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>Spark SQL</strong></td>
      <td>SQL-based analysis</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
    <tr>
      <td><strong>Transformation/Action</strong></td>
      <td>Lazy evaluation model</td>
      <td>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</td>
    </tr>
  </tbody>
</table>

<h3 id="next-part-preview">Next Part Preview</h3>

<p><strong>Part 2: Large-scale Batch Processing</strong> will cover:</p>
<ul>
  <li>Writing UDF (User Defined Function)</li>
  <li>Advanced aggregation and window functions</li>
  <li>Partitioning strategies and performance optimization</li>
  <li>Practical project: Large-scale data processing</li>
</ul>

<hr />

<p><strong>Next Part</strong>: <a href="/en/data-engineering/2025/09/12/apache-spark-batch-processing.html">Part 2: Large-scale Batch Processing and UDF Usage</a></p>

<hr />

<p><em>You‚Äôve now mastered Spark basics! In the next part, we‚Äôll learn more advanced techniques.</em> üöÄ</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
      
        
      
      
      
      
      
        
        
        <a href="/data-engineering/2025/09/12/apache-spark-streaming.html" class="nav-link next">
          Îã§Ïùå: Part 3: Apache Spark Ïã§ÏãúÍ∞Ñ Ïä§Ìä∏Î¶¨Î∞ç Ï≤òÎ¶¨ÏôÄ Kafka Ïó∞Îèô - Ïã§Î¨¥ ÌîÑÎ°úÏ†ùÌä∏ ‚Üí
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        üìö ÏãúÎ¶¨Ï¶à Ï†ÑÏ≤¥ Î≥¥Í∏∞
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>Îç∞Ïù¥ÌÑ∞ ÏóîÏßÄÎãàÏñ¥Í∞Ä Îã§Î£®Îäî Í∏∞Ïà† Î∏îÎ°úÍ∑∏</p>
      </div>
      
      <div class="footer-section">
        <h4>Categories</h4>
        <ul>
          <li><a href="/en/categories/data-engineering/">Data Engineering</a></li>
          <li><a href="/en/categories/bi-engineering/">BI Engineering</a></li>
          <li><a href="/en/categories/infrastructure-tools/">Infrastructure & Tools</a></li>
          <li><a href="/en/categories/data-quality/">Data Quality</a></li>
          <li><a href="/en/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Links</h4>
        <ul>
          <li><a href="/en/">Home</a></li>
          <li><a href="/en/blog/">Blog</a></li>
          <li><a href="/en/about/">About</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>Social</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. All rights reserved</p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
