<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="dbt와 주요 데이터 플랫폼을 활용한 데이터 품질 관리의 모든 것. Snowflake, BigQuery, Redshift와 함께하는 실무 중심의 완전한 가이드입니다.">



<title>dbt를 활용한 데이터 품질 관리 완전 가이드 - 현대적 데이터 파이프라인의 핵심 - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="dbt를 활용한 데이터 품질 관리 완전 가이드 - 현대적 데이터 파이프라인의 핵심">
<meta property="og:description" content="dbt와 주요 데이터 플랫폼을 활용한 데이터 품질 관리의 모든 것. Snowflake, BigQuery, Redshift와 함께하는 실무 중심의 완전한 가이드입니다.">
<meta property="og:url" content="http://localhost:4000/data-quality/2025/09/30/dbt-data-quality-management.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dbt를 활용한 데이터 품질 관리 완전 가이드 - 현대적 데이터 파이프라인의 핵심">
<meta name="twitter:description" content="dbt와 주요 데이터 플랫폼을 활용한 데이터 품질 관리의 모든 것. Snowflake, BigQuery, Redshift와 함께하는 실무 중심의 완전한 가이드입니다.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="메뉴 열기/닫기">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">홈</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">카테고리</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">데이터 엔지니어링</a></li>
              <li><a href="/categories/bi-engineering/">BI 엔지니어링</a></li>
              <li><a href="/categories/infrastructure-tools/">인프라 & 도구</a></li>
              <li><a href="/categories/data-quality/">데이터 품질</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">블로그</a></li>
        <li><a href="/about/">소개</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- 포스트용 언어 전환 -->
        
          <a href="/data-quality/2025/09/30/dbt-data-quality-management.html" class="lang-btn active">한국어</a>
          
          <a href="/en_posts/2025-09-30-dbt-data-quality-management.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data quality</span>
      <span class="post-date">2025년 09월 30일</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">dbt를 활용한 데이터 품질 관리 완전 가이드 - 현대적 데이터 파이프라인의 핵심</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">dbt</span>
      
        <span class="tag">데이터품질</span>
      
        <span class="tag">DataQuality</span>
      
        <span class="tag">Snowflake</span>
      
        <span class="tag">BigQuery</span>
      
        <span class="tag">Redshift</span>
      
        <span class="tag">Databricks</span>
      
        <span class="tag">dbtCloud</span>
      
        <span class="tag">데이터파이프라인</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">📚 Modern data stack 시리즈</span>
      <span class="series-order">Part 2</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">⏱️ 60분</span>
      
      
        <span class="difficulty">📊 중급</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="dbt를-활용한-데이터-품질-관리-완전-가이드---현대적-데이터-파이프라인의-핵심">dbt를 활용한 데이터 품질 관리 완전 가이드 - 현대적 데이터 파이프라인의 핵심</h1>

<blockquote>
  <p><strong>“데이터는 새로운 석유다”</strong>라는 말이 있지만, 정제되지 않은 석유는 아무 쓸모가 없습니다. dbt는 바로 그 <strong>데이터 정제 공장</strong>의 핵심 도구입니다.</p>
</blockquote>

<p>현대적 데이터 스택에서 dbt는 단순한 변환 도구를 넘어 <strong>데이터 품질의 수호자</strong> 역할을 합니다. 이 포스트에서는 dbt와 주요 데이터 플랫폼들을 활용한 완전한 데이터 품질 관리 시스템을 구축하는 방법을 다룹니다.</p>

<hr />

<h2 id="-목차">🎯 목차</h2>

<ul>
  <li><a href="#dbt와-현대적-데이터-스택">dbt와 현대적 데이터 스택</a></li>
  <li><a href="#dbt-생태계와-주요-플랫폼">dbt 생태계와 주요 플랫폼</a></li>
  <li><a href="#데이터-품질-테스트-프레임워크">데이터 품질 테스트 프레임워크</a></li>
  <li><a href="#실무-데이터-품질-파이프라인-구축">실무 데이터 품질 파이프라인 구축</a></li>
  <li><a href="#고급-데이터-품질-전략">고급 데이터 품질 전략</a></li>
  <li><a href="#실습-완전한-dbt-데이터-품질-시스템">실습: 완전한 dbt 데이터 품질 시스템</a></li>
</ul>

<hr />

<h2 id="dbt와-현대적-데이터-스택">🏗️ dbt와 현대적 데이터 스택</h2>

<h3 id="dbt란-무엇인가">dbt란 무엇인가?</h3>

<p><strong>dbt (Data Build Tool)</strong>는 SQL 기반의 데이터 변환 도구로, 현대적 데이터 스택의 핵심 구성 요소입니다.</p>

<table>
  <thead>
    <tr>
      <th><strong>특징</strong></th>
      <th><strong>설명</strong></th>
      <th><strong>장점</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>SQL 중심</strong></td>
      <td>Python/R 대신 SQL로 데이터 변환</td>
      <td>분석가도 쉽게 사용 가능</td>
    </tr>
    <tr>
      <td><strong>버전 관리</strong></td>
      <td>Git과 연동된 코드 관리</td>
      <td>협업 및 변경 추적 용이</td>
    </tr>
    <tr>
      <td><strong>테스트 자동화</strong></td>
      <td>데이터 품질 테스트 내장</td>
      <td>품질 보장 및 신뢰성 향상</td>
    </tr>
    <tr>
      <td><strong>문서화</strong></td>
      <td>자동 생성되는 데이터 문서</td>
      <td>팀 간 소통 개선</td>
    </tr>
    <tr>
      <td><strong>모듈화</strong></td>
      <td>재사용 가능한 매크로</td>
      <td>개발 효율성 증대</td>
    </tr>
  </tbody>
</table>

<h3 id="현대적-데이터-스택에서의-dbt-역할">현대적 데이터 스택에서의 dbt 역할</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Raw Data Sources → Data Warehouse → dbt Layer → Analytics Layer
                                      ↓
                              Data Quality Tests
                                      ↓
                              Documentation
</code></pre></div></div>

<h3 id="데이터-품질의-중요성">데이터 품질의 중요성</h3>

<p><strong>나쁜 데이터의 비용</strong>은 상상 이상입니다:</p>

<ul>
  <li><strong>의사결정 오류</strong>: 잘못된 데이터로 인한 비즈니스 손실</li>
  <li><strong>신뢰도 하락</strong>: 데이터에 대한 팀의 신뢰 상실</li>
  <li><strong>개발 지연</strong>: 데이터 문제 해결에 소요되는 시간</li>
  <li><strong>규정 준수 위험</strong>: 데이터 거버넌스 이슈</li>
</ul>

<hr />

<h2 id="dbt-생태계와-주요-플랫폼">🌐 dbt 생태계와 주요 플랫폼</h2>

<h3 id="주요-데이터-웨어하우스-플랫폼">주요 데이터 웨어하우스 플랫폼</h3>

<h4 id="1-snowflake">1. <strong>Snowflake</strong></h4>
<ul>
  <li><strong>특징</strong>: 클라우드 네이티브, 자동 스케일링</li>
  <li><strong>dbt 통합</strong>: 완벽한 지원, 최적화된 커넥터</li>
  <li><strong>장점</strong>: 성능 우수, 사용 편의성</li>
</ul>

<h4 id="2-google-bigquery">2. <strong>Google BigQuery</strong></h4>
<ul>
  <li><strong>특징</strong>: 서버리스, 페타바이트 스케일</li>
  <li><strong>dbt 통합</strong>: 네이티브 지원, 빠른 쿼리</li>
  <li><strong>장점</strong>: 비용 효율성, 머신러닝 통합</li>
</ul>

<h4 id="3-amazon-redshift">3. <strong>Amazon Redshift</strong></h4>
<ul>
  <li><strong>특징</strong>: 클러스터 기반, 높은 성능</li>
  <li><strong>dbt 통합</strong>: 안정적인 지원, 다양한 옵션</li>
  <li><strong>장점</strong>: AWS 생태계 통합, 성숙한 플랫폼</li>
</ul>

<h4 id="4-databricks">4. <strong>Databricks</strong></h4>
<ul>
  <li><strong>특징</strong>: 레이크하우스, 머신러닝 통합</li>
  <li><strong>dbt 통합</strong>: Unity Catalog 지원</li>
  <li><strong>장점</strong>: 데이터 레이크 + 웨어하우스 통합</li>
</ul>

<h3 id="dbt-실행-환경-비교">dbt 실행 환경 비교</h3>

<table>
  <thead>
    <tr>
      <th><strong>환경</strong></th>
      <th><strong>특징</strong></th>
      <th><strong>장점</strong></th>
      <th><strong>단점</strong></th>
      <th><strong>적합한 경우</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>dbt Cloud</strong></td>
      <td>클라우드 기반 SaaS</td>
      <td>설정 간편, UI 제공</td>
      <td>비용 발생</td>
      <td>중소규모 팀, 빠른 시작</td>
    </tr>
    <tr>
      <td><strong>dbt Core</strong></td>
      <td>오픈소스, 로컬 실행</td>
      <td>무료, 커스터마이징</td>
      <td>설정 복잡</td>
      <td>대규모 팀, 고도화 필요</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="데이터-품질-테스트-프레임워크">🧪 데이터 품질 테스트 프레임워크</h2>

<h3 id="기본-테스트-generic-tests">기본 테스트 (Generic Tests)</h3>

<h4 id="1-not_null-null-값-검증">1. <strong>not_null</strong>: NULL 값 검증</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># models/schema.yml</span>
<span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">users</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">email</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
</code></pre></div></div>

<h4 id="2-unique-중복-값-검증">2. <strong>unique</strong>: 중복 값 검증</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">users</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">unique</span>
          <span class="pi">-</span> <span class="s">not_null</span>
</code></pre></div></div>

<h4 id="3-accepted_values-허용-값-검증">3. <strong>accepted_values</strong>: 허용 값 검증</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">orders</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">status</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">accepted_values</span><span class="pi">:</span>
              <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">pending'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">completed'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">cancelled'</span><span class="pi">]</span>
</code></pre></div></div>

<h4 id="4-relationships-참조-무결성-검증">4. <strong>relationships</strong>: 참조 무결성 검증</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">orders</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">relationships</span><span class="pi">:</span>
              <span class="na">to</span><span class="pi">:</span> <span class="s">ref('users')</span>
              <span class="na">field</span><span class="pi">:</span> <span class="s">user_id</span>
</code></pre></div></div>

<h3 id="커스텀-테스트-custom-tests">커스텀 테스트 (Custom Tests)</h3>

<h4 id="1-단일-테스트-파일">1. <strong>단일 테스트 파일</strong></h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- tests/assert_positive_amount.sql</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">)</span>
<span class="k">where</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</code></pre></div></div>

<h4 id="2-매크로-기반-테스트">2. <strong>매크로 기반 테스트</strong></h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- macros/test_positive_values.sql</span>
<span class="n">test</span> <span class="n">positive_values</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="k">column_name</span><span class="p">)</span>
  <span class="k">select</span> <span class="o">*</span>
  <span class="k">from</span> <span class="n">model</span>
  <span class="k">where</span> <span class="k">column_name</span> <span class="o">&lt;=</span> <span class="mi">0</span>
<span class="n">endtest</span>
</code></pre></div></div>

<h4 id="3-고급-비즈니스-로직-테스트">3. <strong>고급 비즈니스 로직 테스트</strong></h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- tests/assert_revenue_consistency.sql</span>
<span class="k">with</span> <span class="n">daily_revenue</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="n">date_trunc</span><span class="p">(</span><span class="s1">'day'</span><span class="p">,</span> <span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="nb">date</span><span class="p">,</span>
    <span class="k">sum</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_revenue</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'orders'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'completed'</span>
  <span class="k">group</span> <span class="k">by</span> <span class="mi">1</span>
<span class="p">),</span>
<span class="n">revenue_changes</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="o">*</span><span class="p">,</span>
    <span class="n">lag</span><span class="p">(</span><span class="n">total_revenue</span><span class="p">)</span> <span class="n">over</span> <span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="nb">date</span><span class="p">)</span> <span class="k">as</span> <span class="n">prev_revenue</span><span class="p">,</span>
    <span class="k">abs</span><span class="p">(</span><span class="n">total_revenue</span> <span class="o">-</span> <span class="n">lag</span><span class="p">(</span><span class="n">total_revenue</span><span class="p">)</span> <span class="n">over</span> <span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="nb">date</span><span class="p">))</span> <span class="o">/</span> 
    <span class="n">lag</span><span class="p">(</span><span class="n">total_revenue</span><span class="p">)</span> <span class="n">over</span> <span class="p">(</span><span class="k">order</span> <span class="k">by</span> <span class="nb">date</span><span class="p">)</span> <span class="k">as</span> <span class="n">change_rate</span>
  <span class="k">from</span> <span class="n">daily_revenue</span>
<span class="p">)</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">revenue_changes</span>
<span class="k">where</span> <span class="n">change_rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span>  <span class="c1">-- 50% 이상 급격한 변화</span>
</code></pre></div></div>

<h3 id="테스트-실행-및-모니터링">테스트 실행 및 모니터링</h3>

<h4 id="테스트-실행-명령어">테스트 실행 명령어</h4>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 모든 테스트 실행</span>
dbt <span class="nb">test</span>

<span class="c"># 특정 모델 테스트만 실행</span>
dbt <span class="nb">test</span> <span class="nt">--models</span> <span class="nb">users</span>

<span class="c"># 테스트 결과를 파일로 저장</span>
dbt <span class="nb">test</span> <span class="nt">--store-failures</span>
</code></pre></div></div>

<hr />

<h2 id="실무-데이터-품질-파이프라인-구축">🏭 실무 데이터 품질 파이프라인 구축</h2>

<h3 id="1-프로젝트-구조-설계">1. 프로젝트 구조 설계</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dbt_project/
├── dbt_project.yml
├── profiles.yml
├── models/
│   ├── staging/
│   │   ├── stg_users.sql
│   │   ├── stg_orders.sql
│   │   └── schema.yml
│   ├── intermediate/
│   │   ├── int_user_metrics.sql
│   │   └── schema.yml
│   ├── marts/
│   │   ├── core/
│   │   │   ├── dim_users.sql
│   │   │   ├── fact_orders.sql
│   │   │   └── schema.yml
│   │   └── marketing/
│   │       ├── user_segments.sql
│   │       └── schema.yml
│   └── data_quality/
│       ├── dq_summary.sql
│       └── dq_alerts.sql
├── tests/
│   ├── assert_positive_amounts.sql
│   └── assert_business_rules.sql
├── macros/
│   ├── test_positive_values.sql
│   └── generate_schema_name.sql
└── snapshots/
    └── users_snapshot.sql
</code></pre></div></div>

<h3 id="2-데이터-품질-메트릭-정의">2. 데이터 품질 메트릭 정의</h3>

<h4 id="품질-메트릭-분류">품질 메트릭 분류</h4>

<table>
  <thead>
    <tr>
      <th><strong>메트릭 카테고리</strong></th>
      <th><strong>측정 항목</strong></th>
      <th><strong>목표</strong></th>
      <th><strong>임계값</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>완전성</strong></td>
      <td>NULL 값 비율</td>
      <td>&lt; 5%</td>
      <td>5%</td>
    </tr>
    <tr>
      <td><strong>정확성</strong></td>
      <td>데이터 검증 실패율</td>
      <td>&lt; 1%</td>
      <td>1%</td>
    </tr>
    <tr>
      <td><strong>일관성</strong></td>
      <td>참조 무결성 위반</td>
      <td>0%</td>
      <td>0%</td>
    </tr>
    <tr>
      <td><strong>적시성</strong></td>
      <td>데이터 지연 시간</td>
      <td>&lt; 1시간</td>
      <td>1시간</td>
    </tr>
    <tr>
      <td><strong>유효성</strong></td>
      <td>형식 오류 비율</td>
      <td>&lt; 2%</td>
      <td>2%</td>
    </tr>
  </tbody>
</table>

<h3 id="3-실시간-품질-모니터링">3. 실시간 품질 모니터링</h3>

<h4 id="알림-시스템-구축">알림 시스템 구축</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/data_quality/dq_alerts.sql</span>
<span class="k">with</span> <span class="n">quality_violations</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="s1">'high_null_rate'</span> <span class="k">as</span> <span class="n">alert_type</span><span class="p">,</span>
    <span class="s1">'stg_users'</span> <span class="k">as</span> <span class="k">table_name</span><span class="p">,</span>
    <span class="s1">'user_id'</span> <span class="k">as</span> <span class="k">column_name</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">violation_count</span><span class="p">,</span>
    <span class="k">current_timestamp</span> <span class="k">as</span> <span class="n">detected_at</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_users'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">user_id</span> <span class="k">is</span> <span class="k">null</span>
  <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span>
  
  <span class="k">union</span> <span class="k">all</span>
  
  <span class="k">select</span> 
    <span class="s1">'invalid_email_format'</span> <span class="k">as</span> <span class="n">alert_type</span><span class="p">,</span>
    <span class="s1">'stg_users'</span> <span class="k">as</span> <span class="k">table_name</span><span class="p">,</span>
    <span class="s1">'email'</span> <span class="k">as</span> <span class="k">column_name</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">violation_count</span><span class="p">,</span>
    <span class="k">current_timestamp</span> <span class="k">as</span> <span class="n">detected_at</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_users'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">email</span> <span class="k">not</span> <span class="k">like</span> <span class="s1">'%@%'</span>
  <span class="k">having</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span>
<span class="p">)</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">quality_violations</span>
<span class="k">where</span> <span class="n">violation_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></div>

<hr />

<h2 id="고급-데이터-품질-전략">🚀 고급 데이터 품질 전략</h2>

<h3 id="1-데이터-드리프트-감지">1. 데이터 드리프트 감지</h3>

<h4 id="통계적-드리프트-감지">통계적 드리프트 감지</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/data_quality/drift_detection.sql</span>
<span class="k">with</span> <span class="n">current_stats</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">mean_amount</span><span class="p">,</span>
    <span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">std_amount</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">record_count</span><span class="p">,</span>
    <span class="k">current_date</span> <span class="k">as</span> <span class="n">measurement_date</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'fact_orders'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">created_at</span> <span class="o">&gt;=</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">7</span>
<span class="p">),</span>
<span class="n">historical_stats</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="k">avg</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">mean_amount</span><span class="p">,</span>
    <span class="n">stddev</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">std_amount</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">record_count</span><span class="p">,</span>
    <span class="k">current_date</span> <span class="o">-</span> <span class="mi">7</span> <span class="k">as</span> <span class="n">measurement_date</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'fact_orders'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">created_at</span> <span class="o">&gt;=</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">14</span>
    <span class="k">and</span> <span class="n">created_at</span> <span class="o">&lt;</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">7</span>
<span class="p">),</span>
<span class="n">drift_analysis</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="k">c</span><span class="p">.</span><span class="n">mean_amount</span> <span class="k">as</span> <span class="n">current_mean</span><span class="p">,</span>
    <span class="n">h</span><span class="p">.</span><span class="n">mean_amount</span> <span class="k">as</span> <span class="n">historical_mean</span><span class="p">,</span>
    <span class="k">abs</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">mean_amount</span> <span class="o">-</span> <span class="n">h</span><span class="p">.</span><span class="n">mean_amount</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">.</span><span class="n">mean_amount</span> <span class="k">as</span> <span class="n">mean_drift_ratio</span><span class="p">,</span>
    <span class="k">c</span><span class="p">.</span><span class="n">std_amount</span> <span class="k">as</span> <span class="n">current_std</span><span class="p">,</span>
    <span class="n">h</span><span class="p">.</span><span class="n">std_amount</span> <span class="k">as</span> <span class="n">historical_std</span><span class="p">,</span>
    <span class="k">abs</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">std_amount</span> <span class="o">-</span> <span class="n">h</span><span class="p">.</span><span class="n">std_amount</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">.</span><span class="n">std_amount</span> <span class="k">as</span> <span class="n">std_drift_ratio</span><span class="p">,</span>
    <span class="k">c</span><span class="p">.</span><span class="n">record_count</span> <span class="k">as</span> <span class="n">current_count</span><span class="p">,</span>
    <span class="n">h</span><span class="p">.</span><span class="n">record_count</span> <span class="k">as</span> <span class="n">historical_count</span><span class="p">,</span>
    <span class="k">abs</span><span class="p">(</span><span class="k">c</span><span class="p">.</span><span class="n">record_count</span> <span class="o">-</span> <span class="n">h</span><span class="p">.</span><span class="n">record_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span><span class="p">.</span><span class="n">record_count</span> <span class="k">as</span> <span class="n">count_drift_ratio</span>
  <span class="k">from</span> <span class="n">current_stats</span> <span class="k">c</span>
  <span class="k">cross</span> <span class="k">join</span> <span class="n">historical_stats</span> <span class="n">h</span>
<span class="p">)</span>

<span class="k">select</span> 
  <span class="o">*</span><span class="p">,</span>
  <span class="k">case</span> 
    <span class="k">when</span> <span class="n">mean_drift_ratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">2</span> <span class="k">or</span> <span class="n">std_drift_ratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">3</span> <span class="k">or</span> <span class="n">count_drift_ratio</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">.</span><span class="mi">5</span> 
    <span class="k">then</span> <span class="s1">'drift_detected'</span>
    <span class="k">else</span> <span class="s1">'normal'</span>
  <span class="k">end</span> <span class="k">as</span> <span class="n">drift_status</span>
<span class="k">from</span> <span class="n">drift_analysis</span>
</code></pre></div></div>

<h3 id="2-자동화된-품질-관리">2. 자동화된 품질 관리</h3>

<h4 id="cicd-파이프라인-통합">CI/CD 파이프라인 통합</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># .github/workflows/dbt-quality-check.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">dbt Data Quality Check</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">paths</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">models/**'</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">tests/**'</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">quality-check</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    
    <span class="na">steps</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v2</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Python</span>
      <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-python@v2</span>
      <span class="na">with</span><span class="pi">:</span>
        <span class="na">python-version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install dbt</span>
      <span class="na">run</span><span class="pi">:</span> <span class="s">pip install dbt-snowflake</span>
    
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run dbt tests</span>
      <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">dbt deps</span>
        <span class="s">dbt test --store-failures</span>
</code></pre></div></div>

<h3 id="3-팀-협업과-거버넌스">3. 팀 협업과 거버넌스</h3>

<h4 id="데이터-계약-data-contracts">데이터 계약 (Data Contracts)</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># models/schema.yml</span>
<span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">users</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">User</span><span class="nv"> </span><span class="s">dimension</span><span class="nv"> </span><span class="s">table</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">complete</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">information"</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Unique</span><span class="nv"> </span><span class="s">identifier</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">each</span><span class="nv"> </span><span class="s">user"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="s">unique</span>
        <span class="na">data_type</span><span class="pi">:</span> <span class="s">integer</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">email</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">User's</span><span class="nv"> </span><span class="s">email</span><span class="nv"> </span><span class="s">address"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="s">not_empty_string</span>
        <span class="na">data_type</span><span class="pi">:</span> <span class="s">string</span>
      
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">created_at</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Timestamp</span><span class="nv"> </span><span class="s">when</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">was</span><span class="nv"> </span><span class="s">created"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
        <span class="na">data_type</span><span class="pi">:</span> <span class="s">timestamp</span>
</code></pre></div></div>

<hr />

<h2 id="실습-완전한-dbt-데이터-품질-시스템">🛠️ 실습: 완전한 dbt 데이터 품질 시스템</h2>

<h3 id="1-snowflake--dbt-cloud-설정">1. Snowflake + dbt Cloud 설정</h3>

<h4 id="프로젝트-초기-설정">프로젝트 초기 설정</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dbt_project.yml</span>
<span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">ecommerce_data_quality'</span>
<span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.0.0'</span>
<span class="na">config-version</span><span class="pi">:</span> <span class="m">2</span>

<span class="na">profile</span><span class="pi">:</span> <span class="s1">'</span><span class="s">snowflake_ecommerce'</span>

<span class="na">model-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">models"</span><span class="pi">]</span>
<span class="na">analysis-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">analysis"</span><span class="pi">]</span>
<span class="na">test-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">tests"</span><span class="pi">]</span>
<span class="na">seed-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">data"</span><span class="pi">]</span>
<span class="na">macro-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">macros"</span><span class="pi">]</span>
<span class="na">snapshot-paths</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">snapshots"</span><span class="pi">]</span>

<span class="na">target-path</span><span class="pi">:</span> <span class="s2">"</span><span class="s">target"</span>
<span class="na">clean-targets</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">target"</span>
  <span class="pi">-</span> <span class="s2">"</span><span class="s">dbt_packages"</span>

<span class="na">models</span><span class="pi">:</span>
  <span class="na">ecommerce_data_quality</span><span class="pi">:</span>
    <span class="na">staging</span><span class="pi">:</span>
      <span class="na">materialized</span><span class="pi">:</span> <span class="s">view</span>
    <span class="na">intermediate</span><span class="pi">:</span>
      <span class="na">materialized</span><span class="pi">:</span> <span class="s">view</span>
    <span class="na">marts</span><span class="pi">:</span>
      <span class="na">materialized</span><span class="pi">:</span> <span class="s">table</span>
    <span class="na">data_quality</span><span class="pi">:</span>
      <span class="na">materialized</span><span class="pi">:</span> <span class="s">table</span>

<span class="na">tests</span><span class="pi">:</span>
  <span class="na">store_failures</span><span class="pi">:</span> <span class="kc">true</span>
</code></pre></div></div>

<h3 id="2-실무-데이터-모델링-예제">2. 실무 데이터 모델링 예제</h3>

<h4 id="스테이징-모델">스테이징 모델</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/staging/stg_users.sql</span>
<span class="k">select</span> 
  <span class="n">user_id</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">phone</span><span class="p">,</span>
  <span class="n">created_at</span><span class="p">,</span>
  <span class="n">updated_at</span><span class="p">,</span>
  <span class="n">is_active</span>
<span class="k">from</span> <span class="k">source</span><span class="p">(</span><span class="s1">'raw_data'</span><span class="p">,</span> <span class="s1">'users'</span><span class="p">)</span>
<span class="k">where</span> <span class="n">created_at</span> <span class="k">is</span> <span class="k">not</span> <span class="k">null</span>
</code></pre></div></div>

<h4 id="중간-모델">중간 모델</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/intermediate/int_user_orders.sql</span>
<span class="k">with</span> <span class="n">user_orders</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">email</span><span class="p">,</span>
    <span class="n">u</span><span class="p">.</span><span class="n">created_at</span> <span class="k">as</span> <span class="n">user_created_at</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_orders</span><span class="p">,</span>
    <span class="k">sum</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_spent</span><span class="p">,</span>
    <span class="k">avg</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_order_value</span><span class="p">,</span>
    <span class="k">max</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="n">last_order_date</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_users'</span><span class="p">)</span> <span class="n">u</span>
  <span class="k">left</span> <span class="k">join</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_orders'</span><span class="p">)</span> <span class="n">o</span> <span class="k">on</span> <span class="n">u</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">user_id</span>
  <span class="k">group</span> <span class="k">by</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="p">)</span>

<span class="k">select</span> 
  <span class="o">*</span><span class="p">,</span>
  <span class="k">case</span> 
    <span class="k">when</span> <span class="n">total_spent</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="k">then</span> <span class="s1">'high_value'</span>
    <span class="k">when</span> <span class="n">total_spent</span> <span class="o">&gt;</span> <span class="mi">500</span> <span class="k">then</span> <span class="s1">'medium_value'</span>
    <span class="k">else</span> <span class="s1">'low_value'</span>
  <span class="k">end</span> <span class="k">as</span> <span class="n">customer_segment</span><span class="p">,</span>
  
  <span class="k">case</span> 
    <span class="k">when</span> <span class="n">last_order_date</span> <span class="o">&gt;=</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">30</span> <span class="k">then</span> <span class="s1">'active'</span>
    <span class="k">when</span> <span class="n">last_order_date</span> <span class="o">&gt;=</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">90</span> <span class="k">then</span> <span class="s1">'at_risk'</span>
    <span class="k">else</span> <span class="s1">'inactive'</span>
  <span class="k">end</span> <span class="k">as</span> <span class="n">customer_status</span>
<span class="k">from</span> <span class="n">user_orders</span>
</code></pre></div></div>

<h4 id="마트-모델">마트 모델</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/marts/core/dim_users.sql</span>
<span class="k">select</span> 
  <span class="n">user_id</span><span class="p">,</span>
  <span class="n">email</span><span class="p">,</span>
  <span class="n">first_name</span><span class="p">,</span>
  <span class="n">last_name</span><span class="p">,</span>
  <span class="n">phone</span><span class="p">,</span>
  <span class="n">user_created_at</span><span class="p">,</span>
  <span class="n">total_orders</span><span class="p">,</span>
  <span class="n">total_spent</span><span class="p">,</span>
  <span class="n">avg_order_value</span><span class="p">,</span>
  <span class="n">customer_segment</span><span class="p">,</span>
  <span class="n">customer_status</span><span class="p">,</span>
  <span class="k">current_timestamp</span> <span class="k">as</span> <span class="n">dbt_updated_at</span>
<span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'int_user_orders'</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-포괄적인-테스트-스위트">3. 포괄적인 테스트 스위트</h3>

<h4 id="스키마-테스트">스키마 테스트</h4>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># models/staging/schema.yml</span>
<span class="na">version</span><span class="pi">:</span> <span class="m">2</span>

<span class="na">sources</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">raw_data</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Raw</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">source</span><span class="nv"> </span><span class="s">systems"</span>
    <span class="na">tables</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">users</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Raw</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">data"</span>
        <span class="na">columns</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
            <span class="na">tests</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">not_null</span>
              <span class="pi">-</span> <span class="s">unique</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">email</span>
            <span class="na">tests</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">not_null</span>
              <span class="pi">-</span> <span class="s">not_empty_string</span>
          <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">created_at</span>
            <span class="na">tests</span><span class="pi">:</span>
              <span class="pi">-</span> <span class="s">not_null</span>

<span class="na">models</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">stg_users</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Cleaned</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">data</span><span class="nv"> </span><span class="s">from</span><span class="nv"> </span><span class="s">staging</span><span class="nv"> </span><span class="s">layer"</span>
    <span class="na">columns</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">user_id</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Unique</span><span class="nv"> </span><span class="s">user</span><span class="nv"> </span><span class="s">identifier"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="s">unique</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">email</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">User</span><span class="nv"> </span><span class="s">email</span><span class="nv"> </span><span class="s">address"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="s">not_empty_string</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">is_active</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">User</span><span class="nv"> </span><span class="s">active</span><span class="nv"> </span><span class="s">status"</span>
        <span class="na">tests</span><span class="pi">:</span>
          <span class="pi">-</span> <span class="s">not_null</span>
          <span class="pi">-</span> <span class="na">accepted_values</span><span class="pi">:</span>
              <span class="na">values</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">true</span><span class="pi">,</span> <span class="nv">false</span><span class="pi">]</span>
</code></pre></div></div>

<h4 id="비즈니스-로직-테스트">비즈니스 로직 테스트</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- tests/assert_positive_order_amounts.sql</span>
<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_orders'</span><span class="p">)</span>
<span class="k">where</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- tests/assert_user_order_consistency.sql</span>
<span class="k">with</span> <span class="n">user_order_check</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="n">u</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="n">o</span><span class="p">.</span><span class="n">order_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">order_count</span><span class="p">,</span>
    <span class="k">sum</span><span class="p">(</span><span class="n">o</span><span class="p">.</span><span class="n">amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_amount</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_users'</span><span class="p">)</span> <span class="n">u</span>
  <span class="k">left</span> <span class="k">join</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'stg_orders'</span><span class="p">)</span> <span class="n">o</span> <span class="k">on</span> <span class="n">u</span><span class="p">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">user_id</span>
  <span class="k">group</span> <span class="k">by</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="k">select</span> <span class="o">*</span>
<span class="k">from</span> <span class="n">user_order_check</span>
<span class="k">where</span> <span class="n">total_amount</span> <span class="o">&lt;</span> <span class="mi">0</span>
   <span class="k">or</span> <span class="n">order_count</span> <span class="o">&lt;</span> <span class="mi">0</span>
</code></pre></div></div>

<h3 id="4-데이터-품질-모니터링-대시보드">4. 데이터 품질 모니터링 대시보드</h3>

<h4 id="품질-메트릭-집계">품질 메트릭 집계</h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- models/data_quality/quality_metrics_summary.sql</span>
<span class="k">with</span> <span class="n">test_results</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="n">node_name</span><span class="p">,</span>
    <span class="n">status</span><span class="p">,</span>
    <span class="n">execution_time</span><span class="p">,</span>
    <span class="n">rows_affected</span><span class="p">,</span>
    <span class="n">created_at</span>
  <span class="k">from</span> <span class="k">ref</span><span class="p">(</span><span class="s1">'test_results'</span><span class="p">)</span>
  <span class="k">where</span> <span class="n">created_at</span> <span class="o">&gt;=</span> <span class="k">current_date</span> <span class="o">-</span> <span class="mi">7</span>
<span class="p">),</span>

<span class="n">daily_metrics</span> <span class="k">as</span> <span class="p">(</span>
  <span class="k">select</span> 
    <span class="n">date_trunc</span><span class="p">(</span><span class="s1">'day'</span><span class="p">,</span> <span class="n">created_at</span><span class="p">)</span> <span class="k">as</span> <span class="nb">date</span><span class="p">,</span>
    <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_tests</span><span class="p">,</span>
    <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'pass'</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">passed_tests</span><span class="p">,</span>
    <span class="k">sum</span><span class="p">(</span><span class="k">case</span> <span class="k">when</span> <span class="n">status</span> <span class="o">=</span> <span class="s1">'fail'</span> <span class="k">then</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">end</span><span class="p">)</span> <span class="k">as</span> <span class="n">failed_tests</span><span class="p">,</span>
    <span class="k">avg</span><span class="p">(</span><span class="n">execution_time</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_execution_time</span>
  <span class="k">from</span> <span class="n">test_results</span>
  <span class="k">group</span> <span class="k">by</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="k">select</span> 
  <span class="o">*</span><span class="p">,</span>
  <span class="n">round</span><span class="p">(</span><span class="n">passed_tests</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">total_tests</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">pass_rate</span><span class="p">,</span>
  <span class="k">case</span> 
    <span class="k">when</span> <span class="n">passed_tests</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">total_tests</span> <span class="o">&gt;=</span> <span class="mi">95</span> <span class="k">then</span> <span class="s1">'excellent'</span>
    <span class="k">when</span> <span class="n">passed_tests</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">total_tests</span> <span class="o">&gt;=</span> <span class="mi">90</span> <span class="k">then</span> <span class="s1">'good'</span>
    <span class="k">when</span> <span class="n">passed_tests</span> <span class="o">*</span> <span class="mi">100</span><span class="p">.</span><span class="mi">0</span> <span class="o">/</span> <span class="n">total_tests</span> <span class="o">&gt;=</span> <span class="mi">80</span> <span class="k">then</span> <span class="s1">'warning'</span>
    <span class="k">else</span> <span class="s1">'critical'</span>
  <span class="k">end</span> <span class="k">as</span> <span class="n">quality_status</span>
<span class="k">from</span> <span class="n">daily_metrics</span>
<span class="k">order</span> <span class="k">by</span> <span class="nb">date</span> <span class="k">desc</span>
</code></pre></div></div>

<h3 id="5-자동화된-배포-및-모니터링">5. 자동화된 배포 및 모니터링</h3>

<h4 id="운영-모니터링-스크립트">운영 모니터링 스크립트</h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># scripts/quality_monitor.py
</span><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">class</span> <span class="nc">DataQualityMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dbt_cloud_token</span><span class="p">,</span> <span class="n">account_id</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">token</span> <span class="o">=</span> <span class="n">dbt_cloud_token</span>
        <span class="n">self</span><span class="p">.</span><span class="n">account_id</span> <span class="o">=</span> <span class="n">account_id</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://cloud.getdbt.com/api/v2</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">get_latest_run</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">최근 dbt 실행 결과 조회</span><span class="sh">"""</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">Authorization</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Token </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">token</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Content-Type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">application/json</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/accounts/</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">account_id</span><span class="si">}</span><span class="s">/runs/</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">job_definition_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span> <span class="sh">'</span><span class="s">limit</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">runs</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()[</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">runs</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">runs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">check_quality_status</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">데이터 품질 상태 확인</span><span class="sh">"""</span>
        <span class="n">run</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_latest_run</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">run</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No recent runs found</span><span class="sh">'</span><span class="p">}</span>
        
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">run</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="c1"># 테스트 결과 조회
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">base_url</span><span class="si">}</span><span class="s">/accounts/</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">account_id</span><span class="si">}</span><span class="s">/runs/</span><span class="si">{</span><span class="n">run_id</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">Authorization</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Token </span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">token</span><span class="si">}</span><span class="sh">'</span><span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">run_details</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()[</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">run_details</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">],</span>
                <span class="sh">'</span><span class="s">finished_at</span><span class="sh">'</span><span class="p">:</span> <span class="n">run_details</span><span class="p">[</span><span class="sh">'</span><span class="s">finished_at</span><span class="sh">'</span><span class="p">],</span>
                <span class="sh">'</span><span class="s">job_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_id</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">run_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">run_id</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Failed to fetch run details</span><span class="sh">'</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">send_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">severity</span><span class="o">=</span><span class="sh">'</span><span class="s">info</span><span class="sh">'</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">알림 발송 (Slack, Email 등)</span><span class="sh">"""</span>
        <span class="c1"># Slack 웹훅 또는 이메일 발송 로직
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[</span><span class="si">{</span><span class="n">severity</span><span class="p">.</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 사용 예제
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">DataQualityMonitor</span><span class="p">(</span>
        <span class="n">dbt_cloud_token</span><span class="o">=</span><span class="sh">"</span><span class="s">your_token</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">account_id</span><span class="o">=</span><span class="sh">"</span><span class="s">your_account_id</span><span class="sh">"</span>
    <span class="p">)</span>
    
    <span class="n">quality_status</span> <span class="o">=</span> <span class="n">monitor</span><span class="p">.</span><span class="nf">check_quality_status</span><span class="p">(</span><span class="sh">"</span><span class="s">your_job_id</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">quality_status</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">error</span><span class="sh">'</span><span class="p">:</span>
        <span class="n">monitor</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Data quality check failed: </span><span class="si">{</span><span class="n">quality_status</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> 
            <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">monitor</span><span class="p">.</span><span class="nf">send_alert</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="s">Data quality check completed: </span><span class="si">{</span><span class="n">quality_status</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> 
            <span class="sh">'</span><span class="s">info</span><span class="sh">'</span>
        <span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="학습-요약">📊 학습 요약</h2>

<h3 id="핵심-포인트">핵심 포인트</h3>

<ol>
  <li><strong>dbt는 데이터 품질의 핵심 도구</strong>
    <ul>
      <li>SQL 기반의 접근으로 분석가도 쉽게 사용</li>
      <li>자동화된 테스트와 문서화로 신뢰성 확보</li>
    </ul>
  </li>
  <li><strong>플랫폼별 최적화 전략</strong>
    <ul>
      <li>Snowflake, BigQuery, Redshift 등 각 플랫폼의 특성 활용</li>
      <li>dbt Cloud vs dbt Core 선택 기준</li>
    </ul>
  </li>
  <li><strong>체계적인 품질 관리</strong>
    <ul>
      <li>기본 테스트부터 커스텀 테스트까지 단계적 접근</li>
      <li>실시간 모니터링과 알림 시스템 구축</li>
    </ul>
  </li>
  <li><strong>팀 협업과 거버넌스</strong>
    <ul>
      <li>데이터 계약을 통한 명확한 품질 기준</li>
      <li>CI/CD 파이프라인 통합으로 자동화</li>
    </ul>
  </li>
</ol>

<h3 id="다음-단계">다음 단계</h3>

<ul>
  <li><strong>dbt 패키지 활용</strong>: dbt-utils, dbt-expectations 등 확장 기능</li>
  <li><strong>고급 모니터링</strong>: Grafana, DataDog 등 외부 모니터링 도구 연동</li>
  <li><strong>머신러닝 통합</strong>: 데이터 품질 이상 탐지 ML 모델 구축</li>
</ul>

<hr />

<blockquote>
  <p><strong>“좋은 데이터는 좋은 의사결정을 만든다. dbt는 그 좋은 데이터를 보장하는 가장 강력한 도구다.”</strong></p>
</blockquote>

<p>이제 여러분도 dbt를 활용해 신뢰할 수 있는 데이터 품질 관리 시스템을 구축할 준비가 되었습니다. 현대적 데이터 스택에서 데이터 품질은 선택이 아닌 필수입니다. dbt와 함께 데이터의 품질을 보장하고, 더 나은 비즈니스 인사이트를 얻어보세요!</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
          
          
      
      
      
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-quality/" class="btn btn-secondary">
        📚 시리즈 전체 보기
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>데이터 엔지니어가 다루는 기술 블로그</p>
      </div>
      
      <div class="footer-section">
        <h4>카테고리</h4>
        <ul>
          <li><a href="/categories/data-engineering/">데이터 엔지니어링</a></li>
          <li><a href="/categories/bi-engineering/">BI 엔지니어링</a></li>
          <li><a href="/categories/infrastructure-tools/">인프라 & 도구</a></li>
          <li><a href="/categories/data-quality/">데이터 품질</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>링크</h4>
        <ul>
          <li><a href="/">홈</a></li>
          <li><a href="/blog/">블로그</a></li>
          <li><a href="/about/">소개</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>소셜</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. 모든 권리 보유</p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
