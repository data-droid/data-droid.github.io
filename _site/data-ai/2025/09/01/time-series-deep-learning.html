<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ì˜ í•µì‹¬ì„ ë°°ìš°ê³  N-BEATSì™€ DeepARì„ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•´ë³´ì„¸ìš”.">



<title>Part 2: ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ - N-BEATSì™€ DeepAR - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 2: ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ - N-BEATSì™€ DeepAR">
<meta property="og:description" content="ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ì˜ í•µì‹¬ì„ ë°°ìš°ê³  N-BEATSì™€ DeepARì„ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•´ë³´ì„¸ìš”.">
<meta property="og:url" content="http://localhost:4000/data-ai/2025/09/01/time-series-deep-learning.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 2: ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ - N-BEATSì™€ DeepAR">
<meta name="twitter:description" content="ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ì˜ í•µì‹¬ì„ ë°°ìš°ê³  N-BEATSì™€ DeepARì„ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•´ë³´ì„¸ìš”.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <a href="/data-ai/2025/09/01/time-series-deep-learning.html" class="lang-btn active">í•œêµ­ì–´</a>
        
        <a href="/en_posts/2025-09-01-time-series-deep-learning.html" class="lang-btn">English</a>
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data ai</span>
      <span class="post-date">2025ë…„ 09ì›” 01ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 2: ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ - N-BEATSì™€ DeepAR</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">ì‹œê³„ì—´ì˜ˆì¸¡</span>
      
        <span class="tag">ë”¥ëŸ¬ë‹</span>
      
        <span class="tag">N-BEATS</span>
      
        <span class="tag">DeepAR</span>
      
        <span class="tag">PyTorch</span>
      
        <span class="tag">ë¨¸ì‹ ëŸ¬ë‹</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Time series forecasting ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 3</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 30ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ì¤‘ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-2-ë”¥ëŸ¬ë‹-ê¸°ë°˜-ì‹œê³„ì—´-ì˜ˆì¸¡---n-beatsì™€-deepar">Part 2: ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ - N-BEATSì™€ DeepAR</h1>

<blockquote>
  <p>ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ì˜ í•µì‹¬ì„ ë°°ìš°ê³  N-BEATSì™€ DeepARì„ ì‹¤ì œ ì½”ë“œë¡œ êµ¬í˜„í•´ë³´ì„¸ìš”.</p>
</blockquote>

<h2 id="-ëª©ì°¨">ğŸ“‹ ëª©ì°¨</h2>

<ol>
  <li><a href="#ë”¥ëŸ¬ë‹-ê¸°ë°˜-ì‹œê³„ì—´-ì˜ˆì¸¡ì˜-ë“±ì¥">ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ì˜ ë“±ì¥</a></li>
  <li><a href="#n-beats-í•´ì„-ê°€ëŠ¥í•œ-ë”¥ëŸ¬ë‹-ì‹œê³„ì—´-ëª¨ë¸">N-BEATS: í•´ì„ ê°€ëŠ¥í•œ ë”¥ëŸ¬ë‹ ì‹œê³„ì—´ ëª¨ë¸</a></li>
  <li><a href="#deepar-í™•ë¥ ì -ì‹œê³„ì—´-ì˜ˆì¸¡">DeepAR: í™•ë¥ ì  ì‹œê³„ì—´ ì˜ˆì¸¡</a></li>
  <li><a href="#ì‹¤ìŠµ-n-beatsì™€-deepar-êµ¬í˜„">ì‹¤ìŠµ: N-BEATSì™€ DeepAR êµ¬í˜„</a></li>
  <li><a href="#ëª¨ë¸-ì„±ëŠ¥-ë¹„êµ-ë°-ë¶„ì„">ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ ë° ë¶„ì„</a></li>
  <li><a href="#ë‹¤ìŒ-ë‹¨ê³„-ë°-í™•ì¥">ë‹¤ìŒ ë‹¨ê³„ ë° í™•ì¥</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ol>

<h2 id="-ë”¥ëŸ¬ë‹-ê¸°ë°˜-ì‹œê³„ì—´-ì˜ˆì¸¡ì˜-ë“±ì¥">ğŸš€ ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ì˜ ë“±ì¥</h2>

<h3 id="ì „í†µì -ë°©ë²•ì˜-í•œê³„">ì „í†µì  ë°©ë²•ì˜ í•œê³„</h3>

<p>Part 1ì—ì„œ í•™ìŠµí•œ ARIMAì™€ Prophetì€ í›Œë¥­í•œ ëª¨ë¸ì´ì§€ë§Œ, ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤:</p>

<ol>
  <li><strong>ì„ í˜•ì„± ê°€ì •</strong>: ë³µì¡í•œ ë¹„ì„ í˜• íŒ¨í„´ì„ í•™ìŠµí•˜ê¸° ì–´ë ¤ì›€</li>
  <li><strong>ìˆ˜ë™ íŠ¹ì„± ì—”ì§€ë‹ˆì–´ë§</strong>: ë„ë©”ì¸ ì§€ì‹ì— ì˜ì¡´ì </li>
  <li><strong>ì¥ê¸° ì˜ì¡´ì„±</strong>: ë¨¼ ê³¼ê±°ì˜ ì •ë³´ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ì§€ ëª»í•¨</li>
  <li><strong>ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™”</strong>: ì˜ˆì¸¡ì˜ ì‹ ë¢° êµ¬ê°„ì„ ì •í™•íˆ ì¶”ì •í•˜ê¸° ì–´ë ¤ì›€</li>
</ol>

<h3 id="ë”¥ëŸ¬ë‹ì˜-í˜ì‹ ">ë”¥ëŸ¬ë‹ì˜ í˜ì‹ </h3>

<p>ë”¥ëŸ¬ë‹ì€ ì´ëŸ¬í•œ í•œê³„ë¥¼ ê·¹ë³µí•˜ê³  ì‹œê³„ì—´ ì˜ˆì¸¡ì— ìƒˆë¡œìš´ ê°€ëŠ¥ì„±ì„ ì—´ì—ˆìŠµë‹ˆë‹¤:</p>

<ul>
  <li><strong>ë¹„ì„ í˜• íŒ¨í„´ í•™ìŠµ</strong>: ë³µì¡í•œ ê´€ê³„ë¥¼ ìë™ìœ¼ë¡œ ë°œê²¬</li>
  <li><strong>ìë™ íŠ¹ì„± ì¶”ì¶œ</strong>: ë„ë©”ì¸ ì§€ì‹ ì—†ì´ë„ íŒ¨í„´ í•™ìŠµ</li>
  <li><strong>ì¥ê¸° ì˜ì¡´ì„± ëª¨ë¸ë§</strong>: LSTM, Transformer ë“±ì„ í†µí•œ ì‹œí€€ìŠ¤ í•™ìŠµ</li>
  <li><strong>í™•ë¥ ì  ì˜ˆì¸¡</strong>: ë¶ˆí™•ì‹¤ì„±ì„ ì •ëŸ‰í™”í•˜ì—¬ ì‹ ë¢° êµ¬ê°„ ì œê³µ</li>
</ul>

<h2 id="ï¸-n-beats-í•´ì„-ê°€ëŠ¥í•œ-ë”¥ëŸ¬ë‹-ì‹œê³„ì—´-ëª¨ë¸">ğŸ—ï¸ N-BEATS: í•´ì„ ê°€ëŠ¥í•œ ë”¥ëŸ¬ë‹ ì‹œê³„ì—´ ëª¨ë¸</h2>

<h3 id="n-beatsì˜-í•µì‹¬-ì•„ì´ë””ì–´">N-BEATSì˜ í•µì‹¬ ì•„ì´ë””ì–´</h3>

<p>N-BEATS (Neural Basis Expansion Analysis for Time Series)ëŠ” 2019ë…„ Element AIì—ì„œ ê°œë°œí•œ ë”¥ëŸ¬ë‹ ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ì…ë‹ˆë‹¤.</p>

<h4 id="1-ë¸”ë¡-ê¸°ë°˜-ì•„í‚¤í…ì²˜"><strong>1. ë¸”ë¡ ê¸°ë°˜ ì•„í‚¤í…ì²˜</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ì…ë ¥ ì‹œê³„ì—´ â†’ Backcast ë¸”ë¡ â†’ Forecast ë¸”ë¡ â†’ ìµœì¢… ì˜ˆì¸¡
     â†“              â†“              â†“
  Lookback      ê³¼ê±° ì¬êµ¬ì„±     ë¯¸ë˜ ì˜ˆì¸¡
</code></pre></div></div>

<h4 id="2-í•´ì„-ê°€ëŠ¥í•œ-ë¸”ë¡-êµ¬ì¡°"><strong>2. í•´ì„ ê°€ëŠ¥í•œ ë¸”ë¡ êµ¬ì¡°</strong></h4>

<p>ê° ë¸”ë¡ì€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì„± ìš”ì†Œë¥¼ ê°€ì§‘ë‹ˆë‹¤:</p>

<ul>
  <li><strong>Linear Layer</strong>: ì…ë ¥ì„ ê³ ì°¨ì›ìœ¼ë¡œ ë³€í™˜</li>
  <li><strong>ReLU Activation</strong>: ë¹„ì„ í˜•ì„± ì¶”ê°€</li>
  <li><strong>Linear Layer</strong>: ì›ë˜ ì°¨ì›ìœ¼ë¡œ ë³µì›</li>
  <li><strong>Residual Connection</strong>: ê·¸ë˜ë””ì–¸íŠ¸ íë¦„ ê°œì„ </li>
</ul>

<h4 id="3-ì´ì¤‘-ì¶œë ¥-êµ¬ì¡°"><strong>3. ì´ì¤‘ ì¶œë ¥ êµ¬ì¡°</strong></h4>

<ul>
  <li><strong>Backcast</strong>: ì…ë ¥ ì‹œê³„ì—´ì„ ì¬êµ¬ì„±í•˜ì—¬ íŒ¨í„´ í•™ìŠµ</li>
  <li><strong>Forecast</strong>: ë¯¸ë˜ ê°’ì„ ì˜ˆì¸¡</li>
</ul>

<h3 id="n-beatsì˜-ì¥ì ">N-BEATSì˜ ì¥ì </h3>

<ol>
  <li><strong>í•´ì„ ê°€ëŠ¥ì„±</strong>: ê° ë¸”ë¡ì´ í•™ìŠµí•˜ëŠ” íŒ¨í„´ì„ ë¶„ì„ ê°€ëŠ¥</li>
  <li><strong>í™•ì¥ì„±</strong>: ë‹¤ì–‘í•œ ì‹œê³„ì—´ ê¸¸ì´ì— ì ìš© ê°€ëŠ¥</li>
  <li><strong>íš¨ìœ¨ì„±</strong>: ë¹ ë¥¸ í•™ìŠµê³¼ ì˜ˆì¸¡</li>
  <li><strong>ì•ˆì •ì„±</strong>: ê·¸ë˜ë””ì–¸íŠ¸ ì†Œì‹¤ ë¬¸ì œ í•´ê²°</li>
</ol>

<h2 id="-deepar-í™•ë¥ ì -ì‹œê³„ì—´-ì˜ˆì¸¡">ğŸ”® DeepAR: í™•ë¥ ì  ì‹œê³„ì—´ ì˜ˆì¸¡</h2>

<h3 id="deeparì˜-í•µì‹¬-ê°œë…">DeepARì˜ í•µì‹¬ ê°œë…</h3>

<p>DeepARì€ Amazonì—ì„œ ê°œë°œí•œ í™•ë¥ ì  ì‹œê³„ì—´ ì˜ˆì¸¡ ëª¨ë¸ë¡œ, <strong>í™•ë¥  ë¶„í¬ë¥¼ ì§ì ‘ ëª¨ë¸ë§</strong>í•©ë‹ˆë‹¤.</p>

<h4 id="1-í™•ë¥ ì -ì ‘ê·¼ë²•"><strong>1. í™•ë¥ ì  ì ‘ê·¼ë²•</strong></h4>

<p>ì „í†µì  ëª¨ë¸ë“¤ì´ ì  ì˜ˆì¸¡ì„ í•˜ëŠ” ë°˜ë©´, DeepARì€:</p>
<ul>
  <li><strong>í™•ë¥  ë¶„í¬ í•™ìŠµ</strong>: ì •ê·œë¶„í¬, ìŒì´í•­ë¶„í¬ ë“±</li>
  <li><strong>ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™”</strong>: ì˜ˆì¸¡ì˜ ì‹ ë¢° êµ¬ê°„ ì œê³µ</li>
  <li><strong>ì•™ìƒë¸” íš¨ê³¼</strong>: ì—¬ëŸ¬ ìƒ˜í”Œì„ í†µí•œ ì•ˆì •ì  ì˜ˆì¸¡</li>
</ul>

<h4 id="2-lstm-ê¸°ë°˜-ì•„í‚¤í…ì²˜"><strong>2. LSTM ê¸°ë°˜ ì•„í‚¤í…ì²˜</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ì‹œê³„ì—´ ì…ë ¥ â†’ LSTM ì…€ â†’ í™•ë¥  ë¶„í¬ íŒŒë¼ë¯¸í„° â†’ ìƒ˜í”Œë§ â†’ ì˜ˆì¸¡
     â†“           â†“              â†“              â†“
  Lookback    ìƒíƒœ ì—…ë°ì´íŠ¸    Î¼, Ïƒ í•™ìŠµ     í™•ë¥ ì  ì˜ˆì¸¡
</code></pre></div></div>

<h4 id="3-ì¡°ê±´ë¶€-í™•ë¥ -ëª¨ë¸ë§"><strong>3. ì¡°ê±´ë¶€ í™•ë¥  ëª¨ë¸ë§</strong></h4>

<p>DeepARì€ ë‹¤ìŒ í™•ë¥ ì„ ëª¨ë¸ë§í•©ë‹ˆë‹¤:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>P(y_{t+1} | y_1, y_2, ..., y_t, x_1, x_2, ..., x_t)
</code></pre></div></div>

<p>ì—¬ê¸°ì„œ <code class="language-plaintext highlighter-rouge">x_t</code>ëŠ” ì™¸ë¶€ ë³€ìˆ˜(íœ´ì¼, ê³„ì ˆ ë“±)ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>

<h3 id="deeparì˜-ì¥ì ">DeepARì˜ ì¥ì </h3>

<ol>
  <li><strong>ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™”</strong>: ì˜ˆì¸¡ì˜ ì‹ ë¢°ë„ë¥¼ ì •í™•íˆ ì¸¡ì •</li>
  <li><strong>ì™¸ë¶€ ë³€ìˆ˜ í™œìš©</strong>: ê³„ì ˆì„±, íœ´ì¼ ë“± ì¶”ê°€ ì •ë³´ ë°˜ì˜</li>
  <li><strong>ë‹¤ë³€ëŸ‰ ì‹œê³„ì—´</strong>: ì—¬ëŸ¬ ì‹œê³„ì—´ì„ ë™ì‹œì— ëª¨ë¸ë§</li>
  <li><strong>ì‹¤ì‹œê°„ í•™ìŠµ</strong>: ìƒˆë¡œìš´ ë°ì´í„°ë¡œ ì§€ì†ì  ì—…ë°ì´íŠ¸</li>
</ol>

<h2 id="ï¸-ì‹¤ìŠµ-n-beatsì™€-deepar-êµ¬í˜„">ğŸ› ï¸ ì‹¤ìŠµ: N-BEATSì™€ DeepAR êµ¬í˜„</h2>

<h3 id="1-í™˜ê²½-ì„¤ì •-ë°-ë¼ì´ë¸ŒëŸ¬ë¦¬-ì„¤ì¹˜">1. í™˜ê²½ ì„¤ì • ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
# pip install torch torchvision torchaudio
# pip install pandas numpy matplotlib seaborn scikit-learn
</span>
<span class="kn">import</span> <span class="n">torch</span>
<span class="kn">import</span> <span class="n">torch.nn</span> <span class="k">as</span> <span class="n">nn</span>
<span class="kn">import</span> <span class="n">torch.optim</span> <span class="k">as</span> <span class="n">optim</span>
<span class="kn">from</span> <span class="n">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="n">seaborn</span> <span class="k">as</span> <span class="n">sns</span>
<span class="kn">from</span> <span class="n">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="n">warnings</span>
<span class="n">warnings</span><span class="p">.</span><span class="nf">filterwarnings</span><span class="p">(</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># PyTorch ì„¤ì •
</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">device</span><span class="p">(</span><span class="sh">'</span><span class="s">cuda</span><span class="sh">'</span> <span class="k">if</span> <span class="n">torch</span><span class="p">.</span><span class="n">cuda</span><span class="p">.</span><span class="nf">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="sh">'</span><span class="s">cpu</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Using device: </span><span class="si">{</span><span class="n">device</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™” ì„¤ì •
</span><span class="n">plt</span><span class="p">.</span><span class="n">style</span><span class="p">.</span><span class="nf">use</span><span class="p">(</span><span class="sh">'</span><span class="s">seaborn-v0_8</span><span class="sh">'</span><span class="p">)</span>
<span class="n">sns</span><span class="p">.</span><span class="nf">set_palette</span><span class="p">(</span><span class="sh">"</span><span class="s">husl</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-ë³µì¡í•œ-ì‹œê³„ì—´-ë°ì´í„°-ìƒì„±">2. ë³µì¡í•œ ì‹œê³„ì—´ ë°ì´í„° ìƒì„±</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">generate_complex_timeseries</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë³µì¡í•œ ì‹œê³„ì—´ ë°ì´í„° ìƒì„± (ë”¥ëŸ¬ë‹ ëª¨ë¸ìš©)</span><span class="sh">"""</span>
    <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    
    <span class="c1"># ì‹œê°„ ì¸ë±ìŠ¤
</span>    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    
    <span class="c1"># ë¹„ì„ í˜• íŠ¸ë Œë“œ
</span>    <span class="n">trend</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.0001</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">0.0000001</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>
    
    <span class="c1"># ë‹¤ì¤‘ ì£¼ê¸° ê³„ì ˆì„±
</span>    <span class="n">seasonality_1</span> <span class="o">=</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">365</span><span class="p">)</span>  <span class="c1"># ì—°ê°„
</span>    <span class="n">seasonality_2</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span>     <span class="c1"># ì£¼ê°„
</span>    <span class="n">seasonality_3</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>    <span class="c1"># ì¼ê°„
</span>    <span class="n">seasonality_4</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">12</span><span class="p">)</span>    <span class="c1"># ì›”ê°„
</span>    
    <span class="c1"># êµ¬ì¡°ì  ë³€í™” (ì—¬ëŸ¬ ë²ˆ ë°œìƒ)
</span>    <span class="n">structural_changes</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">change_points</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">n</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n</span><span class="o">//</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cp</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">change_points</span><span class="p">):</span>
        <span class="n">structural_changes</span><span class="p">[</span><span class="n">cp</span><span class="p">:]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">cp</span><span class="p">:]</span> <span class="o">/</span> <span class="mi">200</span><span class="p">)</span>
    
    <span class="c1"># ë¹„ì„ í˜• ìƒí˜¸ì‘ìš©
</span>    <span class="n">interaction</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span>
    
    <span class="c1"># ì‹œê°„ì— ë”°ë¼ ë³€í•˜ëŠ” ë…¸ì´ì¦ˆ
</span>    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
    
    <span class="c1"># ì´ìƒì¹˜ ì¶”ê°€
</span>    <span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="o">//</span><span class="mi">40</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">noise</span><span class="p">[</span><span class="n">outliers</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">))</span>
    
    <span class="c1"># ì „ì²´ ì‹œê³„ì—´
</span>    <span class="n">ts</span> <span class="o">=</span> <span class="n">trend</span> <span class="o">+</span> <span class="n">seasonality_1</span> <span class="o">+</span> <span class="n">seasonality_2</span> <span class="o">+</span> <span class="n">seasonality_3</span> <span class="o">+</span> <span class="n">seasonality_4</span> <span class="o">+</span> <span class="n">structural_changes</span> <span class="o">+</span> <span class="n">interaction</span> <span class="o">+</span> <span class="n">noise</span>
    
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Series</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="p">.</span><span class="nf">date_range</span><span class="p">(</span><span class="sh">'</span><span class="s">2020-01-01</span><span class="sh">'</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span><span class="p">))</span>

<span class="c1"># ë³µì¡í•œ ì‹œê³„ì—´ ìƒì„±
</span><span class="n">complex_ts</span> <span class="o">=</span> <span class="nf">generate_complex_timeseries</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>

<span class="c1"># ì‹œê°í™”
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">.</span><span class="n">index</span><span class="p">,</span> <span class="n">complex_ts</span><span class="p">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">ë³µì¡í•œ ì‹œê³„ì—´ ë°ì´í„° (ì „ì²´)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="n">complex_ts</span><span class="p">.</span><span class="n">values</span><span class="p">[:</span><span class="mi">200</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">ì²« 200ì¼ ë°ì´í„° (í™•ëŒ€)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="mi">800</span><span class="p">:</span><span class="mi">1000</span><span class="p">],</span> <span class="n">complex_ts</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="mi">800</span><span class="p">:</span><span class="mi">1000</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">800-1000ì¼ ë°ì´í„° (í™•ëŒ€)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:],</span> <span class="n">complex_ts</span><span class="p">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">200</span><span class="p">:],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">ë§ˆì§€ë§‰ 200ì¼ ë°ì´í„° (í™•ëŒ€)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì‹œê³„ì—´ ê¸¸ì´: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê°’ ë²”ìœ„: </span><span class="si">{</span><span class="n">complex_ts</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> ~ </span><span class="si">{</span><span class="n">complex_ts</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">í‰ê· : </span><span class="si">{</span><span class="n">complex_ts</span><span class="p">.</span><span class="nf">mean</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">complex_ts</span><span class="p">.</span><span class="nf">std</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ë°ì´í„°-ì „ì²˜ë¦¬-ë°-ì‹œí€€ìŠ¤-ìƒì„±">3. ë°ì´í„° ì „ì²˜ë¦¬ ë° ì‹œí€€ìŠ¤ ìƒì„±</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_sequences</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ì‹œí€€ìŠ¤ë¡œ ë³€í™˜</span><span class="sh">"""</span>
    <span class="n">sequences</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">targets</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">lookback</span> <span class="o">-</span> <span class="n">forecast_horizon</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">lookback</span><span class="p">]</span>
        <span class="n">target</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">lookback</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">lookback</span> <span class="o">+</span> <span class="n">forecast_horizon</span><span class="p">]</span>
        <span class="n">sequences</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
        <span class="n">targets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">sequences</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">normalize_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ì •ê·œí™”</span><span class="sh">"""</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>
    <span class="k">return</span> <span class="n">normalized</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span>

<span class="k">def</span> <span class="nf">denormalize_data</span><span class="p">(</span><span class="n">normalized_data</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì •ê·œí™”ëœ ë°ì´í„°ë¥¼ ì›ë˜ ìŠ¤ì¼€ì¼ë¡œ ë³µì›</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">normalized_data</span> <span class="o">*</span> <span class="n">std</span> <span class="o">+</span> <span class="n">mean</span>

<span class="c1"># ë°ì´í„° ì •ê·œí™”
</span><span class="n">ts_normalized</span><span class="p">,</span> <span class="n">mean_val</span><span class="p">,</span> <span class="n">std_val</span> <span class="o">=</span> <span class="nf">normalize_data</span><span class="p">(</span><span class="n">complex_ts</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>

<span class="c1"># ì‹œí€€ìŠ¤ ìƒì„±
</span><span class="n">lookback</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># ê³¼ê±° 100ì¼ ë°ì´í„° ì‚¬ìš©
</span><span class="n">forecast_horizon</span> <span class="o">=</span> <span class="mi">30</span>  <span class="c1"># 30ì¼ ì˜ˆì¸¡
</span><span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="nf">create_sequences</span><span class="p">(</span><span class="n">ts_normalized</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì‹œí€€ìŠ¤ ê°œìˆ˜: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì…ë ¥ í˜•íƒœ: </span><span class="si">{</span><span class="n">sequences</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">íƒ€ê²Ÿ í˜•íƒœ: </span><span class="si">{</span><span class="n">targets</span><span class="p">.</span><span class="n">shape</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># PyTorch í…ì„œë¡œ ë³€í™˜
</span><span class="n">sequences_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">sequences</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="n">targets_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nc">FloatTensor</span><span class="p">(</span><span class="n">targets</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="c1"># ë°ì´í„°ì…‹ ë¶„í•  (í•™ìŠµ:ê²€ì¦:í…ŒìŠ¤íŠ¸ = 7:2:1)
</span><span class="n">total_samples</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">total_samples</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="n">val_size</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">total_samples</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">)</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="n">total_samples</span> <span class="o">-</span> <span class="n">train_size</span> <span class="o">-</span> <span class="n">val_size</span>

<span class="n">train_sequences</span> <span class="o">=</span> <span class="n">sequences_tensor</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">train_targets</span> <span class="o">=</span> <span class="n">targets_tensor</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">val_sequences</span> <span class="o">=</span> <span class="n">sequences_tensor</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">]</span>
<span class="n">val_targets</span> <span class="o">=</span> <span class="n">targets_tensor</span><span class="p">[</span><span class="n">train_size</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">]</span>
<span class="n">test_sequences</span> <span class="o">=</span> <span class="n">sequences_tensor</span><span class="p">[</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">:]</span>
<span class="n">test_targets</span> <span class="o">=</span> <span class="n">targets_tensor</span><span class="p">[</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">val_size</span><span class="p">:]</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">í•™ìŠµ ë°ì´í„°: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê²€ì¦ ë°ì´í„°: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">val_sequences</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">í…ŒìŠ¤íŠ¸ ë°ì´í„°: </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># DataLoader ìƒì„±
</span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="nc">TensorDataset</span><span class="p">(</span><span class="n">train_sequences</span><span class="p">,</span> <span class="n">train_targets</span><span class="p">)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="nc">DataLoader</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">val_dataset</span> <span class="o">=</span> <span class="nc">TensorDataset</span><span class="p">(</span><span class="n">val_sequences</span><span class="p">,</span> <span class="n">val_targets</span><span class="p">)</span>
<span class="n">val_loader</span> <span class="o">=</span> <span class="nc">DataLoader</span><span class="p">(</span><span class="n">val_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="n">test_dataset</span> <span class="o">=</span> <span class="nc">TensorDataset</span><span class="p">(</span><span class="n">test_sequences</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">)</span>
<span class="n">test_loader</span> <span class="o">=</span> <span class="nc">DataLoader</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4-n-beats-ëª¨ë¸-êµ¬í˜„">4. N-BEATS ëª¨ë¸ êµ¬í˜„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NBEATSBlock</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">N-BEATS ë¸”ë¡ êµ¬í˜„</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">NBEATSBlock</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fc3</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fc4</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dropout</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Dropout</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># ì…ë ¥ì„ ê³ ì°¨ì›ìœ¼ë¡œ ë³€í™˜
</span>        <span class="n">h1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="n">h1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout</span><span class="p">(</span><span class="n">h1</span><span class="p">)</span>
        
        <span class="n">h2</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">fc2</span><span class="p">(</span><span class="n">h1</span><span class="p">))</span>
        <span class="n">h2</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout</span><span class="p">(</span><span class="n">h2</span><span class="p">)</span>
        
        <span class="n">h3</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">relu</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">fc3</span><span class="p">(</span><span class="n">h2</span><span class="p">))</span>
        <span class="n">h3</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">dropout</span><span class="p">(</span><span class="n">h3</span><span class="p">)</span>
        
        <span class="c1"># ì¶œë ¥ ìƒì„±
</span>        <span class="n">output</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">fc4</span><span class="p">(</span><span class="n">h3</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">output</span>

<span class="k">class</span> <span class="nc">NBEATS</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">N-BEATS ëª¨ë¸ êµ¬í˜„</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">lookback</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">num_blocks</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">NBEATS</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">lookback</span> <span class="o">=</span> <span class="n">lookback</span>
        <span class="n">self</span><span class="p">.</span><span class="n">forecast_horizon</span> <span class="o">=</span> <span class="n">forecast_horizon</span>
        <span class="n">self</span><span class="p">.</span><span class="n">num_blocks</span> <span class="o">=</span> <span class="n">num_blocks</span>
        
        <span class="c1"># N-BEATS ë¸”ë¡ë“¤
</span>        <span class="n">self</span><span class="p">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">ModuleList</span><span class="p">([</span>
            <span class="nc">NBEATSBlock</span><span class="p">(</span><span class="n">lookback</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">lookback</span> <span class="o">+</span> <span class="n">forecast_horizon</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_blocks</span><span class="p">)</span>
        <span class="p">])</span>
        
        <span class="c1"># ìµœì¢… ì˜ˆì¸¡ì„ ìœ„í•œ ì„ í˜• ë ˆì´ì–´
</span>        <span class="n">self</span><span class="p">.</span><span class="n">final_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">lookback</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="c1"># ì…ë ¥: (batch_size, lookback)
</span>        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="nf">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="c1"># ê° ë¸”ë¡ì„ í†µê³¼í•˜ë©° residual connection
</span>        <span class="n">residual</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">blocks</span><span class="p">):</span>
            <span class="c1"># ë¸”ë¡ ì¶œë ¥
</span>            <span class="n">block_output</span> <span class="o">=</span> <span class="nf">block</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span>
            
            <span class="c1"># Backcastì™€ Forecast ë¶„ë¦¬
</span>            <span class="n">backcast</span> <span class="o">=</span> <span class="n">block_output</span><span class="p">[:,</span> <span class="p">:</span><span class="n">self</span><span class="p">.</span><span class="n">lookback</span><span class="p">]</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">block_output</span><span class="p">[:,</span> <span class="n">self</span><span class="p">.</span><span class="n">lookback</span><span class="p">:]</span>
            
            <span class="c1"># Residual connection
</span>            <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">-</span> <span class="n">backcast</span>
            
            <span class="c1"># ì²« ë²ˆì§¸ ë¸”ë¡ì´ ì•„ë‹Œ ê²½ìš°ì—ë§Œ forecast ëˆ„ì 
</span>            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">total_forecast</span> <span class="o">=</span> <span class="n">forecast</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">total_forecast</span> <span class="o">=</span> <span class="n">total_forecast</span> <span class="o">+</span> <span class="n">forecast</span>
        
        <span class="c1"># ìµœì¢… ì˜ˆì¸¡
</span>        <span class="n">final_forecast</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">final_layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">total_forecast</span>
        
        <span class="k">return</span> <span class="n">final_forecast</span>

<span class="c1"># N-BEATS ëª¨ë¸ ìƒì„±
</span><span class="n">nbeats_model</span> <span class="o">=</span> <span class="nc">NBEATS</span><span class="p">(</span>
    <span class="n">lookback</span><span class="o">=</span><span class="n">lookback</span><span class="p">,</span>
    <span class="n">forecast_horizon</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">,</span>
    <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">num_blocks</span><span class="o">=</span><span class="mi">3</span>
<span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">N-BEATS ëª¨ë¸ íŒŒë¼ë¯¸í„° ìˆ˜: </span><span class="si">{</span><span class="nf">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">nbeats_model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">())</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì†ì‹¤ í•¨ìˆ˜ì™€ ì˜µí‹°ë§ˆì´ì €
</span><span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">MSELoss</span><span class="p">()</span>
<span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">nbeats_model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">scheduler</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="nc">ReduceLROnPlateau</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># í•™ìŠµ í•¨ìˆ˜
</span><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">):</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">train</span><span class="p">()</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>
        
        <span class="c1"># Forward pass
</span>        <span class="n">outputs</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        
        <span class="c1"># Backward pass
</span>        <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
        
        <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">):</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    <span class="n">total_loss</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="nf">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">total_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">total_loss</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">dataloader</span><span class="p">)</span>

<span class="c1"># N-BEATS ëª¨ë¸ í•™ìŠµ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== N-BEATS ëª¨ë¸ í•™ìŠµ ì‹œì‘ ===</span><span class="sh">"</span><span class="p">)</span>
<span class="n">num_epochs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">train_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">val_losses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="n">nbeats_model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">)</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="nf">validate_epoch</span><span class="p">(</span><span class="n">nbeats_model</span><span class="p">,</span> <span class="n">val_loader</span><span class="p">,</span> <span class="n">criterion</span><span class="p">)</span>
    
    <span class="n">train_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
    <span class="n">val_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
    
    <span class="c1"># Learning rate ìŠ¤ì¼€ì¤„ë§
</span>    <span class="n">scheduler</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
    
    <span class="nf">if </span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s">] - Train Loss: </span><span class="si">{</span><span class="n">train_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s">, Val Loss: </span><span class="si">{</span><span class="n">val_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Early stopping
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">val_losses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Early stopping at epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">break</span>

<span class="c1"># í•™ìŠµ ê³¼ì • ì‹œê°í™”
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Training Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Validation Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">N-BEATS ëª¨ë¸ í•™ìŠµ ê³¼ì •</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Epoch</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Loss (MSE)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ìµœì¢… ê²€ì¦ ì†ì‹¤: </span><span class="si">{</span><span class="n">val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="5-deepar-ëª¨ë¸-êµ¬í˜„">5. DeepAR ëª¨ë¸ êµ¬í˜„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DeepAR</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">DeepAR ëª¨ë¸ êµ¬í˜„</span><span class="sh">"""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_dim</span><span class="p">,</span> <span class="n">hidden_dim</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">(</span><span class="n">DeepAR</span><span class="p">,</span> <span class="n">self</span><span class="p">).</span><span class="nf">__init__</span><span class="p">()</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">hidden_dim</span> <span class="o">=</span> <span class="n">hidden_dim</span>
        <span class="n">self</span><span class="p">.</span><span class="n">num_layers</span> <span class="o">=</span> <span class="n">num_layers</span>
        <span class="n">self</span><span class="p">.</span><span class="n">output_dim</span> <span class="o">=</span> <span class="n">output_dim</span>
        
        <span class="c1"># LSTM ë ˆì´ì–´
</span>        <span class="n">self</span><span class="p">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">LSTM</span><span class="p">(</span>
            <span class="n">input_size</span><span class="o">=</span><span class="n">input_dim</span><span class="p">,</span>
            <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_dim</span><span class="p">,</span>
            <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">,</span>
            <span class="n">batch_first</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span>
        <span class="p">)</span>
        
        <span class="c1"># í™•ë¥  ë¶„í¬ íŒŒë¼ë¯¸í„°ë¥¼ ìœ„í•œ ì¶œë ¥ ë ˆì´ì–´
</span>        <span class="n">self</span><span class="p">.</span><span class="n">fc_mu</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fc_sigma</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">hidden_dim</span><span class="p">,</span> <span class="n">output_dim</span><span class="p">)</span>
        
        <span class="c1"># í™œì„±í™” í•¨ìˆ˜
</span>        <span class="n">self</span><span class="p">.</span><span class="n">softplus</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Softplus</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">hidden</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># LSTM ìˆœì „íŒŒ
</span>        <span class="n">lstm_out</span><span class="p">,</span> <span class="n">hidden</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">lstm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">hidden</span><span class="p">)</span>
        
        <span class="c1"># ë§ˆì§€ë§‰ ì‹œì ì˜ ì¶œë ¥ ì‚¬ìš©
</span>        <span class="n">last_output</span> <span class="o">=</span> <span class="n">lstm_out</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="c1"># í™•ë¥  ë¶„í¬ íŒŒë¼ë¯¸í„° ê³„ì‚°
</span>        <span class="n">mu</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">fc_mu</span><span class="p">(</span><span class="n">last_output</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">softplus</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">fc_sigma</span><span class="p">(</span><span class="n">last_output</span><span class="p">))</span> <span class="o">+</span> <span class="mf">1e-6</span>  <span class="c1"># ì•ˆì •ì„±ì„ ìœ„í•œ ì‘ì€ ê°’ ì¶”ê°€
</span>        
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">hidden</span>
    
    <span class="k">def</span> <span class="nf">init_hidden</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì€ë‹‰ ìƒíƒœ ì´ˆê¸°í™”</span><span class="sh">"""</span>
        <span class="nf">return </span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">hidden_dim</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">),</span>
                <span class="n">torch</span><span class="p">.</span><span class="nf">zeros</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">hidden_dim</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">))</span>

<span class="c1"># DeepAR ëª¨ë¸ ìƒì„±
</span><span class="n">deepar_model</span> <span class="o">=</span> <span class="nc">DeepAR</span><span class="p">(</span>
    <span class="n">input_dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">hidden_dim</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">output_dim</span><span class="o">=</span><span class="n">forecast_horizon</span>
<span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">DeepAR ëª¨ë¸ íŒŒë¼ë¯¸í„° ìˆ˜: </span><span class="si">{</span><span class="nf">sum</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="nf">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">deepar_model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">())</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># DeepARìš© ì†ì‹¤ í•¨ìˆ˜ (Negative Log Likelihood)
</span><span class="k">def</span> <span class="nf">nll_loss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">targets</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì •ê·œë¶„í¬ ê°€ì • í•˜ì˜ Negative Log Likelihood ì†ì‹¤</span><span class="sh">"""</span>
    <span class="c1"># ì •ê·œë¶„í¬ì˜ NLL ê³„ì‚°
</span>    <span class="n">nll</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">torch</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">targets</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">torch</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">nll</span><span class="p">)</span>

<span class="c1"># DeepAR ëª¨ë¸ í•™ìŠµ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== DeepAR ëª¨ë¸ í•™ìŠµ ì‹œì‘ ===</span><span class="sh">"</span><span class="p">)</span>
<span class="n">deepar_optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="nc">Adam</span><span class="p">(</span><span class="n">deepar_model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">deepar_scheduler</span> <span class="o">=</span> <span class="n">optim</span><span class="p">.</span><span class="n">lr_scheduler</span><span class="p">.</span><span class="nc">ReduceLROnPlateau</span><span class="p">(</span><span class="n">deepar_optimizer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">min</span><span class="sh">'</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">deepar_train_losses</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">deepar_val_losses</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_epochs</span><span class="p">):</span>
    <span class="c1"># í•™ìŠµ
</span>    <span class="n">deepar_model</span><span class="p">.</span><span class="nf">train</span><span class="p">()</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
        <span class="n">deepar_optimizer</span><span class="p">.</span><span class="nf">zero_grad</span><span class="p">()</span>
        
        <span class="c1"># ì…ë ¥ í˜•íƒœ ì¡°ì • (batch_size, lookback, 1)
</span>        <span class="n">sequences_reshaped</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">deepar_model</span><span class="p">(</span><span class="n">sequences_reshaped</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="nf">nll_loss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        
        <span class="n">loss</span><span class="p">.</span><span class="nf">backward</span><span class="p">()</span>
        <span class="n">deepar_optimizer</span><span class="p">.</span><span class="nf">step</span><span class="p">()</span>
        
        <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>
    
    <span class="n">train_loss</span> <span class="o">=</span> <span class="n">train_loss</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span>
    
    <span class="c1"># ê²€ì¦
</span>    <span class="n">deepar_model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">val_loader</span><span class="p">:</span>
            <span class="n">sequences_reshaped</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">deepar_model</span><span class="p">(</span><span class="n">sequences_reshaped</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="nf">nll_loss</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">val_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="p">.</span><span class="nf">item</span><span class="p">()</span>
    
    <span class="n">val_loss</span> <span class="o">=</span> <span class="n">val_loss</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">val_loader</span><span class="p">)</span>
    
    <span class="n">deepar_train_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">train_loss</span><span class="p">)</span>
    <span class="n">deepar_val_losses</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
    
    <span class="c1"># Learning rate ìŠ¤ì¼€ì¤„ë§
</span>    <span class="n">deepar_scheduler</span><span class="p">.</span><span class="nf">step</span><span class="p">(</span><span class="n">val_loss</span><span class="p">)</span>
    
    <span class="nf">if </span><span class="p">(</span><span class="n">epoch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s">/</span><span class="si">{</span><span class="n">num_epochs</span><span class="si">}</span><span class="s">] - Train Loss: </span><span class="si">{</span><span class="n">train_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="s">, Val Loss: </span><span class="si">{</span><span class="n">val_loss</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># Early stopping
</span>    <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">deepar_val_losses</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">20</span> <span class="ow">and</span> <span class="n">deepar_val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">deepar_val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">20</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Early stopping at epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">break</span>

<span class="c1"># DeepAR í•™ìŠµ ê³¼ì • ì‹œê°í™”
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">deepar_train_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Training Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">deepar_val_losses</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">Validation Loss</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">DeepAR ëª¨ë¸ í•™ìŠµ ê³¼ì •</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Epoch</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">Loss (NLL)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">DeepAR ìµœì¢… ê²€ì¦ ì†ì‹¤: </span><span class="si">{</span><span class="n">deepar_val_losses</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">6</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="6-ëª¨ë¸-ì„±ëŠ¥-ë¹„êµ-ë°-ë¶„ì„">6. ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ ë° ë¶„ì„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">dataloader</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">is_deepar</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ëª¨ë¸ ì„±ëŠ¥ í‰ê°€</span><span class="sh">"""</span>
    <span class="n">model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    <span class="n">all_predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_targets</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">sequences</span><span class="p">,</span> <span class="n">targets</span> <span class="ow">in</span> <span class="n">dataloader</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_deepar</span><span class="p">:</span>
                <span class="c1"># DeepAR ëª¨ë¸
</span>                <span class="n">sequences_reshaped</span> <span class="o">=</span> <span class="n">sequences</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">sequences_reshaped</span><span class="p">)</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">mu</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># N-BEATS ëª¨ë¸
</span>                <span class="n">predictions</span> <span class="o">=</span> <span class="nf">model</span><span class="p">(</span><span class="n">sequences</span><span class="p">)</span>
            
            <span class="n">all_predictions</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">predictions</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">())</span>
            <span class="n">all_targets</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">targets</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">())</span>
    
    <span class="c1"># ì˜ˆì¸¡ê°’ê³¼ íƒ€ê²Ÿì„ í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°
</span>    <span class="n">all_predictions</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">(</span><span class="n">all_predictions</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">all_targets</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">(</span><span class="n">all_targets</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># ì„±ëŠ¥ ì§€í‘œ ê³„ì‚°
</span>    <span class="n">mse</span> <span class="o">=</span> <span class="nf">mean_squared_error</span><span class="p">(</span><span class="n">all_targets</span><span class="p">.</span><span class="nf">flatten</span><span class="p">(),</span> <span class="n">all_predictions</span><span class="p">.</span><span class="nf">flatten</span><span class="p">())</span>
    <span class="n">mae</span> <span class="o">=</span> <span class="nf">mean_absolute_error</span><span class="p">(</span><span class="n">all_targets</span><span class="p">.</span><span class="nf">flatten</span><span class="p">(),</span> <span class="n">all_predictions</span><span class="p">.</span><span class="nf">flatten</span><span class="p">())</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s"> ì„±ëŠ¥:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">all_predictions</span><span class="p">,</span> <span class="n">all_targets</span><span class="p">,</span> <span class="p">(</span><span class="n">mse</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">rmse</span><span class="p">)</span>

<span class="c1"># ëª¨ë¸ ì„±ëŠ¥ í‰ê°€
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== ëª¨ë¸ ì„±ëŠ¥ í‰ê°€ ===</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># N-BEATS ì„±ëŠ¥
</span><span class="n">nbeats_pred</span><span class="p">,</span> <span class="n">nbeats_target</span><span class="p">,</span> <span class="n">nbeats_metrics</span> <span class="o">=</span> <span class="nf">evaluate_model</span><span class="p">(</span>
    <span class="n">nbeats_model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="sh">"</span><span class="s">N-BEATS</span><span class="sh">"</span><span class="p">,</span> <span class="n">is_deepar</span><span class="o">=</span><span class="bp">False</span>
<span class="p">)</span>

<span class="c1"># DeepAR ì„±ëŠ¥
</span><span class="n">deepar_pred</span><span class="p">,</span> <span class="n">deepar_target</span><span class="p">,</span> <span class="n">deepar_metrics</span> <span class="o">=</span> <span class="nf">evaluate_model</span><span class="p">(</span>
    <span class="n">deepar_model</span><span class="p">,</span> <span class="n">test_loader</span><span class="p">,</span> <span class="sh">"</span><span class="s">DeepAR</span><span class="sh">"</span><span class="p">,</span> <span class="n">is_deepar</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>

<span class="c1"># ì„±ëŠ¥ ë¹„êµ ì‹œê°í™”
</span><span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>

<span class="c1"># 1. ì˜ˆì¸¡ vs ì‹¤ì œê°’ ë¹„êµ (ì²« ë²ˆì§¸ ìƒ˜í”Œ)
</span><span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">nbeats_target</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">ì‹¤ì œê°’</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">nbeats_pred</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">N-BEATS ì˜ˆì¸¡</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">N-BEATS: ì˜ˆì¸¡ vs ì‹¤ì œê°’ (ì²« ë²ˆì§¸ ìƒ˜í”Œ)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì˜ˆì¸¡ ê¸°ê°„</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">deepar_target</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">ì‹¤ì œê°’</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">deepar_pred</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">DeepAR ì˜ˆì¸¡</span><span class="sh">'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">green</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">DeepAR: ì˜ˆì¸¡ vs ì‹¤ì œê°’ (ì²« ë²ˆì§¸ ìƒ˜í”Œ)</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì˜ˆì¸¡ ê¸°ê°„</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># 2. ì „ì²´ ì„±ëŠ¥ ë¹„êµ
</span><span class="n">plt</span><span class="p">.</span><span class="nf">subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">N-BEATS</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">DeepAR</span><span class="sh">'</span><span class="p">]</span>
<span class="n">rmse_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="n">mae_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">models</span><span class="p">))</span>
<span class="n">width</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">rmse_values</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">bar</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">width</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">mae_values</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">MAE</span><span class="sh">'</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ëª¨ë¸</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì˜¤ì°¨</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">models</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>

<span class="c1"># ì„±ëŠ¥ ìš”ì•½ í…Œì´ë¸”
</span><span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">ëª¨ë¸</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="sh">'</span><span class="s">N-BEATS</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">DeepAR</span><span class="sh">'</span><span class="p">],</span>
    <span class="sh">'</span><span class="s">MSE</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
    <span class="sh">'</span><span class="s">MAE</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
    <span class="sh">'</span><span class="s">RMSE</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
<span class="p">})</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== ì„±ëŠ¥ ë¹„êµ ìš”ì•½ ===</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">results_df</span><span class="p">.</span><span class="nf">to_string</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>

<span class="c1"># ìŠ¹ì ê²°ì •
</span><span class="k">if</span> <span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>  <span class="c1"># RMSE ê¸°ì¤€
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">ğŸ† N-BEATS ëª¨ë¸ì´ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ë³´ì…ë‹ˆë‹¤! (RMSE: </span><span class="si">{</span><span class="n">nbeats_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">ğŸ† DeepAR ëª¨ë¸ì´ ë” ë‚˜ì€ ì„±ëŠ¥ì„ ë³´ì…ë‹ˆë‹¤! (RMSE: </span><span class="si">{</span><span class="n">deepar_metrics</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. í™•ë¥ ì  ì˜ˆì¸¡ ì‹œê°í™” (DeepAR)
</span><span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">test_loader</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="c1"># í…ŒìŠ¤íŠ¸ ë°ì´í„°ì—ì„œ ìƒ˜í”Œ ì¶”ì¶œ
</span>    <span class="n">test_batch</span> <span class="o">=</span> <span class="nf">next</span><span class="p">(</span><span class="nf">iter</span><span class="p">(</span><span class="n">test_loader</span><span class="p">))</span>
    <span class="n">test_sequences</span><span class="p">,</span> <span class="n">test_targets</span> <span class="o">=</span> <span class="n">test_batch</span>
    
    <span class="n">deepar_model</span><span class="p">.</span><span class="nf">eval</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">torch</span><span class="p">.</span><span class="nf">no_grad</span><span class="p">():</span>
        <span class="n">sequences_reshaped</span> <span class="o">=</span> <span class="n">test_sequences</span><span class="p">.</span><span class="nf">unsqueeze</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">).</span><span class="nf">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nf">deepar_model</span><span class="p">(</span><span class="n">sequences_reshaped</span><span class="p">)</span>
        
        <span class="c1"># ì—¬ëŸ¬ ìƒ˜í”Œ ìƒì„± (Monte Carlo ì‹œë®¬ë ˆì´ì…˜)
</span>        <span class="n">num_samples</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_samples</span><span class="p">):</span>
            <span class="c1"># ì •ê·œë¶„í¬ì—ì„œ ìƒ˜í”Œë§
</span>            <span class="n">noise</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">randn_like</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
            <span class="n">sample</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">+</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">noise</span>
            <span class="n">samples</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">sample</span><span class="p">.</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">())</span>
        
        <span class="n">samples</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>  <span class="c1"># (num_samples, batch_size, forecast_horizon)
</span>        
        <span class="c1"># ì²« ë²ˆì§¸ ìƒ˜í”Œì˜ ì˜ˆì¸¡ êµ¬ê°„ ì‹œê°í™”
</span>        <span class="n">sample_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">forecast_horizons</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="n">forecast_horizon</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
        
        <span class="c1"># ì‹¤ì œê°’
</span>        <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">forecast_horizons</span><span class="p">,</span> <span class="n">test_targets</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">],</span> 
                <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">ì‹¤ì œê°’</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># ì˜ˆì¸¡ê°’ (í‰ê· )
</span>        <span class="n">plt</span><span class="p">.</span><span class="nf">plot</span><span class="p">(</span><span class="n">forecast_horizons</span><span class="p">,</span> <span class="n">mu</span><span class="p">[</span><span class="n">sample_idx</span><span class="p">].</span><span class="nf">cpu</span><span class="p">().</span><span class="nf">numpy</span><span class="p">(),</span> 
                <span class="n">label</span><span class="o">=</span><span class="sh">'</span><span class="s">DeepAR ì˜ˆì¸¡ (í‰ê· )</span><span class="sh">'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># ì‹ ë¢° êµ¬ê°„
</span>        <span class="n">percentiles</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">percentiles</span><span class="p">):</span>
            <span class="n">percentile_values</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">percentile</span><span class="p">(</span><span class="n">samples</span><span class="p">[:,</span> <span class="n">sample_idx</span><span class="p">,</span> <span class="p">:],</span> <span class="n">p</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># í•˜ìœ„ êµ¬ê°„
</span>                <span class="n">plt</span><span class="p">.</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">forecast_horizons</span><span class="p">,</span> <span class="n">percentile_values</span><span class="p">,</span> 
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">,</span> 
                               <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s">% ì‹ ë¢° êµ¬ê°„</span><span class="sh">'</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sh">''</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># ìƒìœ„ êµ¬ê°„
</span>                <span class="n">plt</span><span class="p">.</span><span class="nf">fill_between</span><span class="p">(</span><span class="n">forecast_horizons</span><span class="p">,</span> <span class="n">percentile_values</span><span class="p">,</span> 
                               <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">DeepAR í™•ë¥ ì  ì˜ˆì¸¡ ë° ì‹ ë¢° êµ¬ê°„</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ì˜ˆì¸¡ ê¸°ê°„</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">ê°’</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">DeepAR ì˜ˆì¸¡ì˜ ë¶ˆí™•ì‹¤ì„±:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  í‰ê·  í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">sigma</span><span class="p">.</span><span class="nf">mean</span><span class="p">().</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  ìµœëŒ€ í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">sigma</span><span class="p">.</span><span class="nf">max</span><span class="p">().</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  ìµœì†Œ í‘œì¤€í¸ì°¨: </span><span class="si">{</span><span class="n">sigma</span><span class="p">.</span><span class="nf">min</span><span class="p">().</span><span class="nf">item</span><span class="p">()</span><span class="si">:</span><span class="p">.</span><span class="mi">4</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ë‹¤ìŒ-ë‹¨ê³„-ë°-í™•ì¥">ğŸš€ ë‹¤ìŒ ë‹¨ê³„ ë° í™•ì¥</h2>

<h3 id="part-3ì—ì„œ-ë‹¤ë£°-ë‚´ìš©">Part 3ì—ì„œ ë‹¤ë£° ë‚´ìš©</h3>

<ol>
  <li><strong>Transformer ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡</strong>
    <ul>
      <li>Informer: íš¨ìœ¨ì ì¸ Attention ë©”ì»¤ë‹ˆì¦˜</li>
      <li>Autoformer: ìë™í™”ëœ ì‹œê³„ì—´ ë¶„í•´</li>
      <li>FEDformer: ì£¼íŒŒìˆ˜ ë„ë©”ì¸ ê¸°ë°˜ ì˜ˆì¸¡</li>
    </ul>
  </li>
  <li><strong>ìµœì‹  LLM ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡</strong>
    <ul>
      <li>TimeGPT: ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸ ê¸°ë°˜ ì˜ˆì¸¡</li>
      <li>Lag-Llama: ì˜¤í”ˆì†ŒìŠ¤ ëŒ€ì•ˆ</li>
    </ul>
  </li>
  <li><strong>ì‹¤ë¬´ ì ìš© ë° ìµœì í™”</strong>
    <ul>
      <li>í•˜ì´í¼íŒŒë¼ë¯¸í„° íŠœë‹</li>
      <li>ì•™ìƒë¸” ë°©ë²•</li>
      <li>ë„ë©”ì¸ë³„ ìµœì í™”</li>
    </ul>
  </li>
</ol>

<h3 id="ì¶”ê°€-ê°œì„ -ë°©í–¥">ì¶”ê°€ ê°œì„  ë°©í–¥</h3>

<ol>
  <li><strong>ëª¨ë¸ ì•„í‚¤í…ì²˜ ê°œì„ </strong>
    <ul>
      <li>ë” ê¹Šì€ ë„¤íŠ¸ì›Œí¬ êµ¬ì¡°</li>
      <li>Attention ë©”ì»¤ë‹ˆì¦˜ ë„ì…</li>
      <li>Residual connection ìµœì í™”</li>
    </ul>
  </li>
  <li><strong>ë°ì´í„° ì¦ê°•</strong>
    <ul>
      <li>ë…¸ì´ì¦ˆ ì¶”ê°€</li>
      <li>ì‹œê³„ì—´ ë³€í˜•</li>
      <li>ì ëŒ€ì  í•™ìŠµ</li>
    </ul>
  </li>
  <li><strong>ì•™ìƒë¸” ë°©ë²•</strong>
    <ul>
      <li>ì—¬ëŸ¬ ëª¨ë¸ì˜ ì˜ˆì¸¡ ê²°í•©</li>
      <li>ê°€ì¤‘ í‰ê· </li>
      <li>Stacking</li>
    </ul>
  </li>
</ol>

<h2 id="-í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="ì´ë²ˆ-íŒŒíŠ¸ì—ì„œ-í•™ìŠµí•œ-ë‚´ìš©">ì´ë²ˆ íŒŒíŠ¸ì—ì„œ í•™ìŠµí•œ ë‚´ìš©</h3>

<ol>
  <li><strong>ë”¥ëŸ¬ë‹ ê¸°ë°˜ ì‹œê³„ì—´ ì˜ˆì¸¡ì˜ ë“±ì¥ ë°°ê²½</strong>
    <ul>
      <li>ì „í†µì  ë°©ë²•ì˜ í•œê³„</li>
      <li>ë”¥ëŸ¬ë‹ì˜ í˜ì‹ ì  íŠ¹ì§•</li>
    </ul>
  </li>
  <li><strong>N-BEATS ëª¨ë¸</strong>
    <ul>
      <li>ë¸”ë¡ ê¸°ë°˜ ì•„í‚¤í…ì²˜</li>
      <li>í•´ì„ ê°€ëŠ¥í•œ êµ¬ì¡°</li>
      <li>ì´ì¤‘ ì¶œë ¥ (Backcast + Forecast)</li>
    </ul>
  </li>
  <li><strong>DeepAR ëª¨ë¸</strong>
    <ul>
      <li>í™•ë¥ ì  ì˜ˆì¸¡</li>
      <li>LSTM ê¸°ë°˜ ì•„í‚¤í…ì²˜</li>
      <li>ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™”</li>
    </ul>
  </li>
  <li><strong>ì‹¤ì œ êµ¬í˜„</strong>
    <ul>
      <li>PyTorchë¥¼ ì‚¬ìš©í•œ ëª¨ë¸ êµ¬í˜„</li>
      <li>ë°ì´í„° ì „ì²˜ë¦¬ ë° ì‹œí€€ìŠ¤ ìƒì„±</li>
      <li>ëª¨ë¸ í•™ìŠµ ë° ì„±ëŠ¥ í‰ê°€</li>
    </ul>
  </li>
</ol>

<h3 id="í•µì‹¬-ê°œë…-ì •ë¦¬">í•µì‹¬ ê°œë… ì •ë¦¬</h3>

<table>
  <thead>
    <tr>
      <th>ëª¨ë¸</th>
      <th>íŠ¹ì§•</th>
      <th>ì¥ì </th>
      <th>ë‹¨ì </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>N-BEATS</strong></td>
      <td>ë¸”ë¡ ê¸°ë°˜, í•´ì„ ê°€ëŠ¥</td>
      <td>ë¹ ë¥¸ í•™ìŠµ, í™•ì¥ì„±</td>
      <td>ë³µì¡í•œ íŒ¨í„´ í•™ìŠµ í•œê³„</td>
    </tr>
    <tr>
      <td><strong>DeepAR</strong></td>
      <td>í™•ë¥ ì  ì˜ˆì¸¡, LSTM ê¸°ë°˜</td>
      <td>ë¶ˆí™•ì‹¤ì„± ì •ëŸ‰í™”, ì™¸ë¶€ ë³€ìˆ˜ í™œìš©</td>
      <td>í•™ìŠµ ì‹œê°„, ê³„ì‚° ë³µì¡ë„</td>
    </tr>
  </tbody>
</table>

<h3 id="ì‹¤ë¬´-ì ìš©-ì‹œ-ê³ ë ¤ì‚¬í•­">ì‹¤ë¬´ ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­</h3>

<ol>
  <li><strong>ë°ì´í„° íŠ¹ì„±ì— ë”°ë¥¸ ëª¨ë¸ ì„ íƒ</strong>
    <ul>
      <li>ë‹¨ìˆœí•œ íŒ¨í„´: N-BEATS</li>
      <li>ë³µì¡í•œ íŒ¨í„´ + ë¶ˆí™•ì‹¤ì„±: DeepAR</li>
    </ul>
  </li>
  <li><strong>ê³„ì‚° ìì› ê³ ë ¤</strong>
    <ul>
      <li>ì œí•œëœ ìì›: N-BEATS</li>
      <li>ì¶©ë¶„í•œ ìì›: DeepAR</li>
    </ul>
  </li>
  <li><strong>í•´ì„ ê°€ëŠ¥ì„± ìš”êµ¬ì‚¬í•­</strong>
    <ul>
      <li>ë†’ì€ ìš”êµ¬ì‚¬í•­: N-BEATS</li>
      <li>ì¤‘ê°„ ìš”êµ¬ì‚¬í•­: DeepAR</li>
    </ul>
  </li>
</ol>

<hr />

<p><em>ì´ë²ˆ íŒŒíŠ¸ì—ì„œëŠ” ë”¥ëŸ¬ë‹ì˜ í˜ì„ í™œìš©í•œ ì‹œê³„ì—´ ì˜ˆì¸¡ì„ ê²½í—˜í–ˆìŠµë‹ˆë‹¤. N-BEATSì˜ í•´ì„ ê°€ëŠ¥í•œ êµ¬ì¡°ì™€ DeepARì˜ í™•ë¥ ì  ì˜ˆì¸¡ì„ í†µí•´ ë”ìš± ì •êµí•œ ì‹œê³„ì—´ ë¶„ì„ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤!</em> ğŸ¯</p>

<p><em>ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” Transformer ê¸°ë°˜ ëª¨ë¸ë“¤ì„ í†µí•´ ì¥ê¸° ì˜ì¡´ì„± ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ìµœì‹  ì‹œê³„ì—´ ì˜ˆì¸¡ ê¸°ìˆ ì˜ ìµœì „ì„ ì„ ê²½í—˜í•´ë³´ì„¸ìš”!</em> ğŸš€</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
          
          
      
      
        
        
        <a href="/data-ai/2025/08/31/time-series-basics.html" class="nav-link prev">
          â† ì´ì „: Part 1: ì‹œê³„ì—´ ì˜ˆì¸¡ì˜ ê¸°ì´ˆ - ARIMAë¶€í„° Prophetê¹Œì§€
        </a>
      
      
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-ai/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
