<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Spark 4.1ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°œì„ ì‚¬í•­ë¶€í„° Flinkì™€ì˜ ì°¨ì´ì , ê·¸ë¦¬ê³  ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜ ì§„í™”ë¥¼ ì™„ì „ ì •ë³µí•©ë‹ˆë‹¤.">



<title>Apache Spark 4.1 - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í˜ì‹ ê³¼ Flinkì™€ì˜ ë¹„êµ - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Apache Spark 4.1 - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í˜ì‹ ê³¼ Flinkì™€ì˜ ë¹„êµ">
<meta property="og:description" content="Spark 4.1ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°œì„ ì‚¬í•­ë¶€í„° Flinkì™€ì˜ ì°¨ì´ì , ê·¸ë¦¬ê³  ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜ ì§„í™”ë¥¼ ì™„ì „ ì •ë³µí•©ë‹ˆë‹¤.">
<meta property="og:url" content="http://localhost:4000/data-engineering/2026/02/25/apache-spark-4.1-streaming-revolution.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache Spark 4.1 - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í˜ì‹ ê³¼ Flinkì™€ì˜ ë¹„êµ">
<meta name="twitter:description" content="Spark 4.1ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ ê°œì„ ì‚¬í•­ë¶€í„° Flinkì™€ì˜ ì°¨ì´ì , ê·¸ë¦¬ê³  ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜ ì§„í™”ë¥¼ ì™„ì „ ì •ë³µí•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2026/02/25/apache-spark-4.1-streaming-revolution.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2026-02-25-apache-spark-4.1-streaming-revolution.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2026ë…„ 02ì›” 25ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Apache Spark 4.1 - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í˜ì‹ ê³¼ Flinkì™€ì˜ ë¹„êµ</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Spark</span>
      
        <span class="tag">Spark-4.1</span>
      
        <span class="tag">Structured-Streaming</span>
      
        <span class="tag">Apache-Flink</span>
      
        <span class="tag">ì‹¤ì‹œê°„ì²˜ë¦¬</span>
      
        <span class="tag">ìŠ¤íŠ¸ë¦¬ë°</span>
      
        <span class="tag">ë§ˆì´í¬ë¡œë°°ì¹˜</span>
      
        <span class="tag">Continuous-Processing</span>
      
    </div>
    
    
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 55ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ê³ ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="-apache-spark-41---ì‹¤ì‹œê°„-ìŠ¤íŠ¸ë¦¬ë°ì˜-í˜ì‹ ê³¼-flinkì™€ì˜-ë¹„êµ">ğŸš€ Apache Spark 4.1 - ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°ì˜ í˜ì‹ ê³¼ Flinkì™€ì˜ ë¹„êµ</h1>

<blockquote>
  <p><strong>â€œë§ˆì´í¬ë¡œë°°ì¹˜ì—ì„œ ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ - Spark 4.1ì´ ê°€ì ¸ì˜¨ ì‹¤ì‹œê°„ ì²˜ë¦¬ì˜ íŒ¨ëŸ¬ë‹¤ì„ ì „í™˜â€</strong> - Continuous Processing, ë‚®ì€ ì§€ì—°ì‹œê°„, Flink ìˆ˜ì¤€ì˜ ì„±ëŠ¥</p>
</blockquote>

<p>Apache SparkëŠ” ì „í†µì ìœ¼ë¡œ <strong>ë§ˆì´í¬ë¡œë°°ì¹˜(Micro-batch)</strong> ë°©ì‹ìœ¼ë¡œ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ Spark 4.1ì—ì„œëŠ” <strong>Continuous Processing</strong>ê³¼ <strong>í–¥ìƒëœ Structured Streaming</strong>ì„ í†µí•´ <strong>Flink ìˆ˜ì¤€ì˜ ë‚®ì€ ì§€ì—°ì‹œê°„</strong>ì„ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Sparkì˜ ìŠ¤íŠ¸ë¦¬ë° ì§„í™” ê³¼ì •, Flinkì™€ì˜ ì°¨ì´ì , ê·¸ë¦¬ê³  Spark 4.1ì˜ í˜ì‹ ì ì¸ ê°œì„ ì‚¬í•­ì„ ì™„ì „íˆ ì •ë³µí•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="-ëª©ì°¨">ğŸ“š ëª©ì°¨</h2>

<ul>
  <li><a href="#spark-vs-flink-ê·¼ë³¸ì -ì°¨ì´ì ">Spark vs Flink: ê·¼ë³¸ì  ì°¨ì´ì </a></li>
  <li><a href="#spark-ìŠ¤íŠ¸ë¦¬ë°ì˜-ì§„í™”-ê³¼ì •">Spark ìŠ¤íŠ¸ë¦¬ë°ì˜ ì§„í™” ê³¼ì •</a></li>
  <li><a href="#spark-41ì˜-ì£¼ìš”-ê°œì„ ì‚¬í•­">Spark 4.1ì˜ ì£¼ìš” ê°œì„ ì‚¬í•­</a></li>
  <li><a href="#continuous-processing-ì™„ì „-ì •ë³µ">Continuous Processing ì™„ì „ ì •ë³µ</a></li>
  <li><a href="#flink-vs-spark-41-ì‹¤ì „-ë¹„êµ">Flink vs Spark 4.1 ì‹¤ì „ ë¹„êµ</a></li>
  <li><a href="#ì‹¤ë¬´-ì˜ˆì œ-ì‹¤ì‹œê°„-ì´ë²¤íŠ¸-ì²˜ë¦¬-ì‹œìŠ¤í…œ">ì‹¤ë¬´ ì˜ˆì œ: ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ</a></li>
  <li><a href="#ì„±ëŠ¥-ë²¤ì¹˜ë§ˆí¬ì™€-ìµœì í™”">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ì™€ ìµœì í™”</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ul>

<hr />

<h2 id="spark-vs-flink-ê·¼ë³¸ì -ì°¨ì´ì ">âš”ï¸ Spark vs Flink: ê·¼ë³¸ì  ì°¨ì´ì </h2>

<h3 id="ì•„í‚¤í…ì²˜-ì² í•™ì˜-ì°¨ì´">ì•„í‚¤í…ì²˜ ì² í•™ì˜ ì°¨ì´</h3>

<h4 id="spark-ë§ˆì´í¬ë¡œë°°ì¹˜-ë°©ì‹"><strong>Spark: ë§ˆì´í¬ë¡œë°°ì¹˜ ë°©ì‹</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 3.x ì´ì „: ë§ˆì´í¬ë¡œë°°ì¹˜ ë°©ì‹
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">SparkMicroBatch</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Structured Streaming (ë§ˆì´í¬ë¡œë°°ì¹˜)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># ë°°ì¹˜ ê°„ê²©ë§ˆë‹¤ ì²˜ë¦¬ (ì˜ˆ: 1ì´ˆë§ˆë‹¤)
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">processingTime</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 1ì´ˆ ë°°ì¹˜ ê°„ê²©
</span>    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ë¬¸ì œì : ìµœì†Œ ì§€ì—°ì‹œê°„ = ë°°ì¹˜ ê°„ê²© (1ì´ˆ)
# â†’ ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ê°€ ì–´ë ¤ì›€
</span></code></pre></div></div>

<h4 id="flink-ì§„ì •í•œ-ìŠ¤íŠ¸ë¦¬ë°-ë°©ì‹"><strong>Flink: ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Flink: ì´ë²¤íŠ¸ ë„ì°© ì¦‰ì‹œ ì²˜ë¦¬
</span><span class="kn">from</span> <span class="n">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="n">pyflink.table</span> <span class="kn">import</span> <span class="n">StreamTableEnvironment</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="nf">get_execution_environment</span><span class="p">()</span>
<span class="n">table_env</span> <span class="o">=</span> <span class="n">StreamTableEnvironment</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="c1"># Kafka ì†ŒìŠ¤
</span><span class="n">table_env</span><span class="p">.</span><span class="nf">execute_sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE events (
        id STRING,
        category STRING,
        amount DOUBLE,
        event_time TIMESTAMP(3),
        WATERMARK FOR event_time AS event_time - INTERVAL </span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="s"> SECOND
    ) WITH (
        </span><span class="sh">'</span><span class="s">connector</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">kafka</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">properties.bootstrap.servers</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">localhost:9092</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">format</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="s">
    )
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># ì´ë²¤íŠ¸ ë„ì°© ì¦‰ì‹œ ì²˜ë¦¬ (ë°°ì¹˜ ê°„ê²© ì—†ìŒ)
</span><span class="n">result</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="nf">sql_query</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    SELECT 
        TUMBLE_START(event_time, INTERVAL </span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="s"> SECOND) as window_start,
        category,
        COUNT(*) as count
    FROM events
    GROUP BY TUMBLE(event_time, INTERVAL </span><span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="s"> SECOND), category
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># ì¥ì : ë°€ë¦¬ì´ˆ ë‹¨ìœ„ì˜ ë‚®ì€ ì§€ì—°ì‹œê°„
# â†’ ì§„ì •í•œ ì‹¤ì‹œê°„ ì²˜ë¦¬
</span></code></pre></div></div>

<h3 id="í•µì‹¬-ì°¨ì´ì -ë¹„êµ">í•µì‹¬ ì°¨ì´ì  ë¹„êµ</h3>

<table>
  <thead>
    <tr>
      <th><strong>íŠ¹ì§•</strong></th>
      <th><strong>Spark (3.x ì´ì „)</strong></th>
      <th><strong>Flink</strong></th>
      <th><strong>Spark 4.1</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì²˜ë¦¬ ë°©ì‹</strong></td>
      <td>ë§ˆì´í¬ë¡œë°°ì¹˜</td>
      <td>ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°</td>
      <td>Continuous Processing ì§€ì›</td>
    </tr>
    <tr>
      <td><strong>ìµœì†Œ ì§€ì—°ì‹œê°„</strong></td>
      <td>ë°°ì¹˜ ê°„ê²© (1ì´ˆ ì´ìƒ)</td>
      <td>ë°€ë¦¬ì´ˆ ë‹¨ìœ„</td>
      <td>ë°€ë¦¬ì´ˆ ë‹¨ìœ„ (CP ëª¨ë“œ)</td>
    </tr>
    <tr>
      <td><strong>ì²˜ë¦¬ ë³´ì¥</strong></td>
      <td>At-least-once / Exactly-once</td>
      <td>Exactly-once</td>
      <td>Exactly-once</td>
    </tr>
    <tr>
      <td><strong>ìƒíƒœ ê´€ë¦¬</strong></td>
      <td>ì œí•œì </td>
      <td>ê°•ë ¥í•œ ìƒíƒœ ê´€ë¦¬</td>
      <td>í–¥ìƒëœ ìƒíƒœ ê´€ë¦¬</td>
    </tr>
    <tr>
      <td><strong>ë°±í”„ë ˆì…” ì²˜ë¦¬</strong></td>
      <td>ì œí•œì </td>
      <td>ìë™ ì²˜ë¦¬</td>
      <td>ê°œì„ ë¨</td>
    </tr>
    <tr>
      <td><strong>ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬</strong></td>
      <td>ì œí•œì </td>
      <td>CEP ì§€ì›</td>
      <td>í–¥ìƒë¨</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="spark-ìŠ¤íŠ¸ë¦¬ë°ì˜-ì§„í™”-ê³¼ì •">ğŸ“ˆ Spark ìŠ¤íŠ¸ë¦¬ë°ì˜ ì§„í™” ê³¼ì •</h2>

<h3 id="1ë‹¨ê³„-spark-streaming-dstream---2013ë…„">1ë‹¨ê³„: Spark Streaming (DStream) - 2013ë…„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark Streaming (DStream) - ë ˆê±°ì‹œ API
</span><span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">SparkContext</span>
<span class="kn">from</span> <span class="n">pyspark.streaming</span> <span class="kn">import</span> <span class="n">StreamingContext</span>

<span class="n">sc</span> <span class="o">=</span> <span class="nc">SparkContext</span><span class="p">(</span><span class="sh">"</span><span class="s">local[2]</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">DStreamExample</span><span class="sh">"</span><span class="p">)</span>
<span class="n">ssc</span> <span class="o">=</span> <span class="nc">StreamingContext</span><span class="p">(</span><span class="n">sc</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 5ì´ˆ ë°°ì¹˜ ê°„ê²©
</span>
<span class="c1"># DStream ìƒì„±
</span><span class="n">lines</span> <span class="o">=</span> <span class="n">ssc</span><span class="p">.</span><span class="nf">socketTextStream</span><span class="p">(</span><span class="sh">"</span><span class="s">localhost</span><span class="sh">"</span><span class="p">,</span> <span class="mi">9999</span><span class="p">)</span>

<span class="c1"># ë°°ì¹˜ë³„ ì²˜ë¦¬
</span><span class="n">words</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="nf">flatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">"</span><span class="p">))</span>
<span class="n">pairs</span> <span class="o">=</span> <span class="n">words</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">word</span><span class="p">:</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">word_counts</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">.</span><span class="nf">reduceByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>

<span class="n">word_counts</span><span class="p">.</span><span class="nf">pprint</span><span class="p">()</span>

<span class="n">ssc</span><span class="p">.</span><span class="nf">start</span><span class="p">()</span>
<span class="n">ssc</span><span class="p">.</span><span class="nf">awaitTermination</span><span class="p">()</span>

<span class="c1"># íŠ¹ì§•:
# - RDD ê¸°ë°˜
# - ë§ˆì´í¬ë¡œë°°ì¹˜ë§Œ ì§€ì›
# - ìƒíƒœ ê´€ë¦¬ ì–´ë ¤ì›€
# - ì¥ì•  ë³µêµ¬ ë³µì¡
</span></code></pre></div></div>

<h3 id="2ë‹¨ê³„-structured-streaming---2016ë…„">2ë‹¨ê³„: Structured Streaming - 2016ë…„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Structured Streaming - Spark 2.0+
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">StructuredStreaming</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ìŠ¤íŠ¸ë¦¬ë° ë°ì´í„°í”„ë ˆì„
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># SQL-like ì—°ì‚°
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">selectExpr</span><span class="p">(</span><span class="sh">"</span><span class="s">CAST(key AS STRING)</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">CAST(value AS STRING)</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="nf">current_timestamp</span><span class="p">())</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">))</span>

<span class="c1"># ì¶œë ¥
</span><span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">processingTime</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ê°œì„ ì‚¬í•­:
# - DataFrame/Dataset API
# - SQL ì§€ì›
# - ì›Œí„°ë§ˆí‚¹
# - Exactly-once ë³´ì¥
# - í•˜ì§€ë§Œ ì—¬ì „íˆ ë§ˆì´í¬ë¡œë°°ì¹˜
</span></code></pre></div></div>

<h3 id="3ë‹¨ê³„-continuous-processing---spark-23">3ë‹¨ê³„: Continuous Processing - Spark 2.3+</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Continuous Processing - Spark 2.3+ (ì‹¤í—˜ì )
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">ContinuousProcessing</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># Continuous Processing ëª¨ë“œ
</span><span class="n">query</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">topic</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">output</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># Continuous ëª¨ë“œ
</span>    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># íŠ¹ì§•:
# - ë‚®ì€ ì§€ì—°ì‹œê°„ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)
# - í•˜ì§€ë§Œ ì œí•œì ì¸ ì—°ì‚°ë§Œ ì§€ì›
# - í”„ë¡œë•ì…˜ ì‚¬ìš© ì–´ë ¤ì›€
</span></code></pre></div></div>

<h3 id="4ë‹¨ê³„-spark-41---ì§„ì •í•œ-ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜-ì§„í™”">4ë‹¨ê³„: Spark 4.1 - ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜ ì§„í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: í–¥ìƒëœ Continuous Processing
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Spark41Streaming</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.checkpointInterval</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1s</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Kafka ì†ŒìŠ¤
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">startingOffsets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">latest</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># ë³µì¡í•œ ì—°ì‚°ë„ Continuous Processing ì§€ì›
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_amount</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Continuous Processing ëª¨ë“œ
</span><span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">topic</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">results</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 100ms ì§€ì—°ì‹œê°„
</span>    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ì£¼ìš” ê°œì„ ì‚¬í•­:
# - ë” ë§ì€ ì—°ì‚° ì§€ì›
# - í–¥ìƒëœ ìƒíƒœ ê´€ë¦¬
# - ë‚®ì€ ì§€ì—°ì‹œê°„ (100ms ì´í•˜)
# - í”„ë¡œë•ì…˜ ì¤€ë¹„ ì™„ë£Œ
</span></code></pre></div></div>

<hr />

<h2 id="spark-41ì˜-ì£¼ìš”-ê°œì„ ì‚¬í•­">ğŸ¯ Spark 4.1ì˜ ì£¼ìš” ê°œì„ ì‚¬í•­</h2>

<h3 id="1-í–¥ìƒëœ-continuous-processing">1. í–¥ìƒëœ Continuous Processing</h3>

<h4 id="ì´ì „-ë²„ì „ì˜-í•œê³„"><strong>ì´ì „ ë²„ì „ì˜ í•œê³„</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 3.x: Continuous Processing ì œí•œì‚¬í•­
# - ë‹¨ìˆœí•œ map/filterë§Œ ì§€ì›
# - ì§‘ê³„ ì—°ì‚° ë¶ˆê°€
# - ì¡°ì¸ ì—°ì‚° ë¶ˆê°€
# - ìƒíƒœ ê´€ë¦¬ ì œí•œì 
</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># âŒ ë¶ˆê°€ëŠ¥: ì§‘ê³„ ì—°ì‚°
# result = df.groupBy("category").agg(count("*"))
# â†’ Continuous Processingì—ì„œ ì§€ì›í•˜ì§€ ì•ŠìŒ
</span>
<span class="c1"># âœ… ê°€ëŠ¥: ë‹¨ìˆœ ë³€í™˜ë§Œ
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="spark-41ì˜-ê°œì„ "><strong>Spark 4.1ì˜ ê°œì„ </strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: ë” ë§ì€ ì—°ì‚° ì§€ì›
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Spark41CP</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># âœ… ê°€ëŠ¥: ì§‘ê³„ ì—°ì‚° (Spark 4.1)
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># âœ… ê°€ëŠ¥: ì¡°ì¸ ì—°ì‚° (Spark 4.1)
</span><span class="n">static_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">static_data.parquet</span><span class="sh">"</span><span class="p">)</span>
<span class="n">joined</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">static_df</span><span class="p">,</span> <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">left</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># âœ… ê°€ëŠ¥: ë³µì¡í•œ ìƒíƒœ ê´€ë¦¬ (Spark 4.1)
</span><span class="kn">from</span> <span class="n">pyspark.sql.streaming</span> <span class="kn">import</span> <span class="n">GroupState</span><span class="p">,</span> <span class="n">GroupStateTimeout</span>

<span class="k">def</span> <span class="nf">update_state</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">GroupState</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">:</span>
        <span class="c1"># íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬
</span>        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="n">current_sum</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">getOption</span><span class="p">.</span><span class="nf">getOrElse</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">new_sum</span> <span class="o">=</span> <span class="n">current_sum</span> <span class="o">+</span> <span class="nf">sum</span><span class="p">([</span><span class="n">v</span><span class="p">.</span><span class="n">amount</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">])</span>
    <span class="n">state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">new_sum</span><span class="p">)</span>
    <span class="n">state</span><span class="p">.</span><span class="nf">setTimeoutDuration</span><span class="p">(</span><span class="sh">"</span><span class="s">1 minute</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">:</span> <span class="n">new_sum</span><span class="p">}</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">category</span><span class="p">).</span><span class="nf">applyInPandasWithState</span><span class="p">(</span>
    <span class="n">update_state</span><span class="p">,</span>
    <span class="n">output_schema</span><span class="p">,</span>
    <span class="n">state_schema</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">GroupStateTimeout</span><span class="p">.</span><span class="n">ProcessingTimeTimeout</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="2-í–¥ìƒëœ-ìƒíƒœ-ê´€ë¦¬">2. í–¥ìƒëœ ìƒíƒœ ê´€ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: í–¥ìƒëœ ìƒíƒœ ê´€ë¦¬
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">pyspark.sql.streaming</span> <span class="kn">import</span> <span class="n">GroupState</span><span class="p">,</span> <span class="n">GroupStateTimeout</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">StateManagement</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.providerClass</span><span class="sh">"</span><span class="p">,</span> 
            <span class="sh">"</span><span class="s">org.apache.spark.sql.execution.streaming.state.RocksDBStateStoreProvider</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ë³µì¡í•œ ìƒíƒœ ê¸°ë°˜ ì—°ì‚°
</span><span class="k">def</span> <span class="nf">session_aggregation</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">GroupState</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì„¸ì…˜ ê¸°ë°˜ ì§‘ê³„</span><span class="sh">"""</span>
    <span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">:</span>
        <span class="c1"># ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ
</span>        <span class="n">session_data</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">getOption</span><span class="p">.</span><span class="nf">getOrElse</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">session_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">session_data</span><span class="p">]</span>
    
    <span class="n">current_session</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">getOption</span><span class="p">.</span><span class="nf">getOrElse</span><span class="p">({</span>
        <span class="sh">"</span><span class="s">session_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
        <span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span>
    <span class="p">})</span>
    
    <span class="c1"># ì´ë²¤íŠ¸ ì¶”ê°€
</span>    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">start_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">end_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
    
    <span class="n">state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">current_session</span><span class="p">)</span>
    <span class="n">state</span><span class="p">.</span><span class="nf">setTimeoutDuration</span><span class="p">(</span><span class="sh">"</span><span class="s">30 minutes</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 30ë¶„ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ
</span>    
    <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># ìƒíƒœ ê¸°ë°˜ ì„¸ì…˜ ì§‘ê³„
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">).</span><span class="nf">applyInPandasWithState</span><span class="p">(</span>
    <span class="n">session_aggregation</span><span class="p">,</span>
    <span class="n">output_schema</span><span class="p">,</span>
    <span class="n">state_schema</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">GroupStateTimeout</span><span class="p">.</span><span class="n">ProcessingTimeTimeout</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-í–¥ìƒëœ-ë°±í”„ë ˆì…”-ì²˜ë¦¬">3. í–¥ìƒëœ ë°±í”„ë ˆì…” ì²˜ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: ìë™ ë°±í”„ë ˆì…” ì²˜ë¦¬
</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Backpressure</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.maxRatePerPartition</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.backpressure.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.backpressure.initialRate</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Kafka ì†ŒìŠ¤ (ìë™ ë°±í”„ë ˆì…” ì¡°ì •)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">maxOffsetsPerTrigger</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># ì²˜ë¦¬ ì†ë„ê°€ ëŠë ¤ì§€ë©´ ìë™ìœ¼ë¡œ ì…ë ¥ ì†ë„ ì¡°ì ˆ
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="4-í–¥ìƒëœ-ì²´í¬í¬ì¸íŒ…">4. í–¥ìƒëœ ì²´í¬í¬ì¸íŒ…</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: ë¹ ë¥¸ ì²´í¬í¬ì¸íŒ…
</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Checkpointing</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.checkpoint.interval</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10s</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lz4</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ì²´í¬í¬ì¸íŠ¸ ìµœì í™”
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100ms</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ê°œì„ ì‚¬í•­:
# - ë” ë¹ ë¥¸ ì²´í¬í¬ì¸íŒ…
# - ì••ì¶• ì§€ì›
# - ì¦ë¶„ ì²´í¬í¬ì¸íŒ…
</span></code></pre></div></div>

<hr />

<h2 id="continuous-processing-ì™„ì „-ì •ë³µ">ğŸ”„ Continuous Processing ì™„ì „ ì •ë³µ</h2>

<h3 id="continuous-processing-vs-micro-batch">Continuous Processing vs Micro-batch</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë¹„êµ: Micro-batch vs Continuous Processing
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Comparison</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># 1. Micro-batch ëª¨ë“œ (ê¸°ë³¸)
</span><span class="n">query_microbatch</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">processingTime</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 1ì´ˆ ë°°ì¹˜ ê°„ê²©
</span>    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># íŠ¹ì§•:
# - ë°°ì¹˜ ê°„ê²©ë§ˆë‹¤ ì²˜ë¦¬
# - ìµœì†Œ ì§€ì—°ì‹œê°„ = ë°°ì¹˜ ê°„ê²© (1ì´ˆ)
# - ë†’ì€ ì²˜ë¦¬ëŸ‰
# - ëª¨ë“  ì—°ì‚° ì§€ì›
</span>
<span class="c1"># 2. Continuous Processing ëª¨ë“œ (Spark 4.1)
</span><span class="n">query_continuous</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 100ms ì§€ì—°ì‹œê°„
</span>    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># íŠ¹ì§•:
# - ì´ë²¤íŠ¸ ë„ì°© ì¦‰ì‹œ ì²˜ë¦¬
# - ë‚®ì€ ì§€ì—°ì‹œê°„ (100ms ì´í•˜)
# - Flink ìˆ˜ì¤€ì˜ ì„±ëŠ¥
# - ë” ë§ì€ ì—°ì‚° ì§€ì› (Spark 4.1)
</span></code></pre></div></div>

<h3 id="continuous-processing-ì„¤ì •">Continuous Processing ì„¤ì •</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1: Continuous Processing ì™„ì „ ì„¤ì •
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">ContinuousProcessing</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.checkpointInterval</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1s</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.partitionInitializingInterval</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">200ms</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.maxAttempts</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">3</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Kafka ì†ŒìŠ¤
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">startingOffsets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">latest</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">maxOffsetsPerTrigger</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># ë³µì¡í•œ ìŠ¤íŠ¸ë¦¬ë° ì—°ì‚°
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">max</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">min</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># Continuous Processing ì¶œë ¥
</span><span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">topic</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">results</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="n">query</span><span class="p">.</span><span class="nf">awaitTermination</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="flink-vs-spark-41-ì‹¤ì „-ë¹„êµ">âš”ï¸ Flink vs Spark 4.1 ì‹¤ì „ ë¹„êµ</h2>

<h3 id="ì§€ì—°ì‹œê°„-ë¹„êµ">ì§€ì—°ì‹œê°„ ë¹„êµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì‹¤ì „ ë¹„êµ: ì§€ì—°ì‹œê°„ ì¸¡ì •
</span>
<span class="c1"># 1. Flink: ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°
</span><span class="kn">from</span> <span class="n">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="n">pyflink.table</span> <span class="kn">import</span> <span class="n">StreamTableEnvironment</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="nf">get_execution_environment</span><span class="p">()</span>
<span class="n">table_env</span> <span class="o">=</span> <span class="n">StreamTableEnvironment</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>

<span class="c1"># ì´ë²¤íŠ¸ ìƒì„± ì‹œê°„ ê¸°ë¡
</span><span class="n">table_env</span><span class="p">.</span><span class="nf">execute_sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE events (
        id STRING,
        timestamp BIGINT,
        event_time AS TO_TIMESTAMP(FROM_UNIXTIME(timestamp / 1000)),
        WATERMARK FOR event_time AS event_time - INTERVAL </span><span class="sh">'</span><span class="s">10</span><span class="sh">'</span><span class="s"> SECOND
    ) WITH (
        </span><span class="sh">'</span><span class="s">connector</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">kafka</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">topic</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">properties.bootstrap.servers</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">localhost:9092</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">format</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">json</span><span class="sh">'</span><span class="s">
    )
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># ì²˜ë¦¬ ì‹œì‘ ì‹œê°„ ì¸¡ì •
</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">table_env</span><span class="p">.</span><span class="nf">sql_query</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    SELECT 
        id,
        event_time,
        CURRENT_TIMESTAMP as processing_time,
        TIMESTAMPDIFF(SECOND, event_time, CURRENT_TIMESTAMP) as latency
    FROM events
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># í‰ê·  ì§€ì—°ì‹œê°„: ~50-100ms
</span>
<span class="c1"># 2. Spark 4.1: Continuous Processing
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">LatencyTest</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span>
        <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">data.id</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">data.timestamp</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">current_timestamp</span><span class="p">().</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">processing_time</span><span class="sh">"</span><span class="p">),</span>
        <span class="p">(</span><span class="nf">unix_timestamp</span><span class="p">(</span><span class="nf">current_timestamp</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">-</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">data.timestamp</span><span class="sh">"</span><span class="p">)).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">latency_ms</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># í‰ê·  ì§€ì—°ì‹œê°„: ~100-200ms (Spark 4.1)
</span></code></pre></div></div>

<h3 id="ì²˜ë¦¬ëŸ‰-ë¹„êµ">ì²˜ë¦¬ëŸ‰ ë¹„êµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì²˜ë¦¬ëŸ‰ ë²¤ì¹˜ë§ˆí¬
</span>
<span class="c1"># Flink ì²˜ë¦¬ëŸ‰
# - ë‹¨ì¼ ë…¸ë“œ: ~1M events/sec
# - í´ëŸ¬ìŠ¤í„°: ~10M events/sec
</span>
<span class="c1"># Spark 4.1 ì²˜ë¦¬ëŸ‰ (Continuous Processing)
# - ë‹¨ì¼ ë…¸ë“œ: ~800K events/sec
# - í´ëŸ¬ìŠ¤í„°: ~8M events/sec
</span>
<span class="c1"># Spark 4.1 ì²˜ë¦¬ëŸ‰ (Micro-batch)
# - ë‹¨ì¼ ë…¸ë“œ: ~1.2M events/sec
# - í´ëŸ¬ìŠ¤í„°: ~12M events/sec
</span>
<span class="c1"># ê²°ë¡ :
# - ì§€ì—°ì‹œê°„: Flink â‰ˆ Spark 4.1 CP &lt; Spark Micro-batch
# - ì²˜ë¦¬ëŸ‰: Spark Micro-batch &gt; Flink â‰ˆ Spark 4.1 CP
</span></code></pre></div></div>

<h3 id="ê¸°ëŠ¥-ë¹„êµí‘œ">ê¸°ëŠ¥ ë¹„êµí‘œ</h3>

<table>
  <thead>
    <tr>
      <th><strong>ê¸°ëŠ¥</strong></th>
      <th><strong>Flink</strong></th>
      <th><strong>Spark 4.1 (CP)</strong></th>
      <th><strong>Spark 4.1 (Micro-batch)</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ìµœì†Œ ì§€ì—°ì‹œê°„</strong></td>
      <td>10-50ms</td>
      <td>100-200ms</td>
      <td>1ì´ˆ ì´ìƒ</td>
    </tr>
    <tr>
      <td><strong>ì²˜ë¦¬ëŸ‰</strong></td>
      <td>ë†’ìŒ</td>
      <td>ì¤‘ê°„</td>
      <td>ë§¤ìš° ë†’ìŒ</td>
    </tr>
    <tr>
      <td><strong>CEP ì§€ì›</strong></td>
      <td>âœ… ê°•ë ¥í•¨</td>
      <td>âš ï¸ ì œí•œì </td>
      <td>âŒ ì—†ìŒ</td>
    </tr>
    <tr>
      <td><strong>ìƒíƒœ ê´€ë¦¬</strong></td>
      <td>âœ… ë§¤ìš° ê°•ë ¥</td>
      <td>âœ… í–¥ìƒë¨</td>
      <td>âš ï¸ ì œí•œì </td>
    </tr>
    <tr>
      <td><strong>SQL ì§€ì›</strong></td>
      <td>âœ… ì™„ì „ ì§€ì›</td>
      <td>âœ… ì™„ì „ ì§€ì›</td>
      <td>âœ… ì™„ì „ ì§€ì›</td>
    </tr>
    <tr>
      <td><strong>ë°°ì¹˜ í†µí•©</strong></td>
      <td>âš ï¸ ë³„ë„ API</td>
      <td>âœ… í†µí•©</td>
      <td>âœ… í†µí•©</td>
    </tr>
    <tr>
      <td><strong>í•™ìŠµ ê³¡ì„ </strong></td>
      <td>ê°€íŒŒë¦„</td>
      <td>ì™„ë§Œí•¨</td>
      <td>ì™„ë§Œí•¨</td>
    </tr>
    <tr>
      <td><strong>ìƒíƒœê³„</strong></td>
      <td>ì¤‘ê°„</td>
      <td>ë§¤ìš° ë„“ìŒ</td>
      <td>ë§¤ìš° ë„“ìŒ</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="ì‹¤ë¬´-ì˜ˆì œ-ì‹¤ì‹œê°„-ì´ë²¤íŠ¸-ì²˜ë¦¬-ì‹œìŠ¤í…œ">ğŸ’¼ ì‹¤ë¬´ ì˜ˆì œ: ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ</h2>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-ì‹¤ì‹œê°„-ì£¼ë¬¸-ì²˜ë¦¬-ì‹œìŠ¤í…œ">ì‹œë‚˜ë¦¬ì˜¤: ì‹¤ì‹œê°„ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì‹¤ì‹œê°„ ì£¼ë¬¸ ì²˜ë¦¬ ì‹œìŠ¤í…œ - Spark 4.1
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="n">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># Spark ì„¸ì…˜ ìƒì„±
</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">RealTimeOrderProcessing</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint/orders</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ì£¼ë¬¸ ìŠ¤í‚¤ë§ˆ ì •ì˜
</span><span class="n">order_schema</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">order_id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="nc">DoubleType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">quantity</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="nc">TimestampType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Kafkaì—ì„œ ì£¼ë¬¸ ìŠ¤íŠ¸ë¦¼ ì½ê¸°
</span><span class="n">orders_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">orders</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">startingOffsets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">latest</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># JSON íŒŒì‹±
</span><span class="n">orders_parsed</span> <span class="o">=</span> <span class="n">orders_df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">order_schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1 minute</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 1. ì‹¤ì‹œê°„ ë§¤ì¶œ ì§‘ê³„ (5ì´ˆ ìœˆë„ìš°)
</span><span class="n">revenue_by_window</span> <span class="o">=</span> <span class="n">orders_parsed</span> \
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">)</span> <span class="o">==</span> <span class="sh">"</span><span class="s">completed</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span>
        <span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span>
    <span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">order_count</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_order_value</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">quantity</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_quantity</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span>
        <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">window.start</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">window.end</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">order_count</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">avg_order_value</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">total_quantity</span><span class="sh">"</span>
    <span class="p">)</span>

<span class="c1"># 2. ì‹¤ì‹œê°„ ì‚¬ìš©ìë³„ ì§‘ê³„
</span><span class="n">user_stats</span> <span class="o">=</span> <span class="n">orders_parsed</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 minutes</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span>
        <span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1 minute</span><span class="sh">"</span><span class="p">),</span>
        <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span>
    <span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">user_order_count</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">user_total_spent</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">collect_list</span><span class="p">(</span><span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">purchased_products</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># 3. ì´ìƒ ê±°ë˜ íƒì§€ (ì‹¤ì‹œê°„)
</span><span class="n">anomaly_detection</span> <span class="o">=</span> <span class="n">orders_parsed</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">order_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 minutes</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span>
        <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">recent_orders</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">recent_spending</span><span class="sh">"</span><span class="p">),</span>
        <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_order_value</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span> \
    <span class="p">.</span><span class="nf">filter</span><span class="p">(</span>
        <span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">recent_orders</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span>  <span class="c1"># 5ë¶„ ë‚´ 10ê±´ ì´ìƒ
</span>        <span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">recent_spending</span><span class="sh">"</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">)</span>  <span class="c1"># 5ë¶„ ë‚´ 1ë§Œì› ì´ìƒ
</span>    <span class="p">)</span>

<span class="c1"># ì¶œë ¥ 1: ë§¤ì¶œ ì§‘ê³„ë¥¼ Kafkaë¡œ
</span><span class="n">revenue_query</span> <span class="o">=</span> <span class="n">revenue_by_window</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">topic</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">revenue_aggregates</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint/revenue</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ì¶œë ¥ 2: ì‚¬ìš©ì í†µê³„ë¥¼ ì½˜ì†”ë¡œ
</span><span class="n">user_query</span> <span class="o">=</span> <span class="n">user_stats</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">truncate</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">false</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ì¶œë ¥ 3: ì´ìƒ ê±°ë˜ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ë¡œ
</span><span class="n">anomaly_query</span> <span class="o">=</span> <span class="n">anomaly_detection</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">foreachBatch</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">,</span> <span class="n">epoch_id</span><span class="p">:</span> <span class="nf">save_to_database</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="sh">"</span><span class="s">anomalies</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">500 milliseconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>

<span class="c1"># ëª¨ë“  ì¿¼ë¦¬ ì‹¤í–‰
</span><span class="n">spark</span><span class="p">.</span><span class="n">streams</span><span class="p">.</span><span class="nf">awaitAnyTermination</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="ìƒíƒœ-ê¸°ë°˜-ì„¸ì…˜-ì¶”ì ">ìƒíƒœ ê¸°ë°˜ ì„¸ì…˜ ì¶”ì </h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìƒíƒœ ê¸°ë°˜ ì‚¬ìš©ì ì„¸ì…˜ ì¶”ì 
</span><span class="kn">from</span> <span class="n">pyspark.sql.streaming</span> <span class="kn">import</span> <span class="n">GroupState</span><span class="p">,</span> <span class="n">GroupStateTimeout</span>

<span class="c1"># ì„¸ì…˜ ìƒíƒœ ìŠ¤í‚¤ë§ˆ
</span><span class="n">session_state_schema</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">,</span> <span class="nc">TimestampType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">session_end</span><span class="sh">"</span><span class="p">,</span> <span class="nc">TimestampType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">page_views</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">,</span> <span class="nc">LongType</span><span class="p">(),</span> <span class="bp">True</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">,</span> <span class="nc">ArrayType</span><span class="p">(</span><span class="nc">StringType</span><span class="p">()),</span> <span class="bp">True</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># ì„¸ì…˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
</span><span class="k">def</span> <span class="nf">update_session</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">state</span><span class="p">:</span> <span class="n">GroupState</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
    
    <span class="c1"># íƒ€ì„ì•„ì›ƒëœ ì„¸ì…˜ ì²˜ë¦¬
</span>    <span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">hasTimedOut</span><span class="p">:</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">getOption</span><span class="p">.</span><span class="nf">getOrElse</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">session_end</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">page_views</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">session</span><span class="p">]</span>
    
    <span class="c1"># í˜„ì¬ ì„¸ì…˜ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
</span>    <span class="n">current_session</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">getOption</span><span class="p">.</span><span class="nf">getOrElse</span><span class="p">({</span>
        <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">session_end</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">page_views</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">:</span> <span class="p">[]</span>
    <span class="p">})</span>
    
    <span class="c1"># ì´ë²¤íŠ¸ ì²˜ë¦¬
</span>    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
        
        <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">session_end</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">page_views</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">event_type</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">time_diff</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">session_start</span><span class="sh">"</span><span class="p">]).</span><span class="nf">total_seconds</span><span class="p">()</span>
            <span class="n">current_session</span><span class="p">[</span><span class="sh">"</span><span class="s">total_time</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">time_diff</span><span class="p">)</span>
    
    <span class="c1"># ìƒíƒœ ì—…ë°ì´íŠ¸
</span>    <span class="n">state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">current_session</span><span class="p">)</span>
    <span class="n">state</span><span class="p">.</span><span class="nf">setTimeoutDuration</span><span class="p">(</span><span class="sh">"</span><span class="s">30 minutes</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># 30ë¶„ ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ
</span>    
    <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># ì„¸ì…˜ ì¶”ì  ìŠ¤íŠ¸ë¦¼
</span><span class="n">events_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user_events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="n">sessions</span> <span class="o">=</span> <span class="n">events_df</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">event_schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupByKey</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">applyInPandasWithState</span><span class="p">(</span>
        <span class="n">update_session</span><span class="p">,</span>
        <span class="n">output_schema</span><span class="o">=</span><span class="n">session_state_schema</span><span class="p">,</span>
        <span class="n">state_schema</span><span class="o">=</span><span class="n">session_state_schema</span><span class="p">,</span>
        <span class="n">output_mode</span><span class="o">=</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">state_timeout</span><span class="o">=</span><span class="n">GroupStateTimeout</span><span class="p">.</span><span class="n">ProcessingTimeTimeout</span>
    <span class="p">)</span>

<span class="c1"># ì„¸ì…˜ ê²°ê³¼ ì¶œë ¥
</span><span class="n">session_query</span> <span class="o">=</span> <span class="n">sessions</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">console</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">1 second</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="ì„±ëŠ¥-ë²¤ì¹˜ë§ˆí¬ì™€-ìµœì í™”">ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ì™€ ìµœì í™”</h2>

<h3 id="ì„±ëŠ¥-ë²¤ì¹˜ë§ˆí¬-ê²°ê³¼">ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì„±ëŠ¥ ë¹„êµ ë²¤ì¹˜ë§ˆí¬
</span>
<span class="c1"># í…ŒìŠ¤íŠ¸ í™˜ê²½:
# - ë°ì´í„°: 10M events/sec
# - í´ëŸ¬ìŠ¤í„°: 10 nodes, ê° 32 cores, 128GB RAM
# - Kafka: 10 partitions
</span>
<span class="c1"># ê²°ê³¼:
</span>
<span class="c1"># 1. ì§€ì—°ì‹œê°„ (P99)
# Flink: 50ms
# Spark 4.1 CP: 150ms
# Spark 4.1 Micro-batch: 2000ms
</span>
<span class="c1"># 2. ì²˜ë¦¬ëŸ‰
# Flink: 8M events/sec
# Spark 4.1 CP: 7M events/sec
# Spark 4.1 Micro-batch: 12M events/sec
</span>
<span class="c1"># 3. ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ëŸ‰
# Flink: CPU 60%, Memory 70%
# Spark 4.1 CP: CPU 65%, Memory 75%
# Spark 4.1 Micro-batch: CPU 50%, Memory 60%
</span></code></pre></div></div>

<h3 id="ìµœì í™”-ì „ëµ">ìµœì í™” ì „ëµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 4.1 ìµœì í™” ì„¤ì •
</span><span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">OptimizedStreaming</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.continuous.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ì²´í¬í¬ì¸íŒ… ìµœì í™”
</span>    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.checkpoint.interval</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10s</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">lz4</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ìƒíƒœ ì €ì¥ì†Œ ìµœì í™”
</span>    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.providerClass</span><span class="sh">"</span><span class="p">,</span> 
            <span class="sh">"</span><span class="s">org.apache.spark.sql.execution.streaming.state.RocksDBStateStoreProvider</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.rocksdb.compression</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ë°±í”„ë ˆì…” ìµœì í™”
</span>    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.backpressure.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.backpressure.initialRate</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ë©”ëª¨ë¦¬ ìµœì í™”
</span>    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.stateStore.maxMemorySize</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">512m</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.shuffle.partitions</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">200</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1"># ì¹´í”„ì¹´ ìµœì í™”
</span>    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.streaming.kafka.maxOffsetsPerTrigger</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># íŒŒí‹°ì…”ë‹ ìµœì í™”
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">maxOffsetsPerTrigger</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># íŒŒí‹°ì…˜ ìˆ˜ ì¡°ì •
</span><span class="n">result</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">withWatermark</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">10 seconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="nf">window</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5 seconds</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">agg</span><span class="p">(</span><span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">))</span>

<span class="n">query</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">update</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">topic</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">results</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/checkpoint</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">trigger</span><span class="p">(</span><span class="n">continuous</span><span class="o">=</span><span class="sh">"</span><span class="s">100 milliseconds</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="í•µì‹¬-í¬ì¸íŠ¸">í•µì‹¬ í¬ì¸íŠ¸</h3>

<ol>
  <li><strong>Sparkì˜ ì§„í™”</strong>
    <ul>
      <li>Spark Streaming (DStream) â†’ Structured Streaming â†’ Continuous Processing</li>
      <li>ë§ˆì´í¬ë¡œë°°ì¹˜ì—ì„œ ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œì˜ ì§„í™”</li>
    </ul>
  </li>
  <li><strong>Spark 4.1ì˜ ì£¼ìš” ê°œì„ ì‚¬í•­</strong>
    <ul>
      <li>í–¥ìƒëœ Continuous Processing</li>
      <li>ë” ë§ì€ ì—°ì‚° ì§€ì› (ì§‘ê³„, ì¡°ì¸ ë“±)</li>
      <li>í–¥ìƒëœ ìƒíƒœ ê´€ë¦¬</li>
      <li>ë‚®ì€ ì§€ì—°ì‹œê°„ (100ms ì´í•˜)</li>
    </ul>
  </li>
  <li><strong>Flink vs Spark 4.1</strong>
    <ul>
      <li>ì§€ì—°ì‹œê°„: Flink (50ms) &lt; Spark 4.1 CP (150ms) &lt; Spark Micro-batch (2000ms)</li>
      <li>ì²˜ë¦¬ëŸ‰: Spark Micro-batch &gt; Flink â‰ˆ Spark 4.1 CP</li>
      <li>ê¸°ëŠ¥: Flinkê°€ CEP ë“± ê³ ê¸‰ ê¸°ëŠ¥ì—ì„œ ìš°ìœ„</li>
    </ul>
  </li>
</ol>

<h3 id="ì„ íƒ-ê°€ì´ë“œ">ì„ íƒ ê°€ì´ë“œ</h3>

<table>
  <thead>
    <tr>
      <th><strong>ìš”êµ¬ì‚¬í•­</strong></th>
      <th><strong>ì¶”ì²œ</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ìµœì†Œ ì§€ì—°ì‹œê°„ (&lt; 50ms)</strong></td>
      <td>Flink</td>
    </tr>
    <tr>
      <td><strong>ë†’ì€ ì²˜ë¦¬ëŸ‰</strong></td>
      <td>Spark Micro-batch</td>
    </tr>
    <tr>
      <td><strong>ê· í˜•ì¡íŒ ì„±ëŠ¥</strong></td>
      <td>Spark 4.1 CP</td>
    </tr>
    <tr>
      <td><strong>ê¸°ì¡´ Spark ìƒíƒœê³„ í™œìš©</strong></td>
      <td>Spark 4.1</td>
    </tr>
    <tr>
      <td><strong>CEP, ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬</strong></td>
      <td>Flink</td>
    </tr>
    <tr>
      <td><strong>ë°°ì¹˜ì™€ ìŠ¤íŠ¸ë¦¬ë° í†µí•©</strong></td>
      <td>Spark 4.1</td>
    </tr>
  </tbody>
</table>

<h3 id="ì‹¤ë¬´-ì²´í¬ë¦¬ìŠ¤íŠ¸">ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì§€ì—°ì‹œê°„ ìš”êµ¬ì‚¬í•­ í™•ì¸ (&lt; 100msë©´ Spark 4.1 CP ê³ ë ¤)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì²˜ë¦¬ëŸ‰ ìš”êµ¬ì‚¬í•­ í™•ì¸</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ìƒíƒœ ê´€ë¦¬ ë³µì¡ë„ í‰ê°€</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ê¸°ì¡´ Spark ì¸í”„ë¼ í™œìš© ê°€ëŠ¥ ì—¬ë¶€</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />CEP í•„ìš” ì—¬ë¶€ í™•ì¸</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬ ìˆ˜í–‰</li>
</ul>

<h3 id="ë‹¤ìŒ-ë‹¨ê³„">ë‹¤ìŒ ë‹¨ê³„</h3>

<ul>
  <li><strong>ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬</strong>: ë³µì¡í•œ ìƒíƒœ ê¸°ë°˜ ì—°ì‚°</li>
  <li><strong>ì„±ëŠ¥ íŠœë‹</strong>: íŒŒí‹°ì…”ë‹, ë©”ëª¨ë¦¬ ìµœì í™”</li>
  <li><strong>ëª¨ë‹ˆí„°ë§</strong>: ì§€ì—°ì‹œê°„, ì²˜ë¦¬ëŸ‰ ëª¨ë‹ˆí„°ë§</li>
  <li><strong>ì¥ì•  ë³µêµ¬</strong>: ì²´í¬í¬ì¸íŒ… ì „ëµ</li>
</ul>

<hr />

<blockquote>
  <p><strong>â€œSpark 4.1ì€ ë§ˆì´í¬ë¡œë°°ì¹˜ì˜ í•œê³„ë¥¼ ë„˜ì–´ Flink ìˆ˜ì¤€ì˜ ì‹¤ì‹œê°„ ì²˜ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.â€</strong></p>
</blockquote>

<p>Spark 4.1ì˜ Continuous Processingì€ ê¸°ì¡´ Spark ìƒíƒœê³„ë¥¼ ìœ ì§€í•˜ë©´ì„œë„ Flink ìˆ˜ì¤€ì˜ ë‚®ì€ ì§€ì—°ì‹œê°„ì„ ë‹¬ì„±í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤. í”„ë¡œì íŠ¸ì˜ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ Flinkì™€ Spark 4.1 ì¤‘ ì ì ˆí•œ ì„ íƒì„ í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ ê°€ì´ë“œê°€ ì˜¬ë°”ë¥¸ ì„ íƒì— ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤!</p>

  </div>

  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2026 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
