<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Apache Sparkì˜ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§, í”„ë¡œíŒŒì¼ë§, ë©”ëª¨ë¦¬ ìµœì í™”, í´ëŸ¬ìŠ¤í„° íŠœë‹ì„ í†µí•œ í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•ì„ ì™„ì„±í•©ë‹ˆë‹¤.">



<title>Part 4: Apache Spark ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ - í”„ë¡œë•ì…˜ í™˜ê²½ ì™„ì„± - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 4: Apache Spark ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ - í”„ë¡œë•ì…˜ í™˜ê²½ ì™„ì„±">
<meta property="og:description" content="Apache Sparkì˜ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§, í”„ë¡œíŒŒì¼ë§, ë©”ëª¨ë¦¬ ìµœì í™”, í´ëŸ¬ìŠ¤í„° íŠœë‹ì„ í†µí•œ í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•ì„ ì™„ì„±í•©ë‹ˆë‹¤.">
<meta property="og:url" content="https://data-droid.github.io/data-engineering/2025/09/13/apache-spark-monitoring-tuning.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 4: Apache Spark ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ - í”„ë¡œë•ì…˜ í™˜ê²½ ì™„ì„±">
<meta name="twitter:description" content="Apache Sparkì˜ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§, í”„ë¡œíŒŒì¼ë§, ë©”ëª¨ë¦¬ ìµœì í™”, í´ëŸ¬ìŠ¤í„° íŠœë‹ì„ í†µí•œ í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•ì„ ì™„ì„±í•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/09/13/apache-spark-monitoring-tuning.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-09-13-apache-spark-monitoring-tuning.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 09ì›” 13ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 4: Apache Spark ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ - í”„ë¡œë•ì…˜ í™˜ê²½ ì™„ì„±</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Spark</span>
      
        <span class="tag">ì„±ëŠ¥íŠœë‹</span>
      
        <span class="tag">ëª¨ë‹ˆí„°ë§</span>
      
        <span class="tag">í”„ë¡œíŒŒì¼ë§</span>
      
        <span class="tag">ë©”ëª¨ë¦¬ìµœì í™”</span>
      
        <span class="tag">í´ëŸ¬ìŠ¤í„°ê´€ë¦¬</span>
      
        <span class="tag">Python</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Apache spark complete guide ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 5</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 55ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ì „ë¬¸ê°€</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-4-apache-spark-ëª¨ë‹ˆí„°ë§ê³¼-ì„±ëŠ¥-íŠœë‹---í”„ë¡œë•ì…˜-í™˜ê²½-ì™„ì„±">Part 4: Apache Spark ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ - í”„ë¡œë•ì…˜ í™˜ê²½ ì™„ì„±</h1>

<blockquote>
  <p>Apache Sparkì˜ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§, í”„ë¡œíŒŒì¼ë§, ë©”ëª¨ë¦¬ ìµœì í™”, í´ëŸ¬ìŠ¤í„° íŠœë‹ì„ í†µí•œ í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•ì„ ì™„ì„±í•©ë‹ˆë‹¤.</p>
</blockquote>

<h2 id="-ëª©ì°¨">ğŸ“‹ ëª©ì°¨</h2>

<ol>
  <li><a href="#spark-uiì™€-ë©”íŠ¸ë¦­-ë¶„ì„">Spark UIì™€ ë©”íŠ¸ë¦­ ë¶„ì„</a></li>
  <li><a href="#ì„±ëŠ¥-ëª¨ë‹ˆí„°ë§ê³¼-í”„ë¡œíŒŒì¼ë§">ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ê³¼ í”„ë¡œíŒŒì¼ë§</a></li>
  <li><a href="#ë©”ëª¨ë¦¬-ìµœì í™”ì™€-ìºì‹±-ì „ëµ">ë©”ëª¨ë¦¬ ìµœì í™”ì™€ ìºì‹± ì „ëµ</a></li>
  <li><a href="#í´ëŸ¬ìŠ¤í„°-íŠœë‹ê³¼-í™•ì¥ì„±">í´ëŸ¬ìŠ¤í„° íŠœë‹ê³¼ í™•ì¥ì„±</a></li>
  <li><a href="#ì‹¤ë¬´-í”„ë¡œì íŠ¸-ì„±ëŠ¥-ìµœì í™”-ì‹œìŠ¤í…œ">ì‹¤ë¬´ í”„ë¡œì íŠ¸: ì„±ëŠ¥ ìµœì í™” ì‹œìŠ¤í…œ</a></li>
  <li><a href="#í”„ë¡œë•ì…˜-í™˜ê²½-êµ¬ì¶•">í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ol>

<h2 id="ï¸-spark-uiì™€-ë©”íŠ¸ë¦­-ë¶„ì„">ğŸ–¥ï¸ Spark UIì™€ ë©”íŠ¸ë¦­ ë¶„ì„</h2>

<h3 id="spark-ui-ê°œìš”">Spark UI ê°œìš”</h3>

<p>Spark UIëŠ” Spark ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ë¶„ì„í•˜ëŠ” ì›¹ ê¸°ë°˜ ì¸í„°í˜ì´ìŠ¤ì…ë‹ˆë‹¤.</p>

<h4 id="í•µì‹¬-íƒ­ê³¼-ê¸°ëŠ¥"><strong>í•µì‹¬ íƒ­ê³¼ ê¸°ëŠ¥</strong></h4>

<ol>
  <li><strong>Jobs íƒ­</strong>
    <ul>
      <li>ì‘ì—… ì‹¤í–‰ ìƒíƒœì™€ ì‹œê°„</li>
      <li>ìŠ¤í…Œì´ì§€ë³„ ì‹¤í–‰ ì •ë³´</li>
      <li>ì‘ì—… ì‹¤íŒ¨ ì›ì¸ ë¶„ì„</li>
    </ul>
  </li>
  <li><strong>Stages íƒ­</strong>
    <ul>
      <li>ê° ìŠ¤í…Œì´ì§€ì˜ ìƒì„¸ ì •ë³´</li>
      <li>íƒœìŠ¤í¬ ì‹¤í–‰ ë¶„í¬</li>
      <li>ë°ì´í„° ìŠ¤í(Data Skew) ë¶„ì„</li>
    </ul>
  </li>
  <li><strong>Storage íƒ­</strong>
    <ul>
      <li>ìºì‹œëœ ë°ì´í„° ì •ë³´</li>
      <li>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰</li>
      <li>ë””ìŠ¤í¬ ì €ì¥ ìƒíƒœ</li>
    </ul>
  </li>
  <li><strong>Environment íƒ­</strong>
    <ul>
      <li>Spark ì„¤ì • ì •ë³´</li>
      <li>ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜</li>
      <li>JVM ì„¤ì •</li>
    </ul>
  </li>
</ol>

<h3 id="ë©”íŠ¸ë¦­-ë¶„ì„-ë„êµ¬">ë©”íŠ¸ë¦­ ë¶„ì„ ë„êµ¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë° ë¶„ì„
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">SparkMetricsCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">spark_session</span><span class="p">.</span><span class="n">sparkContext</span>
        
    <span class="k">def</span> <span class="nf">collect_job_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‘ì—… ë©”íŠ¸ë¦­ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        
        <span class="c1"># ì‹¤í–‰ ì¤‘ì¸ ì‘ì—… ì •ë³´
</span>        <span class="n">active_jobs</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getActiveJobIds</span><span class="p">()</span>
        
        <span class="c1"># ì‘ì—…ë³„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
</span>        <span class="n">job_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">active_jobs</span><span class="p">:</span>
            <span class="n">job_info</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getJobInfo</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_metrics</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">status</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numActiveTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numCompletedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numFailedTasks</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">job_metrics</span>
    
    <span class="k">def</span> <span class="nf">collect_stage_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìŠ¤í…Œì´ì§€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        
        <span class="c1"># í™œì„± ìŠ¤í…Œì´ì§€ ì •ë³´
</span>        <span class="n">active_stages</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getActiveStageIds</span><span class="p">()</span>
        
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stage_id</span> <span class="ow">in</span> <span class="n">active_stages</span><span class="p">:</span>
            <span class="n">stage_info</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getStageInfo</span><span class="p">(</span><span class="n">stage_id</span><span class="p">)</span>
            <span class="n">stage_metrics</span><span class="p">[</span><span class="n">stage_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numActiveTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numCompletedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numFailedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">executor_run_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">executorRunTime</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">executor_cpu_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">executorCpuTime</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">input_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">inputBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">output_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">outputBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">shuffle_read_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">shuffleReadBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">shuffle_write_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">shuffleWriteBytes</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">stage_metrics</span>
    
    <span class="k">def</span> <span class="nf">collect_executor_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤í–‰ì ë©”íŠ¸ë¦­ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">executor_info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="n">executor_info</span><span class="p">.</span><span class="n">executorId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">host</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_cores</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalCores</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">maxMemory</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">memoryUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">disk_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">diskUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">activeTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">completedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">failedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalDuration</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_gc_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalGCTime</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">executor_metrics</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">monitor_spark_application</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">MetricsExample</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">collector</span> <span class="o">=</span> <span class="nc">SparkMetricsCollector</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ì£¼ê¸°ì ìœ¼ë¡œ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">job_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_job_metrics</span><span class="p">()</span>
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_stage_metrics</span><span class="p">()</span>
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_executor_metrics</span><span class="p">()</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Job Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">job_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Stage Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">stage_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Executor Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">executor_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10ì´ˆë§ˆë‹¤ ìˆ˜ì§‘
</span></code></pre></div></div>

<h2 id="-ì„±ëŠ¥-ëª¨ë‹ˆí„°ë§ê³¼-í”„ë¡œíŒŒì¼ë§">ğŸ“Š ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ê³¼ í”„ë¡œíŒŒì¼ë§</h2>

<h3 id="ì„±ëŠ¥-í”„ë¡œíŒŒì¼ë§-ë„êµ¬">ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§ ë„êµ¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§ í´ë˜ìŠ¤
</span><span class="k">class</span> <span class="nc">SparkProfiler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">spark_session</span><span class="p">.</span><span class="n">sparkContext</span>
        
    <span class="k">def</span> <span class="nf">profile_query_execution</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¿¼ë¦¬ ì‹¤í–‰ í”„ë¡œíŒŒì¼ë§</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">time</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># ì‹¤í–‰ ê³„íš ë¶„ì„
</span>        <span class="n">execution_plan</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">explain</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># ì¿¼ë¦¬ ì‹¤í–‰
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        
        <span class="c1"># ë©”íŠ¸ë¦­ ìˆ˜ì§‘
</span>        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">total_memory_used</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalGCTime</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="n">profile_result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">query_name</span><span class="sh">'</span><span class="p">:</span> <span class="n">query_name</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">execution_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_memory_used</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">total_gc_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_gc_time</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">execution_plan</span><span class="sh">'</span><span class="p">:</span> <span class="n">execution_plan</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">result_count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">profile_result</span>
    
    <span class="k">def</span> <span class="nf">analyze_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë°ì´í„° ìŠ¤í ë¶„ì„</span><span class="sh">"""</span>
        <span class="c1"># í‚¤ë³„ ë°ì´í„° ë¶„í¬ ë¶„ì„
</span>        <span class="n">key_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">key_columns</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
        
        <span class="c1"># í†µê³„ ì •ë³´ ìˆ˜ì§‘
</span>        <span class="n">stats</span> <span class="o">=</span> <span class="n">key_counts</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
            <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_keys</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">min</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">min_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">max</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">max_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">stddev</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">stddev_count</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># ìŠ¤í ë¹„ìœ¨ ê³„ì‚°
</span>        <span class="n">skew_ratio</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="n">skew_analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span>  <span class="c1"># ìŠ¤í ì„ê³„ê°’
</span>        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">skew_analysis</span>
    
    <span class="k">def</span> <span class="nf">monitor_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">memory_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_executors</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">executor_details</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">executor_detail</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">executor_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">executorId</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">host</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="o">/</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">if</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>
            <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_details</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">executor_detail</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">memory_stats</span>

<span class="c1"># ì„±ëŠ¥ ë¶„ì„ ë„êµ¬ ì‚¬ìš© ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">performance_analysis_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">PerformanceAnalysis</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="nc">SparkProfiler</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ìƒ˜í”Œ ë°ì´í„° ìƒì„±
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">user_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># ì¿¼ë¦¬ í”„ë¡œíŒŒì¼ë§
</span>    <span class="n">profile_result</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">profile_query_execution</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">sample_aggregation</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_value</span><span class="sh">"</span><span class="p">))</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Query Profile Result:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">profile_result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ë°ì´í„° ìŠ¤í ë¶„ì„
</span>    <span class="n">skew_analysis</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">analyze_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Data Skew Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">skew_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§
</span>    <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">monitor_memory_usage</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Memory Usage Stats:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">memory_stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ì„±ëŠ¥-ìµœì í™”-ê°€ì´ë“œë¼ì¸">ì„±ëŠ¥ ìµœì í™” ê°€ì´ë“œë¼ì¸</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì„±ëŠ¥ ìµœì í™” ì²´í¬ë¦¬ìŠ¤íŠ¸
</span><span class="k">class</span> <span class="nc">PerformanceOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        
    <span class="k">def</span> <span class="nf">check_partitioning</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒŒí‹°ì…”ë‹ ìµœì í™” ì²´í¬</span><span class="sh">"""</span>
        <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ í¬ê¸° í™•ì¸
</span>        <span class="n">partition_sizes</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">mapPartitions</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">))]).</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="n">avg_size</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        <span class="n">min_size</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ ë¶ˆê· í˜• í™•ì¸
</span>        <span class="n">imbalance_ratio</span> <span class="o">=</span> <span class="n">max_size</span> <span class="o">/</span> <span class="n">avg_size</span> <span class="k">if</span> <span class="n">avg_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">num_partitions</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">íŒŒí‹°ì…˜ ìˆ˜ê°€ ë„ˆë¬´ ì ìŠµë‹ˆë‹¤. ìµœì†Œ 2ê°œ ì´ìƒ ê¶Œì¥</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">imbalance_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">íŒŒí‹°ì…˜ ë¶ˆê· í˜•ì´ ì‹¬í•©ë‹ˆë‹¤ (ë¹„ìœ¨: </span><span class="si">{</span><span class="n">imbalance_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). repartition() ê³ ë ¤</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">avg_size</span> <span class="o">&gt;</span> <span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 128MB
</span>            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">íŒŒí‹°ì…˜ í¬ê¸°ê°€ ë„ˆë¬´ í½ë‹ˆë‹¤. ë” ì‘ì€ íŒŒí‹°ì…˜ìœ¼ë¡œ ë¶„í•  ê¶Œì¥</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">num_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">avg_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">max_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">min_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">imbalance_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">imbalance_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">check_caching_strategy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">usage_count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìºì‹± ì „ëµ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">storage_level</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">storageLevel</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">usage_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">storage_level</span> <span class="o">==</span> <span class="n">StorageLevel</span><span class="p">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ë²ˆ ì‚¬ìš©í•˜ë¯€ë¡œ ìºì‹±ì„ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">storage_level</span><span class="p">.</span><span class="n">useDisk</span> <span class="ow">and</span> <span class="n">usage_count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">ë””ìŠ¤í¬ ìºì‹±ì€ ë©”ëª¨ë¦¬ ìºì‹±ë³´ë‹¤ ëŠë¦½ë‹ˆë‹¤. ì‚¬ìš© ë¹ˆë„ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">storage_level</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">storage_level</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">usage_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_count</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">analyze_query_plan</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¿¼ë¦¬ ê³„íš ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">explain</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¡°ì¸ í™•ì¸
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">BroadcastHashJoin</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¡°ì¸ì´ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ì‘ì€ í…Œì´ë¸” í¬ê¸°ë¥¼ í™•ì¸í•˜ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì…”í”Œ í™•ì¸
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">Exchange</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">ì…”í”Œì´ ë°œìƒí•©ë‹ˆë‹¤. íŒŒí‹°ì…”ë‹ í‚¤ ìµœì í™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ìŠ¤ìº” í™•ì¸
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">FileScan</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">íŒŒì¼ ìŠ¤ìº”ì´ ë°œìƒí•©ë‹ˆë‹¤. íŒŒí‹°ì…”ë‹ì´ë‚˜ ì¸ë±ì‹±ì„ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">execution_plan</span><span class="sh">'</span><span class="p">:</span> <span class="n">plan</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>

<span class="c1"># ì„±ëŠ¥ ìµœì í™” ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">optimization_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">OptimizationExample</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="nc">PerformanceOptimizer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ìƒ˜í”Œ ë°ì´í„°
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">category_</span><span class="si">{</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># íŒŒí‹°ì…”ë‹ ì²´í¬
</span>    <span class="n">partition_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">check_partitioning</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Partitioning Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">partition_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ìºì‹± ì „ëµ ì²´í¬
</span>    <span class="n">caching_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">check_caching_strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">usage_count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Caching Strategy Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">caching_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ì¿¼ë¦¬ ê³„íš ë¶„ì„
</span>    <span class="n">query_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">analyze_query_plan</span><span class="p">(</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Query Plan Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">query_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="-ë©”ëª¨ë¦¬-ìµœì í™”ì™€-ìºì‹±-ì „ëµ">ğŸ’¾ ë©”ëª¨ë¦¬ ìµœì í™”ì™€ ìºì‹± ì „ëµ</h2>

<h3 id="ë©”ëª¨ë¦¬-ê´€ë¦¬-ìµœì í™”">ë©”ëª¨ë¦¬ ê´€ë¦¬ ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë©”ëª¨ë¦¬ ìµœì í™” ë„êµ¬
</span><span class="k">class</span> <span class="nc">MemoryOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        
    <span class="k">def</span> <span class="nf">optimize_dataframe_memory</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">DataFrame ë©”ëª¨ë¦¬ ìµœì í™”</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">DoubleType</span>
        
        <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span>
        
        <span class="c1"># ì»¬ëŸ¼ íƒ€ì… ìµœì í™”
</span>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">name</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">dataType</span>
            
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">):</span>
                <span class="c1"># í° ì •ìˆ˜ê°’ì´ ì—†ë‹¤ë©´ ë” ì‘ì€ íƒ€ì…ìœ¼ë¡œ ë³€ê²½
</span>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">))).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">))).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="mi">127</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">max_val</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">:</span>
                    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">tinyint</span><span class="sh">"</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="mi">32767</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">max_val</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">:</span>
                    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">smallint</span><span class="sh">"</span><span class="p">)</span>
                    <span class="p">)</span>
            
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">):</span>
                <span class="c1"># Floatë¥¼ Doubleë¡œ ë³€ê²½í•˜ì—¬ ì •ë°€ë„ í–¥ìƒ
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                    <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">double</span><span class="sh">"</span><span class="p">)</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">optimized_df</span>
    
    <span class="k">def</span> <span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³„ì‚°</span><span class="sh">"""</span>
        <span class="c1"># DataFrame í¬ê¸° ì¶”ì •
</span>        <span class="n">num_rows</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
        
        <span class="c1"># ì»¬ëŸ¼ë³„ íƒ€ì… í¬ê¸° ì¶”ì •
</span>        <span class="n">type_sizes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">string</span><span class="sh">'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>  <span class="c1"># í‰ê·  ë¬¸ìì—´ ê¸¸ì´
</span>            <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">bigint</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">double</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">boolean</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span>
        <span class="p">}</span>
        
        <span class="n">estimated_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">dataType</span><span class="p">)</span>
            <span class="n">base_type</span> <span class="o">=</span> <span class="n">field_type</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">lower</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">base_type</span> <span class="ow">in</span> <span class="n">type_sizes</span><span class="p">:</span>
                <span class="n">estimated_size</span> <span class="o">+=</span> <span class="n">type_sizes</span><span class="p">[</span><span class="n">base_type</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">estimated_size</span> <span class="o">+=</span> <span class="mi">8</span>  <span class="c1"># ê¸°ë³¸ê°’
</span>        
        <span class="n">total_estimated_size</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span> <span class="o">*</span> <span class="n">estimated_size</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">num_rows</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_rows</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">num_cols</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_cols</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_size_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_estimated_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_estimated_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">optimize_caching_strategy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìºì‹± ì „ëµ ìµœì í™”</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">StorageLevel</span>
        
        <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">size_mb</span> <span class="o">=</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">estimated_size_mb</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">size_mb</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">MEMORY_ONLY</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ìì£¼ ì‚¬ìš©ë˜ê³  í¬ê¸°ê°€ ì‘ì€ ë°ì´í„°</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">elif</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">size_mb</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">MEMORY_AND_DISK_SER</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ìì£¼ ì‚¬ìš©ë˜ì§€ë§Œ í¬ê¸°ê°€ í° ë°ì´í„°</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">elif</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">DISK_ONLY</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ì¤‘ê°„ ë¹ˆë„ ì‚¬ìš© ë°ì´í„°</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">NO_CACHING</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ë‚®ì€ ë¹ˆë„ ì‚¬ìš© ë°ì´í„°</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">data_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">size_mb</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">access_frequency</span><span class="sh">'</span><span class="p">:</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>

<span class="c1"># ë©”ëª¨ë¦¬ ìµœì í™” ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">memory_optimization_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">MemoryOptimization</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="nc">MemoryOptimizer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ìƒ˜í”Œ ë°ì´í„° ìƒì„±
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">user_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">score</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">is_active</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># ë©”ëª¨ë¦¬ ìµœì í™”
</span>    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">optimize_dataframe_memory</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê³„ì‚°
</span>    <span class="n">original_memory</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">optimized_memory</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">optimized_df</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Original Memory Usage:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">original_memory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Optimized Memory Usage:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">optimized_memory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ìºì‹± ì „ëµ ìµœì í™”
</span>    <span class="n">access_pattern</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">}</span>
    <span class="n">caching_strategy</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">optimize_caching_strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Caching Strategy:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">caching_strategy</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ê³ ê¸‰-ìºì‹±-ì „ëµ">ê³ ê¸‰ ìºì‹± ì „ëµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ê³ ê¸‰ ìºì‹± ê´€ë¦¬ì
</span><span class="k">class</span> <span class="nc">AdvancedCacheManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">smart_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì§€ëŠ¥í˜• ìºì‹±</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">StorageLevel</span>
        
        <span class="c1"># ë°ì´í„° í¬ê¸° í™•ì¸
</span>        <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="c1"># ì ‘ê·¼ íŒ¨í„´ì— ë”°ë¥¸ ìºì‹± ì „ëµ ê²°ì •
</span>        <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">latency_requirement</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">low</span><span class="sh">'</span><span class="p">:</span>
                <span class="n">df</span><span class="p">.</span><span class="nf">cache</span><span class="p">()</span>  <span class="c1"># MEMORY_ONLY
</span>                <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">MEMORY_ONLY</span><span class="sh">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">StorageLevel</span><span class="p">.</span><span class="n">MEMORY_AND_DISK_SER</span><span class="p">)</span>
                <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">MEMORY_AND_DISK_SER</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">StorageLevel</span><span class="p">.</span><span class="n">DISK_ONLY</span><span class="p">)</span>
            <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">DISK_ONLY</span><span class="sh">"</span>
        
        <span class="c1"># ìºì‹œ ì •ë³´ ì €ì¥
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">dataframe</span><span class="sh">'</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">storage_level</span><span class="sh">'</span><span class="p">:</span> <span class="n">storage_level</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">access_count</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">last_accessed</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">monitor_cache_efficiency</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìºì‹œ íš¨ìœ¨ì„± ëª¨ë‹ˆí„°ë§</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">cache_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_cached_data</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">memory_cached</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">disk_cached</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">cache_hit_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">cache_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_cached_data</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span>
            <span class="n">cache_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_cached</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span>
        
        <span class="k">return</span> <span class="n">cache_stats</span>
    
    <span class="k">def</span> <span class="nf">cleanup_unused_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">max_age_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìºì‹œ ì •ë¦¬</span><span class="sh">"""</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">max_age_seconds</span> <span class="o">=</span> <span class="n">max_age_hours</span> <span class="o">*</span> <span class="mi">3600</span>
        
        <span class="n">tables_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">cache_info</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">cache_info</span><span class="p">[</span><span class="sh">'</span><span class="s">last_accessed</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_age_seconds</span><span class="p">:</span>
                <span class="n">cache_info</span><span class="p">[</span><span class="sh">'</span><span class="s">dataframe</span><span class="sh">'</span><span class="p">].</span><span class="nf">unpersist</span><span class="p">()</span>
                <span class="n">tables_to_remove</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tables_to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">tables_to_remove</span><span class="p">)</span>

<span class="c1"># ê³ ê¸‰ ìºì‹± ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">advanced_caching_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">AdvancedCaching</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">cache_manager</span> <span class="o">=</span> <span class="nc">AdvancedCacheManager</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ìƒ˜í”Œ ë°ì´í„°
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">category_</span><span class="si">{</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># ì§€ëŠ¥í˜• ìºì‹±
</span>    <span class="n">access_pattern</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">latency_requirement</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">low</span><span class="sh">'</span>
    <span class="p">}</span>
    
    <span class="n">cached_df</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">smart_cache</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="sh">"</span><span class="s">sample_table</span><span class="sh">"</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">)</span>
    
    <span class="c1"># ìºì‹œ íš¨ìœ¨ì„± ëª¨ë‹ˆí„°ë§
</span>    <span class="n">cache_stats</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">monitor_cache_efficiency</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Cache Statistics:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">cache_stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ìºì‹œ ì •ë¦¬
</span>    <span class="n">cleaned_count</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">cleanup_unused_cache</span><span class="p">(</span><span class="n">max_age_hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Cleaned </span><span class="si">{</span><span class="n">cleaned_count</span><span class="si">}</span><span class="s"> unused cache entries</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ê³ ê¸‰-ì„±ëŠ¥-ë¶„ì„-ë„êµ¬">ğŸ” ê³ ê¸‰ ì„±ëŠ¥ ë¶„ì„ ë„êµ¬</h2>

<h3 id="spark-history-server-í™œìš©ë²•">Spark History Server í™œìš©ë²•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark History Server ì„¤ì • ë° í™œìš©
</span><span class="k">class</span> <span class="nc">HistoryServerAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">history_server_url</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span> <span class="o">=</span> <span class="n">history_server_url</span>
        
    <span class="k">def</span> <span class="nf">analyze_completed_applications</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì™„ë£Œëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶„ì„</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">requests</span>
        
        <span class="c1"># History Server APIë¥¼ í†µí•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ëª©ë¡ ì¡°íšŒ
</span>        <span class="n">apps_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">applications</span> <span class="o">=</span> <span class="n">apps_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="n">analysis_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">applications</span><span class="p">:</span>
            <span class="n">app_id</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="c1"># ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„¸ ì •ë³´ ì¡°íšŒ
</span>            <span class="n">app_details</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">app_info</span> <span class="o">=</span> <span class="n">app_details</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            
            <span class="c1"># ì‘ì—… ì •ë³´ ì¡°íšŒ
</span>            <span class="n">jobs_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/jobs</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="n">jobs_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            
            <span class="n">analysis_result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_id</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">app_name</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">start_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">startTime</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">total_jobs</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">failed_jobs</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span> <span class="k">if</span> <span class="n">j</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">FAILED</span><span class="sh">'</span><span class="p">]),</span>
                <span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_identify_performance_issues</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="n">analysis_results</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">analysis_result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">analysis_results</span>
    
    <span class="k">def</span> <span class="nf">_identify_performance_issues</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">jobs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„±ëŠ¥ ë¬¸ì œ ì‹ë³„</span><span class="sh">"""</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="c1"># ëŠë¦° ì‘ì—… ì‹ë³„ (10ë¶„ ì´ìƒ)
</span>            <span class="k">if</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">600000</span><span class="p">:</span>  <span class="c1"># 10ë¶„ = 600,000ms
</span>                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">slow_job</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">job_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">ì‘ì—… </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">ê°€ </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">ì´ˆ ì†Œìš”</span><span class="sh">"</span>
                <span class="p">})</span>
            
            <span class="c1"># ì‹¤íŒ¨í•œ ì‘ì—… ì‹ë³„
</span>            <span class="k">if</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">FAILED</span><span class="sh">'</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">failed_job</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">job_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">ì‘ì—… </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s"> ì‹¤íŒ¨</span><span class="sh">"</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">issues</span>
    
    <span class="k">def</span> <span class="nf">generate_performance_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„±ëŠ¥ ë³´ê³ ì„œ ìƒì„±</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">requests</span>
        
        <span class="c1"># ìŠ¤í…Œì´ì§€ ì •ë³´ ì¡°íšŒ
</span>        <span class="n">stages_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/stages</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="n">stages_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="c1"># ì‹¤í–‰ì ì •ë³´ ì¡°íšŒ
</span>        <span class="n">executors_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/executors</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">executors</span> <span class="o">=</span> <span class="n">executors_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_stages</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_executors</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">stage_analysis</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_analyze_stages</span><span class="p">(</span><span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">executor_analysis</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_analyze_executors</span><span class="p">(</span><span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_recommendations</span><span class="p">(</span><span class="n">stages</span><span class="p">,</span> <span class="n">executors</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">report</span>
    
    <span class="k">def</span> <span class="nf">_analyze_stages</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">stages</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìŠ¤í…Œì´ì§€ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numFailedTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">slow_stages</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stage_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_task_duration</span> <span class="o">=</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">executorRunTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">avg_task_duration</span>
                <span class="n">stage_count</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="c1"># ëŠë¦° ìŠ¤í…Œì´ì§€ ì‹ë³„ (í‰ê·  íƒœìŠ¤í¬ ì‹œê°„ 30ì´ˆ ì´ìƒ)
</span>                <span class="k">if</span> <span class="n">avg_task_duration</span> <span class="o">&gt;</span> <span class="mi">30000</span><span class="p">:</span>
                    <span class="n">stage_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">slow_stages</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">stage_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">stageId</span><span class="sh">'</span><span class="p">),</span>
                        <span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_task_duration</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">)</span>
                    <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">stage_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stage_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">/</span> <span class="n">stage_count</span>
        
        <span class="k">return</span> <span class="n">stage_metrics</span>
    
    <span class="k">def</span> <span class="nf">_analyze_executors</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤í–‰ì ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_cores</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalCores</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">maxMemory</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="n">total_used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">memoryUsed</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalGCTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_executor_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalDuration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_used_memory</span> <span class="o">/</span> <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_executor_time</span>
        
        <span class="k">return</span> <span class="n">executor_metrics</span>
    
    <span class="k">def</span> <span class="nf">_generate_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">stages</span><span class="p">,</span> <span class="n">executors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¶Œì¥ì‚¬í•­ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ì€ ê²½ìš°
</span>        <span class="n">total_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">maxMemory</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">memoryUsed</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_memory</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">used_memory</span> <span class="o">/</span> <span class="n">total_memory</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">memory</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ìŠµë‹ˆë‹¤. executor-memory ì¦ê°€ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># GC ì‹œê°„ì´ ê¸´ ê²½ìš°
</span>        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalGCTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_executor_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalDuration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">gc</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GC ì‹œê°„ì´ ì „ì²´ ì‹¤í–‰ ì‹œê°„ì˜ 10% ì´ìƒì…ë‹ˆë‹¤. JVM íŠœë‹ì„ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># ëŠë¦° ìŠ¤í…Œì´ì§€ê°€ ìˆëŠ” ê²½ìš°
</span>        <span class="n">slow_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span> <span class="k">if</span> <span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">executorRunTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">max</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30000</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">slow_stages</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">performance</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">slow_stages</span><span class="p">)</span><span class="si">}</span><span class="s">ê°œì˜ ìŠ¤í…Œì´ì§€ê°€ ëŠë¦½ë‹ˆë‹¤. íŒŒí‹°ì…”ë‹ ìµœì í™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># History Server í™œìš© ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">history_server_analysis_example</span><span class="p">():</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">HistoryServerAnalyzer</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:18080</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ì™„ë£Œëœ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¶„ì„
</span>    <span class="n">completed_apps</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">analyze_completed_applications</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Completed Applications Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">completed_apps</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">App: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">app_name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Duration: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Jobs: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">total_jobs</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> (Failed: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_jobs</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">]:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  Performance Issues:</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">]:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    - </span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">()</span>
    
    <span class="c1"># íŠ¹ì • ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„¸ ë¶„ì„
</span>    <span class="k">if</span> <span class="n">completed_apps</span><span class="p">:</span>
        <span class="n">app_id</span> <span class="o">=</span> <span class="n">completed_apps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">generate_performance_report</span><span class="p">(</span><span class="n">app_id</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Performance Report ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="-ì‹¤ë¬´-ì„±ëŠ¥-ë¬¸ì œ-ì§„ë‹¨-ë°-í•´ê²°">ğŸš¨ ì‹¤ë¬´ ì„±ëŠ¥ ë¬¸ì œ ì§„ë‹¨ ë° í•´ê²°</h2>

<h3 id="data-skew-ë¬¸ì œ-í•´ê²°">Data Skew ë¬¸ì œ í•´ê²°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Data Skew ì§„ë‹¨ ë° í•´ê²° ë„êµ¬
</span><span class="k">class</span> <span class="nc">DataSkewResolver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë°ì´í„° ìŠ¤í ê°ì§€</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">stddev</span>
        
        <span class="c1"># í‚¤ë³„ ë°ì´í„° ë¶„í¬ ë¶„ì„
</span>        <span class="n">key_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">key_columns</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
        
        <span class="c1"># í†µê³„ ê³„ì‚°
</span>        <span class="n">stats</span> <span class="o">=</span> <span class="n">key_counts</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
            <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_keys</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">min</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">min_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">max</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">max_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">stddev</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">stddev_count</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">skew_ratio</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_skew_severity</span><span class="p">(</span><span class="n">skew_ratio</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_get_skew_severity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">skew_ratio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìŠ¤í ì‹¬ê°ë„ íŒì •</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">high</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">medium</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">low</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">resolve_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë°ì´í„° ìŠ¤í í•´ê²°</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_apply_salting</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">random_repartition</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_apply_random_repartition</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">adaptive_query_execution</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_enable_adaptive_query_execution</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unknown method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply_salting</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Salting ê¸°ë²• ì ìš©</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">rand</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">lit</span>
        
        <span class="c1"># Salt ê°’ ìƒì„± (0-99 ì‚¬ì´ì˜ ëœë¤ ê°’)
</span>        <span class="n">salted_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="nf">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">int</span><span class="sh">"</span><span class="p">))</span>
        
        <span class="c1"># í‚¤ ì»¬ëŸ¼ì— salt ì¶”ê°€
</span>        <span class="n">salted_keys</span> <span class="o">=</span> <span class="p">[</span><span class="nf">concat</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nf">lit</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">),</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">]</span>
        <span class="n">salted_keys</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">salted_df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="o">*</span><span class="n">salted_keys</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="nf">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">_apply_random_repartition</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëœë¤ ë¦¬íŒŒí‹°ì…”ë‹ ì ìš©</span><span class="sh">"""</span>
        <span class="c1"># í˜„ì¬ íŒŒí‹°ì…˜ ìˆ˜ì˜ 2ë°°ë¡œ ì¦ê°€
</span>        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        <span class="n">new_partitions</span> <span class="o">=</span> <span class="n">current_partitions</span> <span class="o">*</span> <span class="mi">2</span>
        
        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">new_partitions</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_enable_adaptive_query_execution</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì ì‘í˜• ì¿¼ë¦¬ ì‹¤í–‰ í™œì„±í™”</span><span class="sh">"""</span>
        <span class="c1"># Spark ì„¤ì • ë³€ê²½
</span>        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionFactor</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">256MB</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Data Skew í•´ê²° ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">data_skew_resolution_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">DataSkewResolution</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="nc">DataSkewResolver</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ìŠ¤íê°€ ìˆëŠ” ë°ì´í„° ìƒì„± (ì¼ë¶€ í‚¤ì— ëŒ€ëŸ‰ì˜ ë°ì´í„°)
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># ì²˜ìŒ 1000ê°œëŠ” í‚¤ 0ì— í• ë‹¹ (ìŠ¤í ìƒì„±)
</span>            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">))</span>  <span class="c1"># ë‚˜ë¨¸ì§€ëŠ” ê· ë“± ë¶„í¬
</span>    
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># ìŠ¤í ê°ì§€
</span>    <span class="n">skew_analysis</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Data Skew Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">skew_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Data skew detected with ratio: </span><span class="si">{</span><span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Severity: </span><span class="si">{</span><span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ìŠ¤í í•´ê²°
</span>        <span class="n">resolved_df</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">resolve_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># í•´ê²° í›„ ìŠ¤í ì¬ì¸¡ì •
</span>        <span class="n">resolved_skew</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">resolved_df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">])</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== After Skew Resolution ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">resolved_skew</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="slow-task-ë¶„ì„-ë°-ìµœì í™”">Slow Task ë¶„ì„ ë° ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Slow Task ë¶„ì„ ë° ìµœì í™” ë„êµ¬
</span><span class="k">class</span> <span class="nc">SlowTaskAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">analyze_slow_tasks</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">threshold_seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëŠë¦° íƒœìŠ¤í¬ ë¶„ì„</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">stddev</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ë³„ ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •
</span>        <span class="k">def</span> <span class="nf">measure_partition_processing</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
            <span class="kn">import</span> <span class="n">time</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            
            <span class="c1"># ë°ì´í„° ì²˜ë¦¬
</span>            <span class="n">data</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>  <span class="c1"># ì‹¤ì œ ì²˜ë¦¬ ë¡œì§
</span>            
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            <span class="n">processing_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            
            <span class="k">return</span> <span class="p">[(</span><span class="n">processing_time</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
        
        <span class="c1"># ê° íŒŒí‹°ì…˜ì˜ ì²˜ë¦¬ ì‹œê°„ ì¸¡ì •
</span>        <span class="n">partition_metrics</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">mapPartitions</span><span class="p">(</span><span class="n">measure_partition_processing</span><span class="p">).</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">partition_metrics</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">No data to analyze</span><span class="sh">"</span><span class="p">}</span>
        
        <span class="n">processing_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">partition_metrics</span><span class="p">]</span>
        <span class="n">data_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">partition_metrics</span><span class="p">]</span>
        
        <span class="n">slow_partitions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">partition_metrics</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">threshold_seconds</span>
        <span class="p">]</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">partition_metrics</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">slow_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">avg_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">max_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">min_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">stddev_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_stddev</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">slow_partition_details</span><span class="sh">'</span><span class="p">:</span> <span class="n">slow_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_slow_task_recommendations</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">,</span> <span class="n">partition_metrics</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">analysis</span>
    
    <span class="k">def</span> <span class="nf">_calculate_stddev</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í‘œì¤€í¸ì°¨ ê³„ì‚°</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">mean</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">variance</span> <span class="o">**</span> <span class="mf">0.5</span>
    
    <span class="k">def</span> <span class="nf">_generate_slow_task_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">slow_partitions</span><span class="p">,</span> <span class="n">all_partitions</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëŠë¦° íƒœìŠ¤í¬ í•´ê²° ê¶Œì¥ì‚¬í•­ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">slow_partitions</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">repartitioning</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">)</span><span class="si">}</span><span class="s">ê°œì˜ íŒŒí‹°ì…˜ì´ ëŠë¦½ë‹ˆë‹¤. repartition() ë˜ëŠ” coalesce()ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ í¬ê¸° ë¶ˆê· í˜• í™•ì¸
</span>        <span class="n">data_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">all_partitions</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size_ratio</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size_ratio</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">data_distribution</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">íŒŒí‹°ì…˜ í¬ê¸° ë¶ˆê· í˜•ì´ ì‹¬í•©ë‹ˆë‹¤ (ë¹„ìœ¨: </span><span class="si">{</span><span class="n">size_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). ë°ì´í„° ë¶„í¬ë¥¼ ê°œì„ í•˜ì„¸ìš”</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="c1"># ì „ì²´ì ì¸ ì²˜ë¦¬ ì‹œê°„ ë¶„ì‚° í™•ì¸
</span>        <span class="n">processing_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">all_partitions</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">time_ratio</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_ratio</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">performance_optimization</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">ì²˜ë¦¬ ì‹œê°„ ë¶„ì‚°ì´ í½ë‹ˆë‹¤ (ë¹„ìœ¨: </span><span class="si">{</span><span class="n">time_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). ë¡œì§ ìµœì í™”ë¥¼ ê³ ë ¤í•˜ì„¸ìš”</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>
    
    <span class="k">def</span> <span class="nf">optimize_partitioning</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">target_partition_size_mb</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒŒí‹°ì…”ë‹ ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># í˜„ì¬ ë°ì´í„° í¬ê¸° ì¶”ì •
</span>        <span class="n">row_count</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
        <span class="n">estimated_row_size_bytes</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># ì¶”ì •ê°’ (ì‹¤ì œë¡œëŠ” ë” ì •í™•í•œ ê³„ì‚° í•„ìš”)
</span>        <span class="n">total_size_mb</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_count</span> <span class="o">*</span> <span class="n">estimated_row_size_bytes</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        
        <span class="c1"># ìµœì  íŒŒí‹°ì…˜ ìˆ˜ ê³„ì‚°
</span>        <span class="n">optimal_partitions</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">total_size_mb</span> <span class="o">/</span> <span class="n">target_partition_size_mb</span><span class="p">))</span>
        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">optimal_partitions</span> <span class="o">!=</span> <span class="n">current_partitions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">optimal_partitions</span> <span class="o">&gt;</span> <span class="n">current_partitions</span><span class="p">:</span>
                <span class="c1"># íŒŒí‹°ì…˜ ìˆ˜ ì¦ê°€
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">optimal_partitions</span><span class="p">)</span>
                <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">repartitioned from </span><span class="si">{</span><span class="n">current_partitions</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">optimal_partitions</span><span class="si">}</span><span class="s"> partitions</span><span class="sh">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># íŒŒí‹°ì…˜ ìˆ˜ ê°ì†Œ
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">optimal_partitions</span><span class="p">)</span>
                <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">coalesced from </span><span class="si">{</span><span class="n">current_partitions</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">optimal_partitions</span><span class="si">}</span><span class="s"> partitions</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">action</span> <span class="o">=</span> <span class="sh">"</span><span class="s">no partitioning change needed</span><span class="sh">"</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">optimized_dataframe</span><span class="sh">'</span><span class="p">:</span> <span class="n">optimized_df</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">original_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">current_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">optimized_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">optimal_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">action_taken</span><span class="sh">'</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_total_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_size_mb</span>
        <span class="p">}</span>

<span class="c1"># Slow Task ë¶„ì„ ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">slow_task_analysis_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">SlowTaskAnalysis</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">SlowTaskAnalyzer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ë¶ˆê· ë“±í•œ ë°ì´í„° ìƒì„± (ì¼ë¶€ íŒŒí‹°ì…˜ì— ë” ë§ì€ ë°ì´í„°)
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="c1"># ì²˜ìŒ 50%ëŠ” íŒŒí‹°ì…˜ 0ì—, ë‚˜ë¨¸ì§€ëŠ” ê· ë“± ë¶„í¬
</span>        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">heavy_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">light_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">partition_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># ëŠë¦° íƒœìŠ¤í¬ ë¶„ì„
</span>    <span class="n">slow_task_analysis</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">analyze_slow_tasks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">threshold_seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Slow Task Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">slow_task_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># íŒŒí‹°ì…”ë‹ ìµœì í™”
</span>    <span class="n">optimization_result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">optimize_partitioning</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Partitioning Optimization ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Original partitions: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">original_partitions</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Optimized partitions: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">optimized_partitions</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Action taken: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">action_taken</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Estimated total size: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">estimated_total_size_mb</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="shuffle-spill-ë¬¸ì œ-í•´ê²°">Shuffle Spill ë¬¸ì œ í•´ê²°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Shuffle Spill ë¬¸ì œ í•´ê²° ë„êµ¬
</span><span class="k">class</span> <span class="nc">ShuffleSpillResolver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">detect_shuffle_spill</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Shuffle Spill ê°ì§€</span><span class="sh">"""</span>
        <span class="c1"># Spark ì„¤ì •ì—ì„œ spill ê´€ë ¨ ì„¤ì • í™•ì¸
</span>        <span class="n">spill_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">64MB</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spill_settings</span><span class="sh">'</span><span class="p">:</span> <span class="n">spill_settings</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_spill_recommendations</span><span class="p">(</span><span class="n">spill_settings</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_generate_spill_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Spill í•´ê²° ê¶Œì¥ì‚¬í•­ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">adaptive_query</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Adaptive Query Executionì„ í™œì„±í™”í•˜ì—¬ ìë™ ìµœì í™”ë¥¼ í™œìš©í•˜ì„¸ìš”</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">partition_coalescing</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">íŒŒí‹°ì…˜ ê²°í•©ì„ í™œì„±í™”í•˜ì—¬ ì‘ì€ íŒŒí‹°ì…˜ë“¤ì„ í•©ì¹˜ì„¸ìš”</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ í¬ê¸° ì„¤ì • í™•ì¸
</span>        <span class="n">partition_size</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">64MB</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">partition_size</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">partition_size</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">íŒŒí‹°ì…˜ í¬ê¸°ë¥¼ 128MB ì´ìƒìœ¼ë¡œ ì¦ê°€ì‹œì¼œ spillì„ ì¤„ì´ì„¸ìš”</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes=128MB</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">skew_join</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Skew Join ìµœì í™”ë¥¼ í™œì„±í™”í•˜ì—¬ ë°ì´í„° ìŠ¤í ë¬¸ì œë¥¼ í•´ê²°í•˜ì„¸ìš”</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>
    
    <span class="k">def</span> <span class="nf">configure_spill_prevention</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Spill ë°©ì§€ ì„¤ì • ì ìš©</span><span class="sh">"""</span>
        <span class="n">configurations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">128MB</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionFactor</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">256MB</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.localShuffleReader.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.optimizer.excludedRules</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.nonEmptyPartitionRatioForBroadcastJoin</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">0.2</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">applied_configs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">configurations</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">applied_configs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to set </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">applied_configs</span>
    
    <span class="k">def</span> <span class="nf">optimize_shuffle_operations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="sh">"</span><span class="s">join</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Shuffle ì‘ì—… ìµœì í™”</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">join</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_join_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">aggregation</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_aggregation_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">repartition</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_repartition_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">_optimize_join_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¡°ì¸ Shuffle ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì¡°ì¸ íŒíŠ¸ ì¶”ê°€ (ì‘ì€ í…Œì´ë¸”ì˜ ê²½ìš°)
</span>        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">broadcast</span>
        
        <span class="c1"># ì—¬ê¸°ì„œëŠ” ì˜ˆì‹œë¡œ self-joinì„ ìµœì í™”
</span>        <span class="c1"># ì‹¤ì œë¡œëŠ” ë‘ ê°œì˜ ë‹¤ë¥¸ DataFrameì„ ì¡°ì¸í•  ë•Œ ì‚¬ìš©
</span>        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">hint</span><span class="p">(</span><span class="sh">"</span><span class="s">broadcast</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_optimize_aggregation_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì§‘ê³„ Shuffle ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># íŒŒí‹°ì…˜ ìˆ˜ë¥¼ ì¤„ì—¬ì„œ Shuffle ë¹„ìš© ê°ì†Œ
</span>        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_partitions</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">optimized_partitions</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">current_partitions</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">optimized_partitions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">_optimize_repartition_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¦¬íŒŒí‹°ì…”ë‹ Shuffle ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># ì ì‘í˜• ì¿¼ë¦¬ ì‹¤í–‰ì„ í™œìš©í•˜ì—¬ ìë™ ìµœì í™”
</span>        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Shuffle Spill í•´ê²° ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">shuffle_spill_resolution_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">ShuffleSpillResolution</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="nc">ShuffleSpillResolver</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># Shuffle Spill ê°ì§€
</span>    <span class="n">spill_analysis</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_shuffle_spill</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">)],</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]))</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Shuffle Spill Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">spill_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Spill ë°©ì§€ ì„¤ì • ì ìš©
</span>    <span class="n">applied_configs</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">configure_spill_prevention</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Applied Spill Prevention Configs ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">applied_configs</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¡œ Shuffle í…ŒìŠ¤íŠ¸
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># Shuffleì´ ë°œìƒí•˜ëŠ” ì‘ì—… ìˆ˜í–‰
</span>    <span class="n">result_df</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">optimize_shuffle_operations</span><span class="p">(</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">collect_list</span><span class="sh">"</span><span class="p">}),</span>
        <span class="n">operation_type</span><span class="o">=</span><span class="sh">"</span><span class="s">aggregation</span><span class="sh">"</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Shuffle Optimization Applied ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Result partitions: </span><span class="si">{</span><span class="n">result_df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ëª¨ë‹ˆí„°ë§-ìë™í™”">ğŸ¤– ëª¨ë‹ˆí„°ë§ ìë™í™”</h2>

<h3 id="health-check-ì‹œìŠ¤í…œ">Health Check ì‹œìŠ¤í…œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Health Check ì‹œìŠ¤í…œ
</span><span class="k">class</span> <span class="nc">SparkHealthChecker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">memory_usage_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">failed_task_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">executor_loss_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">slow_task_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.2</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">perform_health_check</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì „ì²´ ì‹œìŠ¤í…œ ê±´ê°•ë„ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">health_report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">healthy</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_memory_usage</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">gc_performance</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_gc_performance</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">task_failure</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_task_failure</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">executor_health</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_executor_health</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">cluster_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_cluster_utilization</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># ì „ì²´ ìƒíƒœ ê²°ì •
</span>        <span class="n">failed_checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span> <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">].</span><span class="nf">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">failed_checks</span><span class="p">:</span>
            <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">unhealthy</span><span class="sh">'</span>
            <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">failed_checks</span><span class="p">]</span>
        
        <span class="c1"># ê¶Œì¥ì‚¬í•­ ìƒì„±
</span>        <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_health_recommendations</span><span class="p">(</span><span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">health_report</span>
    
    <span class="k">def</span> <span class="nf">_check_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">total_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_memory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No memory information available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">used_memory</span> <span class="o">/</span> <span class="n">total_memory</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Memory usage: </span><span class="si">{</span><span class="n">usage_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_gc_performance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">GC ì„±ëŠ¥ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalDuration</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalGCTime</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_duration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No duration information available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">gc_ratio</span> <span class="o">=</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_duration</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">gc_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">GC time ratio: </span><span class="si">{</span><span class="n">gc_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">gc_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_task_failure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íƒœìŠ¤í¬ ì‹¤íŒ¨ìœ¨ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">total_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">completedTasks</span> <span class="o">+</span> <span class="n">info</span><span class="p">.</span><span class="n">failedTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">failed_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">failedTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_tasks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No tasks executed yet</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">failure_ratio</span> <span class="o">=</span> <span class="n">failed_tasks</span> <span class="o">/</span> <span class="n">total_tasks</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_task_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">failure_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Task failure ratio: </span><span class="si">{</span><span class="n">failure_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">failure_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_executor_health</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤í–‰ì ê±´ê°•ë„ ì²´í¬</span><span class="sh">"""</span>
        <span class="n">total_executors</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">lost_executors</span> <span class="o">=</span> <span class="nf">len</span><span class="p">([</span><span class="n">info</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span> <span class="k">if</span> <span class="n">info</span><span class="p">.</span><span class="n">isActive</span> <span class="o">==</span> <span class="bp">False</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">total_executors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No executors available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">loss_ratio</span> <span class="o">=</span> <span class="n">lost_executors</span> <span class="o">/</span> <span class="n">total_executors</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_loss_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">loss_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Executor loss ratio: </span><span class="si">{</span><span class="n">loss_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">loss_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_cluster_utilization</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í´ëŸ¬ìŠ¤í„° í™œìš©ë¥  ì²´í¬</span><span class="sh">"""</span>
        <span class="n">total_cores</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalCores</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">active_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">activeTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_cores</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No cores available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">utilization</span> <span class="o">=</span> <span class="n">active_tasks</span> <span class="o">/</span> <span class="n">total_cores</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>  <span class="c1"># í™œìš©ë¥ ì€ ë†’ì„ìˆ˜ë¡ ì¢‹ìŒ
</span>            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Cluster utilization: </span><span class="si">{</span><span class="n">utilization</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">utilization</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_generate_health_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">checks</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê±´ê°•ë„ ê¶Œì¥ì‚¬í•­ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">memory</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ì´ ë†’ìŠµë‹ˆë‹¤. executor-memoryë¥¼ ì¦ê°€ì‹œí‚¤ê±°ë‚˜ ë°ì´í„° ìºì‹±ì„ ìµœì í™”í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_performance</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">gc</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GC ì‹œê°„ì´ ê¸¸ì–´ì§€ê³  ìˆìŠµë‹ˆë‹¤. JVM GC ì„¤ì •ì„ ìµœì í™”í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">task_failure</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">reliability</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">íƒœìŠ¤í¬ ì‹¤íŒ¨ìœ¨ì´ ë†’ìŠµë‹ˆë‹¤. ë¦¬ì†ŒìŠ¤ í• ë‹¹ê³¼ ë°ì´í„° í’ˆì§ˆì„ í™•ì¸í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_health</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">infrastructure</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">ì‹¤í–‰ì ì†ì‹¤ì´ ë°œìƒí•˜ê³  ìˆìŠµë‹ˆë‹¤. í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ ì ê²€í•˜ì„¸ìš”</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># Health Check ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">health_check_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">HealthCheck</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">health_checker</span> <span class="o">=</span> <span class="nc">SparkHealthChecker</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># ê±´ê°•ë„ ì²´í¬ ìˆ˜í–‰
</span>    <span class="n">health_report</span> <span class="o">=</span> <span class="n">health_checker</span><span class="p">.</span><span class="nf">perform_health_check</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Spark Health Check Report ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Overall Status: </span><span class="si">{</span><span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Timestamp: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">, time.localtime(health_report[</span><span class="sh">'</span><span class="n">timestamp</span><span class="sh">'</span><span class="s">]))</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Individual Checks ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">check_name</span><span class="p">,</span> <span class="n">check_result</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">].</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">status_icon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">âœ…</span><span class="sh">"</span> <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">âŒ</span><span class="sh">"</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">status_icon</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">check_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">check_result</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Critical Alerts ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ğŸš¨ </span><span class="si">{</span><span class="n">alert</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Recommendations ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">priority_icon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">ğŸ”´</span><span class="sh">"</span> <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">"</span><span class="s">ğŸŸ¡</span><span class="sh">"</span> <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">"</span><span class="s">ğŸŸ¢</span><span class="sh">"</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">priority_icon</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="apache-spark-ì‹œë¦¬ì¦ˆ-ì™„ì„±-">Apache Spark ì‹œë¦¬ì¦ˆ ì™„ì„±! ğŸ‰</h3>

<p>ì´ì œ <strong>Apache Spark ì™„ì „ ì •ë³µ ì‹œë¦¬ì¦ˆ</strong>ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤:</p>

<ol>
  <li><strong>Part 1</strong>: Spark ê¸°ì´ˆì™€ í•µì‹¬ ê°œë… (RDD, DataFrame, Spark SQL)</li>
  <li><strong>Part 2</strong>: ëŒ€ìš©ëŸ‰ ë°°ì¹˜ ì²˜ë¦¬ì™€ UDF í™œìš© (ì‹¤ë¬´ í”„ë¡œì íŠ¸)</li>
  <li><strong>Part 3</strong>: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ Kafka ì—°ë™ (ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ)</li>
  <li><strong>Part 4</strong>: ëª¨ë‹ˆí„°ë§ê³¼ ì„±ëŠ¥ íŠœë‹ (í”„ë¡œë•ì…˜ í™˜ê²½)</li>
</ol>

<h3 id="ì‹¤ë¬´-ì ìš©-ì—­ëŸ‰">ì‹¤ë¬´ ì ìš© ì—­ëŸ‰</h3>

<p>âœ… <strong>ê¸°ìˆ ì  ì—­ëŸ‰</strong></p>
<ul>
  <li>Spark ì•„í‚¤í…ì²˜ ì™„ì „ ì´í•´</li>
  <li>ë°°ì¹˜/ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ ë§ˆìŠ¤í„°</li>
  <li>ì„±ëŠ¥ ìµœì í™” ì „ë¬¸ê°€</li>
  <li>í”„ë¡œë•ì…˜ í™˜ê²½ êµ¬ì¶•</li>
</ul>

<p>âœ… <strong>ì‹¤ë¬´ ì ìš©</strong></p>
<ul>
  <li>ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•</li>
  <li>ì‹¤ì‹œê°„ ë¶„ì„ íŒŒì´í”„ë¼ì¸ ê°œë°œ</li>
  <li>ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ìš´ì˜</li>
  <li>í´ëŸ¬ìŠ¤í„° ê´€ë¦¬ ë° íŠœë‹</li>
</ul>

<hr />

<p><strong>ì‹œë¦¬ì¦ˆ ì™„ë£Œ</strong>: <a href="/data-engineering/2025/09/10/apache-spark-series-overview.html">Apache Spark ì™„ì „ ì •ë³µ ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°</a></p>

<hr />

<p><em>ì¶•í•˜í•©ë‹ˆë‹¤! ì´ì œ Apache Sparkì˜ ëª¨ë“  ê²ƒì„ ë§ˆìŠ¤í„°í•˜ê³  ë¹…ë°ì´í„° ì²˜ë¦¬ ì „ë¬¸ê°€ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤!</em> ğŸš€âœ¨</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/09/12/apache-spark-streaming.html" class="nav-link prev">
          â† ì´ì „: Part 3: Apache Spark ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ Kafka ì—°ë™ - ì‹¤ë¬´ í”„ë¡œì íŠ¸
        </a>
      
      
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
