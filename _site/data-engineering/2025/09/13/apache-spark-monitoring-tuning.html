<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Apache Spark의 성능 모니터링, 프로파일링, 메모리 최적화, 클러스터 튜닝을 통한 프로덕션 환경 구축을 완성합니다.">



<title>Part 4: Apache Spark 모니터링과 성능 튜닝 - 프로덕션 환경 완성 - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 4: Apache Spark 모니터링과 성능 튜닝 - 프로덕션 환경 완성">
<meta property="og:description" content="Apache Spark의 성능 모니터링, 프로파일링, 메모리 최적화, 클러스터 튜닝을 통한 프로덕션 환경 구축을 완성합니다.">
<meta property="og:url" content="https://data-droid.github.io/data-engineering/2025/09/13/apache-spark-monitoring-tuning.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 4: Apache Spark 모니터링과 성능 튜닝 - 프로덕션 환경 완성">
<meta name="twitter:description" content="Apache Spark의 성능 모니터링, 프로파일링, 메모리 최적화, 클러스터 튜닝을 통한 프로덕션 환경 구축을 완성합니다.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="메뉴 열기/닫기">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">홈</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">카테고리</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">데이터 엔지니어링</a></li>
              <li><a href="/categories/bi-engineering/">BI 엔지니어링</a></li>
              <li><a href="/categories/infrastructure-tools/">인프라 & 도구</a></li>
              <li><a href="/categories/data-quality/">데이터 품질</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">블로그</a></li>
        <li><a href="/about/">소개</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- 포스트용 언어 전환 -->
        
          <a href="/data-engineering/2025/09/13/apache-spark-monitoring-tuning.html" class="lang-btn active">한국어</a>
          
          <a href="/en_posts/2025-09-13-apache-spark-monitoring-tuning.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025년 09월 13일</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 4: Apache Spark 모니터링과 성능 튜닝 - 프로덕션 환경 완성</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Spark</span>
      
        <span class="tag">성능튜닝</span>
      
        <span class="tag">모니터링</span>
      
        <span class="tag">프로파일링</span>
      
        <span class="tag">메모리최적화</span>
      
        <span class="tag">클러스터관리</span>
      
        <span class="tag">Python</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">📚 Apache spark complete guide 시리즈</span>
      <span class="series-order">Part 5</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">⏱️ 55분</span>
      
      
        <span class="difficulty">📊 전문가</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-4-apache-spark-모니터링과-성능-튜닝---프로덕션-환경-완성">Part 4: Apache Spark 모니터링과 성능 튜닝 - 프로덕션 환경 완성</h1>

<blockquote>
  <p>Apache Spark의 성능 모니터링, 프로파일링, 메모리 최적화, 클러스터 튜닝을 통한 프로덕션 환경 구축을 완성합니다.</p>
</blockquote>

<h2 id="-목차">📋 목차</h2>

<ol>
  <li><a href="#spark-ui와-메트릭-분석">Spark UI와 메트릭 분석</a></li>
  <li><a href="#성능-모니터링과-프로파일링">성능 모니터링과 프로파일링</a></li>
  <li><a href="#메모리-최적화와-캐싱-전략">메모리 최적화와 캐싱 전략</a></li>
  <li><a href="#클러스터-튜닝과-확장성">클러스터 튜닝과 확장성</a></li>
  <li><a href="#실무-프로젝트-성능-최적화-시스템">실무 프로젝트: 성능 최적화 시스템</a></li>
  <li><a href="#프로덕션-환경-구축">프로덕션 환경 구축</a></li>
  <li><a href="#학습-요약">학습 요약</a></li>
</ol>

<h2 id="️-spark-ui와-메트릭-분석">🖥️ Spark UI와 메트릭 분석</h2>

<h3 id="spark-ui-개요">Spark UI 개요</h3>

<p>Spark UI는 Spark 애플리케이션의 성능을 모니터링하고 분석하는 웹 기반 인터페이스입니다.</p>

<h4 id="핵심-탭과-기능"><strong>핵심 탭과 기능</strong></h4>

<ol>
  <li><strong>Jobs 탭</strong>
    <ul>
      <li>작업 실행 상태와 시간</li>
      <li>스테이지별 실행 정보</li>
      <li>작업 실패 원인 분석</li>
    </ul>
  </li>
  <li><strong>Stages 탭</strong>
    <ul>
      <li>각 스테이지의 상세 정보</li>
      <li>태스크 실행 분포</li>
      <li>데이터 스큐(Data Skew) 분석</li>
    </ul>
  </li>
  <li><strong>Storage 탭</strong>
    <ul>
      <li>캐시된 데이터 정보</li>
      <li>메모리 사용량</li>
      <li>디스크 저장 상태</li>
    </ul>
  </li>
  <li><strong>Environment 탭</strong>
    <ul>
      <li>Spark 설정 정보</li>
      <li>시스템 환경 변수</li>
      <li>JVM 설정</li>
    </ul>
  </li>
</ol>

<h3 id="메트릭-분석-도구">메트릭 분석 도구</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark 메트릭 수집 및 분석
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">import</span> <span class="n">time</span>

<span class="k">class</span> <span class="nc">SparkMetricsCollector</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">spark_session</span><span class="p">.</span><span class="n">sparkContext</span>
        
    <span class="k">def</span> <span class="nf">collect_job_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">작업 메트릭 수집</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        
        <span class="c1"># 실행 중인 작업 정보
</span>        <span class="n">active_jobs</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getActiveJobIds</span><span class="p">()</span>
        
        <span class="c1"># 작업별 메트릭 수집
</span>        <span class="n">job_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">job_id</span> <span class="ow">in</span> <span class="n">active_jobs</span><span class="p">:</span>
            <span class="n">job_info</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getJobInfo</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
            <span class="n">job_metrics</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">status</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numActiveTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numCompletedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">job_info</span><span class="p">.</span><span class="n">numFailedTasks</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">job_metrics</span>
    
    <span class="k">def</span> <span class="nf">collect_stage_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">스테이지 메트릭 수집</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        
        <span class="c1"># 활성 스테이지 정보
</span>        <span class="n">active_stages</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getActiveStageIds</span><span class="p">()</span>
        
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">stage_id</span> <span class="ow">in</span> <span class="n">active_stages</span><span class="p">:</span>
            <span class="n">stage_info</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getStageInfo</span><span class="p">(</span><span class="n">stage_id</span><span class="p">)</span>
            <span class="n">stage_metrics</span><span class="p">[</span><span class="n">stage_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numActiveTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numCompletedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">num_failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">numFailedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">executor_run_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">executorRunTime</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">executor_cpu_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">executorCpuTime</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">input_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">inputBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">output_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">outputBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">shuffle_read_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">shuffleReadBytes</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">shuffle_write_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage_info</span><span class="p">.</span><span class="n">shuffleWriteBytes</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">stage_metrics</span>
    
    <span class="k">def</span> <span class="nf">collect_executor_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">실행자 메트릭 수집</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">executor_info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="n">executor_info</span><span class="p">.</span><span class="n">executorId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">host</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_cores</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalCores</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">maxMemory</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">memoryUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">disk_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">diskUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">active_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">activeTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">completed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">completedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">failedTasks</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalDuration</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">total_gc_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">executor_info</span><span class="p">.</span><span class="n">totalGCTime</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">executor_metrics</span>

<span class="c1"># 사용 예제
</span><span class="k">def</span> <span class="nf">monitor_spark_application</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">MetricsExample</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">collector</span> <span class="o">=</span> <span class="nc">SparkMetricsCollector</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 주기적으로 메트릭 수집
</span>    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">job_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_job_metrics</span><span class="p">()</span>
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_stage_metrics</span><span class="p">()</span>
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="n">collector</span><span class="p">.</span><span class="nf">collect_executor_metrics</span><span class="p">()</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Job Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">job_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Stage Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">stage_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Executor Metrics ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">executor_metrics</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10초마다 수집
</span></code></pre></div></div>

<h2 id="-성능-모니터링과-프로파일링">📊 성능 모니터링과 프로파일링</h2>

<h3 id="성능-프로파일링-도구">성능 프로파일링 도구</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 성능 프로파일링 클래스
</span><span class="k">class</span> <span class="nc">SparkProfiler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">sc</span> <span class="o">=</span> <span class="n">spark_session</span><span class="p">.</span><span class="n">sparkContext</span>
        
    <span class="k">def</span> <span class="nf">profile_query_execution</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query_name</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">쿼리 실행 프로파일링</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">time</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># 실행 계획 분석
</span>        <span class="n">execution_plan</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">explain</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># 쿼리 실행
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
        
        <span class="c1"># 메트릭 수집
</span>        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">total_memory_used</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalGCTime</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="n">profile_result</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">query_name</span><span class="sh">'</span><span class="p">:</span> <span class="n">query_name</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">execution_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">execution_time</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_memory_used</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">total_gc_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_gc_time</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">execution_plan</span><span class="sh">'</span><span class="p">:</span> <span class="n">execution_plan</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">result_count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">profile_result</span>
    
    <span class="k">def</span> <span class="nf">analyze_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">데이터 스큐 분석</span><span class="sh">"""</span>
        <span class="c1"># 키별 데이터 분포 분석
</span>        <span class="n">key_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">key_columns</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
        
        <span class="c1"># 통계 정보 수집
</span>        <span class="n">stats</span> <span class="o">=</span> <span class="n">key_counts</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
            <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_keys</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">min</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">min_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">max</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">max_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">stddev</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">stddev_count</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="c1"># 스큐 비율 계산
</span>        <span class="n">skew_ratio</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="n">skew_analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span>  <span class="c1"># 스큐 임계값
</span>        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">skew_analysis</span>
    
    <span class="k">def</span> <span class="nf">monitor_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">메모리 사용량 모니터링</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">sc</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">memory_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_executors</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">executor_details</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">executor_detail</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">executor_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">executorId</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">host</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">host</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">memory_used</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">max_memory</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="o">/</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">if</span> <span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>
            <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_details</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">executor_detail</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory_used</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_max_memory</span><span class="sh">'</span><span class="p">]</span>
            <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">memory_stats</span>

<span class="c1"># 성능 분석 도구 사용 예제
</span><span class="k">def</span> <span class="nf">performance_analysis_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">PerformanceAnalysis</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">profiler</span> <span class="o">=</span> <span class="nc">SparkProfiler</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 샘플 데이터 생성
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">user_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 쿼리 프로파일링
</span>    <span class="n">profile_result</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">profile_query_execution</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">sample_aggregation</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_value</span><span class="sh">"</span><span class="p">))</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Query Profile Result:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">profile_result</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 데이터 스큐 분석
</span>    <span class="n">skew_analysis</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">analyze_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Data Skew Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">skew_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 메모리 사용량 모니터링
</span>    <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">profiler</span><span class="p">.</span><span class="nf">monitor_memory_usage</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Memory Usage Stats:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">memory_stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="성능-최적화-가이드라인">성능 최적화 가이드라인</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 성능 최적화 체크리스트
</span><span class="k">class</span> <span class="nc">PerformanceOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        
    <span class="k">def</span> <span class="nf">check_partitioning</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">파티셔닝 최적화 체크</span><span class="sh">"""</span>
        <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="c1"># 파티션 크기 확인
</span>        <span class="n">partition_sizes</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">mapPartitions</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="nf">len</span><span class="p">(</span><span class="nf">list</span><span class="p">(</span><span class="n">x</span><span class="p">))]).</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="n">avg_size</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        <span class="n">max_size</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        <span class="n">min_size</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">partition_sizes</span><span class="p">)</span>
        
        <span class="c1"># 파티션 불균형 확인
</span>        <span class="n">imbalance_ratio</span> <span class="o">=</span> <span class="n">max_size</span> <span class="o">/</span> <span class="n">avg_size</span> <span class="k">if</span> <span class="n">avg_size</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">num_partitions</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">파티션 수가 너무 적습니다. 최소 2개 이상 권장</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">imbalance_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">파티션 불균형이 심합니다 (비율: </span><span class="si">{</span><span class="n">imbalance_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). repartition() 고려</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">avg_size</span> <span class="o">&gt;</span> <span class="mi">128</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 128MB
</span>            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">파티션 크기가 너무 큽니다. 더 작은 파티션으로 분할 권장</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">num_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">avg_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">max_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">max_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">min_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">min_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">imbalance_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">imbalance_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">check_caching_strategy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">usage_count</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">캐싱 전략 체크</span><span class="sh">"""</span>
        <span class="n">storage_level</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">storageLevel</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">usage_count</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">storage_level</span> <span class="o">==</span> <span class="n">StorageLevel</span><span class="p">.</span><span class="n">NONE</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">데이터를 여러 번 사용하므로 캐싱을 고려하세요</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">storage_level</span><span class="p">.</span><span class="n">useDisk</span> <span class="ow">and</span> <span class="n">usage_count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">디스크 캐싱은 메모리 캐싱보다 느립니다. 사용 빈도를 고려하세요</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">storage_level</span><span class="sh">'</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">storage_level</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">usage_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_count</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">analyze_query_plan</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">쿼리 계획 분석</span><span class="sh">"""</span>
        <span class="n">plan</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">explain</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># 브로드캐스트 조인 확인
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">BroadcastHashJoin</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">브로드캐스트 조인이 사용되었습니다. 작은 테이블 크기를 확인하세요</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># 셔플 확인
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">Exchange</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">셔플이 발생합니다. 파티셔닝 키 최적화를 고려하세요</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># 스캔 확인
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">FileScan</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">plan</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sh">"</span><span class="s">파일 스캔이 발생합니다. 파티셔닝이나 인덱싱을 고려하세요</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">execution_plan</span><span class="sh">'</span><span class="p">:</span> <span class="n">plan</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>

<span class="c1"># 성능 최적화 예제
</span><span class="k">def</span> <span class="nf">optimization_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">OptimizationExample</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="nc">PerformanceOptimizer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 샘플 데이터
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">category_</span><span class="si">{</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 파티셔닝 체크
</span>    <span class="n">partition_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">check_partitioning</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Partitioning Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">partition_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 캐싱 전략 체크
</span>    <span class="n">caching_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">check_caching_strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">usage_count</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Caching Strategy Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">caching_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 쿼리 계획 분석
</span>    <span class="n">query_analysis</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">analyze_query_plan</span><span class="p">(</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">(</span><span class="nf">sum</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total</span><span class="sh">"</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Query Plan Analysis:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">query_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="-메모리-최적화와-캐싱-전략">💾 메모리 최적화와 캐싱 전략</h2>

<h3 id="메모리-관리-최적화">메모리 관리 최적화</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 메모리 최적화 도구
</span><span class="k">class</span> <span class="nc">MemoryOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        
    <span class="k">def</span> <span class="nf">optimize_dataframe_memory</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">DataFrame 메모리 최적화</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.types</span> <span class="kn">import</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">LongType</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">,</span> <span class="n">DoubleType</span>
        
        <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span>
        
        <span class="c1"># 컬럼 타입 최적화
</span>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">name</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">dataType</span>
            
            <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">):</span>
                <span class="c1"># 큰 정수값이 없다면 더 작은 타입으로 변경
</span>                <span class="n">max_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">max</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">))).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">min_val</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="nf">min</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">))).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                
                <span class="k">if</span> <span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="mi">127</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">128</span> <span class="o">&lt;=</span> <span class="n">max_val</span> <span class="o">&lt;=</span> <span class="mi">127</span><span class="p">:</span>
                    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">tinyint</span><span class="sh">"</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">min_val</span> <span class="o">&lt;=</span> <span class="mi">32767</span> <span class="ow">and</span> <span class="o">-</span><span class="mi">32768</span> <span class="o">&lt;=</span> <span class="n">max_val</span> <span class="o">&lt;=</span> <span class="mi">32767</span><span class="p">:</span>
                    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                        <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">smallint</span><span class="sh">"</span><span class="p">)</span>
                    <span class="p">)</span>
            
            <span class="k">elif</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">field_type</span><span class="p">,</span> <span class="n">FloatType</span><span class="p">):</span>
                <span class="c1"># Float를 Double로 변경하여 정밀도 향상
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimized_df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span>
                    <span class="n">field_name</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="n">field_name</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">double</span><span class="sh">"</span><span class="p">)</span>
                <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">optimized_df</span>
    
    <span class="k">def</span> <span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">메모리 사용량 계산</span><span class="sh">"""</span>
        <span class="c1"># DataFrame 크기 추정
</span>        <span class="n">num_rows</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
        <span class="n">num_cols</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
        
        <span class="c1"># 컬럼별 타입 크기 추정
</span>        <span class="n">type_sizes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">string</span><span class="sh">'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>  <span class="c1"># 평균 문자열 길이
</span>            <span class="sh">'</span><span class="s">int</span><span class="sh">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">bigint</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">double</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">float</span><span class="sh">'</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">boolean</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="mi">8</span>
        <span class="p">}</span>
        
        <span class="n">estimated_size</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">schema</span><span class="p">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">field_type</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">dataType</span><span class="p">)</span>
            <span class="n">base_type</span> <span class="o">=</span> <span class="n">field_type</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">(</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">lower</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">base_type</span> <span class="ow">in</span> <span class="n">type_sizes</span><span class="p">:</span>
                <span class="n">estimated_size</span> <span class="o">+=</span> <span class="n">type_sizes</span><span class="p">[</span><span class="n">base_type</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">estimated_size</span> <span class="o">+=</span> <span class="mi">8</span>  <span class="c1"># 기본값
</span>        
        <span class="n">total_estimated_size</span> <span class="o">=</span> <span class="n">num_rows</span> <span class="o">*</span> <span class="n">num_cols</span> <span class="o">*</span> <span class="n">estimated_size</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">num_rows</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_rows</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">num_cols</span><span class="sh">'</span><span class="p">:</span> <span class="n">num_cols</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_size_bytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_estimated_size</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_estimated_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">optimize_caching_strategy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">캐싱 전략 최적화</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">StorageLevel</span>
        
        <span class="n">memory_stats</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">size_mb</span> <span class="o">=</span> <span class="n">memory_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">estimated_size_mb</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">size_mb</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">MEMORY_ONLY</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">자주 사용되고 크기가 작은 데이터</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">elif</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="ow">and</span> <span class="n">size_mb</span> <span class="o">&gt;=</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">MEMORY_AND_DISK_SER</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">자주 사용되지만 크기가 큰 데이터</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">elif</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">DISK_ONLY</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">중간 빈도 사용 데이터</span><span class="sh">'</span>
            <span class="p">})</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">strategy</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">NO_CACHING</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">reason</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">낮은 빈도 사용 데이터</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">data_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">size_mb</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">access_frequency</span><span class="sh">'</span><span class="p">:</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">recommendations</span>
        <span class="p">}</span>

<span class="c1"># 메모리 최적화 예제
</span><span class="k">def</span> <span class="nf">memory_optimization_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">MemoryOptimization</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="nc">MemoryOptimizer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 샘플 데이터 생성
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">user_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">score</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">is_active</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 메모리 최적화
</span>    <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">optimize_dataframe_memory</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># 메모리 사용량 계산
</span>    <span class="n">original_memory</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">optimized_memory</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">calculate_memory_usage</span><span class="p">(</span><span class="n">optimized_df</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Original Memory Usage:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">original_memory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Optimized Memory Usage:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">optimized_memory</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 캐싱 전략 최적화
</span>    <span class="n">access_pattern</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">}</span>
    <span class="n">caching_strategy</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">.</span><span class="nf">optimize_caching_strategy</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">Caching Strategy:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">caching_strategy</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="고급-캐싱-전략">고급 캐싱 전략</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 고급 캐싱 관리자
</span><span class="k">class</span> <span class="nc">AdvancedCacheManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span> <span class="o">=</span> <span class="p">{}</span>
        
    <span class="k">def</span> <span class="nf">smart_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">지능형 캐싱</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark</span> <span class="kn">import</span> <span class="n">StorageLevel</span>
        
        <span class="c1"># 데이터 크기 확인
</span>        <span class="n">num_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="c1"># 접근 패턴에 따른 캐싱 전략 결정
</span>        <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">access_pattern</span><span class="p">[</span><span class="sh">'</span><span class="s">latency_requirement</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">low</span><span class="sh">'</span><span class="p">:</span>
                <span class="n">df</span><span class="p">.</span><span class="nf">cache</span><span class="p">()</span>  <span class="c1"># MEMORY_ONLY
</span>                <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">MEMORY_ONLY</span><span class="sh">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">StorageLevel</span><span class="p">.</span><span class="n">MEMORY_AND_DISK_SER</span><span class="p">)</span>
                <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">MEMORY_AND_DISK_SER</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span><span class="p">.</span><span class="nf">persist</span><span class="p">(</span><span class="n">StorageLevel</span><span class="p">.</span><span class="n">DISK_ONLY</span><span class="p">)</span>
            <span class="n">storage_level</span> <span class="o">=</span> <span class="sh">"</span><span class="s">DISK_ONLY</span><span class="sh">"</span>
        
        <span class="c1"># 캐시 정보 저장
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">dataframe</span><span class="sh">'</span><span class="p">:</span> <span class="n">df</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">storage_level</span><span class="sh">'</span><span class="p">:</span> <span class="n">storage_level</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">access_count</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">last_accessed</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">monitor_cache_efficiency</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">캐시 효율성 모니터링</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">cache_stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_cached_data</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">memory_cached</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">disk_cached</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">cache_hit_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">:</span>
            <span class="n">cache_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_cached_data</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span>
            <span class="n">cache_stats</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_cached</span><span class="sh">'</span><span class="p">]</span> <span class="o">+=</span> <span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span>
        
        <span class="k">return</span> <span class="n">cache_stats</span>
    
    <span class="k">def</span> <span class="nf">cleanup_unused_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">max_age_hours</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">사용하지 않는 캐시 정리</span><span class="sh">"""</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="n">max_age_seconds</span> <span class="o">=</span> <span class="n">max_age_hours</span> <span class="o">*</span> <span class="mi">3600</span>
        
        <span class="n">tables_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">cache_info</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">cache_info</span><span class="p">[</span><span class="sh">'</span><span class="s">last_accessed</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">max_age_seconds</span><span class="p">:</span>
                <span class="n">cache_info</span><span class="p">[</span><span class="sh">'</span><span class="s">dataframe</span><span class="sh">'</span><span class="p">].</span><span class="nf">unpersist</span><span class="p">()</span>
                <span class="n">tables_to_remove</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">table_name</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">table_name</span> <span class="ow">in</span> <span class="n">tables_to_remove</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">self</span><span class="p">.</span><span class="n">cached_tables</span><span class="p">[</span><span class="n">table_name</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="nf">len</span><span class="p">(</span><span class="n">tables_to_remove</span><span class="p">)</span>

<span class="c1"># 고급 캐싱 예제
</span><span class="k">def</span> <span class="nf">advanced_caching_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">AdvancedCaching</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">cache_manager</span> <span class="o">=</span> <span class="nc">AdvancedCacheManager</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 샘플 데이터
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">category_</span><span class="si">{</span><span class="n">i</span> <span class="o">%</span> <span class="mi">5</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">10000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 지능형 캐싱
</span>    <span class="n">access_pattern</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">frequency</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">latency_requirement</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">low</span><span class="sh">'</span>
    <span class="p">}</span>
    
    <span class="n">cached_df</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">smart_cache</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="sh">"</span><span class="s">sample_table</span><span class="sh">"</span><span class="p">,</span> <span class="n">access_pattern</span><span class="p">)</span>
    
    <span class="c1"># 캐시 효율성 모니터링
</span>    <span class="n">cache_stats</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">monitor_cache_efficiency</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Cache Statistics:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">cache_stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 사용하지 않는 캐시 정리
</span>    <span class="n">cleaned_count</span> <span class="o">=</span> <span class="n">cache_manager</span><span class="p">.</span><span class="nf">cleanup_unused_cache</span><span class="p">(</span><span class="n">max_age_hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Cleaned </span><span class="si">{</span><span class="n">cleaned_count</span><span class="si">}</span><span class="s"> unused cache entries</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-고급-성능-분석-도구">🔍 고급 성능 분석 도구</h2>

<h3 id="spark-history-server-활용법">Spark History Server 활용법</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark History Server 설정 및 활용
</span><span class="k">class</span> <span class="nc">HistoryServerAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">history_server_url</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span> <span class="o">=</span> <span class="n">history_server_url</span>
        
    <span class="k">def</span> <span class="nf">analyze_completed_applications</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">완료된 애플리케이션 분석</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">requests</span>
        
        <span class="c1"># History Server API를 통한 애플리케이션 목록 조회
</span>        <span class="n">apps_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">applications</span> <span class="o">=</span> <span class="n">apps_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="n">analysis_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">applications</span><span class="p">:</span>
            <span class="n">app_id</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span>
            
            <span class="c1"># 애플리케이션 상세 정보 조회
</span>            <span class="n">app_details</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">app_info</span> <span class="o">=</span> <span class="n">app_details</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            
            <span class="c1"># 작업 정보 조회
</span>            <span class="n">jobs_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/jobs</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">jobs</span> <span class="o">=</span> <span class="n">jobs_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
            
            <span class="n">analysis_result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_id</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">app_name</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">start_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">startTime</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">app_info</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">attempts</span><span class="sh">'</span><span class="p">,</span> <span class="p">[{}])[</span><span class="mi">0</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">total_jobs</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">jobs</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">failed_jobs</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">jobs</span> <span class="k">if</span> <span class="n">j</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">FAILED</span><span class="sh">'</span><span class="p">]),</span>
                <span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_identify_performance_issues</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="n">analysis_results</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">analysis_result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">analysis_results</span>
    
    <span class="k">def</span> <span class="nf">_identify_performance_issues</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">jobs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">성능 문제 식별</span><span class="sh">"""</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">:</span>
            <span class="c1"># 느린 작업 식별 (10분 이상)
</span>            <span class="k">if</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">600000</span><span class="p">:</span>  <span class="c1"># 10분 = 600,000ms
</span>                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">slow_job</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">job_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">작업 </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">가 </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">초 소요</span><span class="sh">"</span>
                <span class="p">})</span>
            
            <span class="c1"># 실패한 작업 식별
</span>            <span class="k">if</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">)</span> <span class="o">==</span> <span class="sh">'</span><span class="s">FAILED</span><span class="sh">'</span><span class="p">:</span>
                <span class="n">issues</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">failed_job</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">job_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">작업 </span><span class="si">{</span><span class="n">job</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">jobId</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s"> 실패</span><span class="sh">"</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">issues</span>
    
    <span class="k">def</span> <span class="nf">generate_performance_report</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">app_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">성능 보고서 생성</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">requests</span>
        
        <span class="c1"># 스테이지 정보 조회
</span>        <span class="n">stages_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/stages</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">stages</span> <span class="o">=</span> <span class="n">stages_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="c1"># 실행자 정보 조회
</span>        <span class="n">executors_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">history_server_url</span><span class="si">}</span><span class="s">/api/v1/applications/</span><span class="si">{</span><span class="n">app_id</span><span class="si">}</span><span class="s">/executors</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">executors</span> <span class="o">=</span> <span class="n">executors_response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        
        <span class="n">report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_stages</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_executors</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">stage_analysis</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_analyze_stages</span><span class="p">(</span><span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">executor_analysis</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_analyze_executors</span><span class="p">(</span><span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_recommendations</span><span class="p">(</span><span class="n">stages</span><span class="p">,</span> <span class="n">executors</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">report</span>
    
    <span class="k">def</span> <span class="nf">_analyze_stages</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">stages</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">스테이지 분석</span><span class="sh">"""</span>
        <span class="n">stage_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numFailedTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">slow_stages</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">stage_count</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">stages</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">avg_task_duration</span> <span class="o">=</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">executorRunTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">avg_task_duration</span>
                <span class="n">stage_count</span> <span class="o">+=</span> <span class="mi">1</span>
                
                <span class="c1"># 느린 스테이지 식별 (평균 태스크 시간 30초 이상)
</span>                <span class="k">if</span> <span class="n">avg_task_duration</span> <span class="o">&gt;</span> <span class="mi">30000</span><span class="p">:</span>
                    <span class="n">stage_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">slow_stages</span><span class="sh">'</span><span class="p">].</span><span class="nf">append</span><span class="p">({</span>
                        <span class="sh">'</span><span class="s">stage_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">stageId</span><span class="sh">'</span><span class="p">),</span>
                        <span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">:</span> <span class="n">avg_task_duration</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">num_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">stage</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">)</span>
                    <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">stage_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">stage_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_task_duration</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_duration</span> <span class="o">/</span> <span class="n">stage_count</span>
        
        <span class="k">return</span> <span class="n">stage_metrics</span>
    
    <span class="k">def</span> <span class="nf">_analyze_executors</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">실행자 분석</span><span class="sh">"""</span>
        <span class="n">executor_metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_cores</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalCores</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">maxMemory</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>
        
        <span class="n">total_used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">memoryUsed</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalGCTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_executor_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalDuration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_utilization</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_used_memory</span> <span class="o">/</span> <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">total_memory</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">executor_metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_executor_time</span>
        
        <span class="k">return</span> <span class="n">executor_metrics</span>
    
    <span class="k">def</span> <span class="nf">_generate_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">stages</span><span class="p">,</span> <span class="n">executors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">권장사항 생성</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># 메모리 사용률이 높은 경우
</span>        <span class="n">total_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">maxMemory</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">memoryUsed</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_memory</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">used_memory</span> <span class="o">/</span> <span class="n">total_memory</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">memory</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">메모리 사용률이 높습니다. executor-memory 증가를 고려하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># GC 시간이 긴 경우
</span>        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalGCTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="n">total_executor_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">totalDuration</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">executors</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_executor_time</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">gc</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GC 시간이 전체 실행 시간의 10% 이상입니다. JVM 튜닝을 고려하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># 느린 스테이지가 있는 경우
</span>        <span class="n">slow_stages</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stages</span> <span class="k">if</span> <span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">executorRunTime</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nf">max</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">numTasks</span><span class="sh">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30000</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">slow_stages</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">performance</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">slow_stages</span><span class="p">)</span><span class="si">}</span><span class="s">개의 스테이지가 느립니다. 파티셔닝 최적화를 고려하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># History Server 활용 예제
</span><span class="k">def</span> <span class="nf">history_server_analysis_example</span><span class="p">():</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">HistoryServerAnalyzer</span><span class="p">(</span><span class="sh">"</span><span class="s">http://localhost:18080</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># 완료된 애플리케이션 분석
</span>    <span class="n">completed_apps</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">analyze_completed_applications</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Completed Applications Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">completed_apps</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">App: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">app_name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> (</span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Duration: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">duration</span><span class="sh">'</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Jobs: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">total_jobs</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> (Failed: </span><span class="si">{</span><span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_jobs</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">]:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">  Performance Issues:</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">issue</span> <span class="ow">in</span> <span class="n">app</span><span class="p">[</span><span class="sh">'</span><span class="s">performance_issues</span><span class="sh">'</span><span class="p">]:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    - </span><span class="si">{</span><span class="n">issue</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">()</span>
    
    <span class="c1"># 특정 애플리케이션 상세 분석
</span>    <span class="k">if</span> <span class="n">completed_apps</span><span class="p">:</span>
        <span class="n">app_id</span> <span class="o">=</span> <span class="n">completed_apps</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sh">'</span><span class="s">app_id</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">generate_performance_report</span><span class="p">(</span><span class="n">app_id</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Performance Report ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="-실무-성능-문제-진단-및-해결">🚨 실무 성능 문제 진단 및 해결</h2>

<h3 id="data-skew-문제-해결">Data Skew 문제 해결</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Data Skew 진단 및 해결 도구
</span><span class="k">class</span> <span class="nc">DataSkewResolver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">데이터 스큐 감지</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">stddev</span>
        
        <span class="c1"># 키별 데이터 분포 분석
</span>        <span class="n">key_counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="o">*</span><span class="n">key_columns</span><span class="p">).</span><span class="nf">count</span><span class="p">()</span>
        
        <span class="c1"># 통계 계산
</span>        <span class="n">stats</span> <span class="o">=</span> <span class="n">key_counts</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
            <span class="nf">count</span><span class="p">(</span><span class="sh">"</span><span class="s">*</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">total_keys</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">min</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">min_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">max</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">max_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">avg</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">avg_count</span><span class="sh">"</span><span class="p">),</span>
            <span class="nf">stddev</span><span class="p">(</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">stddev_count</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">skew_ratio</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="k">if</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">total_keys</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">min_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">max_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">avg_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">stats</span><span class="p">[</span><span class="sh">'</span><span class="s">stddev_count</span><span class="sh">'</span><span class="p">],</span>
            <span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">:</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_skew_severity</span><span class="p">(</span><span class="n">skew_ratio</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_get_skew_severity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">skew_ratio</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">스큐 심각도 판정</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">high</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">skew_ratio</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">medium</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">low</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">resolve_data_skew</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">데이터 스큐 해결</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_apply_salting</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">random_repartition</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_apply_random_repartition</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="sh">"</span><span class="s">adaptive_query_execution</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_enable_adaptive_query_execution</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Unknown method: </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_apply_salting</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Salting 기법 적용</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">rand</span><span class="p">,</span> <span class="n">concat</span><span class="p">,</span> <span class="n">lit</span>
        
        <span class="c1"># Salt 값 생성 (0-99 사이의 랜덤 값)
</span>        <span class="n">salted_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">,</span> <span class="p">(</span><span class="nf">rand</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">int</span><span class="sh">"</span><span class="p">))</span>
        
        <span class="c1"># 키 컬럼에 salt 추가
</span>        <span class="n">salted_keys</span> <span class="o">=</span> <span class="p">[</span><span class="nf">concat</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nf">lit</span><span class="p">(</span><span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">),</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">]</span>
        <span class="n">salted_keys</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">salted_df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="o">*</span><span class="n">salted_keys</span><span class="p">,</span> <span class="o">*</span><span class="p">[</span><span class="nf">col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">key_columns</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">_apply_random_repartition</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">key_columns</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">랜덤 리파티셔닝 적용</span><span class="sh">"""</span>
        <span class="c1"># 현재 파티션 수의 2배로 증가
</span>        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        <span class="n">new_partitions</span> <span class="o">=</span> <span class="n">current_partitions</span> <span class="o">*</span> <span class="mi">2</span>
        
        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">new_partitions</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_enable_adaptive_query_execution</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">적응형 쿼리 실행 활성화</span><span class="sh">"""</span>
        <span class="c1"># Spark 설정 변경
</span>        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionFactor</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">5</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">256MB</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Data Skew 해결 예제
</span><span class="k">def</span> <span class="nf">data_skew_resolution_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">DataSkewResolution</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="nc">DataSkewResolver</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 스큐가 있는 데이터 생성 (일부 키에 대량의 데이터)
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>  <span class="c1"># 처음 1000개는 키 0에 할당 (스큐 생성)
</span>            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">))</span>  <span class="c1"># 나머지는 균등 분포
</span>    
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 스큐 감지
</span>    <span class="n">skew_analysis</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">])</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Data Skew Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">skew_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">is_skewed</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Data skew detected with ratio: </span><span class="si">{</span><span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">skew_ratio</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Severity: </span><span class="si">{</span><span class="n">skew_analysis</span><span class="p">[</span><span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># 스큐 해결
</span>        <span class="n">resolved_df</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">resolve_data_skew</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="sh">"</span><span class="s">salting</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># 해결 후 스큐 재측정
</span>        <span class="n">resolved_skew</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_data_skew</span><span class="p">(</span><span class="n">resolved_df</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">salt</span><span class="sh">"</span><span class="p">])</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== After Skew Resolution ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">resolved_skew</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="slow-task-분석-및-최적화">Slow Task 분석 및 최적화</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Slow Task 분석 및 최적화 도구
</span><span class="k">class</span> <span class="nc">SlowTaskAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">analyze_slow_tasks</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">threshold_seconds</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">느린 태스크 분석</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">avg</span><span class="p">,</span> <span class="n">stddev</span>
        
        <span class="c1"># 파티션별 처리 시간 측정
</span>        <span class="k">def</span> <span class="nf">measure_partition_processing</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
            <span class="kn">import</span> <span class="n">time</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            
            <span class="c1"># 데이터 처리
</span>            <span class="n">data</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>  <span class="c1"># 실제 처리 로직
</span>            
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
            <span class="n">processing_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            
            <span class="k">return</span> <span class="p">[(</span><span class="n">processing_time</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">data</span><span class="p">))]</span>
        
        <span class="c1"># 각 파티션의 처리 시간 측정
</span>        <span class="n">partition_metrics</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">mapPartitions</span><span class="p">(</span><span class="n">measure_partition_processing</span><span class="p">).</span><span class="nf">collect</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">partition_metrics</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">No data to analyze</span><span class="sh">"</span><span class="p">}</span>
        
        <span class="n">processing_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">partition_metrics</span><span class="p">]</span>
        <span class="n">data_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">metric</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">metric</span> <span class="ow">in</span> <span class="n">partition_metrics</span><span class="p">]</span>
        
        <span class="n">slow_partitions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">partition_metrics</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time</span> <span class="o">&gt;</span> <span class="n">threshold_seconds</span>
        <span class="p">]</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">total_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">partition_metrics</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">slow_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">avg_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">max_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">min_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">stddev_processing_time</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_stddev</span><span class="p">(</span><span class="n">processing_times</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">slow_partition_details</span><span class="sh">'</span><span class="p">:</span> <span class="n">slow_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_slow_task_recommendations</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">,</span> <span class="n">partition_metrics</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">analysis</span>
    
    <span class="k">def</span> <span class="nf">_calculate_stddev</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">표준편차 계산</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">mean</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">variance</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">mean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">values</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">variance</span> <span class="o">**</span> <span class="mf">0.5</span>
    
    <span class="k">def</span> <span class="nf">_generate_slow_task_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">slow_partitions</span><span class="p">,</span> <span class="n">all_partitions</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">느린 태스크 해결 권장사항 생성</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">slow_partitions</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">repartitioning</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">slow_partitions</span><span class="p">)</span><span class="si">}</span><span class="s">개의 파티션이 느립니다. repartition() 또는 coalesce()를 고려하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># 파티션 크기 불균형 확인
</span>        <span class="n">data_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">all_partitions</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">size_ratio</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="n">data_sizes</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">size_ratio</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">data_distribution</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">파티션 크기 불균형이 심합니다 (비율: </span><span class="si">{</span><span class="n">size_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). 데이터 분포를 개선하세요</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="c1"># 전체적인 처리 시간 분산 확인
</span>        <span class="n">processing_times</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span> <span class="k">for</span> <span class="n">time</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">all_partitions</span><span class="p">]</span>
        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">time_ratio</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span> <span class="o">/</span> <span class="nf">min</span><span class="p">(</span><span class="n">processing_times</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_ratio</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">performance_optimization</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">처리 시간 분산이 큽니다 (비율: </span><span class="si">{</span><span class="n">time_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">). 로직 최적화를 고려하세요</span><span class="sh">'</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>
    
    <span class="k">def</span> <span class="nf">optimize_partitioning</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">target_partition_size_mb</span><span class="o">=</span><span class="mi">128</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">파티셔닝 최적화</span><span class="sh">"""</span>
        <span class="c1"># 현재 데이터 크기 추정
</span>        <span class="n">row_count</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
        <span class="n">estimated_row_size_bytes</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># 추정값 (실제로는 더 정확한 계산 필요)
</span>        <span class="n">total_size_mb</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_count</span> <span class="o">*</span> <span class="n">estimated_row_size_bytes</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
        
        <span class="c1"># 최적 파티션 수 계산
</span>        <span class="n">optimal_partitions</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">total_size_mb</span> <span class="o">/</span> <span class="n">target_partition_size_mb</span><span class="p">))</span>
        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">optimal_partitions</span> <span class="o">!=</span> <span class="n">current_partitions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">optimal_partitions</span> <span class="o">&gt;</span> <span class="n">current_partitions</span><span class="p">:</span>
                <span class="c1"># 파티션 수 증가
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">optimal_partitions</span><span class="p">)</span>
                <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">repartitioned from </span><span class="si">{</span><span class="n">current_partitions</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">optimal_partitions</span><span class="si">}</span><span class="s"> partitions</span><span class="sh">"</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 파티션 수 감소
</span>                <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">optimal_partitions</span><span class="p">)</span>
                <span class="n">action</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">coalesced from </span><span class="si">{</span><span class="n">current_partitions</span><span class="si">}</span><span class="s"> to </span><span class="si">{</span><span class="n">optimal_partitions</span><span class="si">}</span><span class="s"> partitions</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">optimized_df</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">action</span> <span class="o">=</span> <span class="sh">"</span><span class="s">no partitioning change needed</span><span class="sh">"</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">optimized_dataframe</span><span class="sh">'</span><span class="p">:</span> <span class="n">optimized_df</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">original_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">current_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">optimized_partitions</span><span class="sh">'</span><span class="p">:</span> <span class="n">optimal_partitions</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">action_taken</span><span class="sh">'</span><span class="p">:</span> <span class="n">action</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">estimated_total_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">total_size_mb</span>
        <span class="p">}</span>

<span class="c1"># Slow Task 분석 예제
</span><span class="k">def</span> <span class="nf">slow_task_analysis_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">SlowTaskAnalysis</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">analyzer</span> <span class="o">=</span> <span class="nc">SlowTaskAnalyzer</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 불균등한 데이터 생성 (일부 파티션에 더 많은 데이터)
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">100000</span><span class="p">):</span>
        <span class="c1"># 처음 50%는 파티션 0에, 나머지는 균등 분포
</span>        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">heavy_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">light_data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">partition_key</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># 느린 태스크 분석
</span>    <span class="n">slow_task_analysis</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">analyze_slow_tasks</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">threshold_seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Slow Task Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">slow_task_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># 파티셔닝 최적화
</span>    <span class="n">optimization_result</span> <span class="o">=</span> <span class="n">analyzer</span><span class="p">.</span><span class="nf">optimize_partitioning</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Partitioning Optimization ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Original partitions: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">original_partitions</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Optimized partitions: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">optimized_partitions</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Action taken: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">action_taken</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Estimated total size: </span><span class="si">{</span><span class="n">optimization_result</span><span class="p">[</span><span class="sh">'</span><span class="s">estimated_total_size_mb</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="shuffle-spill-문제-해결">Shuffle Spill 문제 해결</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Shuffle Spill 문제 해결 도구
</span><span class="k">class</span> <span class="nc">ShuffleSpillResolver</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
    
    <span class="k">def</span> <span class="nf">detect_shuffle_spill</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Shuffle Spill 감지</span><span class="sh">"""</span>
        <span class="c1"># Spark 설정에서 spill 관련 설정 확인
</span>        <span class="n">spill_settings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">64MB</span><span class="sh">'</span><span class="p">),</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spill_settings</span><span class="sh">'</span><span class="p">:</span> <span class="n">spill_settings</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_spill_recommendations</span><span class="p">(</span><span class="n">spill_settings</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_generate_spill_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Spill 해결 권장사항 생성</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">adaptive_query</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Adaptive Query Execution을 활성화하여 자동 최적화를 활용하세요</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">partition_coalescing</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">파티션 결합을 활성화하여 작은 파티션들을 합치세요</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="c1"># 파티션 크기 설정 확인
</span>        <span class="n">partition_size</span> <span class="o">=</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">64MB</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">partition_size</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">partition_size</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">파티션 크기를 128MB 이상으로 증가시켜 spill을 줄이세요</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes=128MB</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">skew_join</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Skew Join 최적화를 활성화하여 데이터 스큐 문제를 해결하세요</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">config</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled=true</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>
    
    <span class="k">def</span> <span class="nf">configure_spill_prevention</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Spill 방지 설정 적용</span><span class="sh">"""</span>
        <span class="n">configurations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.coalescePartitions.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.advisoryPartitionSizeInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">128MB</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionFactor</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">5</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.skewJoin.skewedPartitionThresholdInBytes</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">256MB</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.localShuffleReader.enabled</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.optimizer.excludedRules</span><span class="sh">'</span><span class="p">:</span> <span class="sh">''</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">spark.sql.adaptive.nonEmptyPartitionRatioForBroadcastJoin</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">0.2</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">applied_configs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">configurations</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">applied_configs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to set </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">applied_configs</span>
    
    <span class="k">def</span> <span class="nf">optimize_shuffle_operations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">operation_type</span><span class="o">=</span><span class="sh">"</span><span class="s">join</span><span class="sh">"</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Shuffle 작업 최적화</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">join</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_join_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">aggregation</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_aggregation_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operation_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">repartition</span><span class="sh">"</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_optimize_repartition_shuffle</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">_optimize_join_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">조인 Shuffle 최적화</span><span class="sh">"""</span>
        <span class="c1"># 브로드캐스트 조인 힌트 추가 (작은 테이블의 경우)
</span>        <span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">broadcast</span>
        
        <span class="c1"># 여기서는 예시로 self-join을 최적화
</span>        <span class="c1"># 실제로는 두 개의 다른 DataFrame을 조인할 때 사용
</span>        <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">hint</span><span class="p">(</span><span class="sh">"</span><span class="s">broadcast</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_optimize_aggregation_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">집계 Shuffle 최적화</span><span class="sh">"""</span>
        <span class="c1"># 파티션 수를 줄여서 Shuffle 비용 감소
</span>        <span class="n">current_partitions</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_partitions</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">optimized_partitions</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="n">current_partitions</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">coalesce</span><span class="p">(</span><span class="n">optimized_partitions</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span>
    
    <span class="k">def</span> <span class="nf">_optimize_repartition_shuffle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">df</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">리파티셔닝 Shuffle 최적화</span><span class="sh">"""</span>
        <span class="c1"># 적응형 쿼리 실행을 활용하여 자동 최적화
</span>        <span class="k">return</span> <span class="n">df</span>

<span class="c1"># Shuffle Spill 해결 예제
</span><span class="k">def</span> <span class="nf">shuffle_spill_resolution_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">ShuffleSpillResolution</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">resolver</span> <span class="o">=</span> <span class="nc">ShuffleSpillResolver</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># Shuffle Spill 감지
</span>    <span class="n">spill_analysis</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">detect_shuffle_spill</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">test</span><span class="sh">"</span><span class="p">)],</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">]))</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Shuffle Spill Analysis ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">spill_analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Spill 방지 설정 적용
</span>    <span class="n">applied_configs</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">configure_spill_prevention</span><span class="p">()</span>
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Applied Spill Prevention Configs ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">applied_configs</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># 대용량 데이터로 Shuffle 테스트
</span>    <span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">])</span>
    
    <span class="c1"># Shuffle이 발생하는 작업 수행
</span>    <span class="n">result_df</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">.</span><span class="nf">optimize_shuffle_operations</span><span class="p">(</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">groupBy</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">).</span><span class="nf">agg</span><span class="p">({</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">collect_list</span><span class="sh">"</span><span class="p">}),</span>
        <span class="n">operation_type</span><span class="o">=</span><span class="sh">"</span><span class="s">aggregation</span><span class="sh">"</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Shuffle Optimization Applied ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Result partitions: </span><span class="si">{</span><span class="n">result_df</span><span class="p">.</span><span class="n">rdd</span><span class="p">.</span><span class="nf">getNumPartitions</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-모니터링-자동화">🤖 모니터링 자동화</h2>

<h3 id="health-check-시스템">Health Check 시스템</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Health Check 시스템
</span><span class="k">class</span> <span class="nc">SparkHealthChecker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">spark_session</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">spark</span> <span class="o">=</span> <span class="n">spark_session</span>
        <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">memory_usage_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.85</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">failed_task_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">executor_loss_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">slow_task_ratio</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.2</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">perform_health_check</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">전체 시스템 건강도 체크</span><span class="sh">"""</span>
        <span class="n">status_tracker</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="nf">statusTracker</span><span class="p">()</span>
        <span class="n">executor_infos</span> <span class="o">=</span> <span class="n">status_tracker</span><span class="p">.</span><span class="nf">getExecutorInfos</span><span class="p">()</span>
        
        <span class="n">health_report</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">healthy</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_memory_usage</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">gc_performance</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_gc_performance</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">task_failure</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_task_failure</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">executor_health</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_executor_health</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">cluster_utilization</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_cluster_utilization</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">:</span> <span class="p">[],</span>
            <span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>
        
        <span class="c1"># 전체 상태 결정
</span>        <span class="n">failed_checks</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span> <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">].</span><span class="nf">values</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">check</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">failed_checks</span><span class="p">:</span>
            <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">unhealthy</span><span class="sh">'</span>
            <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">check</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span> <span class="k">for</span> <span class="n">check</span> <span class="ow">in</span> <span class="n">failed_checks</span><span class="p">]</span>
        
        <span class="c1"># 권장사항 생성
</span>        <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_generate_health_recommendations</span><span class="p">(</span><span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="n">health_report</span>
    
    <span class="k">def</span> <span class="nf">_check_memory_usage</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">메모리 사용량 체크</span><span class="sh">"""</span>
        <span class="n">total_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">maxMemory</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">used_memory</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">memoryUsed</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_memory</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No memory information available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">usage_ratio</span> <span class="o">=</span> <span class="n">used_memory</span> <span class="o">/</span> <span class="n">total_memory</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Memory usage: </span><span class="si">{</span><span class="n">usage_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">usage_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_gc_performance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">GC 성능 체크</span><span class="sh">"""</span>
        <span class="n">total_duration</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalDuration</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">total_gc_time</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalGCTime</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_duration</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No duration information available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">gc_ratio</span> <span class="o">=</span> <span class="n">total_gc_time</span> <span class="o">/</span> <span class="n">total_duration</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_time_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">gc_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">GC time ratio: </span><span class="si">{</span><span class="n">gc_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">gc_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_task_failure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">태스크 실패율 체크</span><span class="sh">"""</span>
        <span class="n">total_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">completedTasks</span> <span class="o">+</span> <span class="n">info</span><span class="p">.</span><span class="n">failedTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">failed_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">failedTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_tasks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No tasks executed yet</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">failure_ratio</span> <span class="o">=</span> <span class="n">failed_tasks</span> <span class="o">/</span> <span class="n">total_tasks</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">failed_task_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">failure_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Task failure ratio: </span><span class="si">{</span><span class="n">failure_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">failure_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_executor_health</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">실행자 건강도 체크</span><span class="sh">"""</span>
        <span class="n">total_executors</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">lost_executors</span> <span class="o">=</span> <span class="nf">len</span><span class="p">([</span><span class="n">info</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span> <span class="k">if</span> <span class="n">info</span><span class="p">.</span><span class="n">isActive</span> <span class="o">==</span> <span class="bp">False</span><span class="p">])</span>
        
        <span class="k">if</span> <span class="n">total_executors</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No executors available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">loss_ratio</span> <span class="o">=</span> <span class="n">lost_executors</span> <span class="o">/</span> <span class="n">total_executors</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">health_thresholds</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_loss_ratio</span><span class="sh">'</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="n">loss_ratio</span> <span class="o">&lt;</span> <span class="n">threshold</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Executor loss ratio: </span><span class="si">{</span><span class="n">loss_ratio</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s"> (threshold: </span><span class="si">{</span><span class="n">threshold</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="s">)</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">loss_ratio</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">threshold</span><span class="sh">'</span><span class="p">:</span> <span class="n">threshold</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_cluster_utilization</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">executor_infos</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">클러스터 활용률 체크</span><span class="sh">"""</span>
        <span class="n">total_cores</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">totalCores</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        <span class="n">active_tasks</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">info</span><span class="p">.</span><span class="n">activeTasks</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">executor_infos</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">total_cores</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">No cores available</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
        
        <span class="n">utilization</span> <span class="o">=</span> <span class="n">active_tasks</span> <span class="o">/</span> <span class="n">total_cores</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>  <span class="c1"># 활용률은 높을수록 좋음
</span>            <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">'</span><span class="s">Cluster utilization: </span><span class="si">{</span><span class="n">utilization</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="o">%</span><span class="si">}</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">value</span><span class="sh">'</span><span class="p">:</span> <span class="n">utilization</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_generate_health_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">checks</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">건강도 권장사항 생성</span><span class="sh">"""</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">memory</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">메모리 사용량이 높습니다. executor-memory를 증가시키거나 데이터 캐싱을 최적화하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">gc_performance</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">gc</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GC 시간이 길어지고 있습니다. JVM GC 설정을 최적화하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">task_failure</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">reliability</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">태스크 실패율이 높습니다. 리소스 할당과 데이터 품질을 확인하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checks</span><span class="p">[</span><span class="sh">'</span><span class="s">executor_health</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">infrastructure</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">실행자 손실이 발생하고 있습니다. 클러스터 상태를 점검하세요</span><span class="sh">'</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># Health Check 예제
</span><span class="k">def</span> <span class="nf">health_check_example</span><span class="p">():</span>
    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">HealthCheck</span><span class="sh">"</span><span class="p">).</span><span class="nf">getOrCreate</span><span class="p">()</span>
    <span class="n">health_checker</span> <span class="o">=</span> <span class="nc">SparkHealthChecker</span><span class="p">(</span><span class="n">spark</span><span class="p">)</span>
    
    <span class="c1"># 건강도 체크 수행
</span>    <span class="n">health_report</span> <span class="o">=</span> <span class="n">health_checker</span><span class="p">.</span><span class="nf">perform_health_check</span><span class="p">()</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Spark Health Check Report ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Overall Status: </span><span class="si">{</span><span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">overall_status</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Timestamp: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d %H</span><span class="si">:</span><span class="o">%</span><span class="n">M</span><span class="si">:</span><span class="o">%</span><span class="n">S</span><span class="sh">'</span><span class="s">, time.localtime(health_report[</span><span class="sh">'</span><span class="n">timestamp</span><span class="sh">'</span><span class="s">]))</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Individual Checks ===</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">check_name</span><span class="p">,</span> <span class="n">check_result</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">checks</span><span class="sh">'</span><span class="p">].</span><span class="nf">items</span><span class="p">():</span>
        <span class="n">status_icon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">✅</span><span class="sh">"</span> <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="sh">'</span><span class="s">status</span><span class="sh">'</span><span class="p">]</span> <span class="k">else</span> <span class="sh">"</span><span class="s">❌</span><span class="sh">"</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">status_icon</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">check_name</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">check_result</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Critical Alerts ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">critical_alerts</span><span class="sh">'</span><span class="p">]:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">🚨 </span><span class="si">{</span><span class="n">alert</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="se">\n</span><span class="s">=== Recommendations ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">health_report</span><span class="p">[</span><span class="sh">'</span><span class="s">recommendations</span><span class="sh">'</span><span class="p">]:</span>
            <span class="n">priority_icon</span> <span class="o">=</span> <span class="sh">"</span><span class="s">🔴</span><span class="sh">"</span> <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">high</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">"</span><span class="s">🟡</span><span class="sh">"</span> <span class="k">if</span> <span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="sh">'</span><span class="s">medium</span><span class="sh">'</span> <span class="k">else</span> <span class="sh">"</span><span class="s">🟢</span><span class="sh">"</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">priority_icon</span><span class="si">}</span><span class="s"> [</span><span class="si">{</span><span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">priority</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s">] </span><span class="si">{</span><span class="n">rec</span><span class="p">[</span><span class="sh">'</span><span class="s">action</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-학습-요약">📚 학습 요약</h2>

<h3 id="apache-spark-시리즈-완성-">Apache Spark 시리즈 완성! 🎉</h3>

<p>이제 <strong>Apache Spark 완전 정복 시리즈</strong>가 완성되었습니다:</p>

<ol>
  <li><strong>Part 1</strong>: Spark 기초와 핵심 개념 (RDD, DataFrame, Spark SQL)</li>
  <li><strong>Part 2</strong>: 대용량 배치 처리와 UDF 활용 (실무 프로젝트)</li>
  <li><strong>Part 3</strong>: 실시간 스트리밍 처리와 Kafka 연동 (실시간 시스템)</li>
  <li><strong>Part 4</strong>: 모니터링과 성능 튜닝 (프로덕션 환경)</li>
</ol>

<h3 id="실무-적용-역량">실무 적용 역량</h3>

<p>✅ <strong>기술적 역량</strong></p>
<ul>
  <li>Spark 아키텍처 완전 이해</li>
  <li>배치/스트리밍 처리 마스터</li>
  <li>성능 최적화 전문가</li>
  <li>프로덕션 환경 구축</li>
</ul>

<p>✅ <strong>실무 적용</strong></p>
<ul>
  <li>대용량 데이터 처리 시스템 구축</li>
  <li>실시간 분석 파이프라인 개발</li>
  <li>성능 모니터링 시스템 운영</li>
  <li>클러스터 관리 및 튜닝</li>
</ul>

<hr />

<p><strong>시리즈 완료</strong>: <a href="/data-engineering/2025/09/10/apache-spark-series-overview.html">Apache Spark 완전 정복 시리즈 전체 보기</a></p>

<hr />

<p><em>축하합니다! 이제 Apache Spark의 모든 것을 마스터하고 빅데이터 처리 전문가가 되었습니다!</em> 🚀✨</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/09/12/apache-spark-streaming.html" class="nav-link prev">
          ← 이전: Part 3: Apache Spark 실시간 스트리밍 처리와 Kafka 연동 - 실무 프로젝트
        </a>
      
      
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        📚 시리즈 전체 보기
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>데이터 엔지니어가 다루는 기술 블로그</p>
      </div>
      
      <div class="footer-section">
        <h4>카테고리</h4>
        <ul>
          <li><a href="/categories/data-engineering/">데이터 엔지니어링</a></li>
          <li><a href="/categories/bi-engineering/">BI 엔지니어링</a></li>
          <li><a href="/categories/infrastructure-tools/">인프라 & 도구</a></li>
          <li><a href="/categories/data-quality/">데이터 품질</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>링크</h4>
        <ul>
          <li><a href="/">홈</a></li>
          <li><a href="/blog/">블로그</a></li>
          <li><a href="/about/">소개</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>소셜</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. 모든 권리 보유</p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
