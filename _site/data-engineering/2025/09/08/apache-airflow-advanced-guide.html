<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” Apache Airflowì˜ ê³ ê¸‰ ê¸°ëŠ¥ê³¼ ëª¨ë²” ì‚¬ë¡€ë¥¼ í•™ìŠµí•˜ê³  ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë´…ë‹ˆë‹¤.">



<title>Apache Airflow ì‹¬í™” ê°€ì´ë“œ: DAG ìµœì í™”ë¶€í„° ëª¨ë‹ˆí„°ë§ê¹Œì§€ - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Apache Airflow ì‹¬í™” ê°€ì´ë“œ: DAG ìµœì í™”ë¶€í„° ëª¨ë‹ˆí„°ë§ê¹Œì§€">
<meta property="og:description" content="ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” Apache Airflowì˜ ê³ ê¸‰ ê¸°ëŠ¥ê³¼ ëª¨ë²” ì‚¬ë¡€ë¥¼ í•™ìŠµí•˜ê³  ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë´…ë‹ˆë‹¤.">
<meta property="og:url" content="https://data-droid.github.io/data-engineering/2025/09/08/apache-airflow-advanced-guide.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache Airflow ì‹¬í™” ê°€ì´ë“œ: DAG ìµœì í™”ë¶€í„° ëª¨ë‹ˆí„°ë§ê¹Œì§€">
<meta name="twitter:description" content="ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” Apache Airflowì˜ ê³ ê¸‰ ê¸°ëŠ¥ê³¼ ëª¨ë²” ì‚¬ë¡€ë¥¼ í•™ìŠµí•˜ê³  ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë´…ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/09/08/apache-airflow-advanced-guide.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-09-08-apache-airflow-advanced-guide.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 09ì›” 08ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Apache Airflow ì‹¬í™” ê°€ì´ë“œ: DAG ìµœì í™”ë¶€í„° ëª¨ë‹ˆí„°ë§ê¹Œì§€</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Airflow</span>
      
        <span class="tag">ë°ì´í„°íŒŒì´í”„ë¼ì¸</span>
      
        <span class="tag">ì›Œí¬í”Œë¡œìš°</span>
      
        <span class="tag">DAG</span>
      
        <span class="tag">ìŠ¤ì¼€ì¤„ë§</span>
      
        <span class="tag">ëª¨ë‹ˆí„°ë§</span>
      
        <span class="tag">ë°ì´í„°ì—”ì§€ë‹ˆì–´ë§</span>
      
    </div>
    
    
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 25ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ê³ ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="apache-airflow-ì‹¬í™”-ê°€ì´ë“œ-dag-ìµœì í™”ë¶€í„°-ëª¨ë‹ˆí„°ë§ê¹Œì§€">Apache Airflow ì‹¬í™” ê°€ì´ë“œ: DAG ìµœì í™”ë¶€í„° ëª¨ë‹ˆí„°ë§ê¹Œì§€</h1>

<blockquote>
  <p>ì‹¤ë¬´ì—ì„œ ìì£¼ ì‚¬ìš©ë˜ëŠ” Apache Airflowì˜ ê³ ê¸‰ ê¸°ëŠ¥ê³¼ ëª¨ë²” ì‚¬ë¡€ë¥¼ í•™ìŠµí•˜ê³  ì‹¤ì œ í”„ë¡œì íŠ¸ì— ì ìš©í•´ë´…ë‹ˆë‹¤.</p>
</blockquote>

<h2 id="-ëª©ì°¨">ğŸ“‹ ëª©ì°¨</h2>

<ol>
  <li><a href="#airflow-ì•„í‚¤í…ì²˜-ì‹¬í™”-ì´í•´">Airflow ì•„í‚¤í…ì²˜ ì‹¬í™” ì´í•´</a></li>
  <li><a href="#dag-ìµœì í™”-ì „ëµ">DAG ìµœì í™” ì „ëµ</a></li>
  <li><a href="#ê³ ê¸‰-ìŠ¤ì¼€ì¤„ë§ê³¼-íŠ¸ë¦¬ê±°">ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§ê³¼ íŠ¸ë¦¬ê±°</a></li>
  <li><a href="#ì—ëŸ¬-ì²˜ë¦¬ì™€-ì¬ì‹œë„-ì „ëµ">ì—ëŸ¬ ì²˜ë¦¬ì™€ ì¬ì‹œë„ ì „ëµ</a></li>
  <li><a href="#ëª¨ë‹ˆí„°ë§ê³¼-ì•Œë¦¼-ì‹œìŠ¤í…œ">ëª¨ë‹ˆí„°ë§ê³¼ ì•Œë¦¼ ì‹œìŠ¤í…œ</a></li>
  <li><a href="#ì‹¤ìŠµ-ì‹¤ë¬´ê¸‰-ë°ì´í„°-íŒŒì´í”„ë¼ì¸-êµ¬ì¶•">ì‹¤ìŠµ: ì‹¤ë¬´ê¸‰ ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•</a></li>
  <li><a href="#ì„±ëŠ¥-íŠœë‹ê³¼-í™•ì¥ì„±">ì„±ëŠ¥ íŠœë‹ê³¼ í™•ì¥ì„±</a></li>
  <li><a href="#ë³´ì•ˆê³¼-ê¶Œí•œ-ê´€ë¦¬">ë³´ì•ˆê³¼ ê¶Œí•œ ê´€ë¦¬</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ol>

<h2 id="ï¸-airflow-ì•„í‚¤í…ì²˜-ì‹¬í™”-ì´í•´">ğŸ—ï¸ Airflow ì•„í‚¤í…ì²˜ ì‹¬í™” ì´í•´</h2>

<h3 id="í•µì‹¬-ì»´í¬ë„ŒíŠ¸-ë¶„ì„">í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ë¶„ì„</h3>

<p>Apache AirflowëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ë“¤ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤:</p>

<h4 id="1-scheduler"><strong>1. Scheduler</strong></h4>
<ul>
  <li><strong>ì—­í• </strong>: DAG íŒŒì‹±, Task ì¸ìŠ¤í„´ìŠ¤ ìƒì„±, ì‹¤í–‰ ìŠ¤ì¼€ì¤„ë§</li>
  <li><strong>ë™ì‘ ì›ë¦¬</strong>: ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ DAG ìƒíƒœë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ í™•ì¸</li>
  <li><strong>ì„±ëŠ¥ ìµœì í™”</strong>: ë³‘ë ¬ ì²˜ë¦¬, DAG íŒŒì‹± ìºì‹±</li>
</ul>

<h4 id="2-executor"><strong>2. Executor</strong></h4>
<ul>
  <li><strong>LocalExecutor</strong>: ë‹¨ì¼ ë¨¸ì‹ ì—ì„œ ìˆœì°¨ ì‹¤í–‰</li>
  <li><strong>CeleryExecutor</strong>: ë¶„ì‚° í™˜ê²½ì—ì„œ ë³‘ë ¬ ì‹¤í–‰</li>
  <li><strong>KubernetesExecutor</strong>: ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‹¤í–‰</li>
  <li><strong>LocalKubernetesExecutor</strong>: í•˜ì´ë¸Œë¦¬ë“œ ì‹¤í–‰ ë°©ì‹</li>
</ul>

<h4 id="3-webserver"><strong>3. Webserver</strong></h4>
<ul>
  <li><strong>UI ì œê³µ</strong>: DAG ëª¨ë‹ˆí„°ë§, ë¡œê·¸ í™•ì¸, ìˆ˜ë™ ì‹¤í–‰</li>
  <li><strong>REST API</strong>: ì™¸ë¶€ ì‹œìŠ¤í…œê³¼ì˜ ì—°ë™</li>
  <li><strong>ì¸ì¦/ê¶Œí•œ</strong>: ë³´ì•ˆ ê´€ë¦¬</li>
</ul>

<h4 id="4-metadata-database"><strong>4. Metadata Database</strong></h4>
<ul>
  <li><strong>PostgreSQL/MySQL</strong>: ë©”íƒ€ë°ì´í„° ì €ì¥</li>
  <li><strong>ì—°ê²° ì •ë³´</strong>: Connection, Variable, XCom</li>
  <li><strong>ì‹¤í–‰ íˆìŠ¤í† ë¦¬</strong>: Task ì¸ìŠ¤í„´ìŠ¤, ë¡œê·¸ ì •ë³´</li>
</ul>

<h3 id="ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ-ì´í•´">ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ì´í•´</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì£¼ìš” í…Œì´ë¸” êµ¬ì¡°</span>
<span class="c1">-- dag: DAG ë©”íƒ€ë°ì´í„°</span>
<span class="c1">-- dag_run: DAG ì‹¤í–‰ ì¸ìŠ¤í„´ìŠ¤</span>
<span class="c1">-- task_instance: Task ì‹¤í–‰ ì¸ìŠ¤í„´ìŠ¤</span>
<span class="c1">-- log: ì‹¤í–‰ ë¡œê·¸</span>
<span class="c1">-- connection: ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´</span>
<span class="c1">-- variable: ì „ì—­ ë³€ìˆ˜</span>
<span class="c1">-- xcom: Task ê°„ ë°ì´í„° ì „ë‹¬</span>
</code></pre></div></div>

<h2 id="-dag-ìµœì í™”-ì „ëµ">âš¡ DAG ìµœì í™” ì „ëµ</h2>

<h3 id="1-dag-êµ¬ì¡°-ìµœì í™”">1. DAG êµ¬ì¡° ìµœì í™”</h3>

<h4 id="íš¨ìœ¨ì ì¸-task-ì •ì˜"><strong>íš¨ìœ¨ì ì¸ Task ì •ì˜</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="n">airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="n">airflow.operators.python</span> <span class="kn">import</span> <span class="n">PythonOperator</span>
<span class="kn">from</span> <span class="n">airflow.operators.bash</span> <span class="kn">import</span> <span class="n">BashOperator</span>
<span class="kn">from</span> <span class="n">airflow.sensors.filesystem</span> <span class="kn">import</span> <span class="n">FileSensor</span>
<span class="kn">from</span> <span class="n">airflow.utils.task_group</span> <span class="kn">import</span> <span class="n">TaskGroup</span>

<span class="c1"># ê¸°ë³¸ DAG ì„¤ì •
</span><span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">owner</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">data-team</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">depends_on_past</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">start_date</span><span class="sh">'</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">email_on_failure</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">email_on_retry</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">retries</span><span class="sh">'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">retry_delay</span><span class="sh">'</span><span class="p">:</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">catchup</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>  <span class="c1"># ê³¼ê±° ì‹¤í–‰ ê±´ë„ˆë›°ê¸°
</span>    <span class="sh">'</span><span class="s">max_active_runs</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1"># ë™ì‹œ ì‹¤í–‰ ì œí•œ
</span><span class="p">}</span>

<span class="c1"># DAG ì •ì˜
</span><span class="n">dag</span> <span class="o">=</span> <span class="nc">DAG</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">advanced_data_pipeline</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">ê³ ê¸‰ ë°ì´í„° íŒŒì´í”„ë¼ì¸</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="sh">'</span><span class="s">0 2 * * *</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># ë§¤ì¼ ì˜¤ì „ 2ì‹œ
</span>    <span class="n">max_active_runs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">data-engineering</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">etl</span><span class="sh">'</span><span class="p">],</span>
<span class="p">)</span>

<span class="c1"># Task Groupì„ í™œìš©í•œ êµ¬ì¡°í™”
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">data_extraction</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ë°ì´í„° ì¶”ì¶œ</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">extraction_group</span><span class="p">:</span>
    <span class="c1"># íŒŒì¼ ì¡´ì¬ í™•ì¸
</span>    <span class="n">file_sensor</span> <span class="o">=</span> <span class="nc">FileSensor</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">check_source_file</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">filepath</span><span class="o">=</span><span class="sh">'</span><span class="s">/data/input/sales_data.csv</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">poke_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ê²€ì¦
</span>    <span class="n">validate_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">validate_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">validate_source_data</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">file_path</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">/data/input/sales_data.csv</span><span class="sh">'</span><span class="p">},</span>
    <span class="p">)</span>

<span class="c1"># ë©”ì¸ ì²˜ë¦¬ ë¡œì§
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">data_processing</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ë°ì´í„° ì²˜ë¦¬</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">processing_group</span><span class="p">:</span>
    <span class="c1"># ë°ì´í„° ë³€í™˜
</span>    <span class="n">transform_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">transform_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">transform_sales_data</span><span class="p">,</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_processing_pool</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># ë¦¬ì†ŒìŠ¤ í’€ ì‚¬ìš©
</span>        <span class="n">pool_slots</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ë¡œë“œ
</span>    <span class="n">load_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">load_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">load_to_warehouse</span><span class="p">,</span>
        <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">all_success</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ì˜ì¡´ì„± ì„¤ì •
</span><span class="n">extraction_group</span> <span class="o">&gt;&gt;</span> <span class="n">processing_group</span>
</code></pre></div></div>

<h3 id="2-ë¦¬ì†ŒìŠ¤-ê´€ë¦¬-ìµœì í™”">2. ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìµœì í™”</h3>

<h4 id="poolê³¼-queue-í™œìš©"><strong>Poolê³¼ Queue í™œìš©</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># airflow.cfg ì„¤ì •
</span><span class="p">[</span><span class="n">celery</span><span class="p">]</span>
<span class="n">worker_concurrency</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">worker_precheck</span> <span class="o">=</span> <span class="bp">True</span>

<span class="c1"># Pool ì •ì˜
</span><span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">Pool</span>

<span class="c1"># ë¦¬ì†ŒìŠ¤ í’€ ìƒì„±
</span><span class="n">Pool</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="n">pool_name</span><span class="o">=</span><span class="sh">'</span><span class="s">data_processing_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">slots</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">ë°ì´í„° ì²˜ë¦¬ ì „ìš© í’€</span><span class="sh">'</span>
<span class="p">)</span>

<span class="n">Pool</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
    <span class="n">pool_name</span><span class="o">=</span><span class="sh">'</span><span class="s">heavy_computation_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">slots</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">ë¬´ê±°ìš´ ì—°ì‚° ì „ìš© í’€</span><span class="sh">'</span>
<span class="p">)</span>

<span class="c1"># Taskì—ì„œ Pool ì‚¬ìš©
</span><span class="n">heavy_task</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">heavy_computation</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">python_callable</span><span class="o">=</span><span class="n">heavy_computation_function</span><span class="p">,</span>
    <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">heavy_computation_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">pool_slots</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ë©”ëª¨ë¦¬-ì‚¬ìš©ëŸ‰-ìµœì í™”">3. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ëŒ€ìš©ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ì²­í¬ ë‹¨ìœ„ ì²˜ë¦¬
</span><span class="k">def</span> <span class="nf">process_large_dataset</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ ì²­í¬ ë‹¨ìœ„ë¡œ ì²˜ë¦¬</span><span class="sh">"""</span>
    <span class="n">chunk_size</span> <span class="o">=</span> <span class="mi">10000</span>
    
    <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span>
        <span class="sh">'</span><span class="s">/data/large_dataset.csv</span><span class="sh">'</span><span class="p">,</span> 
        <span class="n">chunksize</span><span class="o">=</span><span class="n">chunk_size</span>
    <span class="p">):</span>
        <span class="c1"># ì²­í¬ë³„ ì²˜ë¦¬
</span>        <span class="n">processed_chunk</span> <span class="o">=</span> <span class="nf">process_chunk</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        
        <span class="c1"># ì¤‘ê°„ ê²°ê³¼ ì €ì¥
</span>        <span class="nf">save_intermediate_result</span><span class="p">(</span><span class="n">processed_chunk</span><span class="p">)</span>
        
        <span class="c1"># ë©”ëª¨ë¦¬ ì •ë¦¬
</span>        <span class="k">del</span> <span class="n">processed_chunk</span>
        <span class="n">gc</span><span class="p">.</span><span class="nf">collect</span><span class="p">()</span>

<span class="c1"># XCom ëŒ€ì‹  íŒŒì¼ ê¸°ë°˜ ë°ì´í„° ì „ë‹¬
</span><span class="k">def</span> <span class="nf">save_large_data</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ëŒ€ìš©ëŸ‰ ë°ì´í„°ë¥¼ íŒŒì¼ë¡œ ì €ì¥</span><span class="sh">"""</span>
    <span class="n">large_data</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span><span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">previous_task</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># íŒŒì¼ë¡œ ì €ì¥
</span>    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">/tmp/large_data.pkl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pickle</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">large_data</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="sh">'</span><span class="s">/tmp/large_data.pkl</span><span class="sh">'</span>

<span class="k">def</span> <span class="nf">load_large_data</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">íŒŒì¼ì—ì„œ ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¡œë“œ</span><span class="sh">"""</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span><span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">save_task</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pickle</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ê³ ê¸‰-ìŠ¤ì¼€ì¤„ë§ê³¼-íŠ¸ë¦¬ê±°">â° ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§ê³¼ íŠ¸ë¦¬ê±°</h2>

<h3 id="1-ë™ì -ìŠ¤ì¼€ì¤„ë§">1. ë™ì  ìŠ¤ì¼€ì¤„ë§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì¡°ê±´ë¶€ ìŠ¤ì¼€ì¤„ë§
</span><span class="k">def</span> <span class="nf">should_run_dag</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">DAG ì‹¤í–‰ ì¡°ê±´ í™•ì¸</span><span class="sh">"""</span>
    <span class="c1"># íŠ¹ì • ì¡°ê±´ì—ì„œë§Œ ì‹¤í–‰
</span>    <span class="k">if</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">weekday</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>  <span class="c1"># ì›”, ìˆ˜, ê¸ˆ
</span>        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># ì¡°ê±´ë¶€ DAG
</span><span class="n">dag</span> <span class="o">=</span> <span class="nc">DAG</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">conditional_dag</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="sh">'</span><span class="s">0 9 * * *</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">catchup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ì¡°ê±´ë¶€ ì‹¤í–‰
</span><span class="n">conditional_task</span> <span class="o">=</span> <span class="nc">BranchPythonOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">check_conditions</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">python_callable</span><span class="o">=</span><span class="n">should_run_dag</span><span class="p">,</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ë™ì  Task ìƒì„±
</span><span class="k">def</span> <span class="nf">create_dynamic_tasks</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì‹¤í–‰ ì‹œì ì— ë™ì ìœ¼ë¡œ Task ìƒì„±</span><span class="sh">"""</span>
    <span class="c1"># ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ Task ëª©ë¡ ì¡°íšŒ
</span>    <span class="n">task_list</span> <span class="o">=</span> <span class="nf">get_external_task_list</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">task_info</span> <span class="ow">in</span> <span class="n">task_list</span><span class="p">:</span>
        <span class="n">task</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
            <span class="n">task_id</span><span class="o">=</span><span class="sa">f</span><span class="sh">"</span><span class="s">dynamic_task_</span><span class="si">{</span><span class="n">task_info</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">python_callable</span><span class="o">=</span><span class="n">execute_dynamic_task</span><span class="p">,</span>
            <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">task_info</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_info</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">yield</span> <span class="n">task</span>
</code></pre></div></div>

<h3 id="2-ì™¸ë¶€-íŠ¸ë¦¬ê±°-í™œìš©">2. ì™¸ë¶€ íŠ¸ë¦¬ê±° í™œìš©</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># REST APIë¥¼ í†µí•œ ì™¸ë¶€ íŠ¸ë¦¬ê±°
</span><span class="kn">from</span> <span class="n">airflow.api_connexion.endpoints</span> <span class="kn">import</span> <span class="n">dag_run_endpoint</span>
<span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">DagRun</span>

<span class="c1"># ì™¸ë¶€ ì‹œìŠ¤í…œì—ì„œ DAG ì‹¤í–‰
</span><span class="k">def</span> <span class="nf">trigger_dag_externally</span><span class="p">(</span><span class="n">dag_id</span><span class="p">,</span> <span class="n">conf</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì™¸ë¶€ì—ì„œ DAG ì‹¤í–‰</span><span class="sh">"""</span>
    <span class="n">dag_run</span> <span class="o">=</span> <span class="n">DagRun</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span>
        <span class="n">dag_id</span><span class="o">=</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="n">execution_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
        <span class="n">state</span><span class="o">=</span><span class="sh">'</span><span class="s">running</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">dag_run</span>

<span class="c1"># ì›¹í›…ì„ í†µí•œ íŠ¸ë¦¬ê±°
</span><span class="kn">from</span> <span class="n">airflow.operators.http_operator</span> <span class="kn">import</span> <span class="n">SimpleHttpOperator</span>

<span class="n">webhook_trigger</span> <span class="o">=</span> <span class="nc">SimpleHttpOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">webhook_trigger</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">http_conn_id</span><span class="o">=</span><span class="sh">'</span><span class="s">webhook_connection</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">endpoint</span><span class="o">=</span><span class="sh">'</span><span class="s">trigger</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="sh">'</span><span class="s">{</span><span class="sh">"</span><span class="s">dag_id</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">target_dag</span><span class="sh">"</span><span class="s">}</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">dag</span><span class="o">=</span><span class="n">dag</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ìŠ¤ì¼€ì¤„-ìµœì í™”">3. ìŠ¤ì¼€ì¤„ ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Cron í‘œí˜„ì‹ í™œìš©
</span><span class="kn">from</span> <span class="n">airflow.timetables.trigger</span> <span class="kn">import</span> <span class="n">CronTriggerTimetable</span>

<span class="c1"># ë³µì¡í•œ ìŠ¤ì¼€ì¤„ë§
</span><span class="n">custom_schedule</span> <span class="o">=</span> <span class="nc">CronTriggerTimetable</span><span class="p">(</span>
    <span class="n">cron</span><span class="o">=</span><span class="sh">'</span><span class="s">0 2 * * 1-5</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># í‰ì¼ ì˜¤ì „ 2ì‹œ
</span>    <span class="n">timezone</span><span class="o">=</span><span class="sh">'</span><span class="s">Asia/Seoul</span><span class="sh">'</span>
<span class="p">)</span>

<span class="n">dag</span> <span class="o">=</span> <span class="nc">DAG</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">business_hours_dag</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">timetable</span><span class="o">=</span><span class="n">custom_schedule</span><span class="p">,</span>
    <span class="n">catchup</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ë°ì´í„° ê¸°ë°˜ ìŠ¤ì¼€ì¤„ë§
</span><span class="k">def</span> <span class="nf">get_next_run_time</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ìƒíƒœì— ë”°ë¼ ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ ê²°ì •</span><span class="sh">"""</span>
    <span class="n">last_processed</span> <span class="o">=</span> <span class="nf">get_last_processed_time</span><span class="p">()</span>
    <span class="n">data_available</span> <span class="o">=</span> <span class="nf">check_data_availability</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">data_available</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ì—ëŸ¬-ì²˜ë¦¬ì™€-ì¬ì‹œë„-ì „ëµ">ğŸš¨ ì—ëŸ¬ ì²˜ë¦¬ì™€ ì¬ì‹œë„ ì „ëµ</h2>

<h3 id="1-ê³ ê¸‰-ì¬ì‹œë„-ë¡œì§">1. ê³ ê¸‰ ì¬ì‹œë„ ë¡œì§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì§€ìˆ˜ ë°±ì˜¤í”„ ì¬ì‹œë„
</span><span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">BaseOperator</span>
<span class="kn">from</span> <span class="n">airflow.utils.decorators</span> <span class="kn">import</span> <span class="n">apply_defaults</span>
<span class="kn">import</span> <span class="n">random</span>

<span class="k">class</span> <span class="nc">SmartRetryOperator</span><span class="p">(</span><span class="n">BaseOperator</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì§€ëŠ¥í˜• ì¬ì‹œë„ ì—°ì‚°ì</span><span class="sh">"""</span>
    
    <span class="nd">@apply_defaults</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">base_delay</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">max_delay</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">exponential_base</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">jitter</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_delay</span> <span class="o">=</span> <span class="n">base_delay</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_delay</span> <span class="o">=</span> <span class="n">max_delay</span>
        <span class="n">self</span><span class="p">.</span><span class="n">exponential_base</span> <span class="o">=</span> <span class="n">exponential_base</span>
        <span class="n">self</span><span class="p">.</span><span class="n">jitter</span> <span class="o">=</span> <span class="n">jitter</span>
    
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤í–‰ ë¡œì§</span><span class="sh">"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_execute_logic</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_should_retry</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">_schedule_retry</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
    
    <span class="k">def</span> <span class="nf">_should_retry</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¬ì‹œë„ ì—¬ë¶€ íŒë‹¨</span><span class="sh">"""</span>
        <span class="c1"># íŠ¹ì • ì˜ˆì™¸ë§Œ ì¬ì‹œë„
</span>        <span class="n">retryable_exceptions</span> <span class="o">=</span> <span class="p">(</span><span class="nb">ConnectionError</span><span class="p">,</span> <span class="nb">TimeoutError</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">exception</span><span class="p">,</span> <span class="n">retryable_exceptions</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_schedule_retry</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¬ì‹œë„ ìŠ¤ì¼€ì¤„ë§</span><span class="sh">"""</span>
        <span class="n">retry_count</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="n">try_number</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">exponential_base</span> <span class="o">**</span> <span class="n">retry_count</span><span class="p">),</span>
            <span class="n">self</span><span class="p">.</span><span class="n">max_delay</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">jitter</span><span class="p">:</span>
            <span class="n">delay</span> <span class="o">+=</span> <span class="n">random</span><span class="p">.</span><span class="nf">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">delay</span> <span class="o">*</span> <span class="mf">0.1</span><span class="p">)</span>
        
        <span class="c1"># ì¬ì‹œë„ ì˜ˆì•½
</span>        <span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">TaskInstance</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">ti</span><span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="sh">'</span><span class="s">up_for_retry</span><span class="sh">'</span>
        <span class="n">ti</span><span class="p">.</span><span class="n">next_method</span> <span class="o">=</span> <span class="sh">'</span><span class="s">retry</span><span class="sh">'</span>
        <span class="n">ti</span><span class="p">.</span><span class="n">next_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">delay</span><span class="sh">'</span><span class="p">:</span> <span class="n">delay</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="2-ì—ëŸ¬-ì•Œë¦¼-ì‹œìŠ¤í…œ">2. ì—ëŸ¬ ì•Œë¦¼ ì‹œìŠ¤í…œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìŠ¬ë™ ì•Œë¦¼
</span><span class="kn">from</span> <span class="n">airflow.providers.slack.operators.slack_webhook</span> <span class="kn">import</span> <span class="n">SlackWebhookOperator</span>

<span class="k">def</span> <span class="nf">send_slack_alert</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ìŠ¬ë™ìœ¼ë¡œ ì—ëŸ¬ ì•Œë¦¼</span><span class="sh">"""</span>
    <span class="n">task_instance</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"""</span><span class="s">
    ğŸš¨ Airflow Task ì‹¤íŒ¨ ì•Œë¦¼
    
    DAG: </span><span class="si">{</span><span class="n">task_instance</span><span class="p">.</span><span class="n">dag_id</span><span class="si">}</span><span class="s">
    Task: </span><span class="si">{</span><span class="n">task_instance</span><span class="p">.</span><span class="n">task_id</span><span class="si">}</span><span class="s">
    ì‹¤í–‰ ì‹œê°„: </span><span class="si">{</span><span class="n">task_instance</span><span class="p">.</span><span class="n">start_date</span><span class="si">}</span><span class="s">
    ì—ëŸ¬: </span><span class="si">{</span><span class="n">context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">exception</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Unknown error</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">
    ë¡œê·¸: </span><span class="si">{</span><span class="n">task_instance</span><span class="p">.</span><span class="n">log_url</span><span class="si">}</span><span class="s">
    </span><span class="sh">"""</span>
    
    <span class="k">return</span> <span class="nc">SlackWebhookOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">slack_alert</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">http_conn_id</span><span class="o">=</span><span class="sh">'</span><span class="s">slack_webhook</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ì´ë©”ì¼ ì•Œë¦¼
</span><span class="kn">from</span> <span class="n">airflow.operators.email_operator</span> <span class="kn">import</span> <span class="n">EmailOperator</span>

<span class="n">email_alert</span> <span class="o">=</span> <span class="nc">EmailOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">email_alert</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">to</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">data-team@company.com</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">subject</span><span class="o">=</span><span class="sh">'</span><span class="s">Airflow Task ì‹¤íŒ¨ - </span><span class="sh">'</span><span class="p">,</span>
    <span class="n">html_content</span><span class="o">=</span><span class="sh">"""</span><span class="s">
    &lt;h2&gt;Task ì‹¤íŒ¨ ì•Œë¦¼&lt;/h2&gt;
    &lt;p&gt;&lt;strong&gt;DAG:&lt;/strong&gt; {task_instance.dag_id}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;Task:&lt;/strong&gt; {task_instance.task_id}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;ì‹¤í–‰ ì‹œê°„:&lt;/strong&gt; {task_instance.start_date}&lt;/p&gt;
    &lt;p&gt;&lt;strong&gt;ì—ëŸ¬:&lt;/strong&gt; {context.get(</span><span class="sh">'</span><span class="s">exception</span><span class="sh">'</span><span class="s">, </span><span class="sh">'</span><span class="s">Unknown error</span><span class="sh">'</span><span class="s">)}&lt;/p&gt;
    </span><span class="sh">"""</span><span class="p">,</span>
    <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">one_failed</span><span class="sh">'</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="3-circuit-breaker-íŒ¨í„´">3. Circuit Breaker íŒ¨í„´</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CircuitBreakerOperator</span><span class="p">(</span><span class="n">BaseOperator</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì„œí‚· ë¸Œë ˆì´ì»¤ íŒ¨í„´ êµ¬í˜„</span><span class="sh">"""</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">failure_threshold</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">recovery_timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">expected_exception</span><span class="o">=</span><span class="nb">Exception</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">failure_threshold</span> <span class="o">=</span> <span class="n">failure_threshold</span>
        <span class="n">self</span><span class="p">.</span><span class="n">recovery_timeout</span> <span class="o">=</span> <span class="n">recovery_timeout</span>
        <span class="n">self</span><span class="p">.</span><span class="n">expected_exception</span> <span class="o">=</span> <span class="n">expected_exception</span>
    
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„œí‚· ë¸Œë ˆì´ì»¤ ë¡œì§</span><span class="sh">"""</span>
        <span class="n">circuit_state</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_circuit_state</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">circuit_state</span> <span class="o">==</span> <span class="sh">'</span><span class="s">OPEN</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_should_attempt_reset</span><span class="p">():</span>
                <span class="n">circuit_state</span> <span class="o">=</span> <span class="sh">'</span><span class="s">HALF_OPEN</span><span class="sh">'</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">Circuit breaker is OPEN</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_execute_task</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_record_success</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">except</span> <span class="n">self</span><span class="p">.</span><span class="n">expected_exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">_record_failure</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="k">def</span> <span class="nf">_get_circuit_state</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„œí‚· ìƒíƒœ í™•ì¸</span><span class="sh">"""</span>
        <span class="c1"># ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ìƒíƒœ ì¡°íšŒ
</span>        <span class="c1"># êµ¬í˜„ ìƒëµ
</span>        <span class="k">pass</span>
</code></pre></div></div>

<h2 id="-ëª¨ë‹ˆí„°ë§ê³¼-ì•Œë¦¼-ì‹œìŠ¤í…œ">ğŸ“Š ëª¨ë‹ˆí„°ë§ê³¼ ì•Œë¦¼ ì‹œìŠ¤í…œ</h2>

<h3 id="1-ì»¤ìŠ¤í…€-ë©”íŠ¸ë¦­-ìˆ˜ì§‘">1. ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Prometheus ë©”íŠ¸ë¦­ ìˆ˜ì§‘
</span><span class="kn">from</span> <span class="n">airflow.configuration</span> <span class="kn">import</span> <span class="n">conf</span>
<span class="kn">from</span> <span class="n">airflow.stats</span> <span class="kn">import</span> <span class="n">Stats</span>

<span class="k">def</span> <span class="nf">collect_custom_metrics</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘</span><span class="sh">"""</span>
    <span class="n">task_instance</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># ì‹¤í–‰ ì‹œê°„ ë©”íŠ¸ë¦­
</span>    <span class="n">execution_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">task_instance</span><span class="p">.</span><span class="n">end_date</span> <span class="o">-</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">start_date</span><span class="p">).</span><span class="nf">total_seconds</span><span class="p">()</span>
    <span class="n">Stats</span><span class="p">.</span><span class="nf">gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">task_execution_time</span><span class="sh">'</span><span class="p">,</span> <span class="n">execution_time</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">dag_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">task_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">task_id</span>
    <span class="p">})</span>
    
    <span class="c1"># ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ë©”íŠ¸ë¦­
</span>    <span class="kn">import</span> <span class="n">psutil</span>
    <span class="n">memory_usage</span> <span class="o">=</span> <span class="n">psutil</span><span class="p">.</span><span class="nc">Process</span><span class="p">().</span><span class="nf">memory_info</span><span class="p">().</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># MB
</span>    <span class="n">Stats</span><span class="p">.</span><span class="nf">gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">task_memory_usage</span><span class="sh">'</span><span class="p">,</span> <span class="n">memory_usage</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">dag_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">task_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">task_id</span>
    <span class="p">})</span>
    
    <span class="c1"># ë°ì´í„° ì²˜ë¦¬ëŸ‰ ë©”íŠ¸ë¦­
</span>    <span class="n">processed_records</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">processed_records</span><span class="sh">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Stats</span><span class="p">.</span><span class="nf">gauge</span><span class="p">(</span><span class="sh">'</span><span class="s">processed_records</span><span class="sh">'</span><span class="p">,</span> <span class="n">processed_records</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">dag_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">dag_id</span><span class="p">,</span>
        <span class="sh">'</span><span class="s">task_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">task_instance</span><span class="p">.</span><span class="n">task_id</span>
    <span class="p">})</span>

<span class="c1"># ë©”íŠ¸ë¦­ ìˆ˜ì§‘ Task
</span><span class="n">metrics_task</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
    <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">collect_metrics</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">python_callable</span><span class="o">=</span><span class="n">collect_custom_metrics</span><span class="p">,</span>
    <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">all_done</span><span class="sh">'</span><span class="p">,</span>  <span class="c1"># ì„±ê³µ/ì‹¤íŒ¨ ê´€ê³„ì—†ì´ ì‹¤í–‰
</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="2-ëŒ€ì‹œë³´ë“œ-êµ¬ì¶•">2. ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Grafana ëŒ€ì‹œë³´ë“œìš© ì¿¼ë¦¬
</span><span class="k">def</span> <span class="nf">get_dag_performance_metrics</span><span class="p">():</span>
    <span class="sh">"""</span><span class="s">DAG ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¡°íšŒ</span><span class="sh">"""</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
    SELECT 
        dag_id,
        COUNT(*) as total_runs,
        AVG(EXTRACT(EPOCH FROM (end_date - start_date))) as avg_duration,
        COUNT(CASE WHEN state = </span><span class="sh">'</span><span class="s">success</span><span class="sh">'</span><span class="s"> THEN 1 END) as success_count,
        COUNT(CASE WHEN state = </span><span class="sh">'</span><span class="s">failed</span><span class="sh">'</span><span class="s"> THEN 1 END) as failed_count
    FROM dag_run 
    WHERE start_date &gt;= NOW() - INTERVAL </span><span class="sh">'</span><span class="s">7 days</span><span class="sh">'</span><span class="s">
    GROUP BY dag_id
    ORDER BY avg_duration DESC
    </span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">query</span>

<span class="c1"># Airflow UI ì»¤ìŠ¤í…€ ë·°
</span><span class="kn">from</span> <span class="n">airflow.plugins_manager</span> <span class="kn">import</span> <span class="n">AirflowPlugin</span>
<span class="kn">from</span> <span class="n">flask</span> <span class="kn">import</span> <span class="n">Blueprint</span><span class="p">,</span> <span class="n">render_template</span>

<span class="k">class</span> <span class="nc">CustomViewPlugin</span><span class="p">(</span><span class="n">AirflowPlugin</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">custom_view_plugin</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">appbuilder_views</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Custom Dashboard</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Custom</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">:</span> <span class="nc">CustomDashboardView</span><span class="p">(),</span>
            <span class="p">}</span>
        <span class="p">]</span>

<span class="k">class</span> <span class="nc">CustomDashboardView</span><span class="p">:</span>
    <span class="nd">@expose</span><span class="p">(</span><span class="sh">"</span><span class="s">/custom-dashboard</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">custom_dashboard</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì»¤ìŠ¤í…€ ëŒ€ì‹œë³´ë“œ</span><span class="sh">"""</span>
        <span class="c1"># ë©”íŠ¸ë¦­ ë°ì´í„° ì¡°íšŒ
</span>        <span class="n">metrics</span> <span class="o">=</span> <span class="nf">get_dag_performance_metrics</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">render_template</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">custom_dashboard.html</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span>
        <span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ì‹¤ì‹œê°„-ëª¨ë‹ˆí„°ë§">3. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ
</span><span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">BaseOperator</span>
<span class="kn">from</span> <span class="n">airflow.utils.decorators</span> <span class="kn">import</span> <span class="n">apply_defaults</span>

<span class="k">class</span> <span class="nc">RealTimeMonitorOperator</span><span class="p">(</span><span class="n">BaseOperator</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì—°ì‚°ì</span><span class="sh">"""</span>
    
    <span class="nd">@apply_defaults</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="n">self</span><span class="p">,</span>
        <span class="n">monitoring_interval</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">alert_thresholds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">monitoring_interval</span> <span class="o">=</span> <span class="n">monitoring_interval</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_thresholds</span> <span class="o">=</span> <span class="n">alert_thresholds</span> <span class="ow">or</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹¤í–‰</span><span class="sh">"""</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
</span>                <span class="n">system_health</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_system_health</span><span class="p">()</span>
                
                <span class="c1"># ì„ê³„ê°’ í™•ì¸
</span>                <span class="n">alerts</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_check_thresholds</span><span class="p">(</span><span class="n">system_health</span><span class="p">)</span>
                
                <span class="c1"># ì•Œë¦¼ ë°œì†¡
</span>                <span class="k">for</span> <span class="n">alert</span> <span class="ow">in</span> <span class="n">alerts</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">_send_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
                
                <span class="c1"># ëŒ€ê¸°
</span>                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">monitoring_interval</span><span class="p">)</span>
                
            <span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">log</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ëª¨ë‹ˆí„°ë§ ì˜¤ë¥˜: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">monitoring_interval</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_check_system_health</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">cpu_usage</span><span class="sh">'</span><span class="p">:</span> <span class="n">psutil</span><span class="p">.</span><span class="nf">cpu_percent</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">:</span> <span class="n">psutil</span><span class="p">.</span><span class="nf">virtual_memory</span><span class="p">().</span><span class="n">percent</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">disk_usage</span><span class="sh">'</span><span class="p">:</span> <span class="n">psutil</span><span class="p">.</span><span class="nf">disk_usage</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">).</span><span class="n">percent</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">active_dags</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_count_active_dags</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">failed_tasks</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_count_failed_tasks</span><span class="p">(),</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_check_thresholds</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">health_data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„ê³„ê°’ í™•ì¸</span><span class="sh">"""</span>
        <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">health_data</span><span class="p">[</span><span class="sh">'</span><span class="s">cpu_usage</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">alert_thresholds</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">cpu</span><span class="sh">'</span><span class="p">,</span> <span class="mi">80</span><span class="p">):</span>
            <span class="n">alerts</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">cpu_high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">CPU ì‚¬ìš©ë¥ ì´ ë†’ìŠµë‹ˆë‹¤: </span><span class="si">{</span><span class="n">health_data</span><span class="p">[</span><span class="sh">'</span><span class="s">cpu_usage</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">health_data</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">alert_thresholds</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">memory</span><span class="sh">'</span><span class="p">,</span> <span class="mi">85</span><span class="p">):</span>
            <span class="n">alerts</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">'</span><span class="s">type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">memory_high</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ìŠµë‹ˆë‹¤: </span><span class="si">{</span><span class="n">health_data</span><span class="p">[</span><span class="sh">'</span><span class="s">memory_usage</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">%</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">alerts</span>
</code></pre></div></div>

<h2 id="ï¸-ì‹¤ìŠµ-ì‹¤ë¬´ê¸‰-ë°ì´í„°-íŒŒì´í”„ë¼ì¸-êµ¬ì¶•">ğŸ› ï¸ ì‹¤ìŠµ: ì‹¤ë¬´ê¸‰ ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•</h2>

<h3 id="1-í™˜ê²½-ì„¤ì •">1. í™˜ê²½ ì„¤ì •</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Airflow ì„¤ì¹˜ ë° ì„¤ì •</span>
pip <span class="nb">install </span>apache-airflow[postgres,celery,redis,slack]
pip <span class="nb">install </span>apache-airflow-providers-postgres
pip <span class="nb">install </span>apache-airflow-providers-slack
pip <span class="nb">install </span>apache-airflow-providers-http

<span class="c"># ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</span>
<span class="nb">export </span><span class="nv">AIRFLOW__CORE__SQL_ALCHEMY_CONN</span><span class="o">=</span><span class="s2">"postgresql://airflow:airflow@localhost/airflow"</span>
<span class="nb">export </span><span class="nv">AIRFLOW__CORE__EXECUTOR</span><span class="o">=</span><span class="s2">"CeleryExecutor"</span>
<span class="nb">export </span><span class="nv">AIRFLOW__CELERY__BROKER_URL</span><span class="o">=</span><span class="s2">"redis://localhost:6379/0"</span>
<span class="nb">export </span><span class="nv">AIRFLOW__CELERY__RESULT_BACKEND</span><span class="o">=</span><span class="s2">"redis://localhost:6379/0"</span>

<span class="c"># Airflow ì´ˆê¸°í™”</span>
airflow db init
airflow <span class="nb">users </span>create <span class="se">\</span>
    <span class="nt">--username</span> admin <span class="se">\</span>
    <span class="nt">--firstname</span> Admin <span class="se">\</span>
    <span class="nt">--lastname</span> User <span class="se">\</span>
    <span class="nt">--role</span> Admin <span class="se">\</span>
    <span class="nt">--email</span> admin@example.com
</code></pre></div></div>

<h3 id="2-ì‹¤ë¬´ê¸‰-etl-íŒŒì´í”„ë¼ì¸">2. ì‹¤ë¬´ê¸‰ ETL íŒŒì´í”„ë¼ì¸</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># dags/advanced_etl_pipeline.py
</span><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="n">airflow</span> <span class="kn">import</span> <span class="n">DAG</span>
<span class="kn">from</span> <span class="n">airflow.operators.python</span> <span class="kn">import</span> <span class="n">PythonOperator</span>
<span class="kn">from</span> <span class="n">airflow.operators.bash</span> <span class="kn">import</span> <span class="n">BashOperator</span>
<span class="kn">from</span> <span class="n">airflow.sensors.filesystem</span> <span class="kn">import</span> <span class="n">FileSensor</span>
<span class="kn">from</span> <span class="n">airflow.utils.task_group</span> <span class="kn">import</span> <span class="n">TaskGroup</span>
<span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">from</span> <span class="n">airflow.hooks.postgres_hook</span> <span class="kn">import</span> <span class="n">PostgresHook</span>
<span class="kn">from</span> <span class="n">airflow.providers.slack.operators.slack_webhook</span> <span class="kn">import</span> <span class="n">SlackWebhookOperator</span>

<span class="c1"># ì„¤ì •ê°’ ë¡œë“œ
</span><span class="n">BATCH_SIZE</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">Variable</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">batch_size</span><span class="sh">"</span><span class="p">,</span> <span class="n">default_var</span><span class="o">=</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">Variable</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">max_retries</span><span class="sh">"</span><span class="p">,</span> <span class="n">default_var</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

<span class="n">default_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">owner</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">data-engineering-team</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">depends_on_past</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">start_date</span><span class="sh">'</span><span class="p">:</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">email_on_failure</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">email_on_retry</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">retries</span><span class="sh">'</span><span class="p">:</span> <span class="n">MAX_RETRIES</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">retry_delay</span><span class="sh">'</span><span class="p">:</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">retry_exponential_backoff</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">max_retry_delay</span><span class="sh">'</span><span class="p">:</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">catchup</span><span class="sh">'</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">max_active_runs</span><span class="sh">'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">dag</span> <span class="o">=</span> <span class="nc">DAG</span><span class="p">(</span>
    <span class="sh">'</span><span class="s">advanced_etl_pipeline</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">default_args</span><span class="o">=</span><span class="n">default_args</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="sh">'</span><span class="s">ê³ ê¸‰ ETL íŒŒì´í”„ë¼ì¸ - ë°ì´í„° ì¶”ì¶œ, ë³€í™˜, ë¡œë“œ</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">schedule_interval</span><span class="o">=</span><span class="sh">'</span><span class="s">0 2 * * *</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">max_active_runs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">etl</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">data-engineering</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">production</span><span class="sh">'</span><span class="p">],</span>
    <span class="n">doc_md</span><span class="o">=</span><span class="n">__doc__</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># ë°ì´í„° ì¶”ì¶œ ê·¸ë£¹
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">data_extraction</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ë°ì´í„° ì¶”ì¶œ</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">extraction_group</span><span class="p">:</span>
    
    <span class="c1"># ì†ŒìŠ¤ íŒŒì¼ í™•ì¸
</span>    <span class="n">check_source_files</span> <span class="o">=</span> <span class="nc">FileSensor</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">check_source_files</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">filepath</span><span class="o">=</span><span class="p">[</span>
            <span class="sh">'</span><span class="s">/data/input/sales_data.csv</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">/data/input/customer_data.csv</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">/data/input/product_data.csv</span><span class="sh">'</span>
        <span class="p">],</span>
        <span class="n">poke_interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">mode</span><span class="o">=</span><span class="sh">'</span><span class="s">reschedule</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° í’ˆì§ˆ ê²€ì¦
</span>    <span class="n">validate_data_quality</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">validate_data_quality</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">validate_data_quality</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="sh">'</span><span class="s">source_files</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                <span class="sh">'</span><span class="s">/data/input/sales_data.csv</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">/data/input/customer_data.csv</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">/data/input/product_data.csv</span><span class="sh">'</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_validation_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ì¶”ì¶œ
</span>    <span class="n">extract_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">extract_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">extract_data_from_sources</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">batch_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">BATCH_SIZE</span><span class="p">},</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_extraction_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ë°ì´í„° ë³€í™˜ ê·¸ë£¹
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">data_transformation</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ë°ì´í„° ë³€í™˜</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">transformation_group</span><span class="p">:</span>
    
    <span class="c1"># ë°ì´í„° ì •ì œ
</span>    <span class="n">clean_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">clean_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">clean_and_validate_data</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">batch_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">BATCH_SIZE</span><span class="p">},</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_processing_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ë³€í™˜
</span>    <span class="n">transform_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">transform_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">transform_business_logic</span><span class="p">,</span>
        <span class="n">op_kwargs</span><span class="o">=</span><span class="p">{</span><span class="sh">'</span><span class="s">batch_size</span><span class="sh">'</span><span class="p">:</span> <span class="n">BATCH_SIZE</span><span class="p">},</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_processing_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ì§‘ê³„
</span>    <span class="n">aggregate_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">aggregate_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">create_aggregated_metrics</span><span class="p">,</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_processing_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ë°ì´í„° ë¡œë“œ ê·¸ë£¹
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">data_loading</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ë°ì´í„° ë¡œë“œ</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">loading_group</span><span class="p">:</span>
    
    <span class="c1"># ìŠ¤í…Œì´ì§• í…Œì´ë¸” ë¡œë“œ
</span>    <span class="n">load_to_staging</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">load_to_staging</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">load_to_staging_tables</span><span class="p">,</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_loading_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ ë¡œë“œ
</span>    <span class="n">load_to_warehouse</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">load_to_warehouse</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">load_to_data_warehouse</span><span class="p">,</span>
        <span class="n">pool</span><span class="o">=</span><span class="sh">'</span><span class="s">data_loading_pool</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„° ê²€ì¦
</span>    <span class="n">validate_loaded_data</span> <span class="o">=</span> <span class="nc">PythonOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">validate_loaded_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">python_callable</span><span class="o">=</span><span class="n">validate_loaded_data</span><span class="p">,</span>
        <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">all_success</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ì•Œë¦¼ ë° ëª¨ë‹ˆí„°ë§
</span><span class="k">with</span> <span class="nc">TaskGroup</span><span class="p">(</span><span class="sh">"</span><span class="s">monitoring</span><span class="sh">"</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="sh">"</span><span class="s">ëª¨ë‹ˆí„°ë§</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">monitoring_group</span><span class="p">:</span>
    
    <span class="c1"># ì„±ê³µ ì•Œë¦¼
</span>    <span class="n">success_notification</span> <span class="o">=</span> <span class="nc">SlackWebhookOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">success_notification</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">http_conn_id</span><span class="o">=</span><span class="sh">'</span><span class="s">slack_webhook</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="sh">"""</span><span class="s">
        âœ… ETL íŒŒì´í”„ë¼ì¸ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œ
        
        ì‹¤í–‰ ì‹œê°„: 
        ì²˜ë¦¬ëœ ë ˆì½”ë“œ ìˆ˜: {ti.xcom_pull(task_ids=</span><span class="sh">'</span><span class="s">extract_data</span><span class="sh">'</span><span class="s">)}
        </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">all_success</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>
    
    <span class="c1"># ì‹¤íŒ¨ ì•Œë¦¼
</span>    <span class="n">failure_notification</span> <span class="o">=</span> <span class="nc">SlackWebhookOperator</span><span class="p">(</span>
        <span class="n">task_id</span><span class="o">=</span><span class="sh">'</span><span class="s">failure_notification</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">http_conn_id</span><span class="o">=</span><span class="sh">'</span><span class="s">slack_webhook</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">message</span><span class="o">=</span><span class="sh">"""</span><span class="s">
        âŒ ETL íŒŒì´í”„ë¼ì¸ ì‹¤íŒ¨
        
        ì‹¤í–‰ ì‹œê°„: 
        ì‹¤íŒ¨í•œ Task: 
        ì—ëŸ¬ ë¡œê·¸: 
        </span><span class="sh">"""</span><span class="p">,</span>
        <span class="n">trigger_rule</span><span class="o">=</span><span class="sh">'</span><span class="s">one_failed</span><span class="sh">'</span><span class="p">,</span>
    <span class="p">)</span>

<span class="c1"># ì˜ì¡´ì„± ì„¤ì •
</span><span class="n">extraction_group</span> <span class="o">&gt;&gt;</span> <span class="n">transformation_group</span> <span class="o">&gt;&gt;</span> <span class="n">loading_group</span>
<span class="p">[</span><span class="n">loading_group</span><span class="p">,</span> <span class="n">monitoring_group</span><span class="p">]</span>

<span class="c1"># DAG ë¬¸ì„œí™”
</span><span class="n">dag</span><span class="p">.</span><span class="n">doc_md</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
# ê³ ê¸‰ ETL íŒŒì´í”„ë¼ì¸

ì´ DAGëŠ” ì‹¤ë¬´ê¸‰ ë°ì´í„° íŒŒì´í”„ë¼ì¸ì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ì£¼ìš” ê¸°ëŠ¥
- ë°ì´í„° í’ˆì§ˆ ê²€ì¦
- ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì¬ì‹œë„
- ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- ì•Œë¦¼ ì‹œìŠ¤í…œ

## ì‹¤í–‰ ì£¼ê¸°
ë§¤ì¼ ì˜¤ì „ 2ì‹œ ì‹¤í–‰

## ëª¨ë‹ˆí„°ë§
- Slack ì•Œë¦¼
- ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
- ì—ëŸ¬ ì¶”ì 
</span><span class="sh">"""</span>
</code></pre></div></div>

<h3 id="3-í•µì‹¬-í•¨ìˆ˜-êµ¬í˜„">3. í•µì‹¬ í•¨ìˆ˜ êµ¬í˜„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># plugins/etl_functions.py
</span><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span> <span class="n">airflow.hooks.postgres_hook</span> <span class="kn">import</span> <span class="n">PostgresHook</span>
<span class="kn">from</span> <span class="n">airflow.models</span> <span class="kn">import</span> <span class="n">Variable</span>
<span class="kn">import</span> <span class="n">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="p">.</span><span class="nf">getLogger</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">validate_data_quality</span><span class="p">(</span><span class="n">source_files</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° í’ˆì§ˆ ê²€ì¦</span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° í’ˆì§ˆ ê²€ì¦ ì‹œì‘</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">validation_results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">source_files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># íŒŒì¼ ì¡´ì¬ í™•ì¸
</span>            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                <span class="k">raise</span> <span class="nc">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="c1"># ë°ì´í„° ë¡œë“œ
</span>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            
            <span class="c1"># ê¸°ë³¸ ê²€ì¦
</span>            <span class="n">validation_result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">'</span><span class="s">file_path</span><span class="sh">'</span><span class="p">:</span> <span class="n">file_path</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">row_count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">column_count</span><span class="sh">'</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">),</span>
                <span class="sh">'</span><span class="s">null_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">df</span><span class="p">.</span><span class="nf">isnull</span><span class="p">().</span><span class="nf">sum</span><span class="p">().</span><span class="nf">sum</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">duplicate_count</span><span class="sh">'</span><span class="p">:</span> <span class="n">df</span><span class="p">.</span><span class="nf">duplicated</span><span class="p">().</span><span class="nf">sum</span><span class="p">(),</span>
                <span class="sh">'</span><span class="s">file_size_mb</span><span class="sh">'</span><span class="p">:</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">),</span>
            <span class="p">}</span>
            
            <span class="c1"># ë°ì´í„° íƒ€ì… ê²€ì¦
</span>            <span class="n">validation_result</span><span class="p">[</span><span class="sh">'</span><span class="s">data_types</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">dtypes</span><span class="p">.</span><span class="nf">to_dict</span><span class="p">()</span>
            
            <span class="c1"># ì´ìƒì¹˜ ê²€ì¦ (IQR ë°©ë²•)
</span>            <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">number</span><span class="p">]).</span><span class="n">columns</span>
            <span class="n">outliers</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_columns</span><span class="p">:</span>
                <span class="n">Q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
                <span class="n">Q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
                <span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>
                <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
                <span class="n">outliers</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lower_bound</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">upper_bound</span><span class="p">)])</span>
            
            <span class="n">validation_result</span><span class="p">[</span><span class="sh">'</span><span class="s">outliers</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">outliers</span>
            
            <span class="n">validation_results</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">validation_result</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê²€ì¦ ì™„ë£Œ: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s">í–‰</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ê²€ì¦ ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="c1"># ê²€ì¦ ê²°ê³¼ë¥¼ XComì— ì €ì¥
</span>    <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">validation_results</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">validation_results</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">validation_results</span>

<span class="k">def</span> <span class="nf">extract_data_from_sources</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ì†ŒìŠ¤ì—ì„œ ë°ì´í„° ì¶”ì¶œ</span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° ì¶”ì¶œ ì‹œì‘</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ê²€ì¦ ê²°ê³¼ ë¡œë“œ
</span>    <span class="n">validation_results</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">validate_data_quality</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">validation_results</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_records</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">validation</span> <span class="ow">in</span> <span class="n">validation_results</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ë°°ì¹˜ ë‹¨ìœ„ë¡œ ë°ì´í„° ë¡œë“œ
</span>            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            
            <span class="c1"># ë°ì´í„° ì „ì²˜ë¦¬
</span>            <span class="n">df</span> <span class="o">=</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
            <span class="n">extracted_data</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
            <span class="n">total_records</span> <span class="o">+=</span> <span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì¶”ì¶œ ì™„ë£Œ: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s">í–‰</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì¶”ì¶œ ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="c1"># ì¶”ì¶œ ê²°ê³¼ë¥¼ XComì— ì €ì¥
</span>    <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">extracted_data</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">extracted_data</span><span class="p">)</span>
    <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">total_records</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">total_records</span><span class="p">)</span>
    
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë°ì´í„° ì¶”ì¶œ ì™„ë£Œ - ì´ </span><span class="si">{</span><span class="n">total_records</span><span class="si">}</span><span class="s">ê°œ ë ˆì½”ë“œ</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">total_records</span>

<span class="k">def</span> <span class="nf">clean_and_validate_data</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ì •ì œ ë° ê²€ì¦</span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° ì •ì œ ì‹œì‘</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ì¶”ì¶œëœ ë°ì´í„° ë¡œë“œ
</span>    <span class="n">extracted_data</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">extract_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">extracted_data</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="n">cleaned_data</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">extracted_data</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># ê²°ì¸¡ê°’ ì²˜ë¦¬
</span>            <span class="n">df_cleaned</span> <span class="o">=</span> <span class="nf">handle_missing_values</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            
            <span class="c1"># ì¤‘ë³µ ì œê±°
</span>            <span class="n">df_cleaned</span> <span class="o">=</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">)</span>
            
            <span class="c1"># ì´ìƒì¹˜ ì²˜ë¦¬
</span>            <span class="n">df_cleaned</span> <span class="o">=</span> <span class="nf">handle_outliers</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">)</span>
            
            <span class="c1"># ë°ì´í„° íƒ€ì… ë³€í™˜
</span>            <span class="n">df_cleaned</span> <span class="o">=</span> <span class="nf">convert_data_types</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">)</span>
            
            <span class="n">cleaned_data</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_cleaned</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì •ì œ ì™„ë£Œ: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df_cleaned</span><span class="p">)</span><span class="si">}</span><span class="s">í–‰</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ì •ì œ ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="c1"># ì •ì œ ê²°ê³¼ë¥¼ XComì— ì €ì¥
</span>    <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">cleaned_data</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">cleaned_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">cleaned_data</span>

<span class="k">def</span> <span class="nf">transform_business_logic</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©í•œ ë°ì´í„° ë³€í™˜</span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° ë³€í™˜ ì‹œì‘</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ì •ì œëœ ë°ì´í„° ë¡œë“œ
</span>    <span class="n">cleaned_data</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">clean_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">cleaned_data</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="n">transformed_data</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">cleaned_data</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># íŒŒì¼ë³„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©
</span>            <span class="k">if</span> <span class="sh">'</span><span class="s">sales_data</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">df_transformed</span> <span class="o">=</span> <span class="nf">transform_sales_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="sh">'</span><span class="s">customer_data</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">df_transformed</span> <span class="o">=</span> <span class="nf">transform_customer_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">elif</span> <span class="sh">'</span><span class="s">product_data</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">file_path</span><span class="p">:</span>
                <span class="n">df_transformed</span> <span class="o">=</span> <span class="nf">transform_product_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_transformed</span> <span class="o">=</span> <span class="n">df</span>
            
            <span class="n">transformed_data</span><span class="p">[</span><span class="n">file_path</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_transformed</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë³€í™˜ ì™„ë£Œ: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df_transformed</span><span class="p">)</span><span class="si">}</span><span class="s">í–‰</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë³€í™˜ ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="c1"># ë³€í™˜ ê²°ê³¼ë¥¼ XComì— ì €ì¥
</span>    <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_push</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">transformed_data</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">transformed_data</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">transformed_data</span>

<span class="k">def</span> <span class="nf">load_to_data_warehouse</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ì— ë¡œë“œ</span><span class="sh">"""</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ ë¡œë“œ ì‹œì‘</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ë³€í™˜ëœ ë°ì´í„° ë¡œë“œ
</span>    <span class="n">transformed_data</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="sh">'</span><span class="s">task_instance</span><span class="sh">'</span><span class="p">].</span><span class="nf">xcom_pull</span><span class="p">(</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="sh">'</span><span class="s">transform_data</span><span class="sh">'</span><span class="p">,</span>
        <span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">transformed_data</span><span class="sh">'</span>
    <span class="p">)</span>
    
    <span class="c1"># ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
</span>    <span class="n">postgres_hook</span> <span class="o">=</span> <span class="nc">PostgresHook</span><span class="p">(</span><span class="n">postgres_conn_id</span><span class="o">=</span><span class="sh">'</span><span class="s">data_warehouse_conn</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">transformed_data</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># í…Œì´ë¸”ëª… ê²°ì •
</span>            <span class="n">table_name</span> <span class="o">=</span> <span class="nf">determine_table_name</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            
            <span class="c1"># ë°ì´í„° ë¡œë“œ
</span>            <span class="n">postgres_hook</span><span class="p">.</span><span class="nf">insert_rows</span><span class="p">(</span>
                <span class="n">table</span><span class="o">=</span><span class="n">table_name</span><span class="p">,</span>
                <span class="n">rows</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="nf">tolist</span><span class="p">(),</span>
                <span class="n">target_fields</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">tolist</span><span class="p">(),</span>
                <span class="n">replace</span><span class="o">=</span><span class="bp">True</span>
            <span class="p">)</span>
            
            <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë¡œë“œ ì™„ë£Œ: </span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s">í–‰</span><span class="sh">"</span><span class="p">)</span>
            
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ë¡œë“œ ì‹¤íŒ¨: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="nf">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>
    
    <span class="n">logger</span><span class="p">.</span><span class="nf">info</span><span class="p">(</span><span class="sh">"</span><span class="s">ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ ë¡œë“œ ì™„ë£Œ</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
</span><span class="k">def</span> <span class="nf">preprocess_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° ì „ì²˜ë¦¬</span><span class="sh">"""</span>
    <span class="c1"># ì»¬ëŸ¼ëª… ì •ê·œí™”
</span>    <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">lower</span><span class="p">().</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s"> </span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">_</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># ë‚ ì§œ ì»¬ëŸ¼ ì²˜ë¦¬
</span>    <span class="n">date_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]).</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">date_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">date</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">col</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">col</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">coerce</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">handle_missing_values</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ê²°ì¸¡ê°’ ì²˜ë¦¬</span><span class="sh">"""</span>
    <span class="c1"># ìˆ«ìí˜• ì»¬ëŸ¼: í‰ê· ê°’ìœ¼ë¡œ ëŒ€ì²´
</span>    <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">number</span><span class="p">]).</span><span class="n">columns</span>
    <span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">].</span><span class="nf">mean</span><span class="p">())</span>
    
    <span class="c1"># ë²”ì£¼í˜• ì»¬ëŸ¼: ìµœë¹ˆê°’ìœ¼ë¡œ ëŒ€ì²´
</span>    <span class="n">categorical_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]).</span><span class="n">columns</span>
    <span class="n">df</span><span class="p">[</span><span class="n">categorical_columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">categorical_columns</span><span class="p">].</span><span class="nf">fillna</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">categorical_columns</span><span class="p">].</span><span class="nf">mode</span><span class="p">().</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì¤‘ë³µ ì œê±°</span><span class="sh">"""</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">handle_outliers</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ì´ìƒì¹˜ ì²˜ë¦¬ (IQR ë°©ë²•)</span><span class="sh">"""</span>
    <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">number</span><span class="p">]).</span><span class="n">columns</span>
    
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_columns</span><span class="p">:</span>
        <span class="n">Q1</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">Q3</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">IQR</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">-</span> <span class="n">Q1</span>
        <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">Q1</span> <span class="o">-</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">Q3</span> <span class="o">+</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="n">IQR</span>
        
        <span class="c1"># ì´ìƒì¹˜ë¥¼ ê²½ê³„ê°’ìœ¼ë¡œ ëŒ€ì²´
</span>        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nf">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="n">lower_bound</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="n">upper_bound</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">convert_data_types</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë°ì´í„° íƒ€ì… ë³€í™˜</span><span class="sh">"""</span>
    <span class="c1"># ë‚ ì§œ ì»¬ëŸ¼ ì²˜ë¦¬
</span>    <span class="n">date_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]).</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">date_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="sh">'</span><span class="s">date</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">col</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="sh">'</span><span class="s">time</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">col</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">coerce</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="c1"># ìˆ«ìí˜• ì»¬ëŸ¼ ì²˜ë¦¬
</span>    <span class="n">numeric_columns</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">]).</span><span class="n">columns</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">numeric_columns</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="n">dtype</span> <span class="o">==</span> <span class="sh">'</span><span class="s">object</span><span class="sh">'</span><span class="p">:</span>
            <span class="c1"># ìˆ«ìë¡œ ë³€í™˜ ê°€ëŠ¥í•œì§€ í™•ì¸
</span>            <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">-</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nb">str</span><span class="p">.</span><span class="nf">isnumeric</span><span class="p">().</span><span class="nf">all</span><span class="p">():</span>
                <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">coerce</span><span class="sh">'</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">determine_table_name</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">íŒŒì¼ ê²½ë¡œì—ì„œ í…Œì´ë¸”ëª… ê²°ì •</span><span class="sh">"""</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
    <span class="n">table_name</span> <span class="o">=</span> <span class="n">filename</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">.csv</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">_data</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">staging_</span><span class="si">{</span><span class="n">table_name</span><span class="si">}</span><span class="sh">"</span>

<span class="c1"># ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€í™˜ í•¨ìˆ˜ë“¤
</span><span class="k">def</span> <span class="nf">transform_sales_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ë§¤ì¶œ ë°ì´í„° ë³€í™˜</span><span class="sh">"""</span>
    <span class="c1"># ë§¤ì¶œ ê¸ˆì•¡ ê³„ì‚°
</span>    <span class="k">if</span> <span class="sh">'</span><span class="s">quantity</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">unit_price</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">total_amount</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">quantity</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">unit_price</span><span class="sh">'</span><span class="p">]</span>
    
    <span class="c1"># í• ì¸ìœ¨ ì ìš©
</span>    <span class="k">if</span> <span class="sh">'</span><span class="s">discount_rate</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">final_amount</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">total_amount</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">discount_rate</span><span class="sh">'</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">transform_customer_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ê³ ê° ë°ì´í„° ë³€í™˜</span><span class="sh">"""</span>
    <span class="c1"># ê³ ê° ë“±ê¸‰ ê³„ì‚°
</span>    <span class="k">if</span> <span class="sh">'</span><span class="s">total_purchase</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">customer_grade</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">cut</span><span class="p">(</span>
            <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">total_purchase</span><span class="sh">'</span><span class="p">],</span>
            <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)],</span>
            <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Bronze</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Silver</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Gold</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Platinum</span><span class="sh">'</span><span class="p">]</span>
        <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">transform_product_data</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">ìƒí’ˆ ë°ì´í„° ë³€í™˜</span><span class="sh">"""</span>
    <span class="c1"># ì¹´í…Œê³ ë¦¬ ì •ê·œí™”
</span>    <span class="k">if</span> <span class="sh">'</span><span class="s">category</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">upper</span><span class="p">().</span><span class="nb">str</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></div>

<h2 id="-í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="ì´ë²ˆ-í¬ìŠ¤íŠ¸ì—ì„œ-í•™ìŠµí•œ-ë‚´ìš©">ì´ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œ í•™ìŠµí•œ ë‚´ìš©</h3>

<ol>
  <li><strong>Airflow ì•„í‚¤í…ì²˜ ì‹¬í™” ì´í•´</strong>
    <ul>
      <li>í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ë¶„ì„</li>
      <li>ë©”íƒ€ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ</li>
      <li>Executor ì¢…ë¥˜ì™€ íŠ¹ì§•</li>
    </ul>
  </li>
  <li><strong>DAG ìµœì í™” ì „ëµ</strong>
    <ul>
      <li>íš¨ìœ¨ì ì¸ Task ì •ì˜</li>
      <li>ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ìµœì í™”</li>
      <li>ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ìµœì í™”</li>
    </ul>
  </li>
  <li><strong>ê³ ê¸‰ ìŠ¤ì¼€ì¤„ë§ê³¼ íŠ¸ë¦¬ê±°</strong>
    <ul>
      <li>ë™ì  ìŠ¤ì¼€ì¤„ë§</li>
      <li>ì™¸ë¶€ íŠ¸ë¦¬ê±° í™œìš©</li>
      <li>ìŠ¤ì¼€ì¤„ ìµœì í™”</li>
    </ul>
  </li>
  <li><strong>ì—ëŸ¬ ì²˜ë¦¬ì™€ ì¬ì‹œë„ ì „ëµ</strong>
    <ul>
      <li>ê³ ê¸‰ ì¬ì‹œë„ ë¡œì§</li>
      <li>ì—ëŸ¬ ì•Œë¦¼ ì‹œìŠ¤í…œ</li>
      <li>Circuit Breaker íŒ¨í„´</li>
    </ul>
  </li>
  <li><strong>ëª¨ë‹ˆí„°ë§ê³¼ ì•Œë¦¼ ì‹œìŠ¤í…œ</strong>
    <ul>
      <li>ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ìˆ˜ì§‘</li>
      <li>ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</li>
      <li>ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§</li>
    </ul>
  </li>
  <li><strong>ì‹¤ë¬´ê¸‰ ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•</strong>
    <ul>
      <li>ì™„ì „í•œ ETL íŒŒì´í”„ë¼ì¸</li>
      <li>ë°ì´í„° í’ˆì§ˆ ê²€ì¦</li>
      <li>ì—ëŸ¬ ì²˜ë¦¬ ë° ì•Œë¦¼</li>
    </ul>
  </li>
</ol>

<h3 id="í•µì‹¬-ê°œë…-ì •ë¦¬">í•µì‹¬ ê°œë… ì •ë¦¬</h3>

<table>
  <thead>
    <tr>
      <th>ê°œë…</th>
      <th>ì„¤ëª…</th>
      <th>ì¤‘ìš”ë„</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>DAG ìµœì í™”</strong></td>
      <td>ì„±ëŠ¥ê³¼ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± í–¥ìƒ</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì—ëŸ¬ ì²˜ë¦¬</strong></td>
      <td>ì•ˆì •ì ì¸ íŒŒì´í”„ë¼ì¸ ìš´ì˜</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ëª¨ë‹ˆí„°ë§</strong></td>
      <td>ì‹¤ì‹œê°„ ìƒíƒœ ì¶”ì </td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ìŠ¤ì¼€ì¤„ë§</strong></td>
      <td>ìœ ì—°í•œ ì‹¤í–‰ ì œì–´</td>
      <td>â­â­â­â­</td>
    </tr>
  </tbody>
</table>

<h3 id="ì‹¤ë¬´-ì ìš©-ì‹œ-ê³ ë ¤ì‚¬í•­">ì‹¤ë¬´ ì ìš© ì‹œ ê³ ë ¤ì‚¬í•­</h3>

<ol>
  <li><strong>ì„±ëŠ¥ ìµœì í™”</strong>: Pool, Queue, ë©”ëª¨ë¦¬ ê´€ë¦¬</li>
  <li><strong>ì•ˆì •ì„±</strong>: ì—ëŸ¬ ì²˜ë¦¬, ì¬ì‹œë„, Circuit Breaker</li>
  <li><strong>ëª¨ë‹ˆí„°ë§</strong>: ë©”íŠ¸ë¦­ ìˆ˜ì§‘, ì•Œë¦¼, ëŒ€ì‹œë³´ë“œ</li>
  <li><strong>í™•ì¥ì„±</strong>: ë¶„ì‚° í™˜ê²½, ë¦¬ì†ŒìŠ¤ ê´€ë¦¬</li>
</ol>

<hr />

<p><em>ì´ ê°€ì´ë“œë¥¼ í†µí•´ Apache Airflowì˜ ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ ë§ˆìŠ¤í„°í•˜ê³ , ì‹¤ë¬´ì—ì„œ ì•ˆì •ì ì´ê³  íš¨ìœ¨ì ì¸ ë°ì´í„° íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!</em> ğŸš€</p>

  </div>

  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
