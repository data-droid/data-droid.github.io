<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Apache Flinkì˜ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬, ì²´í¬í¬ì¸íŒ…, ì„¸ì´ë¸Œí¬ì¸íŠ¸, ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµì„ í•™ìŠµí•˜ê³  ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ íŒ¨í„´ë“¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.">



<title>Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ">
<meta property="og:description" content="Apache Flinkì˜ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬, ì²´í¬í¬ì¸íŒ…, ì„¸ì´ë¸Œí¬ì¸íŠ¸, ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµì„ í•™ìŠµí•˜ê³  ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ íŒ¨í„´ë“¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.">
<meta property="og:url" content="http://localhost:4000/data-engineering/2025/09/16/apache-flink-advanced-streaming.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ">
<meta name="twitter:description" content="Apache Flinkì˜ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬, ì²´í¬í¬ì¸íŒ…, ì„¸ì´ë¸Œí¬ì¸íŠ¸, ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµì„ í•™ìŠµí•˜ê³  ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ íŒ¨í„´ë“¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/09/16/apache-flink-advanced-streaming.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-09-16-apache-flink-advanced-streaming.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 09ì›” 16ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Flink</span>
      
        <span class="tag">ê³ ê¸‰ìƒíƒœê´€ë¦¬</span>
      
        <span class="tag">ì²´í¬í¬ì¸íŒ…</span>
      
        <span class="tag">ì„¸ì´ë¸Œí¬ì¸íŠ¸</span>
      
        <span class="tag">ì‹œê°„ì²˜ë¦¬</span>
      
        <span class="tag">ìŠ¤íŠ¸ë¦¬ë°ìµœì í™”</span>
      
        <span class="tag">Python</span>
      
        <span class="tag">PyFlink</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Apache flink complete guide ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 3</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 40ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ê³ ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-2-apache-flink-ê³ ê¸‰-ìŠ¤íŠ¸ë¦¬ë°-ì²˜ë¦¬ì™€-ìƒíƒœ-ê´€ë¦¬---í”„ë¡œë•ì…˜ê¸‰-ì‹¤ì‹œê°„-ì‹œìŠ¤í…œ">Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ</h1>

<blockquote>
  <p>Apache Flinkì˜ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬, ì²´í¬í¬ì¸íŒ…, ì„¸ì´ë¸Œí¬ì¸íŠ¸, ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµì„ í•™ìŠµí•˜ê³  ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê³ ê¸‰ íŒ¨í„´ë“¤ì„ êµ¬í˜„í•©ë‹ˆë‹¤.</p>
</blockquote>

<h2 id="ëª©ì°¨">ğŸ“‹ ëª©ì°¨</h2>

<ol>
  <li><a href="#ê³ ê¸‰-ìƒíƒœ-ê´€ë¦¬-íŒ¨í„´">ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´</a></li>
  <li><a href="#ì²´í¬í¬ì¸íŒ…ê³¼-ì„¸ì´ë¸Œí¬ì¸íŠ¸-ì‹¬í™”">ì²´í¬í¬ì¸íŒ…ê³¼ ì„¸ì´ë¸Œí¬ì¸íŠ¸ ì‹¬í™”</a></li>
  <li><a href="#ë³µì¡í•œ-ì‹œê°„-ì²˜ë¦¬-ì „ëµ">ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµ</a></li>
  <li><a href="#ì„±ëŠ¥-ìµœì í™”-ê¸°ë²•">ì„±ëŠ¥ ìµœì í™” ê¸°ë²•</a></li>
  <li><a href="#ì‹¤ë¬´-í”„ë¡œì íŠ¸-ì‹¤ì‹œê°„-ì¶”ì²œ-ì‹œìŠ¤í…œ">ì‹¤ë¬´ í”„ë¡œì íŠ¸: ì‹¤ì‹œê°„ ì¶”ì²œ ì‹œìŠ¤í…œ</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ol>

<h2 id="ï¸-ê³ ê¸‰-ìƒíƒœ-ê´€ë¦¬-íŒ¨í„´">ğŸ—ƒï¸ ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´</h2>

<h3 id="ìƒíƒœ-ë°±ì—”ë“œ-state-backend">ìƒíƒœ ë°±ì—”ë“œ (State Backend)</h3>

<p>FlinkëŠ” ë‹¤ì–‘í•œ ìƒíƒœ ë°±ì—”ë“œë¥¼ ì œê³µí•˜ì—¬ ë‹¤ì–‘í•œ ì„±ëŠ¥ê³¼ ë‚´êµ¬ì„± ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•©ë‹ˆë‹¤.</p>

<h4 id="1-memorystatebackend"><strong>1. MemoryStateBackend</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">MemoryStateBackend</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="nf">get_execution_environment</span><span class="p">()</span>

<span class="c1"># ë©”ëª¨ë¦¬ ìƒíƒœ ë°±ì—”ë“œ ì„¤ì • (ê°œë°œ/í…ŒìŠ¤íŠ¸ìš©)
</span><span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="nc">MemoryStateBackend</span><span class="p">())</span>

<span class="c1"># ì„¤ì • ì˜µì…˜
</span><span class="n">backend</span> <span class="o">=</span> <span class="nc">MemoryStateBackend</span><span class="p">(</span>
    <span class="n">max_state_size</span><span class="o">=</span><span class="mi">5</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 5MB
</span>    <span class="n">asynchronous_snapshots</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="2-fsstatebackend"><strong>2. FsStateBackend</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">FsStateBackend</span>

<span class="c1"># íŒŒì¼ ì‹œìŠ¤í…œ ìƒíƒœ ë°±ì—”ë“œ ì„¤ì •
</span><span class="n">backend</span> <span class="o">=</span> <span class="nc">FsStateBackend</span><span class="p">(</span>
    <span class="n">checkpoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/flink-checkpoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">savepoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/flink-savepoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">asynchronous_snapshots</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="3-rocksdbstatebackend"><strong>3. RocksDBStateBackend</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">RocksDBStateBackend</span>

<span class="c1"># RocksDB ìƒíƒœ ë°±ì—”ë“œ ì„¤ì • (í”„ë¡œë•ì…˜ ê¶Œì¥)
</span><span class="n">backend</span> <span class="o">=</span> <span class="nc">RocksDBStateBackend</span><span class="p">(</span>
    <span class="n">checkpoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/flink-checkpoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">savepoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/flink-savepoints</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">enable_incremental_checkpointing</span><span class="o">=</span><span class="bp">True</span>
<span class="p">)</span>
<span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>

<span class="c1"># RocksDB ìµœì í™” ì„¤ì •
</span><span class="n">backend</span><span class="p">.</span><span class="nf">set_predefined_options</span><span class="p">(</span><span class="n">RocksDBConfigurableOptions</span><span class="p">.</span><span class="n">PREDEFINED_OPTION_DEFAULT</span><span class="p">)</span>
<span class="n">backend</span><span class="p">.</span><span class="nf">set_rocksdb_options</span><span class="p">(</span><span class="n">RocksDBConfigurableOptions</span><span class="p">.</span><span class="n">ROCKSDB_OPTIONS_FILE</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ê³ ê¸‰-ìƒíƒœ-ê´€ë¦¬-íŒ¨í„´">ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´</h3>

<h4 id="1-ìƒíƒœ-ttl-time-to-live"><strong>1. ìƒíƒœ TTL (Time-To-Live)</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.common.state</span> <span class="kn">import</span> <span class="n">StateTtlConfig</span><span class="p">,</span> <span class="n">ValueStateDescriptor</span>
<span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="n">pyflink.common.typeinfo</span> <span class="kn">import</span> <span class="n">Types</span>

<span class="k">class</span> <span class="nc">TTLStateExample</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_session_state</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="c1"># TTL ì„¤ì •
</span>        <span class="n">ttl_config</span> <span class="o">=</span> <span class="n">StateTtlConfig</span><span class="p">.</span><span class="nf">new_builder</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">hours</span><span class="p">(</span><span class="mi">24</span><span class="p">))</span> \
            <span class="p">.</span><span class="nf">set_update_type</span><span class="p">(</span><span class="n">StateTtlConfig</span><span class="p">.</span><span class="n">UpdateType</span><span class="p">.</span><span class="n">OnCreateAndWrite</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">set_state_visibility</span><span class="p">(</span><span class="n">StateTtlConfig</span><span class="p">.</span><span class="n">StateVisibility</span><span class="p">.</span><span class="n">NeverReturnExpired</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">cleanup_full_snapshot</span><span class="p">()</span> \
            <span class="p">.</span><span class="nf">build</span><span class="p">()</span>
        
        <span class="c1"># TTLì´ ì ìš©ëœ ìƒíƒœ ë””ìŠ¤í¬ë¦½í„°
</span>        <span class="n">state_descriptor</span> <span class="o">=</span> <span class="nc">ValueStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">user_session</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="n">state_descriptor</span><span class="p">.</span><span class="nf">enable_time_to_live</span><span class="p">(</span><span class="n">ttl_config</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">user_session_state</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_state</span><span class="p">(</span><span class="n">state_descriptor</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="c1"># ìƒíƒœ ì‚¬ìš©
</span>        <span class="n">current_session</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_session_state</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_session</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># ìƒˆë¡œìš´ ì„¸ì…˜ ìƒì„±
</span>            <span class="n">new_session</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">session_</span><span class="si">{</span><span class="n">ctx</span><span class="p">.</span><span class="nf">timestamp</span><span class="p">()</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">self</span><span class="p">.</span><span class="n">user_session_state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">new_session</span><span class="p">)</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">New session created: </span><span class="si">{</span><span class="n">new_session</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Existing session: </span><span class="si">{</span><span class="n">current_session</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="2-ìƒíƒœ-ìŠ¤ëƒ…ìƒ·ê³¼-ë³µì›"><strong>2. ìƒíƒœ ìŠ¤ëƒ…ìƒ·ê³¼ ë³µì›</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.common.state</span> <span class="kn">import</span> <span class="n">CheckpointedFunction</span><span class="p">,</span> <span class="n">ListState</span>

<span class="k">class</span> <span class="nc">StatefulFunction</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">,</span> <span class="n">CheckpointedFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements_state</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="c1"># ìƒíƒœ ì´ˆê¸°í™”ëŠ” checkpointed_functionì—ì„œ ìˆ˜í–‰
</span>        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">initialize_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì²´í¬í¬ì¸íŠ¸ì—ì„œ ìƒíƒœ ì´ˆê¸°í™”</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements_state</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">get_operator_state</span><span class="p">(</span>
            <span class="nc">ListStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">buffered-elements</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        
        <span class="c1"># ì´ì „ ìƒíƒœ ë³µì›
</span>        <span class="k">if</span> <span class="n">context</span><span class="p">.</span><span class="nf">is_restored</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements_state</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">snapshot_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìƒíƒœ ìŠ¤ëƒ…ìƒ· ìƒì„±</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements_state</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements_state</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="c1"># ë²„í¼ì— ìš”ì†Œ ì¶”ê°€
</span>        <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># ì¡°ê±´ì— ë”°ë¼ ì²˜ë¦¬
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="c1"># ë°°ì¹˜ ì²˜ë¦¬
</span>            <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">process_batch</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">)</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">buffered_elements</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">elements</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Processed batch of </span><span class="si">{</span><span class="nf">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span><span class="si">}</span><span class="s"> elements</span><span class="sh">"</span>
</code></pre></div></div>

<h4 id="3-ìƒíƒœ-ë¶„í• ê³¼-ë³‘í•©"><strong>3. ìƒíƒœ ë¶„í• ê³¼ ë³‘í•©</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PartitionableStateFunction</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">,</span> <span class="n">CheckpointedFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">partitioned_state</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">initialize_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¶„í•  ê°€ëŠ¥í•œ ìƒíƒœ ì´ˆê¸°í™”</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">partitioned_state</span> <span class="o">=</span> <span class="n">context</span><span class="p">.</span><span class="nf">get_union_list_state</span><span class="p">(</span>
            <span class="nc">ListStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">partitioned-data</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        
        <span class="c1"># ìƒíƒœ ë³µì›
</span>        <span class="k">if</span> <span class="n">context</span><span class="p">.</span><span class="nf">is_restored</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">partitioned_state</span><span class="p">.</span><span class="nf">get</span><span class="p">():</span>
                <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
    
    <span class="k">def</span> <span class="nf">snapshot_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìƒíƒœ ìŠ¤ëƒ…ìƒ·</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">partitioned_state</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">.</span><span class="nf">values</span><span class="p">():</span>
            <span class="n">self</span><span class="p">.</span><span class="n">partitioned_state</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="c1"># ë¶„í• ëœ ë°ì´í„° ì²˜ë¦¬
</span>        <span class="n">partition_key</span> <span class="o">=</span> <span class="n">value</span> <span class="o">%</span> <span class="mi">4</span>  <span class="c1"># 4ê°œ íŒŒí‹°ì…˜ìœ¼ë¡œ ë¶„í• 
</span>        
        <span class="k">if</span> <span class="n">partition_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">partition_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">partition_key</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ë³„ ì§‘ê³„
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">partition_key</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">partition_key</span><span class="p">])</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Partition </span><span class="si">{</span><span class="n">partition_key</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">partitioned_data</span><span class="p">[</span><span class="n">partition_key</span><span class="p">].</span><span class="nf">clear</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ì²´í¬í¬ì¸íŒ…ê³¼-ì„¸ì´ë¸Œí¬ì¸íŠ¸-ì‹¬í™”">ğŸ”„ ì²´í¬í¬ì¸íŒ…ê³¼ ì„¸ì´ë¸Œí¬ì¸íŠ¸ ì‹¬í™”</h2>

<h3 id="ê³ ê¸‰-ì²´í¬í¬ì¸íŒ…-ì„¤ì •">ê³ ê¸‰ ì²´í¬í¬ì¸íŒ… ì„¤ì •</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.common.checkpointing</span> <span class="kn">import</span> <span class="n">CheckpointingMode</span><span class="p">,</span> <span class="n">ExternalizedCheckpointCleanup</span>
<span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="k">class</span> <span class="nc">AdvancedCheckpointingSetup</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setup_checkpointing</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">setup_checkpointing</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">checkpoint_config</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_checkpoint_config</span><span class="p">()</span>
        
        <span class="c1"># ê¸°ë³¸ ì²´í¬í¬ì¸íŒ… í™œì„±í™”
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">enable_checkpointing</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># 1ì´ˆë§ˆë‹¤
</span>        
        <span class="c1"># Exactly-once ëª¨ë“œ ì„¤ì •
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_checkpointing_mode</span><span class="p">(</span><span class="n">CheckpointingMode</span><span class="p">.</span><span class="n">EXACTLY_ONCE</span><span class="p">)</span>
        
        <span class="c1"># ì™¸ë¶€í™”ëœ ì²´í¬í¬ì¸íŠ¸ ì„¤ì • (ì‘ì—… ì·¨ì†Œ í›„ì—ë„ ìœ ì§€)
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">enable_externalized_checkpoints</span><span class="p">(</span>
            <span class="n">ExternalizedCheckpointCleanup</span><span class="p">.</span><span class="n">RETAIN_ON_CANCELLATION</span>
        <span class="p">)</span>
        
        <span class="c1"># ìµœëŒ€ ë™ì‹œ ì²´í¬í¬ì¸íŠ¸ ìˆ˜
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_max_concurrent_checkpoints</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># ì²´í¬í¬ì¸íŠ¸ ê°„ ìµœì†Œ ëŒ€ê¸° ì‹œê°„
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_min_pause_between_checkpoints</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        
        <span class="c1"># ì²´í¬í¬ì¸íŠ¸ íƒ€ì„ì•„ì›ƒ
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_checkpoint_timeout</span><span class="p">(</span><span class="mi">60000</span><span class="p">)</span>  <span class="c1"># 60ì´ˆ
</span>        
        <span class="c1"># ì‹¤íŒ¨ í—ˆìš© íšŸìˆ˜
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_tolerable_checkpoint_failure_number</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        
        <span class="c1"># ì§€ì—° ê°€ëŠ¥í•œ ì²´í¬í¬ì¸íŠ¸ ì„¤ì •
</span>        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_unaligned_checkpoints</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">checkpoint_config</span><span class="p">.</span><span class="nf">set_unaligned_checkpoints_enabled</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì„¸ì´ë¸Œí¬ì¸íŠ¸-ê´€ë¦¬">ì„¸ì´ë¸Œí¬ì¸íŠ¸ ê´€ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">class</span> <span class="nc">SavepointManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flink_rest_url</span><span class="o">=</span><span class="sh">"</span><span class="s">http://localhost:8081</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rest_url</span> <span class="o">=</span> <span class="n">flink_rest_url</span>
    
    <span class="k">def</span> <span class="nf">create_savepoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">savepoint_path</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì´ë¸Œí¬ì¸íŠ¸ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">rest_url</span><span class="si">}</span><span class="s">/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s">/savepoints</span><span class="sh">"</span>
        
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">target-directory</span><span class="sh">"</span><span class="p">:</span> <span class="n">savepoint_path</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">cancel-job</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span>
        <span class="p">}</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">202</span><span class="p">:</span>
            <span class="n">trigger_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()[</span><span class="sh">"</span><span class="s">request-id</span><span class="sh">"</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">wait_for_completion</span><span class="p">(</span><span class="n">trigger_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to create savepoint: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">wait_for_completion</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">trigger_id</span><span class="p">,</span> <span class="n">max_wait_time</span><span class="o">=</span><span class="mi">300</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì´ë¸Œí¬ì¸íŠ¸ ì™„ë£Œ ëŒ€ê¸°</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">time</span>
        
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">max_wait_time</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">rest_url</span><span class="si">}</span><span class="s">/jobs/savepoints/</span><span class="si">{</span><span class="n">trigger_id</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">COMPLETED</span><span class="sh">"</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">operation</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">location</span><span class="sh">"</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">FAILED</span><span class="sh">"</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Savepoint failed: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sh">"</span><span class="s">Savepoint creation timeout</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">restore_from_savepoint</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">savepoint_path</span><span class="p">,</span> <span class="n">jar_path</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì´ë¸Œí¬ì¸íŠ¸ì—ì„œ ë³µì›</span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">rest_url</span><span class="si">}</span><span class="s">/jars/upload</span><span class="sh">"</span>
        
        <span class="c1"># JAR íŒŒì¼ ì—…ë¡œë“œ
</span>        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">jar_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">jarfile</span><span class="sh">'</span><span class="p">:</span> <span class="n">f</span><span class="p">}</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">files</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">jar_id</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()[</span><span class="sh">"</span><span class="s">filename</span><span class="sh">"</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="c1"># ì„¸ì´ë¸Œí¬ì¸íŠ¸ì—ì„œ ì‘ì—… ì‹œì‘
</span>            <span class="n">start_url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">rest_url</span><span class="si">}</span><span class="s">/jars/</span><span class="si">{</span><span class="n">jar_id</span><span class="si">}</span><span class="s">/run</span><span class="sh">"</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">savepointPath</span><span class="sh">"</span><span class="p">:</span> <span class="n">savepoint_path</span>
            <span class="p">}</span>
            
            <span class="n">start_response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">start_url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">start_response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to upload JAR: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">list_savepoints</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì´ë¸Œí¬ì¸íŠ¸ ëª©ë¡ ì¡°íšŒ</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” íŒŒì¼ ì‹œìŠ¤í…œì„ ìŠ¤ìº”í•˜ê±°ë‚˜ ë©”íƒ€ë°ì´í„° ì €ì¥ì†Œë¥¼ ì¡°íšŒ
</span>        <span class="k">return</span> <span class="p">[]</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">manage_savepoints_example</span><span class="p">():</span>
    <span class="n">manager</span> <span class="o">=</span> <span class="nc">SavepointManager</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># ì„¸ì´ë¸Œí¬ì¸íŠ¸ ìƒì„±
</span>        <span class="n">savepoint_location</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">create_savepoint</span><span class="p">(</span>
            <span class="sh">"</span><span class="s">job-id-123</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">file:///tmp/flink-savepoints/</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Savepoint created: </span><span class="si">{</span><span class="n">savepoint_location</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì„¸ì´ë¸Œí¬ì¸íŠ¸ì—ì„œ ë³µì›
</span>        <span class="n">success</span> <span class="o">=</span> <span class="n">manager</span><span class="p">.</span><span class="nf">restore_from_savepoint</span><span class="p">(</span>
            <span class="n">savepoint_location</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">/path/to/job.jar</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Restore success: </span><span class="si">{</span><span class="n">success</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì²´í¬í¬ì¸íŠ¸-ëª¨ë‹ˆí„°ë§">ì²´í¬í¬ì¸íŠ¸ ëª¨ë‹ˆí„°ë§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CheckpointMonitor</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">flink_rest_url</span><span class="o">=</span><span class="sh">"</span><span class="s">http://localhost:8081</span><span class="sh">"</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rest_url</span> <span class="o">=</span> <span class="n">flink_rest_url</span>
    
    <span class="k">def</span> <span class="nf">get_checkpoint_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì²´í¬í¬ì¸íŠ¸ ë©”íŠ¸ë¦­ ì¡°íšŒ</span><span class="sh">"""</span>
        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">rest_url</span><span class="si">}</span><span class="s">/jobs/</span><span class="si">{</span><span class="n">job_id</span><span class="si">}</span><span class="s">/checkpoints</span><span class="sh">"</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to get checkpoint metrics: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">analyze_checkpoint_performance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">job_id</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì²´í¬í¬ì¸íŠ¸ ì„±ëŠ¥ ë¶„ì„</span><span class="sh">"""</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_checkpoint_metrics</span><span class="p">(</span><span class="n">job_id</span><span class="p">)</span>
        
        <span class="n">checkpoints</span> <span class="o">=</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">latest</span><span class="sh">"</span><span class="p">,</span> <span class="p">{}).</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">completed</span><span class="sh">"</span><span class="p">,</span> <span class="p">[])</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checkpoints</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">No completed checkpoints found</span><span class="sh">"</span><span class="p">}</span>
        
        <span class="c1"># ì„±ëŠ¥ ë¶„ì„
</span>        <span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">checkpoints</span><span class="p">]</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="p">[</span><span class="n">cp</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">cp</span> <span class="ow">in</span> <span class="n">checkpoints</span><span class="p">]</span>
        
        <span class="n">analysis</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">total_checkpoints</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">checkpoints</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">avg_duration_ms</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">durations</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">max_duration_ms</span><span class="sh">"</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">min_duration_ms</span><span class="sh">"</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">avg_size_bytes</span><span class="sh">"</span><span class="p">:</span> <span class="nf">sum</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">max_size_bytes</span><span class="sh">"</span><span class="p">:</span> <span class="nf">max</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">min_size_bytes</span><span class="sh">"</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1"># ì„±ëŠ¥ ê¶Œì¥ì‚¬í•­
</span>        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="sh">"</span><span class="s">avg_duration_ms</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>  <span class="c1"># 10ì´ˆ ì´ìƒ
</span>            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">performance</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì²´í¬í¬ì¸íŠ¸ ì‹œê°„ì´ ê¸¸ì–´ì„œ ì„±ëŠ¥ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìƒíƒœ í¬ê¸°ë¥¼ ì¤„ì´ê±°ë‚˜ ë°±ì—”ë“œë¥¼ ìµœì í™”í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="k">if</span> <span class="n">analysis</span><span class="p">[</span><span class="sh">"</span><span class="s">avg_size_bytes</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">:</span>  <span class="c1"># 100MB ì´ìƒ
</span>            <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">storage</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ì²´í¬í¬ì¸íŠ¸ í¬ê¸°ê°€ í½ë‹ˆë‹¤. ë¶ˆí•„ìš”í•œ ìƒíƒœë¥¼ ì •ë¦¬í•˜ê±°ë‚˜ TTLì„ ì„¤ì •í•˜ì„¸ìš”.</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="n">analysis</span><span class="p">[</span><span class="sh">"</span><span class="s">recommendations</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">recommendations</span>
        
        <span class="k">return</span> <span class="n">analysis</span>

<span class="c1"># ëª¨ë‹ˆí„°ë§ ì˜ˆì œ
</span><span class="k">def</span> <span class="nf">checkpoint_monitoring_example</span><span class="p">():</span>
    <span class="n">monitor</span> <span class="o">=</span> <span class="nc">CheckpointMonitor</span><span class="p">()</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">analysis</span> <span class="o">=</span> <span class="n">monitor</span><span class="p">.</span><span class="nf">analyze_checkpoint_performance</span><span class="p">(</span><span class="sh">"</span><span class="s">job-id-123</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">=== Checkpoint Performance Analysis ===</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="-ë³µì¡í•œ-ì‹œê°„-ì²˜ë¦¬-ì „ëµ">â° ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬ ì „ëµ</h2>

<h3 id="ë‹¤ì¤‘-ì‹œê°„-ìœˆë„ìš°-ì²˜ë¦¬">ë‹¤ì¤‘ ì‹œê°„ ìœˆë„ìš° ì²˜ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.window</span> <span class="kn">import</span> <span class="n">TumblingEventTimeWindows</span><span class="p">,</span> <span class="n">SlidingEventTimeWindows</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">AllWindowFunction</span>
<span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>
<span class="kn">from</span> <span class="n">pyflink.common.typeinfo</span> <span class="kn">import</span> <span class="n">Types</span>

<span class="k">class</span> <span class="nc">MultiTimeWindowProcessor</span><span class="p">(</span><span class="n">AllWindowFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">window_results</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë‹¤ì¤‘ ì‹œê°„ ìœˆë„ìš°ì—ì„œ ë°ì´í„° ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="n">window_start</span> <span class="o">=</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span>
        <span class="n">window_end</span> <span class="o">=</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span>
        
        <span class="c1"># ìœˆë„ìš°ë³„ ì§‘ê³„
</span>        <span class="n">window_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">window_start</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">window_end</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="k">if</span> <span class="n">window_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">:</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">-inf</span><span class="sh">'</span><span class="p">)</span>
            <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># (timestamp, value) í˜•íƒœ ê°€ì •
</span>            <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">sum</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
            <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span>
                <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">],</span> <span class="n">value</span>
            <span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span>
                <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">][</span><span class="sh">"</span><span class="s">max</span><span class="sh">"</span><span class="p">],</span> <span class="n">value</span>
            <span class="p">)</span>
        
        <span class="c1"># ê²°ê³¼ ì¶œë ¥
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">window_results</span><span class="p">[</span><span class="n">window_key</span><span class="p">].</span><span class="nf">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">window_start</span>
        <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">window_end</span>
        <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">AdvancedTimeProcessing</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">setup_multi_window_processing</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë‹¤ì¤‘ ìœˆë„ìš° ì²˜ë¦¬ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># 1ë¶„ ìœˆë„ìš°
</span>        <span class="n">one_minute_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">window_all</span><span class="p">(</span>
            <span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="nc">MultiTimeWindowProcessor</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="c1"># 5ë¶„ ìœˆë„ìš°
</span>        <span class="n">five_minute_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">window_all</span><span class="p">(</span>
            <span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="nc">MultiTimeWindowProcessor</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="c1"># 1ë¶„ ìŠ¬ë¼ì´ë”© ìœˆë„ìš° (30ì´ˆ ìŠ¬ë¼ì´ë“œ)
</span>        <span class="n">sliding_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">window_all</span><span class="p">(</span>
            <span class="n">SlidingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">Time</span><span class="p">.</span><span class="nf">seconds</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        <span class="p">).</span><span class="nf">apply</span><span class="p">(</span><span class="nc">MultiTimeWindowProcessor</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">one_minute</span><span class="sh">"</span><span class="p">:</span> <span class="n">one_minute_window</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">five_minute</span><span class="sh">"</span><span class="p">:</span> <span class="n">five_minute_window</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">sliding</span><span class="sh">"</span><span class="p">:</span> <span class="n">sliding_window</span>
        <span class="p">}</span>
</code></pre></div></div>

<h3 id="ë™ì -ì›Œí„°ë§ˆí¬-ìƒì„±">ë™ì  ì›Œí„°ë§ˆí¬ ìƒì„±</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">ProcessFunction</span>
<span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="k">class</span> <span class="nc">DynamicWatermarkGenerator</span><span class="p">(</span><span class="n">ProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">max_delay_seconds</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_delay_seconds</span> <span class="o">=</span> <span class="n">max_delay_seconds</span>
        <span class="n">self</span><span class="p">.</span><span class="n">current_watermark</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">element_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë™ì  ì›Œí„°ë§ˆí¬ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">event_time</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="n">processing_time</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">timer_service</span><span class="p">().</span><span class="nf">current_processing_time</span><span class="p">()</span>
        
        <span class="c1"># ì§€ì—° ì‹œê°„ ê³„ì‚°
</span>        <span class="n">delay</span> <span class="o">=</span> <span class="n">processing_time</span> <span class="o">-</span> <span class="n">event_time</span>
        <span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
        
        <span class="c1"># ìµœê·¼ 100ê°œ ìš”ì†Œì˜ í‰ê·  ì§€ì—° ì‹œê°„ìœ¼ë¡œ ì›Œí„°ë§ˆí¬ ì¡°ì •
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">.</span><span class="nf">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">:</span>
            <span class="n">avg_delay</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">delay_statistics</span><span class="p">)</span>
            <span class="n">dynamic_delay</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">avg_delay</span> <span class="o">*</span> <span class="mf">1.5</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">max_delay_seconds</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
            
            <span class="c1"># ë™ì  ì›Œí„°ë§ˆí¬ ìƒì„±
</span>            <span class="n">new_watermark</span> <span class="o">=</span> <span class="n">event_time</span> <span class="o">-</span> <span class="n">dynamic_delay</span>
            <span class="k">if</span> <span class="n">new_watermark</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">current_watermark</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="n">current_watermark</span> <span class="o">=</span> <span class="n">new_watermark</span>
                <span class="n">ctx</span><span class="p">.</span><span class="nf">timer_service</span><span class="p">().</span><span class="nf">register_event_time_timer</span><span class="p">(</span><span class="n">new_watermark</span><span class="p">)</span>
        
        <span class="c1"># ìš”ì†Œ ì²˜ë¦¬
</span>        <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">on_timer</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íƒ€ì´ë¨¸ ê¸°ë°˜ ì›Œí„°ë§ˆí¬ ìƒì„±</span><span class="sh">"""</span>
        <span class="c1"># ì£¼ê¸°ì ìœ¼ë¡œ ì›Œí„°ë§ˆí¬ ìƒì„±
</span>        <span class="n">current_time</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">timer_service</span><span class="p">().</span><span class="nf">current_processing_time</span><span class="p">()</span>
        <span class="n">next_watermark</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">max_delay_seconds</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">next_watermark</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">current_watermark</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">current_watermark</span> <span class="o">=</span> <span class="n">next_watermark</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">timer_service</span><span class="p">().</span><span class="nf">register_processing_time_timer</span><span class="p">(</span><span class="n">current_time</span> <span class="o">+</span> <span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì‹œê°„-ê¸°ë°˜-ìƒíƒœ-ê´€ë¦¬">ì‹œê°„ ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.common.state</span> <span class="kn">import</span> <span class="n">ValueStateDescriptor</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">KeyedProcessFunction</span>

<span class="k">class</span> <span class="nc">TimeBasedStateManager</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">last_activity_time</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">session_timeout_ms</span> <span class="o">=</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># 30ë¶„
</span>    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_state</span><span class="p">(</span>
            <span class="nc">ValueStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">user_activity</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">last_activity_time</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_state</span><span class="p">(</span>
            <span class="nc">ValueStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">last_activity_time</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">LONG</span><span class="p">())</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹œê°„ ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬</span><span class="sh">"""</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">ctx</span><span class="p">.</span><span class="nf">timestamp</span><span class="p">()</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">element</span><span class="p">.</span><span class="n">user_id</span>
        
        <span class="c1"># ì´ì „ í™œë™ ì‹œê°„ í™•ì¸
</span>        <span class="n">last_time</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">last_activity_time</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">last_time</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="p">(</span><span class="n">current_time</span> <span class="o">-</span> <span class="n">last_time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">self</span><span class="p">.</span><span class="n">session_timeout_ms</span><span class="p">:</span>
            <span class="c1"># ìƒˆë¡œìš´ ì„¸ì…˜ ì‹œì‘
</span>            <span class="n">new_session</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">session_</span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">new_session</span><span class="p">)</span>
            
            <span class="c1"># ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ íƒ€ì´ë¨¸ ë“±ë¡
</span>            <span class="n">timeout_timer</span> <span class="o">=</span> <span class="n">current_time</span> <span class="o">+</span> <span class="n">self</span><span class="p">.</span><span class="n">session_timeout_ms</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">timer_service</span><span class="p">().</span><span class="nf">register_event_time_timer</span><span class="p">(</span><span class="n">timeout_timer</span><span class="p">)</span>
            
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">New session started for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">new_session</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ê¸°ì¡´ ì„¸ì…˜ ì—…ë°ì´íŠ¸
</span>            <span class="n">current_session</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Activity in existing session: </span><span class="si">{</span><span class="n">current_session</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ ì—…ë°ì´íŠ¸
</span>        <span class="n">self</span><span class="p">.</span><span class="n">last_activity_time</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">on_timer</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="c1"># ì„¸ì…˜ ì¢…ë£Œ ì²˜ë¦¬
</span>        <span class="n">session</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">session</span><span class="p">:</span>
            <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Session timeout: </span><span class="si">{</span><span class="n">session</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">user_activity_state</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
            <span class="n">self</span><span class="p">.</span><span class="n">last_activity_time</span><span class="p">.</span><span class="nf">clear</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="ì„±ëŠ¥-ìµœì í™”-ê¸°ë²•">âš¡ ì„±ëŠ¥ ìµœì í™” ê¸°ë²•</h2>

<h3 id="ë³‘ë ¬ì„±-ìµœì í™”">ë³‘ë ¬ì„± ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.connectors</span> <span class="kn">import</span> <span class="n">FlinkKafkaConsumer</span>
<span class="kn">from</span> <span class="n">pyflink.common.serialization</span> <span class="kn">import</span> <span class="n">SimpleStringSchema</span>

<span class="k">class</span> <span class="nc">ParallelismOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">optimize_kafka_parallelism</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">bootstrap_servers</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Kafka ë³‘ë ¬ì„± ìµœì í™”</span><span class="sh">"""</span>
        <span class="n">kafka_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">bootstrap.servers</span><span class="sh">'</span><span class="p">:</span> <span class="n">bootstrap_servers</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">group.id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">optimized-consumer-group</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">kafka_source</span> <span class="o">=</span> <span class="nc">FlinkKafkaConsumer</span><span class="p">(</span>
            <span class="n">topic</span><span class="p">,</span>
            <span class="nc">SimpleStringSchema</span><span class="p">(),</span>
            <span class="n">kafka_properties</span>
        <span class="p">)</span>
        
        <span class="c1"># íŒŒí‹°ì…˜ ìˆ˜ì— ë§ì¶° ë³‘ë ¬ì„± ì„¤ì •
</span>        <span class="n">kafka_source</span><span class="p">.</span><span class="nf">set_parallelism</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Kafka íŒŒí‹°ì…˜ ìˆ˜ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
</span>        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">add_source</span><span class="p">(</span><span class="n">kafka_source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">optimize_processing_parallelism</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì²˜ë¦¬ ë³‘ë ¬ì„± ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># í‚¤ë³„ ë³‘ë ¬ì„± ì„¤ì •
</span>        <span class="n">keyed_stream</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># ì²« ë²ˆì§¸ í•„ë“œë¡œ í‚¤ ì§€ì •
</span>        
        <span class="c1"># ë³‘ë ¬ ì²˜ë¦¬ ì„¤ì •
</span>        <span class="n">optimized_stream</span> <span class="o">=</span> <span class="n">keyed_stream</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">expensive_operation</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">()</span>
        <span class="p">).</span><span class="nf">set_parallelism</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>  <span class="c1"># ë†’ì€ ë³‘ë ¬ì„±ìœ¼ë¡œ ì„¤ì •
</span>        
        <span class="k">return</span> <span class="n">optimized_stream</span>
    
    <span class="k">def</span> <span class="nf">expensive_operation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹„ìš©ì´ í° ì—°ì‚° ì‹œë®¬ë ˆì´ì…˜</span><span class="sh">"""</span>
        <span class="kn">import</span> <span class="n">time</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># 10ms ì²˜ë¦¬ ì‹œê°„
</span>        <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">processed_</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">MemoryOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">setup_memory_optimization</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë©”ëª¨ë¦¬ ìµœì í™” ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># JVM í™ ë©”ëª¨ë¦¬ ì„¤ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.memory.process.size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">2048m</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.memory.managed.size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1024m</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="c1"># ë„¤íŠ¸ì›Œí¬ ë²„í¼ ì„¤ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.network.memory.fraction</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">0.2</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.memory.min</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">128mb</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.memory.max</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">1gb</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="c1"># ìƒíƒœ ë°±ì—”ë“œ ìµœì í™”
</span>        <span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">RocksDBStateBackend</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="nc">RocksDBStateBackend</span><span class="p">(</span>
            <span class="n">checkpoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/flink-checkpoints</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">enable_incremental_checkpointing</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        
        <span class="c1"># RocksDB ë©”ëª¨ë¦¬ ì„¤ì •
</span>        <span class="n">backend</span><span class="p">.</span><span class="nf">set_rocksdb_options</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">write_buffer_size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">64MB</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">max_write_buffer_number</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">3</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">block_cache_size</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">256MB</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">optimize_data_serialization</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë°ì´í„° ì§ë ¬í™” ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># Kryo ì§ë ¬í™” ì„¤ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.runtime.kryo.default.serializers</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="c1"># Arrow ê¸°ë°˜ ì§ë ¬í™” ì‚¬ìš©
</span>        <span class="n">optimized_stream</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>  <span class="c1"># ë³€í™˜ ì—†ìŒ
</span>            <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">()</span>  <span class="c1"># ìµœì í™”ëœ íƒ€ì…
</span>        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">optimized_stream</span>
</code></pre></div></div>

<h3 id="ë„¤íŠ¸ì›Œí¬-ìµœì í™”">ë„¤íŠ¸ì›Œí¬ ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NetworkOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">setup_network_optimization</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë„¤íŠ¸ì›Œí¬ ìµœì í™” ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ìµœì í™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.num-arenas</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">4</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.server.numThreads</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">4</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.client.numThreads</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">4</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.server.backlog</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="c1"># ë²„í¼ í¬ê¸° ìµœì í™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.network.memory.buffers-per-channel</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">2</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.memory.floating-buffers-per-gate</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">8</span><span class="sh">"</span>
        <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">optimize_shuffle_network</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Shuffle ë„¤íŠ¸ì›Œí¬ ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># ë°ì´í„° íŒŒí‹°ì…”ë‹ ìµœì í™”
</span>        <span class="n">optimized_stream</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">partition_custom</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">key</span><span class="p">,</span> <span class="n">num_partitions</span><span class="p">:</span> <span class="nf">hash</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">%</span> <span class="n">num_partitions</span><span class="p">,</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># í‚¤ ì¶”ì¶œ í•¨ìˆ˜
</span>        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">optimized_stream</span>

<span class="k">class</span> <span class="nc">LatencyOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">setup_low_latency_config</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì €ì§€ì—° ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># ë²„í¼ íƒ€ì„ì•„ì›ƒ ìµœì†Œí™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_config</span><span class="p">().</span><span class="nf">set_global_job_parameters</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.server.backlog</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">0</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">taskmanager.network.netty.client.connectTimeoutSec</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">10</span><span class="sh">"</span>
        <span class="p">})</span>
        
        <span class="c1"># ì²´í¬í¬ì¸íŒ… ê°„ê²© ì¡°ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_checkpoint_config</span><span class="p">().</span><span class="nf">enable_checkpointing</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>  <span class="c1"># 100ms
</span>        
        <span class="c1"># ì§€ì—° ê°€ëŠ¥í•œ ì²´í¬í¬ì¸íŠ¸ í™œì„±í™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_checkpoint_config</span><span class="p">().</span><span class="nf">set_unaligned_checkpoints</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">optimize_processing_latency</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì²˜ë¦¬ ì§€ì—°ì‹œê°„ ìµœì í™”</span><span class="sh">"""</span>
        <span class="c1"># ìŠ¤íŠ¸ë¦¬ë° ëª¨ë“œ ì„¤ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">set_buffer_timeout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 1ms ë²„í¼ íƒ€ì„ì•„ì›ƒ
</span>        
        <span class="c1"># ì¦‰ì‹œ ì²˜ë¦¬ ì„¤ì •
</span>        <span class="n">optimized_stream</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">()</span>
        <span class="p">).</span><span class="nf">set_buffer_timeout</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># ë²„í¼ë§ ì—†ì´ ì¦‰ì‹œ ì²˜ë¦¬
</span>        
        <span class="k">return</span> <span class="n">optimized_stream</span>
</code></pre></div></div>

<h2 id="ì‹¤ë¬´-í”„ë¡œì íŠ¸-ì‹¤ì‹œê°„-ì¶”ì²œ-ì‹œìŠ¤í…œ">ğŸš€ ì‹¤ë¬´ í”„ë¡œì íŠ¸: ì‹¤ì‹œê°„ ì¶”ì²œ ì‹œìŠ¤í…œ</h2>

<h3 id="í”„ë¡œì íŠ¸-ê°œìš”">í”„ë¡œì íŠ¸ ê°œìš”</h3>

<p>ì‚¬ìš©ì í–‰ë™ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ê°œì¸í™”ëœ ì¶”ì²œì„ ì œê³µí•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>

<h3 id="1-ë°ì´í„°-ëª¨ë¸-ì •ì˜">1. ë°ì´í„° ëª¨ë¸ ì •ì˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">UserEvent</span><span class="p">:</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">event_type</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># view, click, purchase, like
</span>    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span>
    
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">item_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">item_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">event_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">event_type</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">session_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">session_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">metadata</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">metadata</span>
        <span class="p">})</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">json_str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">UserProfile</span><span class="p">:</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">interests</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>  <span class="c1"># ì¹´í…Œê³ ë¦¬ë³„ ê´€ì‹¬ë„
</span>    <span class="n">behavior_patterns</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>  <span class="c1"># í–‰ë™ íŒ¨í„´
</span>    <span class="n">last_updated</span><span class="p">:</span> <span class="nb">int</span>
    
    <span class="k">def</span> <span class="nf">update_interest</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê´€ì‹¬ë„ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        
        <span class="c1"># ì§€ìˆ˜ ì´ë™ í‰ê· ìœ¼ë¡œ ì—…ë°ì´íŠ¸
</span>        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">[</span><span class="n">category</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">weight</span>
    
    <span class="k">def</span> <span class="nf">get_top_interests</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìƒìœ„ ê´€ì‹¬ì‚¬ ë°˜í™˜</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">.</span><span class="nf">items</span><span class="p">(),</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)[:</span><span class="n">top_k</span><span class="p">]</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Recommendation</span><span class="p">:</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></div>

<h3 id="2-ì‹¤ì‹œê°„-ì‚¬ìš©ì-í”„ë¡œíŒŒì¼ë§">2. ì‹¤ì‹œê°„ ì‚¬ìš©ì í”„ë¡œíŒŒì¼ë§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">KeyedProcessFunction</span>
<span class="kn">from</span> <span class="n">pyflink.common.state</span> <span class="kn">import</span> <span class="n">ValueStateDescriptor</span><span class="p">,</span> <span class="n">MapStateDescriptor</span>
<span class="kn">from</span> <span class="n">pyflink.common.typeinfo</span> <span class="kn">import</span> <span class="n">Types</span>

<span class="k">class</span> <span class="nc">RealTimeUserProfiler</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_profile_state</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">item_categories</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># ì•„ì´í…œ-ì¹´í…Œê³ ë¦¬ ë§¤í•‘
</span>    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_profile_state</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_state</span><span class="p">(</span>
            <span class="nc">ValueStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">user_profile</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_event</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ì‚¬ìš©ì í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">user_event</span><span class="p">.</span><span class="n">user_id</span>
        
        <span class="c1"># í˜„ì¬ í”„ë¡œíŒŒì¼ ë¡œë“œ
</span>        <span class="n">profile_json</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_profile_state</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">profile_json</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">UserProfile</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">profile_json</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="nc">UserProfile</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                <span class="n">interests</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">behavior_patterns</span><span class="o">=</span><span class="p">{},</span>
                <span class="n">last_updated</span><span class="o">=</span><span class="n">user_event</span><span class="p">.</span><span class="n">timestamp</span>
            <span class="p">)</span>
        
        <span class="c1"># ì´ë²¤íŠ¸ íƒ€ì…ë³„ ì²˜ë¦¬
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">update_profile_from_event</span><span class="p">(</span><span class="n">profile</span><span class="p">,</span> <span class="n">user_event</span><span class="p">)</span>
        
        <span class="c1"># í”„ë¡œíŒŒì¼ ì €ì¥
</span>        <span class="n">self</span><span class="p">.</span><span class="n">user_profile_state</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">profile</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
        
        <span class="c1"># ì—…ë°ì´íŠ¸ëœ í”„ë¡œíŒŒì¼ ì¶œë ¥
</span>        <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_profile_from_event</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">profile</span><span class="p">:</span> <span class="n">UserProfile</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">UserEvent</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
        <span class="c1"># ì•„ì´í…œ ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸° (ì‹¤ì œë¡œëŠ” ë³„ë„ ì„œë¹„ìŠ¤ì—ì„œ ì¡°íšŒ)
</span>        <span class="n">category</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_item_category</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">item_id</span><span class="p">)</span>
        
        <span class="c1"># ì´ë²¤íŠ¸ íƒ€ì…ë³„ ê°€ì¤‘ì¹˜
</span>        <span class="n">event_weights</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">click</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">like</span><span class="sh">'</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">purchase</span><span class="sh">'</span><span class="p">:</span> <span class="mf">1.0</span>
        <span class="p">}</span>
        
        <span class="n">weight</span> <span class="o">=</span> <span class="n">event_weights</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">event_type</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
        
        <span class="c1"># ê´€ì‹¬ë„ ì—…ë°ì´íŠ¸
</span>        <span class="n">profile</span><span class="p">.</span><span class="nf">update_interest</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span>
        
        <span class="c1"># í–‰ë™ íŒ¨í„´ ì—…ë°ì´íŠ¸
</span>        <span class="n">pattern_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">event</span><span class="p">.</span><span class="n">event_type</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">profile</span><span class="p">.</span><span class="n">behavior_patterns</span><span class="p">[</span><span class="n">pattern_key</span><span class="p">]</span> <span class="o">=</span> \
            <span class="n">profile</span><span class="p">.</span><span class="n">behavior_patterns</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">pattern_key</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        
        <span class="n">profile</span><span class="p">.</span><span class="n">last_updated</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">timestamp</span>
    
    <span class="k">def</span> <span class="nf">get_item_category</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ì•„ì´í…œ ì¹´í…Œê³ ë¦¬ ì¡°íšŒ</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ìºì‹œì—ì„œ ì¡°íšŒ
</span>        <span class="n">categories</span> <span class="o">=</span> <span class="p">[</span><span class="sh">'</span><span class="s">electronics</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">books</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">clothing</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">home</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">sports</span><span class="sh">'</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">categories</span><span class="p">[</span><span class="nf">hash</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span> <span class="o">%</span> <span class="nf">len</span><span class="p">(</span><span class="n">categories</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">interests</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">interests</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">behavior_patterns</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">behavior_patterns</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">last_updated</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">last_updated</span>
        <span class="p">})</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">json_str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-í˜‘ì—…-í•„í„°ë§-ê¸°ë°˜-ì¶”ì²œ-ì—”ì§„">3. í˜‘ì—… í•„í„°ë§ ê¸°ë°˜ ì¶”ì²œ ì—”ì§„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CollaborativeFilteringEngine</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">item_item_similarity</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_similarity</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_map_state</span><span class="p">(</span>
            <span class="nc">MapStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">user_item_matrix</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">(),</span> <span class="n">Types</span><span class="p">.</span><span class="nc">FLOAT</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">item_item_similarity</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_map_state</span><span class="p">(</span>
            <span class="nc">MapStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">item_similarity</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">(),</span> <span class="n">Types</span><span class="p">.</span><span class="nc">FLOAT</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_similarity</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_map_state</span><span class="p">(</span>
            <span class="nc">MapStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">user_similarity</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">(),</span> <span class="n">Types</span><span class="p">.</span><span class="nc">FLOAT</span><span class="p">())</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_event</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í˜‘ì—… í•„í„°ë§ ê¸°ë°˜ ì¶”ì²œ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">user_event</span><span class="p">.</span><span class="n">user_id</span>
        <span class="n">item_id</span> <span class="o">=</span> <span class="n">user_event</span><span class="p">.</span><span class="n">item_id</span>
        
        <span class="c1"># ì‚¬ìš©ì-ì•„ì´í…œ í–‰ë ¬ ì—…ë°ì´íŠ¸
</span>        <span class="n">matrix_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">item_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">current_rating</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">matrix_key</span><span class="p">)</span> <span class="ow">or</span> <span class="mf">0.0</span>
        
        <span class="c1"># ì´ë²¤íŠ¸ ê¸°ë°˜ í‰ì  ê³„ì‚°
</span>        <span class="n">event_rating</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_rating_from_event</span><span class="p">(</span><span class="n">user_event</span><span class="p">)</span>
        <span class="n">new_rating</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_rating</span> <span class="o">+</span> <span class="n">event_rating</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">matrix_key</span><span class="p">,</span> <span class="n">new_rating</span><span class="p">)</span>
        
        <span class="c1"># ì•„ì´í…œ ê¸°ë°˜ ì¶”ì²œ ìƒì„±
</span>        <span class="n">item_recommendations</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_item_based_recommendations</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">item_id</span><span class="p">)</span>
        
        <span class="c1"># ì‚¬ìš©ì ê¸°ë°˜ ì¶”ì²œ ìƒì„±
</span>        <span class="n">user_recommendations</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_user_based_recommendations</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        
        <span class="c1"># ì¶”ì²œ ê²°ê³¼ í†µí•©
</span>        <span class="n">final_recommendations</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">combine_recommendations</span><span class="p">(</span>
            <span class="n">item_recommendations</span><span class="p">,</span> <span class="n">user_recommendations</span>
        <span class="p">)</span>
        
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">final_recommendations</span><span class="p">:</span>
            <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">calculate_rating_from_event</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">UserEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ì´ë²¤íŠ¸ ê¸°ë°˜ í‰ì  ê³„ì‚°</span><span class="sh">"""</span>
        <span class="n">rating_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">view</span><span class="sh">'</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">click</span><span class="sh">'</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">like</span><span class="sh">'</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">purchase</span><span class="sh">'</span><span class="p">:</span> <span class="mf">5.0</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">rating_map</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">event_type</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">generate_item_based_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•„ì´í…œ ê¸°ë°˜ ì¶”ì²œ ìƒì„±</span><span class="sh">"""</span>
        <span class="c1"># ìœ ì‚¬í•œ ì•„ì´í…œ ì°¾ê¸°
</span>        <span class="n">similar_items</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">find_similar_items</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">top_k</span><span class="p">)</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">similar_item</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="n">similar_items</span><span class="p">:</span>
            <span class="c1"># ì‚¬ìš©ìê°€ ì•„ì§ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šì€ ì•„ì´í…œë§Œ ì¶”ì²œ
</span>            <span class="n">matrix_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">similar_item</span><span class="si">}</span><span class="sh">"</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">matrix_key</span><span class="p">):</span>
                <span class="n">score</span> <span class="o">=</span> <span class="n">similarity</span> <span class="o">*</span> <span class="mf">0.8</span>  <span class="c1"># ì•„ì´í…œ ê¸°ë°˜ ê°€ì¤‘ì¹˜
</span>                <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Recommendation</span><span class="p">(</span>
                    <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                    <span class="n">item_id</span><span class="o">=</span><span class="n">similar_item</span><span class="p">,</span>
                    <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="sh">"</span><span class="s">Similar to items you liked</span><span class="sh">"</span><span class="p">,</span>
                    <span class="n">timestamp</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
                <span class="p">))</span>
        
        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="n">top_k</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">generate_user_based_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ê¸°ë°˜ ì¶”ì²œ ìƒì„±</span><span class="sh">"""</span>
        <span class="c1"># ìœ ì‚¬í•œ ì‚¬ìš©ì ì°¾ê¸°
</span>        <span class="n">similar_users</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">find_similar_users</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">top_k</span><span class="p">)</span>
        
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">similar_user</span><span class="p">,</span> <span class="n">similarity</span> <span class="ow">in</span> <span class="n">similar_users</span><span class="p">:</span>
            <span class="c1"># ìœ ì‚¬í•œ ì‚¬ìš©ìê°€ ì¢‹ì•„í•œ ì•„ì´í…œ ì¤‘ í˜„ì¬ ì‚¬ìš©ìê°€ ì•„ì§ ìƒí˜¸ì‘ìš©í•˜ì§€ ì•Šì€ ê²ƒ
</span>            <span class="n">user_items</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_items</span><span class="p">(</span><span class="n">similar_user</span><span class="p">)</span>
            <span class="n">current_user_items</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_items</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">item_id</span> <span class="ow">in</span> <span class="n">user_items</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_user_items</span><span class="p">:</span>
                    <span class="n">score</span> <span class="o">=</span> <span class="n">similarity</span> <span class="o">*</span> <span class="mf">0.6</span>  <span class="c1"># ì‚¬ìš©ì ê¸°ë°˜ ê°€ì¤‘ì¹˜
</span>                    <span class="n">recommendations</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="nc">Recommendation</span><span class="p">(</span>
                        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
                        <span class="n">item_id</span><span class="o">=</span><span class="n">item_id</span><span class="p">,</span>
                        <span class="n">score</span><span class="o">=</span><span class="n">score</span><span class="p">,</span>
                        <span class="n">reason</span><span class="o">=</span><span class="sh">"</span><span class="s">Users with similar tastes liked this</span><span class="sh">"</span><span class="p">,</span>
                        <span class="n">timestamp</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
                    <span class="p">))</span>
        
        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="n">top_k</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">find_similar_items</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìœ ì‚¬í•œ ì•„ì´í…œ ì°¾ê¸°</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œë¡œëŠ” ë” ì •êµí•œ ìœ ì‚¬ë„ ê³„ì‚° ì•Œê³ ë¦¬ì¦˜ ì‚¬ìš©
</span>        <span class="n">similar_items</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ëª¨ë“  ì•„ì´í…œê³¼ì˜ ìœ ì‚¬ë„ ê³„ì‚° (ê°„ë‹¨í•œ ì˜ˆì‹œ)
</span>        <span class="k">for</span> <span class="n">other_item</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_all_items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">other_item</span> <span class="o">!=</span> <span class="n">item_id</span><span class="p">:</span>
                <span class="n">similarity</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_item_similarity</span><span class="p">(</span><span class="n">item_id</span><span class="p">,</span> <span class="n">other_item</span><span class="p">)</span>
                <span class="n">similar_items</span><span class="p">.</span><span class="nf">append</span><span class="p">((</span><span class="n">other_item</span><span class="p">,</span> <span class="n">similarity</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">similar_items</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)[:</span><span class="n">top_k</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">calculate_item_similarity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item1</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">item2</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ì•„ì´í…œ ìœ ì‚¬ë„ ê³„ì‚° (ì½”ì‚¬ì¸ ìœ ì‚¬ë„)</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œë¡œëŠ” ì‚¬ìš©ì-ì•„ì´í…œ í–‰ë ¬ì„ ê¸°ë°˜ìœ¼ë¡œ ê³„ì‚°
</span>        <span class="k">return</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">hash</span><span class="p">(</span><span class="n">item1</span><span class="p">)</span> <span class="o">-</span> <span class="nf">hash</span><span class="p">(</span><span class="n">item2</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nf">hash</span><span class="p">(</span><span class="n">item1</span><span class="p">)</span> <span class="o">+</span> <span class="nf">hash</span><span class="p">(</span><span class="n">item2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_all_items</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ëª¨ë“  ì•„ì´í…œ ëª©ë¡ ë°˜í™˜</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œë¡œëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì¡°íšŒ
</span>        <span class="k">return</span> <span class="p">[</span><span class="sa">f</span><span class="sh">"</span><span class="s">item_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="sh">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
    
    <span class="k">def</span> <span class="nf">get_user_items</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ìê°€ ìƒí˜¸ì‘ìš©í•œ ì•„ì´í…œ ëª©ë¡ ë°˜í™˜</span><span class="sh">"""</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">user_item_matrix</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">):</span>
                <span class="n">item_id</span> <span class="o">=</span> <span class="n">key</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">:</span><span class="sh">"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">items</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">item_id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">items</span>
    
    <span class="k">def</span> <span class="nf">combine_recommendations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">item_recs</span><span class="p">,</span> <span class="n">user_recs</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¶”ì²œ ê²°ê³¼ í†µí•©</span><span class="sh">"""</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="c1"># ì•„ì´í…œ ê¸°ë°˜ ì¶”ì²œ ì¶”ê°€
</span>        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">item_recs</span><span class="p">:</span>
            <span class="n">combined</span><span class="p">[</span><span class="n">rec</span><span class="p">.</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
        
        <span class="c1"># ì‚¬ìš©ì ê¸°ë°˜ ì¶”ì²œ ì¶”ê°€ (ì ìˆ˜ ì¡°ì •)
</span>        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="n">user_recs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="p">.</span><span class="n">item_id</span> <span class="ow">in</span> <span class="n">combined</span><span class="p">:</span>
                <span class="c1"># ì´ë¯¸ ìˆëŠ” ê²½ìš° ì ìˆ˜ í‰ê· 
</span>                <span class="n">combined</span><span class="p">[</span><span class="n">rec</span><span class="p">.</span><span class="n">item_id</span><span class="p">].</span><span class="n">score</span> <span class="o">=</span> <span class="p">(</span><span class="n">combined</span><span class="p">[</span><span class="n">rec</span><span class="p">.</span><span class="n">item_id</span><span class="p">].</span><span class="n">score</span> <span class="o">+</span> <span class="n">rec</span><span class="p">.</span><span class="n">score</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">combined</span><span class="p">[</span><span class="n">rec</span><span class="p">.</span><span class="n">item_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec</span>
        
        <span class="k">return</span> <span class="nf">list</span><span class="p">(</span><span class="n">combined</span><span class="p">.</span><span class="nf">values</span><span class="p">())</span>
</code></pre></div></div>

<h3 id="4-ì‹¤ì‹œê°„-ì¶”ì²œ-ì‹œìŠ¤í…œ-í†µí•©">4. ì‹¤ì‹œê°„ ì¶”ì²œ ì‹œìŠ¤í…œ í†µí•©</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeRecommendationSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="nf">get_execution_environment</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setup_environment</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">setup_environment</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í™˜ê²½ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># ì²´í¬í¬ì¸íŒ… í™œì„±í™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_checkpoint_config</span><span class="p">().</span><span class="nf">enable_checkpointing</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        
        <span class="c1"># ìƒíƒœ ë°±ì—”ë“œ ì„¤ì •
</span>        <span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">RocksDBStateBackend</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="nc">RocksDBStateBackend</span><span class="p">(</span>
            <span class="n">checkpoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/recommendation-checkpoints</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_kafka_source</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">bootstrap_servers</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Kafka ì†ŒìŠ¤ ìƒì„±</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyflink.datastream.connectors</span> <span class="kn">import</span> <span class="n">FlinkKafkaConsumer</span>
        <span class="kn">from</span> <span class="n">pyflink.common.serialization</span> <span class="kn">import</span> <span class="n">SimpleStringSchema</span>
        
        <span class="n">kafka_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">bootstrap.servers</span><span class="sh">'</span><span class="p">:</span> <span class="n">bootstrap_servers</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">group.id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">recommendation-system</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">kafka_source</span> <span class="o">=</span> <span class="nc">FlinkKafkaConsumer</span><span class="p">(</span>
            <span class="n">topic</span><span class="p">,</span>
            <span class="nc">SimpleStringSchema</span><span class="p">(),</span>
            <span class="n">kafka_properties</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">add_source</span><span class="p">(</span><span class="n">kafka_source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_user_events</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">event_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ì´ë²¤íŠ¸ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">parse_event</span><span class="p">(</span><span class="n">event_str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">UserEvent</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">event_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to parse event: </span><span class="si">{</span><span class="n">event_str</span><span class="si">}</span><span class="s">, Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
        
        <span class="k">return</span> <span class="n">event_stream</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">parse_event</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span> \
                          <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">run_recommendation_system</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¶”ì²œ ì‹œìŠ¤í…œ ì‹¤í–‰</span><span class="sh">"""</span>
        <span class="c1"># Kafkaì—ì„œ ì‚¬ìš©ì ì´ë²¤íŠ¸ ì½ê¸°
</span>        <span class="n">event_stream</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_kafka_source</span><span class="p">(</span><span class="sh">"</span><span class="s">user-events</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì´ë²¤íŠ¸ íŒŒì‹±
</span>        <span class="n">parsed_events</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_user_events</span><span class="p">(</span><span class="n">event_stream</span><span class="p">)</span>
        
        <span class="c1"># íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ì›Œí„°ë§ˆí¬ í• ë‹¹
</span>        <span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">BoundedOutOfOrdernessTimestampExtractor</span>
        <span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>
        
        <span class="k">class</span> <span class="nc">EventTimestampExtractor</span><span class="p">(</span><span class="n">BoundedOutOfOrdernessTimestampExtractor</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
                <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">seconds</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
            
            <span class="k">def</span> <span class="nf">extract_timestamp</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">previous_timestamp</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">element</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">*</span> <span class="mi">1000</span>
        
        <span class="n">watermarked_events</span> <span class="o">=</span> <span class="n">parsed_events</span><span class="p">.</span><span class="nf">assign_timestamps_and_watermarks</span><span class="p">(</span>
            <span class="nc">EventTimestampExtractor</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="c1"># ì‹¤ì‹œê°„ ì‚¬ìš©ì í”„ë¡œíŒŒì¼ë§
</span>        <span class="n">user_profiles</span> <span class="o">=</span> <span class="n">watermarked_events</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
                                        <span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="nc">RealTimeUserProfiler</span><span class="p">())</span>
        
        <span class="c1"># í˜‘ì—… í•„í„°ë§ ê¸°ë°˜ ì¶”ì²œ
</span>        <span class="n">recommendations</span> <span class="o">=</span> <span class="n">watermarked_events</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
                                          <span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="nc">CollaborativeFilteringEngine</span><span class="p">())</span>
        
        <span class="c1"># ê²°ê³¼ ì¶œë ¥
</span>        <span class="n">user_profiles</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">User Profiles</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">recommendations</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Recommendations</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì‹¤í–‰
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">Real-time Recommendation System</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì‹œìŠ¤í…œ ì‹¤í–‰
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">system</span> <span class="o">=</span> <span class="nc">RealTimeRecommendationSystem</span><span class="p">()</span>
    <span class="n">system</span><span class="p">.</span><span class="nf">run_recommendation_system</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="ì´ë²ˆ-íŒŒíŠ¸ì—ì„œ-í•™ìŠµí•œ-ë‚´ìš©">ì´ë²ˆ íŒŒíŠ¸ì—ì„œ í•™ìŠµí•œ ë‚´ìš©</h3>

<ol>
  <li><strong>ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´</strong>
    <ul>
      <li>ìƒíƒœ ë°±ì—”ë“œ (Memory, Fs, RocksDB)</li>
      <li>ìƒíƒœ TTLê³¼ ìë™ ì •ë¦¬</li>
      <li>ìƒíƒœ ìŠ¤ëƒ…ìƒ·ê³¼ ë³µì›</li>
      <li>ìƒíƒœ ë¶„í• ê³¼ ë³‘í•©</li>
    </ul>
  </li>
  <li><strong>ì²´í¬í¬ì¸íŒ…ê³¼ ì„¸ì´ë¸Œí¬ì¸íŠ¸</strong>
    <ul>
      <li>ê³ ê¸‰ ì²´í¬í¬ì¸íŒ… ì„¤ì •</li>
      <li>ì„¸ì´ë¸Œí¬ì¸íŠ¸ ìƒì„±ê³¼ ë³µì›</li>
      <li>ì²´í¬í¬ì¸íŠ¸ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</li>
      <li>ì¥ì•  ë³µêµ¬ ì „ëµ</li>
    </ul>
  </li>
  <li><strong>ë³µì¡í•œ ì‹œê°„ ì²˜ë¦¬</strong>
    <ul>
      <li>ë‹¤ì¤‘ ì‹œê°„ ìœˆë„ìš° ì²˜ë¦¬</li>
      <li>ë™ì  ì›Œí„°ë§ˆí¬ ìƒì„±</li>
      <li>ì‹œê°„ ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬</li>
      <li>ì§€ì—° ë°ì´í„° ì²˜ë¦¬</li>
    </ul>
  </li>
  <li><strong>ì„±ëŠ¥ ìµœì í™”</strong>
    <ul>
      <li>ë³‘ë ¬ì„± ìµœì í™”</li>
      <li>ë©”ëª¨ë¦¬ ìµœì í™”</li>
      <li>ë„¤íŠ¸ì›Œí¬ ìµœì í™”</li>
      <li>ì§€ì—°ì‹œê°„ ìµœì í™”</li>
    </ul>
  </li>
  <li><strong>ì‹¤ë¬´ í”„ë¡œì íŠ¸</strong>
    <ul>
      <li>ì‹¤ì‹œê°„ ì¶”ì²œ ì‹œìŠ¤í…œ</li>
      <li>ì‚¬ìš©ì í”„ë¡œíŒŒì¼ë§</li>
      <li>í˜‘ì—… í•„í„°ë§</li>
      <li>ê°œì¸í™” ì¶”ì²œ</li>
    </ul>
  </li>
</ol>

<h3 id="í•µì‹¬-ê¸°ìˆ -ìŠ¤íƒ">í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ</h3>

<table>
  <thead>
    <tr>
      <th>ê¸°ìˆ </th>
      <th>ìš©ë„</th>
      <th>ì¤‘ìš”ë„</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ê³ ê¸‰ ìƒíƒœ ê´€ë¦¬</strong></td>
      <td>ë³µì¡í•œ ìƒíƒœ ì²˜ë¦¬</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì²´í¬í¬ì¸íŒ…</strong></td>
      <td>ì¥ì•  ë³µêµ¬ì™€ ì•ˆì •ì„±</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì‹œê°„ ì²˜ë¦¬</strong></td>
      <td>ì •í™•í•œ ì‹œê°„ ê¸°ë°˜ ë¶„ì„</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì„±ëŠ¥ ìµœì í™”</strong></td>
      <td>í”„ë¡œë•ì…˜ í™˜ê²½ ìµœì í™”</td>
      <td>â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì‹¤ì‹œê°„ ì¶”ì²œ</strong></td>
      <td>ê°œì¸í™” ì„œë¹„ìŠ¤</td>
      <td>â­â­â­â­</td>
    </tr>
  </tbody>
</table>

<h3 id="ë‹¤ìŒ-íŒŒíŠ¸-ë¯¸ë¦¬ë³´ê¸°">ë‹¤ìŒ íŒŒíŠ¸ ë¯¸ë¦¬ë³´ê¸°</h3>

<p><strong>Part 3: ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP (Complex Event Processing)</strong>ì—ì„œëŠ” ë‹¤ìŒ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:</p>
<ul>
  <li>ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ íŒ¨í„´</li>
  <li>ì‹¤ì‹œê°„ ì§‘ê³„ì™€ ìœˆë„ìš° í•¨ìˆ˜</li>
  <li>CEP íŒ¨í„´ ë§¤ì¹­</li>
  <li>ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</li>
</ul>

<hr />

<p><strong>ë‹¤ìŒ íŒŒíŠ¸</strong>: <a href="/data-engineering/2025/09/17/apache-flink-real-time-analytics.html">Part 3: ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP</a></p>

<hr />

<p><em>ì´ì œ Flinkì˜ ê³ ê¸‰ ê¸°ëŠ¥ë“¤ì„ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤! ë‹¤ìŒ íŒŒíŠ¸ì—ì„œëŠ” ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì„¸ê³„ë¡œ ë“¤ì–´ê°€ê² ìŠµë‹ˆë‹¤.</em> ğŸš€</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/09/15/apache-flink-basics.html" class="nav-link prev">
          â† ì´ì „: Part 1: Apache Flink ê¸°ì´ˆì™€ í•µì‹¬ ê°œë… - ì§„ì •í•œ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì˜ ì‹œì‘
        </a>
      
      
      
        
        
        <a href="/data-engineering/2025/09/17/apache-flink-real-time-analytics.html" class="nav-link next">
          ë‹¤ìŒ: Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„± â†’
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
