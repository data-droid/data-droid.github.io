<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="Apache Flinkì˜ CEP (Complex Event Processing), ì‹¤ì‹œê°„ ì§‘ê³„, ìœˆë„ìš° í•¨ìˆ˜, íŒ¨í„´ ë§¤ì¹­ì„ í•™ìŠµí•˜ê³  ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œì™€ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.">



<title>Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„± - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„±">
<meta property="og:description" content="Apache Flinkì˜ CEP (Complex Event Processing), ì‹¤ì‹œê°„ ì§‘ê³„, ìœˆë„ìš° í•¨ìˆ˜, íŒ¨í„´ ë§¤ì¹­ì„ í•™ìŠµí•˜ê³  ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œì™€ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.">
<meta property="og:url" content="https://data-droid.github.io/data-engineering/2025/09/17/apache-flink-real-time-analytics.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„±">
<meta name="twitter:description" content="Apache Flinkì˜ CEP (Complex Event Processing), ì‹¤ì‹œê°„ ì§‘ê³„, ìœˆë„ìš° í•¨ìˆ˜, íŒ¨í„´ ë§¤ì¹­ì„ í•™ìŠµí•˜ê³  ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œì™€ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/09/17/apache-flink-real-time-analytics.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-09-17-apache-flink-real-time-analytics.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 09ì›” 17ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„±</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Apache-Flink</span>
      
        <span class="tag">CEP</span>
      
        <span class="tag">ì‹¤ì‹œê°„ë¶„ì„</span>
      
        <span class="tag">íŒ¨í„´ë§¤ì¹­</span>
      
        <span class="tag">ìœˆë„ìš°í•¨ìˆ˜</span>
      
        <span class="tag">ì‹¤ì‹œê°„ëŒ€ì‹œë³´ë“œ</span>
      
        <span class="tag">Python</span>
      
        <span class="tag">PyFlink</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Apache flink complete guide ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 4</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 45ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ê³ ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="part-3-apache-flink-ì‹¤ì‹œê°„-ë¶„ì„ê³¼-cep---ë³µì¡í•œ-ì´ë²¤íŠ¸-ì²˜ë¦¬ì˜-ì™„ì„±">Part 3: Apache Flink ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEP - ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬ì˜ ì™„ì„±</h1>

<blockquote>
  <p>Apache Flinkì˜ CEP (Complex Event Processing), ì‹¤ì‹œê°„ ì§‘ê³„, ìœˆë„ìš° í•¨ìˆ˜, íŒ¨í„´ ë§¤ì¹­ì„ í•™ìŠµí•˜ê³  ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œì™€ ì•Œë¦¼ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>
</blockquote>

<h2 id="ëª©ì°¨">ğŸ“‹ ëª©ì°¨</h2>

<ol>
  <li><a href="#cep-complex-event-processing-ê¸°ì´ˆ">CEP (Complex Event Processing) ê¸°ì´ˆ</a></li>
  <li><a href="#ê³ ê¸‰-íŒ¨í„´-ë§¤ì¹­">ê³ ê¸‰ íŒ¨í„´ ë§¤ì¹­</a></li>
  <li><a href="#ì‹¤ì‹œê°„-ì§‘ê³„ì™€-ìœˆë„ìš°-í•¨ìˆ˜">ì‹¤ì‹œê°„ ì§‘ê³„ì™€ ìœˆë„ìš° í•¨ìˆ˜</a></li>
  <li><a href="#ì‹¤ì‹œê°„-ëŒ€ì‹œë³´ë“œ-êµ¬ì¶•">ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</a></li>
  <li><a href="#ì‹¤ë¬´-í”„ë¡œì íŠ¸-ì‹¤ì‹œê°„-ê¸ˆìœµ-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ">ì‹¤ë¬´ í”„ë¡œì íŠ¸: ì‹¤ì‹œê°„ ê¸ˆìœµ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ol>

<h2 id="cep-complex-event-processing-ê¸°ì´ˆ">ğŸ¯ CEP (Complex Event Processing) ê¸°ì´ˆ</h2>

<h3 id="cepë€-ë¬´ì—‡ì¸ê°€">CEPë€ ë¬´ì—‡ì¸ê°€?</h3>

<p>CEPëŠ” <strong>ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬</strong>ë¥¼ ì˜ë¯¸í•˜ë©°, ì‹¤ì‹œê°„ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì—¬ëŸ¬ ì´ë²¤íŠ¸ë“¤ì„ ë¶„ì„í•˜ì—¬ ì˜ë¯¸ ìˆëŠ” íŒ¨í„´ì´ë‚˜ ìƒí™©ì„ ê°ì§€í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>

<h4 id="cepì˜-í•µì‹¬-ê°œë…"><strong>CEPì˜ í•µì‹¬ ê°œë…</strong></h4>

<ol>
  <li><strong>ì´ë²¤íŠ¸ ìŠ¤íŠ¸ë¦¼</strong>: ì—°ì†ì ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ë°ì´í„°</li>
  <li><strong>íŒ¨í„´ ë§¤ì¹­</strong>: íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ì´ë²¤íŠ¸ ì‹œí€€ìŠ¤</li>
  <li><strong>ì‹œê°„ ìœˆë„ìš°</strong>: ì´ë²¤íŠ¸ ë¶„ì„ ì‹œê°„ ë²”ìœ„</li>
  <li><strong>ìƒíƒœ ê´€ë¦¬</strong>: íŒ¨í„´ ë§¤ì¹­ì„ ìœ„í•œ ìƒíƒœ ì €ì¥</li>
</ol>

<h3 id="flink-cep-ê¸°ë³¸-êµ¬ì¡°">Flink CEP ê¸°ë³¸ êµ¬ì¡°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream</span> <span class="kn">import</span> <span class="n">StreamExecutionEnvironment</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.cep</span> <span class="kn">import</span> <span class="n">CEP</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">PatternStream</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">KeyedProcessFunction</span>
<span class="kn">from</span> <span class="n">pyflink.common.typeinfo</span> <span class="kn">import</span> <span class="n">Types</span>
<span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>

<span class="k">class</span> <span class="nc">CEPBasics</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">env</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
    
    <span class="k">def</span> <span class="nf">setup_basic_cep_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸°ë³¸ CEP íŒ¨í„´ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># 1. íŒ¨í„´ ì •ì˜
</span>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">middle</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>  <span class="c1"># 10ë¶„ ë‚´ íŒ¨í„´ ë§¤ì¹­
</span>        
        <span class="c1"># 2. íŒ¨í„´ ìŠ¤íŠ¸ë¦¼ ìƒì„±
</span>        <span class="n">pattern_stream</span> <span class="o">=</span> <span class="n">CEP</span><span class="p">.</span><span class="nf">pattern</span><span class="p">(</span>
            <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">event</span><span class="p">:</span> <span class="n">event</span><span class="p">.</span><span class="n">user_id</span><span class="p">),</span>
            <span class="n">pattern</span>
        <span class="p">)</span>
        
        <span class="c1"># 3. íŒ¨í„´ ë§¤ì¹­ ê²°ê³¼ ì²˜ë¦¬
</span>        <span class="n">result_stream</span> <span class="o">=</span> <span class="n">pattern_stream</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">pattern</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">process_pattern</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">result_stream</span>
    
    <span class="k">def</span> <span class="nf">process_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒ¨í„´ ë§¤ì¹­ ê²°ê³¼ ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="n">start_event</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">middle_event</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="sh">"</span><span class="s">middle</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">end_event</span> <span class="o">=</span> <span class="n">pattern</span><span class="p">[</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">start_event</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">pattern_type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">login_to_purchase</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">end_event</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">start_event</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">end_event</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="p">}</span>
</code></pre></div></div>

<h3 id="ê³ ê¸‰-íŒ¨í„´-ì •ì˜">ê³ ê¸‰ íŒ¨í„´ ì •ì˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AdvancedPatternDefinitions</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">create_sequence_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìˆœì°¨ íŒ¨í„´ ì •ì˜</span><span class="sh">"""</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">first</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">second</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">browse</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">third</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">add_to_cart</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">fourth</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">checkout</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">hours</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
    
    <span class="k">def</span> <span class="nf">create_or_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">OR íŒ¨í„´ ì •ì˜</span><span class="sh">"""</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">action</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">view</span><span class="sh">"</span> <span class="ow">or</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">click</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
    
    <span class="k">def</span> <span class="nf">create_not_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">NOT íŒ¨í„´ ì •ì˜ (íŠ¹ì • ì´ë²¤íŠ¸ê°€ ì—†ì–´ì•¼ í•¨)</span><span class="sh">"""</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">middle</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">not_followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">blocked</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">logout</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">15</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
    
    <span class="k">def</span> <span class="nf">create_times_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë°˜ë³µ íŒ¨í„´ ì •ì˜</span><span class="sh">"""</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">repeated</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">click</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">times</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># ì •í™•íˆ 3ë²ˆ ë°˜ë³µ
</span>            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
    
    <span class="k">def</span> <span class="nf">create_greedy_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íƒìš•ì  ë§¤ì¹­ íŒ¨í„´</span><span class="sh">"""</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">greedy</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">one_or_more</span><span class="p">()</span> \
            <span class="p">.</span><span class="nf">greedy</span><span class="p">()</span>  <span class="c1"># ê°€ëŠ¥í•œ í•œ ë§ì´ ë§¤ì¹­
</span>            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
</code></pre></div></div>

<h2 id="-ê³ ê¸‰-íŒ¨í„´-ë§¤ì¹­">ğŸ” ê³ ê¸‰ íŒ¨í„´ ë§¤ì¹­</h2>

<h3 id="ì¡°ê±´ë¶€-íŒ¨í„´-ë§¤ì¹­">ì¡°ê±´ë¶€ íŒ¨í„´ ë§¤ì¹­</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.cep</span> <span class="kn">import</span> <span class="n">IterativeCondition</span><span class="p">,</span> <span class="n">SimpleCondition</span>

<span class="k">class</span> <span class="nc">ConditionalPatternMatching</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">create_conditional_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¡°ê±´ë¶€ íŒ¨í„´ ì •ì˜</span><span class="sh">"""</span>
        <span class="c1"># ë³µì¡í•œ ì¡°ê±´ì´ ìˆëŠ” íŒ¨í„´
</span>        <span class="n">pattern</span> <span class="o">=</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">start</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">UserLoginCondition</span><span class="p">())</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">middle</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">PriceRangeCondition</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">end</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">PurchaseCondition</span><span class="p">())</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">pattern</span>
    
    <span class="k">class</span> <span class="nc">UserLoginCondition</span><span class="p">(</span><span class="n">SimpleCondition</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ë¡œê·¸ì¸ ì¡°ê±´</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">value</span><span class="p">.</span><span class="n">user_id</span><span class="p">.</span><span class="nf">startswith</span><span class="p">(</span><span class="sh">"</span><span class="s">premium_</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">class</span> <span class="nc">PriceRangeCondition</span><span class="p">(</span><span class="n">SimpleCondition</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê°€ê²© ë²”ìœ„ ì¡°ê±´</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">min_price</span><span class="p">,</span> <span class="n">max_price</span><span class="p">):</span>
            <span class="n">self</span><span class="p">.</span><span class="n">min_price</span> <span class="o">=</span> <span class="n">min_price</span>
            <span class="n">self</span><span class="p">.</span><span class="n">max_price</span> <span class="o">=</span> <span class="n">max_price</span>
        
        <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">price</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">min_price</span> <span class="o">&lt;=</span> <span class="n">price</span> <span class="o">&lt;=</span> <span class="n">self</span><span class="p">.</span><span class="n">max_price</span>
    
    <span class="k">class</span> <span class="nc">PurchaseCondition</span><span class="p">(</span><span class="n">SimpleCondition</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">êµ¬ë§¤ ì¡°ê±´</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">filter</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">and</span> <span class="n">value</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></div>

<h3 id="ë™ì -íŒ¨í„´-ë§¤ì¹­">ë™ì  íŒ¨í„´ ë§¤ì¹­</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DynamicPatternMatching</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">pattern_cache</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">create_dynamic_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">pattern_type</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë™ì  íŒ¨í„´ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">pattern_type</span><span class="si">}</span><span class="sh">"</span>
        
        <span class="k">if</span> <span class="n">cache_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">pattern_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">high_value</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_high_value_pattern</span><span class="p">()</span>
            <span class="k">elif</span> <span class="n">pattern_type</span> <span class="o">==</span> <span class="sh">"</span><span class="s">frequent</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_frequent_pattern</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_default_pattern</span><span class="p">()</span>
            
            <span class="n">self</span><span class="p">.</span><span class="n">pattern_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">pattern</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">pattern_cache</span><span class="p">[</span><span class="n">cache_key</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">create_high_value_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê³ ê°€ì¹˜ êµ¬ë§¤ íŒ¨í„´</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">browse</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">and</span> 
                          <span class="n">e</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">create_frequent_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹ˆë²ˆí•œ êµ¬ë§¤ íŒ¨í„´</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">first_purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">second_purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">third_purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">hours</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">create_default_pattern</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸°ë³¸ íŒ¨í„´</span><span class="sh">"""</span>
        <span class="k">return</span> <span class="n">Pattern</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">action</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">"</span><span class="s">view</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">click</span><span class="sh">"</span><span class="p">])</span> \
            <span class="p">.</span><span class="nf">followed_by</span><span class="p">(</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="k">lambda</span> <span class="n">e</span><span class="p">:</span> <span class="n">e</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">within</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">60</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="íŒ¨í„´-ê²°ê³¼-í›„ì²˜ë¦¬">íŒ¨í„´ ê²°ê³¼ í›„ì²˜ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PatternPostProcessing</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">process_pattern_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒ¨í„´ ê²°ê³¼ í›„ì²˜ë¦¬</span><span class="sh">"""</span>
        <span class="c1"># íŒ¨í„´ì—ì„œ ì´ë²¤íŠ¸ ì¶”ì¶œ
</span>        <span class="n">events</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">extract_events</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        
        <span class="c1"># ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©
</span>        <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">apply_business_logic</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># ì•Œë¦¼ ìƒì„±
</span>        <span class="n">alert</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">generate_alert</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">pattern_result</span><span class="sh">"</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">alert</span><span class="sh">"</span><span class="p">:</span> <span class="n">alert</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="nf">int</span><span class="p">(</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">extract_events</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒ¨í„´ì—ì„œ ì´ë²¤íŠ¸ ì¶”ì¶œ</span><span class="sh">"""</span>
        <span class="n">events</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">event_list</span> <span class="ow">in</span> <span class="n">pattern</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">event_list</span><span class="p">:</span>
                <span class="n">events</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">event_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># ì²« ë²ˆì§¸ ì´ë²¤íŠ¸
</span>        <span class="k">return</span> <span class="n">events</span>
    
    <span class="k">def</span> <span class="nf">apply_business_logic</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ìš©</span><span class="sh">"""</span>
        <span class="c1"># ì‚¬ìš©ì ì„¸ì…˜ ë¶„ì„
</span>        <span class="n">session_duration</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_session_duration</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># êµ¬ë§¤ í–‰ë™ ë¶„ì„
</span>        <span class="n">purchase_behavior</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_purchase_behavior</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="c1"># ìœ„í—˜ë„ í‰ê°€
</span>        <span class="n">risk_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_risk_score</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">session_duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">session_duration</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">purchase_behavior</span><span class="sh">"</span><span class="p">:</span> <span class="n">purchase_behavior</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="n">risk_score</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">generate_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">result</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">alerts</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ìœ„í—˜ë„ ê¸°ë°˜ ì•Œë¦¼
</span>        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="n">alerts</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">high_risk</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">High risk transaction detected</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="c1"># êµ¬ë§¤ íŒ¨í„´ ê¸°ë°˜ ì•Œë¦¼
</span>        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase_behavior</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">is_abnormal</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">alerts</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">abnormal_purchase</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Abnormal purchase pattern detected</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">warning</span><span class="sh">"</span>
            <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">alerts</span>
    
    <span class="k">def</span> <span class="nf">calculate_session_duration</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì„¸ì…˜ ì§€ì† ì‹œê°„ ê³„ì‚°</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span> <span class="ow">and</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">].</span><span class="n">timestamp</span>
        <span class="k">return</span> <span class="mi">0</span>
    
    <span class="k">def</span> <span class="nf">analyze_purchase_behavior</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">êµ¬ë§¤ í–‰ë™ ë¶„ì„</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">purchase</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">purchase</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            
            <span class="c1"># ì •ìƒì ì¸ êµ¬ë§¤ íŒ¨í„´ì¸ì§€ í™•ì¸
</span>            <span class="n">is_abnormal</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">5000</span> <span class="ow">or</span> <span class="n">amount</span> <span class="o">&lt;</span> <span class="mi">10</span>  <span class="c1"># ì˜ˆì‹œ ì¡°ê±´
</span>            
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">is_abnormal</span><span class="sh">"</span><span class="p">:</span> <span class="n">is_abnormal</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span> <span class="n">purchase</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">unknown</span><span class="sh">"</span><span class="p">)</span>
            <span class="p">}</span>
        
        <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">is_abnormal</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">calculate_risk_score</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìœ„í—˜ë„ ì ìˆ˜ ê³„ì‚°</span><span class="sh">"""</span>
        <span class="n">risk_factors</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ë¹ ë¥¸ êµ¬ë§¤ (ë¡œê·¸ì¸ í›„ 5ë¶„ ì´ë‚´)
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_quick_purchase</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
            <span class="n">risk_factors</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># ë†’ì€ ê¸ˆì•¡
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_high_amount</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
            <span class="n">risk_factors</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)</span>
        
        <span class="c1"># ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_unusual_time</span><span class="p">(</span><span class="n">events</span><span class="p">):</span>
            <span class="n">risk_factors</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nf">sum</span><span class="p">(</span><span class="n">risk_factors</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">is_quick_purchase</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹ ë¥¸ êµ¬ë§¤ ì—¬ë¶€ í™•ì¸</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">login</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span> <span class="ow">and</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">].</span><span class="n">timestamp</span> <span class="o">-</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">login</span><span class="sh">"</span><span class="p">].</span><span class="n">timestamp</span>
            <span class="k">return</span> <span class="n">duration</span> <span class="o">&lt;</span> <span class="mi">300</span>  <span class="c1"># 5ë¶„ ì´ë‚´
</span>        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">is_high_amount</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë†’ì€ ê¸ˆì•¡ ì—¬ë¶€ í™•ì¸</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">amount</span> <span class="o">=</span> <span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">].</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="mi">2000</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">is_unusual_time</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">events</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹„ì •ìƒì ì¸ ì‹œê°„ëŒ€ ì—¬ë¶€ í™•ì¸</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">purchase_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">].</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="n">hour</span> <span class="o">=</span> <span class="n">purchase_time</span><span class="p">.</span><span class="n">hour</span>
            <span class="k">return</span> <span class="n">hour</span> <span class="o">&lt;</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">hour</span> <span class="o">&gt;</span> <span class="mi">23</span>  <span class="c1"># ìƒˆë²½ ì‹œê°„ëŒ€
</span>        <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<h2 id="ì‹¤ì‹œê°„-ì§‘ê³„ì™€-ìœˆë„ìš°-í•¨ìˆ˜">ğŸ“Š ì‹¤ì‹œê°„ ì§‘ê³„ì™€ ìœˆë„ìš° í•¨ìˆ˜</h2>

<h3 id="ê³ ê¸‰-ìœˆë„ìš°-ì—°ì‚°">ê³ ê¸‰ ìœˆë„ìš° ì—°ì‚°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.window</span> <span class="kn">import</span> <span class="n">TumblingEventTimeWindows</span><span class="p">,</span> <span class="n">SlidingEventTimeWindows</span><span class="p">,</span> <span class="n">SessionEventTimeWindows</span>
<span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">WindowFunction</span><span class="p">,</span> <span class="n">AllWindowFunction</span>

<span class="k">class</span> <span class="nc">AdvancedWindowOperations</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">setup_advanced_windows</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê³ ê¸‰ ìœˆë„ìš° ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># 1. íŠ¬ë¸”ë§ ìœˆë„ìš° (ê³ ì • í¬ê¸°)
</span>        <span class="n">tumbling_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">window</span><span class="p">(</span><span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span> \
            <span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">AdvancedWindowFunction</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="c1"># 2. ìŠ¬ë¼ì´ë”© ìœˆë„ìš° (ê²¹ì¹˜ëŠ” ìœˆë„ìš°)
</span>        <span class="n">sliding_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">window</span><span class="p">(</span><span class="n">SlidingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span> \
            <span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">AdvancedWindowFunction</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="c1"># 3. ì„¸ì…˜ ìœˆë„ìš° (í™œë™ ê¸°ë°˜)
</span>        <span class="n">session_window</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">window</span><span class="p">(</span><span class="n">SessionEventTimeWindows</span><span class="p">.</span><span class="nf">with_gap</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span> \
            <span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nc">AdvancedWindowFunction</span><span class="p">(),</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">tumbling</span><span class="sh">"</span><span class="p">:</span> <span class="n">tumbling_window</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">sliding</span><span class="sh">"</span><span class="p">:</span> <span class="n">sliding_window</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">session</span><span class="sh">"</span><span class="p">:</span> <span class="n">session_window</span>
        <span class="p">}</span>
    
    <span class="k">class</span> <span class="nc">AdvancedWindowFunction</span><span class="p">(</span><span class="n">WindowFunction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê³ ê¸‰ ìœˆë„ìš° í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">inputs</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="c1"># ìœˆë„ìš° ë‚´ ë°ì´í„° ë¶„ì„
</span>            <span class="n">analysis_result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">analyze_window_data</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            
            <span class="c1"># ê²°ê³¼ ìƒì„±
</span>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">event_count</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">),</span>
                <span class="sh">"</span><span class="s">analysis</span><span class="sh">"</span><span class="p">:</span> <span class="n">analysis_result</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span>
            <span class="p">}</span>
            
            <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">analyze_window_data</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">):</span>
            <span class="sh">"""</span><span class="s">ìœˆë„ìš° ë‚´ ë°ì´í„° ë¶„ì„</span><span class="sh">"""</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inputs</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">No data in window</span><span class="sh">"</span><span class="p">}</span>
            
            <span class="c1"># ê¸°ë³¸ í†µê³„
</span>            <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">action</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
            <span class="n">action_counts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
                <span class="n">action_counts</span><span class="p">[</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_counts</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="c1"># ì‹œê°„ ë¶„ì„
</span>            <span class="n">timestamps</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">timestamp</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">]</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span> <span class="o">-</span> <span class="nf">min</span><span class="p">(</span><span class="n">timestamps</span><span class="p">)</span>
            
            <span class="c1"># ê¸ˆì•¡ ë¶„ì„ (êµ¬ë§¤ ì´ë²¤íŠ¸ê°€ ìˆëŠ” ê²½ìš°)
</span>            <span class="n">amounts</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">inputs</span> 
                      <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">total_amount</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">amounts</span><span class="p">)</span>
            <span class="n">avg_amount</span> <span class="o">=</span> <span class="n">total_amount</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">amounts</span><span class="p">)</span> <span class="k">if</span> <span class="n">amounts</span> <span class="k">else</span> <span class="mi">0</span>
            
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">:</span> <span class="n">action_counts</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">session_duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">total_purchase_amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">total_amount</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">average_purchase_amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">avg_amount</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">purchase_count</span><span class="sh">"</span><span class="p">:</span> <span class="nf">len</span><span class="p">(</span><span class="n">amounts</span><span class="p">)</span>
            <span class="p">}</span>
</code></pre></div></div>

<h3 id="ì‹¤ì‹œê°„-ì§‘ê³„-ì—”ì§„">ì‹¤ì‹œê°„ ì§‘ê³„ ì—”ì§„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeAggregationEngine</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">aggregation_state</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">def</span> <span class="nf">setup_real_time_aggregations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">data_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ì§‘ê³„ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># 1. ì‚¬ìš©ìë³„ ì‹¤ì‹œê°„ ì§‘ê³„
</span>        <span class="n">user_aggregations</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">window</span><span class="p">(</span><span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> \
            <span class="p">.</span><span class="nf">aggregate</span><span class="p">(</span>
                <span class="n">self</span><span class="p">.</span><span class="nc">UserAggregateFunction</span><span class="p">(),</span>
                <span class="n">self</span><span class="p">.</span><span class="nc">UserWindowFunction</span><span class="p">(),</span>
                <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">()</span>
            <span class="p">)</span>
        
        <span class="c1"># 2. ê¸€ë¡œë²Œ ì‹¤ì‹œê°„ ì§‘ê³„
</span>        <span class="n">global_aggregations</span> <span class="o">=</span> <span class="n">data_stream</span><span class="p">.</span><span class="nf">window_all</span><span class="p">(</span>
            <span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">).</span><span class="nf">aggregate</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="nc">GlobalAggregateFunction</span><span class="p">(),</span>
            <span class="n">self</span><span class="p">.</span><span class="nc">GlobalWindowFunction</span><span class="p">(),</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">user_aggregations</span><span class="sh">"</span><span class="p">:</span> <span class="n">user_aggregations</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">global_aggregations</span><span class="sh">"</span><span class="p">:</span> <span class="n">global_aggregations</span>
        <span class="p">}</span>
    
    <span class="k">class</span> <span class="nc">UserAggregateFunction</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ì§‘ê³„ í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">create_accumulator</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">event_count</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">first_timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">last_timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span>
            <span class="p">}</span>
        
        <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">event_count</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
            
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">][</span><span class="n">value</span><span class="p">.</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">action</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">first_timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">first_timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
            
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">last_timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
            
            <span class="k">return</span> <span class="n">accumulator</span>
        
        <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">accumulator</span>
    
    <span class="k">class</span> <span class="nc">UserWindowFunction</span><span class="p">(</span><span class="n">WindowFunction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ìœˆë„ìš° í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">input</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_empty_result</span><span class="p">()</span>
            
            <span class="c1"># ìœˆë„ìš° ë©”íƒ€ë°ì´í„° ì¶”ê°€
</span>            <span class="n">result</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span>
            <span class="p">})</span>
            
            <span class="c1"># íŒŒìƒ ì§€í‘œ ê³„ì‚°
</span>            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">events_per_minute</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">event_count</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="nf">max</span><span class="p">(</span>
                <span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">last_timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="o">-</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">first_timestamp</span><span class="sh">"</span><span class="p">])</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>
            
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">average_purchase_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">create_empty_result</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">event_count</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">action_counts</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">first_timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">last_timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">events_per_minute</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">average_purchase_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="p">}</span>
    
    <span class="k">class</span> <span class="nc">GlobalAggregateFunction</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ê¸€ë¡œë²Œ ì§‘ê³„ í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">create_accumulator</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">:</span> <span class="nf">set</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">timestamp_range</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">]</span>
            <span class="p">}</span>
        
        <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">value</span><span class="p">.</span><span class="n">action</span> <span class="o">==</span> <span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">amount</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>
            
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">][</span><span class="n">value</span><span class="p">.</span><span class="n">action</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">action</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp_range</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp_range</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
            
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp_range</span><span class="sh">"</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">timestamp</span>
            
            <span class="k">return</span> <span class="n">accumulator</span>
        
        <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">):</span>
            <span class="c1"># setì„ listë¡œ ë³€í™˜ (ì§ë ¬í™” ê°€ëŠ¥í•˜ë„ë¡)
</span>            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">accumulator</span>
    
    <span class="k">class</span> <span class="nc">GlobalWindowFunction</span><span class="p">(</span><span class="n">AllWindowFunction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸€ë¡œë²Œ ìœˆë„ìš° í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">input</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_empty_global_result</span><span class="p">()</span>
            
            <span class="c1"># ìœˆë„ìš° ë©”íƒ€ë°ì´í„° ì¶”ê°€
</span>            <span class="n">result</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_duration</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span> <span class="o">-</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span>
            <span class="p">})</span>
            
            <span class="c1"># íŒŒìƒ ì§€í‘œ ê³„ì‚°
</span>            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">events_per_second</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="nf">max</span><span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">window_duration</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span>
            <span class="p">)</span>
            
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">revenue_per_user</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">conversion_rate</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> 
                <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">]</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">create_empty_global_result</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">total_events</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="sh">"</span><span class="s">total_revenue</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">action_distribution</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">timestamp_range</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">events_per_second</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">revenue_per_user</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">conversion_rate</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="p">}</span>
</code></pre></div></div>

<h2 id="ì‹¤ì‹œê°„-ëŒ€ì‹œë³´ë“œ-êµ¬ì¶•">ğŸ“ˆ ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</h2>

<h3 id="grafana-ì—°ë™-ëŒ€ì‹œë³´ë“œ">Grafana ì—°ë™ ëŒ€ì‹œë³´ë“œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">json</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">GrafanaDashboardManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">grafana_url</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">grafana_url</span> <span class="o">=</span> <span class="n">grafana_url</span>
        <span class="n">self</span><span class="p">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="n">self</span><span class="p">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">Authorization</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Bearer </span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">Content-Type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">application/json</span><span class="sh">"</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">create_real_time_dashboard</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">dashboard_config</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">dashboard</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">dashboard</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="n">dashboard_config</span><span class="p">[</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">panels</span><span class="sh">"</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_panels</span><span class="p">(</span><span class="n">dashboard_config</span><span class="p">[</span><span class="sh">"</span><span class="s">metrics</span><span class="sh">"</span><span class="p">]),</span>
                <span class="sh">"</span><span class="s">time</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">from</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">now-1h</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">to</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">now</span><span class="sh">"</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">refresh</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">5s</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">timezone</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">browser</span><span class="sh">"</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span>
            <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">grafana_url</span><span class="si">}</span><span class="s">/api/dashboards/db</span><span class="sh">"</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">dashboard</span>
        <span class="p">)</span>
        
        <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nc">Exception</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to create dashboard: </span><span class="si">{</span><span class="n">response</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_panels</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">metrics_config</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒ¨ë„ ìƒì„±</span><span class="sh">"""</span>
        <span class="n">panels</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">metric</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">metrics_config</span><span class="p">):</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">[</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">[</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">targets</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="sh">"</span><span class="s">expr</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">[</span><span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">],</span>
                        <span class="sh">"</span><span class="s">refId</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">A</span><span class="sh">"</span>
                    <span class="p">}</span>
                <span class="p">],</span>
                <span class="sh">"</span><span class="s">gridPos</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">h</span><span class="sh">"</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">x</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">12</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">:</span> <span class="p">(</span><span class="n">i</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">yAxes</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="sh">"</span><span class="s">label</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">),</span>
                        <span class="sh">"</span><span class="s">min</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
            
            <span class="c1"># íŒ¨ë„ íƒ€ì…ë³„ íŠ¹ë³„ ì„¤ì •
</span>            <span class="k">if</span> <span class="n">metric</span><span class="p">[</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">panel</span><span class="p">[</span><span class="sh">"</span><span class="s">fieldConfig</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">defaults</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">mode</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">thresholds</span><span class="sh">"</span><span class="p">},</span>
                        <span class="sh">"</span><span class="s">thresholds</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                            <span class="sh">"</span><span class="s">steps</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                                <span class="p">{</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">green</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="bp">None</span><span class="p">},</span>
                                <span class="p">{</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">yellow</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">,</span> <span class="mi">100</span><span class="p">)},</span>
                                <span class="p">{</span><span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">red</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">metric</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">,</span> <span class="mi">200</span><span class="p">)}</span>
                            <span class="p">]</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">metric</span><span class="p">[</span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">table</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">panel</span><span class="p">[</span><span class="sh">"</span><span class="s">targets</span><span class="sh">"</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="sh">"</span><span class="s">format</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="sh">"</span><span class="s">table</span><span class="sh">"</span>
            
            <span class="n">panels</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">panels</span>
    
    <span class="k">def</span> <span class="nf">setup_flink_metrics_dashboard</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Flink ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ ì„¤ì •</span><span class="sh">"""</span>
        <span class="n">metrics_config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Total Events per Second</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_taskmanager_job_task_operator_numRecordsInPerSecond</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Events/sec</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5000</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Average Latency</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_taskmanager_job_task_operator_latency</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ms</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Backpressure</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_taskmanager_job_task_backPressuredTimeMsPerSecond</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ms/sec</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Checkpoint Duration</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_jobmanager_job_lastCheckpointDuration</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">ms</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">30000</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Memory Usage</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_taskmanager_Status_JVM_Memory_Heap_Used</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">bytes</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1073741824</span><span class="p">,</span>  <span class="c1"># 1GB
</span>                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2147483648</span>   <span class="c1"># 2GB
</span>            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Event Timeline</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">timeseries</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">flink_taskmanager_job_task_operator_numRecordsInPerSecond</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Events/sec</span><span class="sh">"</span>
            <span class="p">}</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_real_time_dashboard</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Apache Flink Real-time Metrics</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">metrics</span><span class="sh">"</span><span class="p">:</span> <span class="n">metrics_config</span>
        <span class="p">})</span>
    
    <span class="k">def</span> <span class="nf">create_business_metrics_dashboard</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë¹„ì¦ˆë‹ˆìŠ¤ ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ ì„¤ì •</span><span class="sh">"""</span>
        <span class="n">metrics_config</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Total Revenue</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">sum(purchase_amount)</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">$</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">50000</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Conversion Rate</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">purchase_events / total_events * 100</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mf">5.0</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Active Users</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">count(distinct user_id)</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Users</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">500</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Average Session Duration</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">stat</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">avg(session_duration)</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">seconds</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">warning_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">critical_threshold</span><span class="sh">"</span><span class="p">:</span> <span class="mi">600</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Revenue Trend</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">timeseries</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">sum(purchase_amount)</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">$</span><span class="sh">"</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Top Categories</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">table</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">topk(10, sum(purchase_amount) by category)</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">y_axis_label</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Revenue</span><span class="sh">"</span>
            <span class="p">}</span>
        <span class="p">]</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_real_time_dashboard</span><span class="p">({</span>
            <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Business Metrics Dashboard</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">metrics</span><span class="sh">"</span><span class="p">:</span> <span class="n">metrics_config</span>
        <span class="p">})</span>
</code></pre></div></div>

<h3 id="ì‹¤ì‹œê°„-ì•Œë¦¼-ì‹œìŠ¤í…œ">ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeAlertingSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_rules</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_history</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">setup_alert_rules</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ ê·œì¹™ ì„¤ì •</span><span class="sh">"""</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alert_rules</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">high_latency</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">latency</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">High latency detected: {latency}ms</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">slack</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">low_throughput</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">throughput</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">warning</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Low throughput detected: {throughput} events/sec</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">slack</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">high_error_rate</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">error_rate</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">High error rate detected: {error_rate}%</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">slack</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pagerduty</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">memory_usage_high</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">memory_usage</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">warning</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">High memory usage: {memory_usage}%</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">slack</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">checkpoint_failure</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">metrics</span><span class="p">:</span> <span class="n">metrics</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpoint_failures</span><span class="sh">"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Checkpoint failures detected: {checkpoint_failures}</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pagerduty</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">evaluate_alerts</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">metrics</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ í‰ê°€</span><span class="sh">"""</span>
        <span class="n">active_alerts</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">rule_name</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">alert_rules</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">rule</span><span class="p">[</span><span class="sh">"</span><span class="s">condition</span><span class="sh">"</span><span class="p">](</span><span class="n">metrics</span><span class="p">):</span>
                <span class="n">alert</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">rule_name</span><span class="sh">"</span><span class="p">:</span> <span class="n">rule_name</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="n">rule</span><span class="p">[</span><span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">],</span>
                    <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="n">rule</span><span class="p">[</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">].</span><span class="nf">format</span><span class="p">(</span><span class="o">**</span><span class="n">metrics</span><span class="p">),</span>
                    <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">isoformat</span><span class="p">(),</span>
                    <span class="sh">"</span><span class="s">metrics</span><span class="sh">"</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">:</span> <span class="n">rule</span><span class="p">[</span><span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">]</span>
                <span class="p">}</span>
                
                <span class="c1"># ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€ (5ë¶„ ë‚´ ë™ì¼í•œ ì•Œë¦¼ ì œí•œ)
</span>                <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="nf">is_duplicate_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">):</span>
                    <span class="n">active_alerts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">send_notifications</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">alert_history</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">active_alerts</span>
    
    <span class="k">def</span> <span class="nf">is_duplicate_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¤‘ë³µ ì•Œë¦¼ í™•ì¸</span><span class="sh">"""</span>
        <span class="n">recent_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">timestamp</span><span class="p">()</span> <span class="o">-</span> <span class="mi">300</span>  <span class="c1"># 5ë¶„ ì „
</span>        
        <span class="k">for</span> <span class="n">historical_alert</span> <span class="ow">in</span> <span class="nf">reversed</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">alert_history</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">historical_alert</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">recent_time</span><span class="p">:</span>
                <span class="k">break</span>
            
            <span class="nf">if </span><span class="p">(</span><span class="n">historical_alert</span><span class="p">[</span><span class="sh">"</span><span class="s">rule_name</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">rule_name</span><span class="sh">"</span><span class="p">]</span> <span class="ow">and</span>
                <span class="n">historical_alert</span><span class="p">[</span><span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">]):</span>
                <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">send_notifications</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">notification_channels</span><span class="sh">"</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">channel</span> <span class="o">==</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_email_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="sh">"</span><span class="s">slack</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_slack_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">channel</span> <span class="o">==</span> <span class="sh">"</span><span class="s">pagerduty</span><span class="sh">"</span><span class="p">:</span>
                <span class="n">self</span><span class="p">.</span><span class="nf">send_pagerduty_alert</span><span class="p">(</span><span class="n">alert</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_email_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì´ë©”ì¼ ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” SMTP ë˜ëŠ” ì´ë©”ì¼ ì„œë¹„ìŠ¤ API ì‚¬ìš©
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">EMAIL ALERT [</span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s">]: </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_slack_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Slack ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” Slack Webhook API ì‚¬ìš©
</span>        <span class="n">color</span> <span class="o">=</span> <span class="sh">"</span><span class="s">danger</span><span class="sh">"</span> <span class="k">if</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">]</span> <span class="o">==</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span> <span class="k">else</span> <span class="sh">"</span><span class="s">warning</span><span class="sh">"</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">attachments</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="sh">"</span><span class="s">color</span><span class="sh">"</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Flink Alert: </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="sh">'</span><span class="s">rule_name</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">text</span><span class="sh">"</span><span class="p">:</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">],</span>
                    <span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Severity</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">},</span>
                        <span class="p">{</span><span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">alert</span><span class="p">[</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">],</span> <span class="sh">"</span><span class="s">short</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">SLACK ALERT: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send_pagerduty_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">alert</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">PagerDuty ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="c1"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” PagerDuty API ì‚¬ìš©
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">PAGERDUTY ALERT [</span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="sh">'</span><span class="s">severity</span><span class="sh">'</span><span class="p">].</span><span class="nf">upper</span><span class="p">()</span><span class="si">}</span><span class="s">]: </span><span class="si">{</span><span class="n">alert</span><span class="p">[</span><span class="sh">'</span><span class="s">message</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="ì‹¤ë¬´-í”„ë¡œì íŠ¸-ì‹¤ì‹œê°„-ê¸ˆìœµ-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ">ğŸš€ ì‹¤ë¬´ í”„ë¡œì íŠ¸: ì‹¤ì‹œê°„ ê¸ˆìœµ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</h2>

<h3 id="í”„ë¡œì íŠ¸-ê°œìš”">í”„ë¡œì íŠ¸ ê°œìš”</h3>

<p>ê¸ˆìœµ ê±°ë˜ ë°ì´í„°ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ ì´ìƒ ê±°ë˜ íŒ¨í„´ì„ ê°ì§€í•˜ê³ , ë¦¬ìŠ¤í¬ë¥¼ í‰ê°€í•˜ëŠ” ì‹œìŠ¤í…œì„ êµ¬ì¶•í•©ë‹ˆë‹¤.</p>

<h3 id="1-ê¸ˆìœµ-ë°ì´í„°-ëª¨ë¸">1. ê¸ˆìœµ ë°ì´í„° ëª¨ë¸</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="n">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span> <span class="n">json</span>

<span class="k">class</span> <span class="nc">TransactionType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">DEPOSIT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">deposit</span><span class="sh">"</span>
    <span class="n">WITHDRAWAL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">withdrawal</span><span class="sh">"</span>
    <span class="n">TRANSFER</span> <span class="o">=</span> <span class="sh">"</span><span class="s">transfer</span><span class="sh">"</span>
    <span class="n">PAYMENT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">payment</span><span class="sh">"</span>
    <span class="n">INVESTMENT</span> <span class="o">=</span> <span class="sh">"</span><span class="s">investment</span><span class="sh">"</span>

<span class="k">class</span> <span class="nc">RiskLevel</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="sh">"</span><span class="s">low</span><span class="sh">"</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="sh">"</span><span class="s">medium</span><span class="sh">"</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="sh">"</span><span class="s">high</span><span class="sh">"</span>
    <span class="n">CRITICAL</span> <span class="o">=</span> <span class="sh">"</span><span class="s">critical</span><span class="sh">"</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">FinancialTransaction</span><span class="p">:</span>
    <span class="n">transaction_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">account_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">transaction_type</span><span class="p">:</span> <span class="n">TransactionType</span>
    <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">currency</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">merchant_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>  <span class="c1"># latitude, longitude
</span>    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span>
    
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">'</span><span class="s">transaction_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">user_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">account_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">account_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">transaction_type</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">amount</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">currency</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">currency</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">merchant_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">merchant_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">location</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">location</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">metadata</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">metadata</span>
        <span class="p">})</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">json_str</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">json_str</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">transaction_type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="nc">TransactionType</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">transaction_type</span><span class="sh">'</span><span class="p">])</span>
        <span class="k">return</span> <span class="nf">cls</span><span class="p">(</span><span class="o">**</span><span class="n">data</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">RiskAssessment</span><span class="p">:</span>
    <span class="n">transaction_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">risk_level</span><span class="p">:</span> <span class="n">RiskLevel</span>
    <span class="n">risk_score</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">risk_factors</span><span class="p">:</span> <span class="nb">list</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">recommendation</span><span class="p">:</span> <span class="nb">str</span>
    
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">({</span>
            <span class="sh">'</span><span class="s">transaction_id</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">risk_level</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">risk_level</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">risk_score</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">risk_score</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">risk_factors</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">risk_factors</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">timestamp</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">recommendation</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">recommendation</span>
        <span class="p">})</span>
</code></pre></div></div>

<h3 id="2-ì‹¤ì‹œê°„-ì´ìƒ-ê±°ë˜-ê°ì§€">2. ì‹¤ì‹œê°„ ì´ìƒ ê±°ë˜ ê°ì§€</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">KeyedProcessFunction</span>
<span class="kn">from</span> <span class="n">pyflink.common.state</span> <span class="kn">import</span> <span class="n">ValueStateDescriptor</span><span class="p">,</span> <span class="n">MapStateDescriptor</span><span class="p">,</span> <span class="n">ListStateDescriptor</span>
<span class="kn">from</span> <span class="n">pyflink.common.typeinfo</span> <span class="kn">import</span> <span class="n">Types</span>
<span class="kn">import</span> <span class="n">math</span>

<span class="k">class</span> <span class="nc">FraudDetectionEngine</span><span class="p">(</span><span class="n">KeyedProcessFunction</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_transaction_history</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_behavior_profile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">location_history</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">self</span><span class="p">.</span><span class="n">velocity_checker</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">runtime_context</span><span class="p">):</span>
        <span class="c1"># ì‚¬ìš©ì ê±°ë˜ íˆìŠ¤í† ë¦¬
</span>        <span class="n">self</span><span class="p">.</span><span class="n">user_transaction_history</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_list_state</span><span class="p">(</span>
            <span class="nc">ListStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">transaction_history</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        
        <span class="c1"># ì‚¬ìš©ì í–‰ë™ í”„ë¡œíŒŒì¼
</span>        <span class="n">self</span><span class="p">.</span><span class="n">user_behavior_profile</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_state</span><span class="p">(</span>
            <span class="nc">ValueStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">behavior_profile</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        
        <span class="c1"># ìœ„ì¹˜ íˆìŠ¤í† ë¦¬
</span>        <span class="n">self</span><span class="p">.</span><span class="n">location_history</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_list_state</span><span class="p">(</span>
            <span class="nc">ListStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">location_history</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">())</span>
        <span class="p">)</span>
        
        <span class="c1"># ì†ë„ ê²€ì‚¬ê¸°
</span>        <span class="n">self</span><span class="p">.</span><span class="n">velocity_checker</span> <span class="o">=</span> <span class="n">runtime_context</span><span class="p">.</span><span class="nf">get_map_state</span><span class="p">(</span>
            <span class="nc">MapStateDescriptor</span><span class="p">(</span><span class="sh">"</span><span class="s">velocity_checker</span><span class="sh">"</span><span class="p">,</span> <span class="n">Types</span><span class="p">.</span><span class="nc">STRING</span><span class="p">(),</span> <span class="n">Types</span><span class="p">.</span><span class="nc">INT</span><span class="p">())</span>
        <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_element</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">,</span> <span class="n">ctx</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ì´ìƒ ê±°ë˜ ê°ì§€</span><span class="sh">"""</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">user_id</span>
        
        <span class="c1"># 1. ì†ë„ ê²€ì‚¬ (Velocity Check)
</span>        <span class="n">velocity_risk</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_velocity</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># 2. ìœ„ì¹˜ ê¸°ë°˜ ê²€ì‚¬ (Location-based Check)
</span>        <span class="n">location_risk</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_location_anomaly</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># 3. ê¸ˆì•¡ ê¸°ë°˜ ê²€ì‚¬ (Amount-based Check)
</span>        <span class="n">amount_risk</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_amount_anomaly</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># 4. íŒ¨í„´ ê¸°ë°˜ ê²€ì‚¬ (Pattern-based Check)
</span>        <span class="n">pattern_risk</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_pattern_anomaly</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># 5. ì‹œê°„ ê¸°ë°˜ ê²€ì‚¬ (Time-based Check)
</span>        <span class="n">time_risk</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">check_time_anomaly</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># ì¢…í•© ìœ„í—˜ë„ ê³„ì‚°
</span>        <span class="n">risk_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_comprehensive_risk_score</span><span class="p">([</span>
            <span class="n">velocity_risk</span><span class="p">,</span> <span class="n">location_risk</span><span class="p">,</span> <span class="n">amount_risk</span><span class="p">,</span> <span class="n">pattern_risk</span><span class="p">,</span> <span class="n">time_risk</span>
        <span class="p">])</span>
        
        <span class="c1"># ìœ„í—˜ë„ ë ˆë²¨ ê²°ì •
</span>        <span class="n">risk_level</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">determine_risk_level</span><span class="p">(</span><span class="n">risk_score</span><span class="p">)</span>
        
        <span class="c1"># ìœ„í—˜ í‰ê°€ ê²°ê³¼ ìƒì„±
</span>        <span class="n">risk_assessment</span> <span class="o">=</span> <span class="nc">RiskAssessment</span><span class="p">(</span>
            <span class="n">transaction_id</span><span class="o">=</span><span class="n">transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
            <span class="n">risk_level</span><span class="o">=</span><span class="n">risk_level</span><span class="p">,</span>
            <span class="n">risk_score</span><span class="o">=</span><span class="n">risk_score</span><span class="p">,</span>
            <span class="n">risk_factors</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">collect_risk_factors</span><span class="p">([</span>
                <span class="n">velocity_risk</span><span class="p">,</span> <span class="n">location_risk</span><span class="p">,</span> <span class="n">amount_risk</span><span class="p">,</span> <span class="n">pattern_risk</span><span class="p">,</span> <span class="n">time_risk</span>
            <span class="p">]),</span>
            <span class="n">timestamp</span><span class="o">=</span><span class="n">transaction</span><span class="p">.</span><span class="n">timestamp</span><span class="p">,</span>
            <span class="n">recommendation</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="nf">generate_recommendation</span><span class="p">(</span><span class="n">risk_level</span><span class="p">,</span> <span class="n">risk_score</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="c1"># ìƒíƒœ ì—…ë°ì´íŠ¸
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">update_user_state</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
        
        <span class="c1"># ê²°ê³¼ ì¶œë ¥
</span>        <span class="n">ctx</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">risk_assessment</span><span class="p">)</span>
        
        <span class="c1"># ë†’ì€ ìœ„í—˜ë„ì¸ ê²½ìš° ì¦‰ì‹œ ì•Œë¦¼
</span>        <span class="k">if</span> <span class="n">risk_level</span> <span class="ow">in</span> <span class="p">[</span><span class="n">RiskLevel</span><span class="p">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">send_immediate_alert</span><span class="p">(</span><span class="n">risk_assessment</span><span class="p">,</span> <span class="n">transaction</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">check_velocity</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì†ë„ ê²€ì‚¬ (ë‹¨ì‹œê°„ ë‚´ ë‹¤ìˆ˜ ê±°ë˜)</span><span class="sh">"""</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="n">transaction_type</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span>
        
        <span class="c1"># ì‹œê°„ ìœˆë„ìš°ë³„ ê±°ë˜ íšŸìˆ˜ í™•ì¸
</span>        <span class="n">time_windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">300</span><span class="p">,</span> <span class="mi">900</span><span class="p">,</span> <span class="mi">3600</span><span class="p">]</span>  <span class="c1"># 5ë¶„, 15ë¶„, 1ì‹œê°„
</span>        <span class="n">velocity_risks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">time_windows</span><span class="p">:</span>
            <span class="n">window_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">transaction_type</span><span class="si">}</span><span class="s">_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="sh">"</span>
            <span class="n">recent_count</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">velocity_checker</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">window_key</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span>
            
            <span class="c1"># ìœˆë„ìš°ë³„ ì„ê³„ê°’ ì„¤ì •
</span>            <span class="n">thresholds</span> <span class="o">=</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">withdrawal</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">transfer</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">payment</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
            <span class="p">}</span>
            
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">transaction_type</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">])[</span><span class="n">time_windows</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="n">window</span><span class="p">)]</span>
            
            <span class="k">if</span> <span class="n">recent_count</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">:</span>
                <span class="n">velocity_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">high_velocity</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">window</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">:</span> <span class="n">recent_count</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">threshold</span><span class="sh">"</span><span class="p">:</span> <span class="n">threshold</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="nf">min</span><span class="p">((</span><span class="n">recent_count</span> <span class="o">/</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="p">})</span>
            
            <span class="c1"># ì¹´ìš´í„° ì—…ë°ì´íŠ¸ (ì‹¤ì œë¡œëŠ” ì‹œê°„ ê¸°ë°˜ ì •ë¦¬ í•„ìš”)
</span>            <span class="n">self</span><span class="p">.</span><span class="n">velocity_checker</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">window_key</span><span class="p">,</span> <span class="n">recent_count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">velocity_risks</span>
    
    <span class="k">def</span> <span class="nf">check_location_anomaly</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìœ„ì¹˜ ê¸°ë°˜ ì´ìƒ ê²€ì‚¬</span><span class="sh">"""</span>
        <span class="n">location_risks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ìƒˆë¡œìš´ ìœ„ì¹˜ì¸ì§€ í™•ì¸
</span>        <span class="n">transaction_location</span> <span class="o">=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">location</span>
        <span class="n">location_history</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">location_history</span><span class="p">.</span><span class="nf">get</span><span class="p">())</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">location_history</span><span class="p">:</span>
            <span class="c1"># ì²« ê±°ë˜ì¸ ê²½ìš°
</span>            <span class="n">self</span><span class="p">.</span><span class="n">location_history</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">transaction_location</span><span class="p">))</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># ê±°ë¦¬ ê³„ì‚°
</span>        <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">historical_location_str</span> <span class="ow">in</span> <span class="n">location_history</span><span class="p">:</span>
            <span class="n">historical_location</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">historical_location_str</span><span class="p">)</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">calculate_distance</span><span class="p">(</span><span class="n">transaction_location</span><span class="p">,</span> <span class="n">historical_location</span><span class="p">)</span>
            <span class="n">distances</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">distance</span><span class="p">)</span>
        
        <span class="n">min_distance</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="k">if</span> <span class="n">distances</span> <span class="k">else</span> <span class="nf">float</span><span class="p">(</span><span class="sh">'</span><span class="s">inf</span><span class="sh">'</span><span class="p">)</span>
        
        <span class="c1"># ì´ìƒì ì¸ ìœ„ì¹˜ íŒì •
</span>        <span class="k">if</span> <span class="n">min_distance</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>  <span class="c1"># 100km ì´ìƒ
</span>            <span class="n">location_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">unusual_location</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">distance_from_last</span><span class="sh">"</span><span class="p">:</span> <span class="n">min_distance</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">min_distance</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
            <span class="p">})</span>
        
        <span class="c1"># ìœ„ì¹˜ íˆìŠ¤í† ë¦¬ ì—…ë°ì´íŠ¸
</span>        <span class="n">self</span><span class="p">.</span><span class="n">location_history</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">transaction_location</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">location_risks</span>
    
    <span class="k">def</span> <span class="nf">check_amount_anomaly</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸ˆì•¡ ê¸°ë°˜ ì´ìƒ ê²€ì‚¬</span><span class="sh">"""</span>
        <span class="n">amount_risks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ì‚¬ìš©ì í‰ê·  ê±°ë˜ ê¸ˆì•¡ê³¼ ë¹„êµ
</span>        <span class="n">user_profile</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_behavior_profile</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">user_profile</span> <span class="ow">and</span> <span class="sh">"</span><span class="s">average_amount</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">:</span>
            <span class="n">avg_amount</span> <span class="o">=</span> <span class="n">user_profile</span><span class="p">[</span><span class="sh">"</span><span class="s">average_amount</span><span class="sh">"</span><span class="p">]</span>
            <span class="n">std_amount</span> <span class="o">=</span> <span class="n">user_profile</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">std_amount</span><span class="sh">"</span><span class="p">,</span> <span class="n">avg_amount</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
            
            <span class="c1"># Z-score ê³„ì‚°
</span>            <span class="n">z_score</span> <span class="o">=</span> <span class="nf">abs</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">amount</span> <span class="o">-</span> <span class="n">avg_amount</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_amount</span>
            
            <span class="k">if</span> <span class="n">z_score</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>  <span class="c1"># 3ì‹œê·¸ë§ˆ ì´ìƒ
</span>                <span class="n">amount_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">unusual_amount</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">average_amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">avg_amount</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">z_score</span><span class="sh">"</span><span class="p">:</span> <span class="n">z_score</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="nf">min</span><span class="p">(</span><span class="n">z_score</span> <span class="o">/</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">amount_risks</span>
    
    <span class="k">def</span> <span class="nf">check_pattern_anomaly</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">íŒ¨í„´ ê¸°ë°˜ ì´ìƒ ê²€ì‚¬</span><span class="sh">"""</span>
        <span class="n">pattern_risks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># ê±°ë˜ ì‹œê°„ íŒ¨í„´ í™•ì¸
</span>        <span class="n">transaction_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="n">hour</span> <span class="o">=</span> <span class="n">transaction_time</span><span class="p">.</span><span class="n">hour</span>
        
        <span class="n">user_profile</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_behavior_profile</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">user_profile</span> <span class="ow">and</span> <span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">:</span>
            <span class="n">typical_hours</span> <span class="o">=</span> <span class="n">user_profile</span><span class="p">[</span><span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">hour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typical_hours</span><span class="p">:</span>
                <span class="n">pattern_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">unusual_time</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">hour</span><span class="sh">"</span><span class="p">:</span> <span class="n">hour</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span><span class="p">:</span> <span class="n">typical_hours</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span>
                <span class="p">})</span>
        
        <span class="c1"># ê±°ë˜ ìœ í˜• íŒ¨í„´ í™•ì¸
</span>        <span class="k">if</span> <span class="n">user_profile</span> <span class="ow">and</span> <span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">:</span>
            <span class="n">typical_types</span> <span class="o">=</span> <span class="n">user_profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">]</span>
            
            <span class="k">if</span> <span class="n">transaction</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">typical_types</span><span class="p">:</span>
                <span class="n">pattern_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">unusual_transaction_type</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">transaction_type</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">typical_types</span><span class="sh">"</span><span class="p">:</span> <span class="n">typical_types</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.4</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">pattern_risks</span>
    
    <span class="k">def</span> <span class="nf">check_time_anomaly</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹œê°„ ê¸°ë°˜ ì´ìƒ ê²€ì‚¬</span><span class="sh">"""</span>
        <span class="n">time_risks</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="n">transaction_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
        
        <span class="c1"># ìƒˆë²½ ì‹œê°„ëŒ€ ê±°ë˜ (2AM - 6AM)
</span>        <span class="k">if</span> <span class="mi">2</span> <span class="o">&lt;=</span> <span class="n">transaction_time</span><span class="p">.</span><span class="n">hour</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">time_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">late_night_transaction</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">hour</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction_time</span><span class="p">.</span><span class="n">hour</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.2</span>
            <span class="p">})</span>
        
        <span class="c1"># ì£¼ë§ ê±°ë˜ íŒ¨í„´ í™•ì¸
</span>        <span class="k">if</span> <span class="n">transaction_time</span><span class="p">.</span><span class="nf">weekday</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>  <span class="c1"># í† ìš”ì¼, ì¼ìš”ì¼
</span>            <span class="n">user_profile</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_behavior_profile</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">user_profile</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">user_profile</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">"</span><span class="s">weekend_activity</span><span class="sh">"</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
                <span class="n">time_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">weekend_unusual_activity</span><span class="sh">"</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">weekday</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction_time</span><span class="p">.</span><span class="nf">weekday</span><span class="p">(),</span>
                    <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.3</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">time_risks</span>
    
    <span class="k">def</span> <span class="nf">calculate_comprehensive_risk_score</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">risk_factors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¢…í•© ìœ„í—˜ë„ ì ìˆ˜ ê³„ì‚°</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">risk_factors</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        
        <span class="c1"># ê° ìœ„í—˜ ìš”ì†Œì˜ ìµœëŒ€ ì ìˆ˜ ì‚¬ìš©
</span>        <span class="n">max_risks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">risk_list</span> <span class="ow">in</span> <span class="n">risk_factors</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">risk_list</span><span class="p">:</span>
                <span class="n">max_risk_score</span> <span class="o">=</span> <span class="nf">max</span><span class="p">([</span><span class="n">risk</span><span class="p">[</span><span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">]</span> <span class="k">for</span> <span class="n">risk</span> <span class="ow">in</span> <span class="n">risk_list</span><span class="p">])</span>
                <span class="n">max_risks</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">max_risk_score</span><span class="p">)</span>
        
        <span class="c1"># ê°€ì¤‘ í‰ê·  ê³„ì‚°
</span>        <span class="k">if</span> <span class="n">max_risks</span><span class="p">:</span>
            <span class="k">return</span> <span class="nf">sum</span><span class="p">(</span><span class="n">max_risks</span><span class="p">)</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">max_risks</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="mf">0.0</span>
    
    <span class="k">def</span> <span class="nf">determine_risk_level</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">risk_score</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìœ„í—˜ë„ ë ˆë²¨ ê²°ì •</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">risk_score</span> <span class="o">&gt;=</span> <span class="mf">0.8</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">CRITICAL</span>
        <span class="k">elif</span> <span class="n">risk_score</span> <span class="o">&gt;=</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">HIGH</span>
        <span class="k">elif</span> <span class="n">risk_score</span> <span class="o">&gt;=</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">MEDIUM</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">LOW</span>
    
    <span class="k">def</span> <span class="nf">collect_risk_factors</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">risk_factors</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ìœ„í—˜ ìš”ì†Œ ìˆ˜ì§‘</span><span class="sh">"""</span>
        <span class="n">all_factors</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">risk_list</span> <span class="ow">in</span> <span class="n">risk_factors</span><span class="p">:</span>
            <span class="n">all_factors</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">risk_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">all_factors</span>
    
    <span class="k">def</span> <span class="nf">generate_recommendation</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">risk_level</span><span class="p">,</span> <span class="n">risk_score</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¶Œì¥ì‚¬í•­ ìƒì„±</span><span class="sh">"""</span>
        <span class="k">if</span> <span class="n">risk_level</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">CRITICAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Immediate transaction blocking recommended</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">risk_level</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">HIGH</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Additional verification required</span><span class="sh">"</span>
        <span class="k">elif</span> <span class="n">risk_level</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="p">.</span><span class="n">MEDIUM</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Monitor closely, consider manual review</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sh">"</span><span class="s">Low risk, normal processing</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">update_user_state</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì ìƒíƒœ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
        <span class="c1"># ê±°ë˜ íˆìŠ¤í† ë¦¬ ì¶”ê°€
</span>        <span class="n">self</span><span class="p">.</span><span class="n">user_transaction_history</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="nf">to_json</span><span class="p">())</span>
        
        <span class="c1"># í–‰ë™ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">update_behavior_profile</span><span class="p">(</span><span class="n">transaction</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">update_behavior_profile</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í–‰ë™ í”„ë¡œíŒŒì¼ ì—…ë°ì´íŠ¸</span><span class="sh">"""</span>
        <span class="n">profile</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_user_behavior_profile</span><span class="p">()</span> <span class="ow">or</span> <span class="p">{}</span>
        
        <span class="c1"># í‰ê·  ê±°ë˜ ê¸ˆì•¡ ì—…ë°ì´íŠ¸
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">:</span>
            <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_count</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">transaction</span><span class="p">.</span><span class="n">amount</span>
        <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_count</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">average_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_count</span><span class="sh">"</span><span class="p">]</span>
        
        <span class="c1"># ê±°ë˜ ìœ í˜• ì¶”ê°€
</span>        <span class="k">if</span> <span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">:</span>
            <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">set</span><span class="p">()</span>
        
        <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        
        <span class="c1"># ì „í˜•ì ì¸ ê±°ë˜ ì‹œê°„ ì—…ë°ì´íŠ¸
</span>        <span class="n">transaction_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">transaction</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="k">if</span> <span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">:</span>
            <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">transaction_time</span><span class="p">.</span><span class="n">hour</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span><span class="p">]:</span>
            <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">typical_hours</span><span class="sh">"</span><span class="p">].</span><span class="nf">append</span><span class="p">(</span><span class="n">transaction_time</span><span class="p">.</span><span class="n">hour</span><span class="p">)</span>
        
        <span class="c1"># í”„ë¡œíŒŒì¼ ì €ì¥
</span>        <span class="n">self</span><span class="p">.</span><span class="n">user_behavior_profile</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">profile</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">get_user_behavior_profile</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‚¬ìš©ì í–‰ë™ í”„ë¡œíŒŒì¼ ì¡°íšŒ</span><span class="sh">"""</span>
        <span class="n">profile_json</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_behavior_profile</span><span class="p">.</span><span class="nf">value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">profile_json</span><span class="p">:</span>
            <span class="n">profile</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">profile_json</span><span class="p">)</span>
            <span class="c1"># setì„ listë¡œ ë³€í™˜ (ì§ë ¬í™” ê°€ëŠ¥í•˜ë„ë¡)
</span>            <span class="k">if</span> <span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span> <span class="ow">in</span> <span class="n">profile</span><span class="p">:</span>
                <span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">profile</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">profile</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">calculate_distance</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">loc1</span><span class="p">,</span> <span class="n">loc2</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ë‘ ìœ„ì¹˜ ê°„ ê±°ë¦¬ ê³„ì‚° (Haversine formula)</span><span class="sh">"""</span>
        <span class="n">lat1</span><span class="p">,</span> <span class="n">lon1</span> <span class="o">=</span> <span class="n">loc1</span><span class="p">[</span><span class="sh">"</span><span class="s">latitude</span><span class="sh">"</span><span class="p">],</span> <span class="n">loc1</span><span class="p">[</span><span class="sh">"</span><span class="s">longitude</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">lat2</span><span class="p">,</span> <span class="n">lon2</span> <span class="o">=</span> <span class="n">loc2</span><span class="p">[</span><span class="sh">"</span><span class="s">latitude</span><span class="sh">"</span><span class="p">],</span> <span class="n">loc2</span><span class="p">[</span><span class="sh">"</span><span class="s">longitude</span><span class="sh">"</span><span class="p">]</span>
        
        <span class="n">R</span> <span class="o">=</span> <span class="mi">6371</span>  <span class="c1"># ì§€êµ¬ ë°˜ì§€ë¦„ (km)
</span>        
        <span class="n">dlat</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat2</span> <span class="o">-</span> <span class="n">lat1</span><span class="p">)</span>
        <span class="n">dlon</span> <span class="o">=</span> <span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lon2</span> <span class="o">-</span> <span class="n">lon1</span><span class="p">)</span>
        
        <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlat</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span>
             <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat1</span><span class="p">))</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">radians</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span> <span class="o">*</span>
             <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dlon</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
        
        <span class="n">c</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">math</span><span class="p">.</span><span class="nf">atan2</span><span class="p">(</span><span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">a</span><span class="p">))</span>
        <span class="n">distance</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">c</span>
        
        <span class="k">return</span> <span class="n">distance</span>
    
    <span class="k">def</span> <span class="nf">send_immediate_alert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">risk_assessment</span><span class="p">,</span> <span class="n">transaction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì¦‰ì‹œ ì•Œë¦¼ ì „ì†¡</span><span class="sh">"""</span>
        <span class="n">alert</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">fraud_alert</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">severity</span><span class="sh">"</span><span class="p">:</span> <span class="n">risk_assessment</span><span class="p">.</span><span class="n">risk_level</span><span class="p">.</span><span class="n">value</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">transaction_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction</span><span class="p">.</span><span class="n">transaction_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction</span><span class="p">.</span><span class="n">user_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="n">transaction</span><span class="p">.</span><span class="n">amount</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">risk_score</span><span class="sh">"</span><span class="p">:</span> <span class="n">risk_assessment</span><span class="p">.</span><span class="n">risk_score</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">recommendation</span><span class="sh">"</span><span class="p">:</span> <span class="n">risk_assessment</span><span class="p">.</span><span class="n">recommendation</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">risk_assessment</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="p">}</span>
        
        <span class="c1"># ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì•Œë¦¼ ì‹œìŠ¤í…œìœ¼ë¡œ ì „ì†¡
</span>        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">IMMEDIATE ALERT: </span><span class="si">{</span><span class="n">alert</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="3-ì‹¤ì‹œê°„-ê¸ˆìœµ-ëª¨ë‹ˆí„°ë§-ì‹œìŠ¤í…œ-í†µí•©">3. ì‹¤ì‹œê°„ ê¸ˆìœµ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ í†µí•©</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RealTimeFinancialMonitoringSystem</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">StreamExecutionEnvironment</span><span class="p">.</span><span class="nf">get_execution_environment</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">setup_environment</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">alerting_system</span> <span class="o">=</span> <span class="nc">RealTimeAlertingSystem</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dashboard_manager</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">setup_environment</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">í™˜ê²½ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># ì²´í¬í¬ì¸íŒ… í™œì„±í™”
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">get_checkpoint_config</span><span class="p">().</span><span class="nf">enable_checkpointing</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
        
        <span class="c1"># ìƒíƒœ ë°±ì—”ë“œ ì„¤ì •
</span>        <span class="kn">from</span> <span class="n">pyflink.datastream.state</span> <span class="kn">import</span> <span class="n">RocksDBStateBackend</span>
        <span class="n">backend</span> <span class="o">=</span> <span class="nc">RocksDBStateBackend</span><span class="p">(</span>
            <span class="n">checkpoint_data_uri</span><span class="o">=</span><span class="sh">"</span><span class="s">file:///tmp/financial-monitoring-checkpoints</span><span class="sh">"</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">set_state_backend</span><span class="p">(</span><span class="n">backend</span><span class="p">)</span>
        
        <span class="c1"># ì´ë²¤íŠ¸ ì‹œê°„ ì„¤ì •
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">set_stream_time_characteristic</span><span class="p">(</span><span class="n">TimeCharacteristic</span><span class="p">.</span><span class="n">EventTime</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">create_kafka_source</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">bootstrap_servers</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">Kafka ì†ŒìŠ¤ ìƒì„±</span><span class="sh">"""</span>
        <span class="kn">from</span> <span class="n">pyflink.datastream.connectors</span> <span class="kn">import</span> <span class="n">FlinkKafkaConsumer</span>
        <span class="kn">from</span> <span class="n">pyflink.common.serialization</span> <span class="kn">import</span> <span class="n">SimpleStringSchema</span>
        
        <span class="n">kafka_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">bootstrap.servers</span><span class="sh">'</span><span class="p">:</span> <span class="n">bootstrap_servers</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">group.id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">financial-monitoring-system</span><span class="sh">'</span>
        <span class="p">}</span>
        
        <span class="n">kafka_source</span> <span class="o">=</span> <span class="nc">FlinkKafkaConsumer</span><span class="p">(</span>
            <span class="n">topic</span><span class="p">,</span>
            <span class="nc">SimpleStringSchema</span><span class="p">(),</span>
            <span class="n">kafka_properties</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">add_source</span><span class="p">(</span><span class="n">kafka_source</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">parse_financial_transactions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸ˆìœµ ê±°ë˜ íŒŒì‹±</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">parse_transaction</span><span class="p">(</span><span class="n">transaction_str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FinancialTransaction</span><span class="p">.</span><span class="nf">from_json</span><span class="p">(</span><span class="n">transaction_str</span><span class="p">)</span>
            <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Failed to parse transaction: </span><span class="si">{</span><span class="n">transaction_str</span><span class="si">}</span><span class="s">, Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">None</span>
        
        <span class="k">return</span> <span class="n">transaction_stream</span><span class="p">.</span><span class="nf">map</span><span class="p">(</span><span class="n">parse_transaction</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">())</span> \
                               <span class="p">.</span><span class="nf">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">setup_real_time_aggregations</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">transaction_stream</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ì‹¤ì‹œê°„ ì§‘ê³„ ì„¤ì •</span><span class="sh">"""</span>
        <span class="c1"># 1ë¶„ ìœˆë„ìš°ë¡œ ì‹¤ì‹œê°„ ì§‘ê³„
</span>        <span class="n">real_time_metrics</span> <span class="o">=</span> <span class="n">transaction_stream</span><span class="p">.</span><span class="nf">window_all</span><span class="p">(</span>
            <span class="n">TumblingEventTimeWindows</span><span class="p">.</span><span class="nf">of</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">minutes</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">).</span><span class="nf">aggregate</span><span class="p">(</span>
            <span class="n">self</span><span class="p">.</span><span class="nc">FinancialMetricsAggregateFunction</span><span class="p">(),</span>
            <span class="n">self</span><span class="p">.</span><span class="nc">FinancialMetricsWindowFunction</span><span class="p">(),</span>
            <span class="n">output_type</span><span class="o">=</span><span class="n">Types</span><span class="p">.</span><span class="nc">PICKLED_BYTE_ARRAY</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">real_time_metrics</span>
    
    <span class="k">class</span> <span class="nc">FinancialMetricsAggregateFunction</span><span class="p">:</span>
        <span class="sh">"""</span><span class="s">ê¸ˆìœµ ë©”íŠ¸ë¦­ ì§‘ê³„ í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">create_accumulator</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">high_risk_transactions</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">:</span> <span class="nf">set</span><span class="p">(),</span>
                <span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">hourly_distribution</span><span class="sh">"</span><span class="p">:</span> <span class="p">{}</span>
            <span class="p">}</span>
        
        <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span><span class="p">.</span><span class="n">amount</span>
            
            <span class="k">if</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="sh">'</span><span class="s">risk_level</span><span class="sh">'</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="p">.</span><span class="n">risk_level</span> <span class="ow">in</span> <span class="p">[</span><span class="sh">'</span><span class="s">high</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">critical</span><span class="sh">'</span><span class="p">]:</span>
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">high_risk_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">].</span><span class="nf">add</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span>
            
            <span class="n">transaction_type</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="n">transaction_type</span><span class="p">.</span><span class="n">value</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">][</span><span class="n">transaction_type</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">transaction_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="n">hour</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">fromtimestamp</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">timestamp</span><span class="p">).</span><span class="n">hour</span>
            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">hourly_distribution</span><span class="sh">"</span><span class="p">][</span><span class="n">hour</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">hourly_distribution</span><span class="sh">"</span><span class="p">].</span><span class="nf">get</span><span class="p">(</span><span class="n">hour</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            
            <span class="k">return</span> <span class="n">accumulator</span>
        
        <span class="k">def</span> <span class="nf">get_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">accumulator</span><span class="p">):</span>
            <span class="c1"># setì„ listë¡œ ë³€í™˜
</span>            <span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">accumulator</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">accumulator</span>
    
    <span class="k">class</span> <span class="nc">FinancialMetricsWindowFunction</span><span class="p">(</span><span class="n">AllWindowFunction</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸ˆìœµ ë©”íŠ¸ë¦­ ìœˆë„ìš° í•¨ìˆ˜</span><span class="sh">"""</span>
        <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="nb">input</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">input</span> <span class="k">else</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_empty_metrics</span><span class="p">()</span>
            
            <span class="c1"># ìœˆë„ìš° ë©”íƒ€ë°ì´í„° ì¶”ê°€
</span>            <span class="n">metrics</span><span class="p">.</span><span class="nf">update</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">window_start</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">start</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">window_end</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">:</span> <span class="n">window</span><span class="p">.</span><span class="n">end</span>
            <span class="p">})</span>
            
            <span class="c1"># íŒŒìƒ ì§€í‘œ ê³„ì‚°
</span>            <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">average_transaction_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">risk_rate</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">high_risk_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">transactions_per_user</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="nf">len</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">metrics</span><span class="p">[</span><span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            
            <span class="n">out</span><span class="p">.</span><span class="nf">collect</span><span class="p">(</span><span class="n">metrics</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">create_empty_metrics</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">total_transactions</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">total_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">high_risk_transactions</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">unique_users</span><span class="sh">"</span><span class="p">:</span> <span class="p">[],</span>
                <span class="sh">"</span><span class="s">transaction_types</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">hourly_distribution</span><span class="sh">"</span><span class="p">:</span> <span class="p">{},</span>
                <span class="sh">"</span><span class="s">average_transaction_amount</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">risk_rate</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">transactions_per_user</span><span class="sh">"</span><span class="p">:</span> <span class="mf">0.0</span>
            <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">run_financial_monitoring_system</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="sh">"""</span><span class="s">ê¸ˆìœµ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì‹¤í–‰</span><span class="sh">"""</span>
        <span class="c1"># Kafkaì—ì„œ ê±°ë˜ ë°ì´í„° ì½ê¸°
</span>        <span class="n">transaction_stream</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">create_kafka_source</span><span class="p">(</span><span class="sh">"</span><span class="s">financial-transactions</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ê±°ë˜ íŒŒì‹±
</span>        <span class="n">parsed_transactions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_financial_transactions</span><span class="p">(</span><span class="n">transaction_stream</span><span class="p">)</span>
        
        <span class="c1"># íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ì›Œí„°ë§ˆí¬ í• ë‹¹
</span>        <span class="kn">from</span> <span class="n">pyflink.datastream.functions</span> <span class="kn">import</span> <span class="n">BoundedOutOfOrdernessTimestampExtractor</span>
        <span class="kn">from</span> <span class="n">pyflink.common.time</span> <span class="kn">import</span> <span class="n">Time</span>
        
        <span class="k">class</span> <span class="nc">TransactionTimestampExtractor</span><span class="p">(</span><span class="n">BoundedOutOfOrdernessTimestampExtractor</span><span class="p">):</span>
            <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
                <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">(</span><span class="n">Time</span><span class="p">.</span><span class="nf">seconds</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span>  <span class="c1"># 30ì´ˆ ì§€ì—° í—ˆìš©
</span>            
            <span class="k">def</span> <span class="nf">extract_timestamp</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">previous_timestamp</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">element</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">*</span> <span class="mi">1000</span>
        
        <span class="n">watermarked_transactions</span> <span class="o">=</span> <span class="n">parsed_transactions</span><span class="p">.</span><span class="nf">assign_timestamps_and_watermarks</span><span class="p">(</span>
            <span class="nc">TransactionTimestampExtractor</span><span class="p">()</span>
        <span class="p">)</span>
        
        <span class="c1"># ì´ìƒ ê±°ë˜ ê°ì§€
</span>        <span class="n">risk_assessments</span> <span class="o">=</span> <span class="n">watermarked_transactions</span><span class="p">.</span><span class="nf">key_by</span><span class="p">(</span><span class="k">lambda</span> <span class="n">tx</span><span class="p">:</span> <span class="n">tx</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span> \
                                                   <span class="p">.</span><span class="nf">process</span><span class="p">(</span><span class="nc">FraudDetectionEngine</span><span class="p">())</span>
        
        <span class="c1"># ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ê³„ì‚°
</span>        <span class="n">real_time_metrics</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">setup_real_time_aggregations</span><span class="p">(</span><span class="n">watermarked_transactions</span><span class="p">)</span>
        
        <span class="c1"># ê²°ê³¼ ì¶œë ¥
</span>        <span class="n">risk_assessments</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Risk Assessments</span><span class="sh">"</span><span class="p">)</span>
        <span class="n">real_time_metrics</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Real-time Metrics</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="c1"># ì‹¤í–‰
</span>        <span class="n">self</span><span class="p">.</span><span class="n">env</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span><span class="sh">"</span><span class="s">Real-time Financial Monitoring System</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì‹œìŠ¤í…œ ì‹¤í–‰
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="n">system</span> <span class="o">=</span> <span class="nc">RealTimeFinancialMonitoringSystem</span><span class="p">()</span>
    <span class="n">system</span><span class="p">.</span><span class="nf">run_financial_monitoring_system</span><span class="p">()</span>
</code></pre></div></div>

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="ì´ë²ˆ-íŒŒíŠ¸ì—ì„œ-í•™ìŠµí•œ-ë‚´ìš©">ì´ë²ˆ íŒŒíŠ¸ì—ì„œ í•™ìŠµí•œ ë‚´ìš©</h3>

<ol>
  <li><strong>CEP (Complex Event Processing)</strong>
    <ul>
      <li>CEPì˜ ê¸°ë³¸ ê°œë…ê³¼ íŒ¨í„´ ì •ì˜</li>
      <li>ê³ ê¸‰ íŒ¨í„´ ë§¤ì¹­ (ìˆœì°¨, OR, NOT, ë°˜ë³µ íŒ¨í„´)</li>
      <li>ì¡°ê±´ë¶€ íŒ¨í„´ ë§¤ì¹­ê³¼ ë™ì  íŒ¨í„´ ìƒì„±</li>
      <li>íŒ¨í„´ ê²°ê³¼ í›„ì²˜ë¦¬</li>
    </ul>
  </li>
  <li><strong>ì‹¤ì‹œê°„ ì§‘ê³„ì™€ ìœˆë„ìš° í•¨ìˆ˜</strong>
    <ul>
      <li>ê³ ê¸‰ ìœˆë„ìš° ì—°ì‚° (íŠ¬ë¸”ë§, ìŠ¬ë¼ì´ë”©, ì„¸ì…˜)</li>
      <li>ì‹¤ì‹œê°„ ì§‘ê³„ ì—”ì§„ êµ¬ì¶•</li>
      <li>ì‚¬ìš©ìë³„ ë° ê¸€ë¡œë²Œ ì§‘ê³„</li>
      <li>íŒŒìƒ ì§€í‘œ ê³„ì‚°</li>
    </ul>
  </li>
  <li><strong>ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</strong>
    <ul>
      <li>Grafana ì—°ë™ ëŒ€ì‹œë³´ë“œ</li>
      <li>ì‹¤ì‹œê°„ ì•Œë¦¼ ì‹œìŠ¤í…œ</li>
      <li>ë‹¤ì¤‘ ì±„ë„ ì•Œë¦¼ (ì´ë©”ì¼, Slack, PagerDuty)</li>
      <li>ì¤‘ë³µ ì•Œë¦¼ ë°©ì§€</li>
    </ul>
  </li>
  <li><strong>ì‹¤ë¬´ í”„ë¡œì íŠ¸</strong>
    <ul>
      <li>ì‹¤ì‹œê°„ ê¸ˆìœµ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</li>
      <li>ì´ìƒ ê±°ë˜ ê°ì§€ ì—”ì§„</li>
      <li>ë‹¤ì¤‘ ìœ„í—˜ ìš”ì†Œ í‰ê°€</li>
      <li>ì¢…í•© ìœ„í—˜ë„ ì ìˆ˜ ê³„ì‚°</li>
    </ul>
  </li>
</ol>

<h3 id="í•µì‹¬-ê¸°ìˆ -ìŠ¤íƒ">í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ</h3>

<table>
  <thead>
    <tr>
      <th>ê¸°ìˆ </th>
      <th>ìš©ë„</th>
      <th>ì¤‘ìš”ë„</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>CEP íŒ¨í„´ ë§¤ì¹­</strong></td>
      <td>ë³µì¡í•œ ì´ë²¤íŠ¸ ì²˜ë¦¬</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì‹¤ì‹œê°„ ì§‘ê³„</strong></td>
      <td>ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ê³„ì‚°</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ìœˆë„ìš° í•¨ìˆ˜</strong></td>
      <td>ì‹œê°„ ê¸°ë°˜ ë¶„ì„</td>
      <td>â­â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ</strong></td>
      <td>ëª¨ë‹ˆí„°ë§ê³¼ ì‹œê°í™”</td>
      <td>â­â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì•Œë¦¼ ì‹œìŠ¤í…œ</strong></td>
      <td>ì´ìƒ ìƒí™© ëŒ€ì‘</td>
      <td>â­â­â­â­</td>
    </tr>
  </tbody>
</table>

<h3 id="ë‹¤ìŒ-íŒŒíŠ¸-ë¯¸ë¦¬ë³´ê¸°">ë‹¤ìŒ íŒŒíŠ¸ ë¯¸ë¦¬ë³´ê¸°</h3>

<p><strong>Part 4: í”„ë¡œë•ì…˜ ë°°í¬ì™€ ì„±ëŠ¥ ìµœì í™”</strong>ì—ì„œëŠ” ë‹¤ìŒ ë‚´ìš©ì„ ë‹¤ë£¹ë‹ˆë‹¤:</p>
<ul>
  <li>Kubernetesë¥¼ í™œìš©í•œ Flink í´ëŸ¬ìŠ¤í„° ë°°í¬</li>
  <li>ì„±ëŠ¥ íŠœë‹ê³¼ ëª¨ë‹ˆí„°ë§</li>
  <li>ì¥ì•  ë³µêµ¬ì™€ ìš´ì˜ ì „ëµ</li>
  <li>Flink Metricsì™€ Grafana ì—°ë™</li>
</ul>

<hr />

<p><strong>ë‹¤ìŒ íŒŒíŠ¸</strong>: <a href="/data-engineering/2025/09/18/apache-flink-production-deployment.html">Part 4: í”„ë¡œë•ì…˜ ë°°í¬ì™€ ì„±ëŠ¥ ìµœì í™”</a></p>

<hr />

<p><em>ì´ì œ Flinkì˜ ì‹¤ì‹œê°„ ë¶„ì„ê³¼ CEPë¥¼ ë§ˆìŠ¤í„°í–ˆìŠµë‹ˆë‹¤! ë§ˆì§€ë§‰ íŒŒíŠ¸ì—ì„œëŠ” í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œì˜ ë°°í¬ì™€ ìš´ì˜ì„ ë‹¤ë¤„ë³´ê² ìŠµë‹ˆë‹¤.</em> ğŸš€</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/09/16/apache-flink-advanced-streaming.html" class="nav-link prev">
          â† ì´ì „: Part 2: Apache Flink ê³ ê¸‰ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬ì™€ ìƒíƒœ ê´€ë¦¬ - í”„ë¡œë•ì…˜ê¸‰ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ
        </a>
      
      
      
        
        
        <a href="/data-engineering/2025/09/18/apache-flink-production-deployment.html" class="nav-link next">
          ë‹¤ìŒ: Part 4: Apache Flink í”„ë¡œë•ì…˜ ë°°í¬ì™€ ì„±ëŠ¥ ìµœì í™” - ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ìš´ì˜ì˜ ì™„ì„± â†’
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee-a61ab2193/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
