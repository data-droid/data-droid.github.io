<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ì˜ í•µì‹¬ í…Œì´ë¸” í¬ë§·ì¸ Delta Lake, Apache Iceberg, Apache Hudië¥¼ ì•„í‚¤í…ì²˜ë¶€í„° ACID, Time Travel, ì„±ëŠ¥ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">



<title>Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ">
<meta property="og:description" content="ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ì˜ í•µì‹¬ í…Œì´ë¸” í¬ë§·ì¸ Delta Lake, Apache Iceberg, Apache Hudië¥¼ ì•„í‚¤í…ì²˜ë¶€í„° ACID, Time Travel, ì„±ëŠ¥ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">
<meta property="og:url" content="http://localhost:4000/data-engineering/2025/10/21/delta-lake-iceberg-hudi-comparison.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ">
<meta name="twitter:description" content="ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ì˜ í•µì‹¬ í…Œì´ë¸” í¬ë§·ì¸ Delta Lake, Apache Iceberg, Apache Hudië¥¼ ì•„í‚¤í…ì²˜ë¶€í„° ACID, Time Travel, ì„±ëŠ¥ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/10/21/delta-lake-iceberg-hudi-comparison.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-10-21-delta-lake-iceberg-hudi-comparison.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 10ì›” 21ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">DeltaLake</span>
      
        <span class="tag">Iceberg</span>
      
        <span class="tag">Hudi</span>
      
        <span class="tag">DataLakehouse</span>
      
        <span class="tag">TableFormat</span>
      
        <span class="tag">ACID</span>
      
        <span class="tag">TimeTravel</span>
      
        <span class="tag">Spark</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Cloud data architecture ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 4</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 60ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ê³ ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="ï¸-delta-lake-vs-iceberg-vs-hudi-ì‹¤ì „-ë¹„êµ---í…Œì´ë¸”-í¬ë§·-ì™„ì „-ì •ë³µ">ğŸ›ï¸ Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ</h1>

<blockquote>
  <p><strong>â€œíŒŒì¼ í¬ë§·ì—ì„œ í…Œì´ë¸” í¬ë§·ìœ¼ë¡œ - ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ì˜ í•µì‹¬ ê¸°ìˆ â€</strong> - ACID, Time Travel, Schema Evolutionì„ ì§€ì›í•˜ëŠ” ì°¨ì„¸ëŒ€ ë°ì´í„° ë ˆì´í¬</p>
</blockquote>

<p>Parquet, ORC, Avro ê°™ì€ íŒŒì¼ í¬ë§·ë§Œìœ¼ë¡œëŠ” ACID íŠ¸ëœì­ì…˜, ìŠ¤í‚¤ë§ˆ ì§„í™”, Time Travel ê°™ì€ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì œê³µí•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤. Delta Lake, Apache Iceberg, Apache HudiëŠ” íŒŒì¼ í¬ë§· ìœ„ì— ë©”íƒ€ë°ì´í„° ë ˆì´ì–´ë¥¼ ì¶”ê°€í•˜ì—¬ <strong>ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤ ìˆ˜ì¤€ì˜ ê¸°ëŠ¥ì„ ë°ì´í„° ë ˆì´í¬ì—ì„œ ì œê³µ</strong>í•©ë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì„¸ ê°€ì§€ í…Œì´ë¸” í¬ë§·ì˜ ì•„í‚¤í…ì²˜, ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬, ê·¸ë¦¬ê³  ìƒí™©ë³„ ìµœì  ì„ íƒ ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="-ëª©ì°¨">ğŸ“š ëª©ì°¨</h2>

<ul>
  <li><a href="#í…Œì´ë¸”-í¬ë§·ì´ë€">í…Œì´ë¸” í¬ë§·ì´ë€?</a></li>
  <li><a href="#delta-lake-ì•„í‚¤í…ì²˜">Delta Lake ì•„í‚¤í…ì²˜</a></li>
  <li><a href="#apache-iceberg-ì•„í‚¤í…ì²˜">Apache Iceberg ì•„í‚¤í…ì²˜</a></li>
  <li><a href="#apache-hudi-ì•„í‚¤í…ì²˜">Apache Hudi ì•„í‚¤í…ì²˜</a></li>
  <li><a href="#ê¸°ëŠ¥-ë¹„êµ">ê¸°ëŠ¥ ë¹„êµ</a></li>
  <li><a href="#ì‹¤ì œ-ë²¤ì¹˜ë§ˆí¬-ë¹„êµ">ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ë¹„êµ</a></li>
  <li><a href="#ìƒí™©ë³„-ìµœì -ì„ íƒ">ìƒí™©ë³„ ìµœì  ì„ íƒ</a></li>
  <li><a href="#ë§ˆì´ê·¸ë ˆì´ì…˜-ê°€ì´ë“œ">ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ul>

<hr />

<h2 id="í…Œì´ë¸”-í¬ë§·ì´ë€">ğŸ¯ í…Œì´ë¸” í¬ë§·ì´ë€?</h2>

<h3 id="íŒŒì¼-í¬ë§·-vs-í…Œì´ë¸”-í¬ë§·">íŒŒì¼ í¬ë§· vs í…Œì´ë¸” í¬ë§·</h3>

<table>
  <thead>
    <tr>
      <th><strong>êµ¬ë¶„</strong></th>
      <th><strong>íŒŒì¼ í¬ë§·</strong></th>
      <th><strong>í…Œì´ë¸” í¬ë§·</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì˜ˆì‹œ</strong></td>
      <td>Parquet, ORC, Avro</td>
      <td>Delta Lake, Iceberg, Hudi</td>
    </tr>
    <tr>
      <td><strong>ì—­í• </strong></td>
      <td>ë°ì´í„° ì €ì¥ ë°©ì‹</td>
      <td>ë©”íƒ€ë°ì´í„° + íŠ¸ëœì­ì…˜ ê´€ë¦¬</td>
    </tr>
    <tr>
      <td><strong>ACID</strong></td>
      <td>ë¯¸ì§€ì›</td>
      <td>ì§€ì›</td>
    </tr>
    <tr>
      <td><strong>Time Travel</strong></td>
      <td>ë¶ˆê°€ëŠ¥</td>
      <td>ê°€ëŠ¥</td>
    </tr>
    <tr>
      <td><strong>Schema Evolution</strong></td>
      <td>ì œí•œì </td>
      <td>ì™„ë²½ ì§€ì›</td>
    </tr>
    <tr>
      <td><strong>Update/Delete</strong></td>
      <td>ì–´ë ¤ì›€</td>
      <td>ì‰¬ì›€</td>
    </tr>
  </tbody>
</table>

<h3 id="ë°ì´í„°-ë ˆì´í¬í•˜ìš°ìŠ¤-ì•„í‚¤í…ì²˜">ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ ì•„í‚¤í…ì²˜</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ì „í†µì ì¸ ë°ì´í„° ë ˆì´í¬:
S3/HDFS
  â””â”€â”€ Parquet Files
      â””â”€â”€ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì§ì ‘ íŒŒì¼ ê´€ë¦¬

ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤:
S3/HDFS
  â””â”€â”€ Parquet Files (ë°ì´í„°)
      â””â”€â”€ Delta/Iceberg/Hudi (ë©”íƒ€ë°ì´í„° ë ˆì´ì–´)
          â””â”€â”€ ACID, Time Travel, Schema Evolution
</code></pre></div></div>

<h3 id="ì™œ-í…Œì´ë¸”-í¬ë§·ì´-í•„ìš”í•œê°€">ì™œ í…Œì´ë¸” í¬ë§·ì´ í•„ìš”í•œê°€?</h3>

<h4 id="ë¬¸ì œ-1-ì¼ê´€ì„±-ì—†ëŠ”-ì½ê¸°"><strong>ë¬¸ì œ 1: ì¼ê´€ì„± ì—†ëŠ” ì½ê¸°</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì „í†µì ì¸ ë°ì´í„° ë ˆì´í¬
# Writerê°€ íŒŒì¼ ì“°ëŠ” ì¤‘ì— Readerê°€ ì½ìœ¼ë©´?
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ì“°ê¸° ì¤‘...
# ë™ì‹œì— ë‹¤ë¥¸ í”„ë¡œì„¸ìŠ¤
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ë¶ˆì™„ì „í•œ ë°ì´í„° ì½ì„ ìˆ˜ ìˆìŒ
</span></code></pre></div></div>

<h4 id="ë¬¸ì œ-2-updatedelete-ë¶ˆê°€ëŠ¥"><strong>ë¬¸ì œ 2: Update/Delete ë¶ˆê°€ëŠ¥</strong></h4>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Parquetë§Œìœ¼ë¡œëŠ” ë¶ˆê°€ëŠ¥</span>
<span class="k">UPDATE</span> <span class="n">events</span> <span class="k">SET</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="k">WHERE</span> <span class="nb">date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
<span class="c1">-- í•´ê²°: ì „ì²´ íŒŒí‹°ì…˜ ì¬ì‘ì„± í•„ìš” (ë¹„íš¨ìœ¨ì )</span>
</code></pre></div></div>

<h4 id="ë¬¸ì œ-3-ìŠ¤í‚¤ë§ˆ-ë³€ê²½ì˜-ì–´ë ¤ì›€"><strong>ë¬¸ì œ 3: ìŠ¤í‚¤ë§ˆ ë³€ê²½ì˜ ì–´ë ¤ì›€</strong></h4>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì»¬ëŸ¼ ì¶”ê°€ ì‹œ ê¸°ì¡´ íŒŒì¼ê³¼ í˜¸í™˜ì„± ë¬¸ì œ
</span><span class="n">df_v1</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">data/v1/</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ì»¬ëŸ¼ 3ê°œ
</span><span class="n">df_v2</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">data/v2/</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ì»¬ëŸ¼ 4ê°œ
# ë‘ ë²„ì „ ë™ì‹œ ì½ê¸° ì‹œ ìŠ¤í‚¤ë§ˆ ì¶©ëŒ ê°€ëŠ¥
</span></code></pre></div></div>

<h3 id="í…Œì´ë¸”-í¬ë§·ì˜-í•´ê²°ì±…">í…Œì´ë¸” í¬ë§·ì˜ í•´ê²°ì±…</h3>

<table>
  <thead>
    <tr>
      <th><strong>ë¬¸ì œ</strong></th>
      <th><strong>í•´ê²°ì±…</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì¼ê´€ì„±</strong></td>
      <td>íŠ¸ëœì­ì…˜ ë¡œê·¸ë¡œ ì›ìì„± ë³´ì¥</td>
    </tr>
    <tr>
      <td><strong>Update/Delete</strong></td>
      <td>Merge-on-Read or Copy-on-Write</td>
    </tr>
    <tr>
      <td><strong>ìŠ¤í‚¤ë§ˆ ë³€ê²½</strong></td>
      <td>ë©”íƒ€ë°ì´í„° ë²„ì „ ê´€ë¦¬</td>
    </tr>
    <tr>
      <td><strong>Time Travel</strong></td>
      <td>ìŠ¤ëƒ…ìƒ· ê¸°ë°˜ ë²„ì „ ê´€ë¦¬</td>
    </tr>
    <tr>
      <td><strong>ì„±ëŠ¥</strong></td>
      <td>ë©”íƒ€ë°ì´í„° ìºì‹±, í†µê³„ ìµœì í™”</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="delta-lake-ì•„í‚¤í…ì²˜">ğŸ”· Delta Lake ì•„í‚¤í…ì²˜</h2>

<h3 id="í•µì‹¬-ê°œë…">í•µì‹¬ ê°œë…</h3>

<p>Delta LakeëŠ” <strong>íŠ¸ëœì­ì…˜ ë¡œê·¸ ê¸°ë°˜</strong>ì˜ í…Œì´ë¸” í¬ë§·ì…ë‹ˆë‹¤.</p>

<h4 id="ì£¼ìš”-êµ¬ì„±ìš”ì†Œ"><strong>ì£¼ìš” êµ¬ì„±ìš”ì†Œ</strong></h4>
<ul>
  <li><strong>Transaction Log (_delta_log/)</strong>: JSON í˜•ì‹ì˜ íŠ¸ëœì­ì…˜ ë¡œê·¸</li>
  <li><strong>Data Files</strong>: Parquet íŒŒì¼</li>
  <li><strong>Checkpoint</strong>: ì£¼ê¸°ì ì¸ ë©”íƒ€ë°ì´í„° ìŠ¤ëƒ…ìƒ·</li>
</ul>

<h3 id="ë””ë ‰í† ë¦¬-êµ¬ì¡°">ë””ë ‰í† ë¦¬ êµ¬ì¡°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s3://bucket/delta-table/
â”œâ”€â”€ _delta_log/
â”‚   â”œâ”€â”€ 00000000000000000000.json  <span class="c"># íŠ¸ëœì­ì…˜ 0</span>
â”‚   â”œâ”€â”€ 00000000000000000001.json  <span class="c"># íŠ¸ëœì­ì…˜ 1</span>
â”‚   â”œâ”€â”€ 00000000000000000002.json  <span class="c"># íŠ¸ëœì­ì…˜ 2</span>
â”‚   â”œâ”€â”€ 00000000000000000010.checkpoint.parquet  <span class="c"># ì²´í¬í¬ì¸íŠ¸</span>
â”‚   â””â”€â”€ _last_checkpoint  <span class="c"># ë§ˆì§€ë§‰ ì²´í¬í¬ì¸íŠ¸ ìœ„ì¹˜</span>
â”œâ”€â”€ part-00000-uuid.snappy.parquet
â”œâ”€â”€ part-00001-uuid.snappy.parquet
â””â”€â”€ part-00002-uuid.snappy.parquet
</code></pre></div></div>

<h3 id="íŠ¸ëœì­ì…˜-ë¡œê·¸-ì˜ˆì‹œ">íŠ¸ëœì­ì…˜ ë¡œê·¸ ì˜ˆì‹œ</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"commitInfo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1705305600000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"operation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WRITE"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"operationParameters"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Append"</span><span class="p">},</span><span class="w">
    </span><span class="nl">"readVersion"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"isolationLevel"</span><span class="p">:</span><span class="w"> </span><span class="s2">"WriteSerializable"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">{</span><span class="w">
  </span><span class="nl">"add"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"path"</span><span class="p">:</span><span class="w"> </span><span class="s2">"part-00000-uuid.snappy.parquet"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"partitionValues"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nl">"date"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-15"</span><span class="p">},</span><span class="w">
    </span><span class="nl">"size"</span><span class="p">:</span><span class="w"> </span><span class="mi">134217728</span><span class="p">,</span><span class="w">
    </span><span class="nl">"modificationTime"</span><span class="p">:</span><span class="w"> </span><span class="mi">1705305600000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"dataChange"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
    </span><span class="nl">"stats"</span><span class="p">:</span><span class="w"> </span><span class="s2">"{</span><span class="se">\"</span><span class="s2">numRecords</span><span class="se">\"</span><span class="s2">:1000000,</span><span class="se">\"</span><span class="s2">minValues</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">amount</span><span class="se">\"</span><span class="s2">:0.5},</span><span class="se">\"</span><span class="s2">maxValues</span><span class="se">\"</span><span class="s2">:{</span><span class="se">\"</span><span class="s2">amount</span><span class="se">\"</span><span class="s2">:999.9}}"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="delta-lake-ê¸°ë³¸-ì‚¬ìš©ë²•">Delta Lake ê¸°ë³¸ ì‚¬ìš©ë²•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Delta Lake</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.extensions</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">io.delta.sql.DeltaSparkSessionExtension</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.spark_catalog</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.spark.sql.delta.catalog.DeltaCatalog</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># 1. Delta í…Œì´ë¸” ìƒì„±
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. ACID íŠ¸ëœì­ì…˜
</span><span class="kn">from</span> <span class="n">delta.tables</span> <span class="kn">import</span> <span class="n">DeltaTable</span>

<span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="p">.</span><span class="nf">forPath</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Update
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span>
    <span class="n">condition</span> <span class="o">=</span> <span class="sh">"</span><span class="s">date = </span><span class="sh">'</span><span class="s">2024-01-15</span><span class="sh">'"</span><span class="p">,</span>
    <span class="nb">set</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">amount * 1.1</span><span class="sh">"</span><span class="p">}</span>
<span class="p">)</span>

<span class="c1"># Delete
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="sh">"</span><span class="s">amount &lt; 0</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Merge (Upsert)
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">target</span><span class="sh">"</span><span class="p">).</span><span class="nf">merge</span><span class="p">(</span>
    <span class="n">updates_df</span><span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">source</span><span class="sh">"</span><span class="p">),</span>
    <span class="sh">"</span><span class="s">target.id = source.id</span><span class="sh">"</span>
<span class="p">).</span><span class="nf">whenMatchedUpdate</span><span class="p">(</span>
    <span class="nb">set</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">source.amount</span><span class="sh">"</span><span class="p">}</span>
<span class="p">).</span><span class="nf">whenNotMatchedInsert</span><span class="p">(</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">source.id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">source.amount</span><span class="sh">"</span><span class="p">}</span>
<span class="p">).</span><span class="nf">execute</span><span class="p">()</span>

<span class="c1"># 3. Time Travel
# íŠ¹ì • ë²„ì „ìœ¼ë¡œ ì½ê¸°
</span><span class="n">df_v5</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">versionAsOf</span><span class="sh">"</span><span class="p">,</span> <span class="mi">5</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># íŠ¹ì • ì‹œê°„ìœ¼ë¡œ ì½ê¸°
</span><span class="n">df_yesterday</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">timestampAsOf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-14 00:00:00</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Schema Evolution
</span><span class="n">df_new_schema</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">mergeSchema</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="delta-lake-ìµœì í™”">Delta Lake ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Optimize (Compaction)
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">optimize</span><span class="p">().</span><span class="nf">executeCompaction</span><span class="p">()</span>

<span class="c1"># 2. Z-Ordering (ë‹¤ì°¨ì› í´ëŸ¬ìŠ¤í„°ë§)
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">optimize</span><span class="p">().</span><span class="nf">executeZOrderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. Vacuum (ì˜¤ë˜ëœ íŒŒì¼ ì‚­ì œ)
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">vacuum</span><span class="p">(</span><span class="mi">168</span><span class="p">)</span>  <span class="c1"># 7ì¼ ì´ìƒ ëœ íŒŒì¼ ì‚­ì œ
</span>
<span class="c1"># 4. Data Skipping (í†µê³„ ê¸°ë°˜ ìŠ¤í‚µ)
# ìë™ìœ¼ë¡œ min/max í†µê³„ ìˆ˜ì§‘ ë° í™œìš©
</span></code></pre></div></div>

<hr />

<h2 id="apache-iceberg-ì•„í‚¤í…ì²˜">ğŸ”¶ Apache Iceberg ì•„í‚¤í…ì²˜</h2>

<h3 id="í•µì‹¬-ê°œë…-1">í•µì‹¬ ê°œë…</h3>

<p>IcebergëŠ” <strong>ë©”íƒ€ë°ì´í„° íŠ¸ë¦¬ êµ¬ì¡°</strong>ë¡œ ëŒ€ê·œëª¨ í…Œì´ë¸”ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>

<h4 id="ì£¼ìš”-êµ¬ì„±ìš”ì†Œ-1"><strong>ì£¼ìš” êµ¬ì„±ìš”ì†Œ</strong></h4>
<ul>
  <li><strong>Metadata Files</strong>: í…Œì´ë¸” ë©”íƒ€ë°ì´í„°</li>
  <li><strong>Manifest Lists</strong>: ìŠ¤ëƒ…ìƒ·ë³„ manifest ëª©ë¡</li>
  <li><strong>Manifest Files</strong>: ë°ì´í„° íŒŒì¼ ëª©ë¡ê³¼ í†µê³„</li>
  <li><strong>Data Files</strong>: Parquet/ORC/Avro íŒŒì¼</li>
</ul>

<h3 id="ë©”íƒ€ë°ì´í„°-ê³„ì¸µ-êµ¬ì¡°">ë©”íƒ€ë°ì´í„° ê³„ì¸µ êµ¬ì¡°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Iceberg Metadata Hierarchy:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Table Metadata (metadata.json)  â”‚
â”‚  â”œâ”€â”€ Schema                     â”‚
â”‚  â”œâ”€â”€ Partition Spec             â”‚
â”‚  â””â”€â”€ Current Snapshot ID        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Snapshot                        â”‚
â”‚  â”œâ”€â”€ Snapshot ID                â”‚
â”‚  â”œâ”€â”€ Timestamp                  â”‚
â”‚  â””â”€â”€ Manifest List             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manifest List                   â”‚
â”‚  â”œâ”€â”€ Manifest File 1            â”‚
â”‚  â”œâ”€â”€ Manifest File 2            â”‚
â”‚  â””â”€â”€ Manifest File 3            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Manifest File                   â”‚
â”‚  â”œâ”€â”€ Data File 1 + Stats        â”‚
â”‚  â”œâ”€â”€ Data File 2 + Stats        â”‚
â”‚  â””â”€â”€ Data File 3 + Stats        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Files (Parquet)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="ë””ë ‰í† ë¦¬-êµ¬ì¡°-1">ë””ë ‰í† ë¦¬ êµ¬ì¡°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s3://bucket/iceberg-table/
â”œâ”€â”€ metadata/
â”‚   â”œâ”€â”€ v1.metadata.json
â”‚   â”œâ”€â”€ v2.metadata.json
â”‚   â”œâ”€â”€ snap-123-1-abc.avro  <span class="c"># Manifest List</span>
â”‚   â”œâ”€â”€ abc123-m0.avro       <span class="c"># Manifest File</span>
â”‚   â””â”€â”€ abc123-m1.avro
â””â”€â”€ data/
    â”œâ”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-15/
    â”‚   â”œâ”€â”€ 00000-0-data-uuid.parquet
    â”‚   â””â”€â”€ 00001-0-data-uuid.parquet
    â””â”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-16/
        â””â”€â”€ 00000-0-data-uuid.parquet
</code></pre></div></div>

<h3 id="iceberg-ê¸°ë³¸-ì‚¬ìš©ë²•">Iceberg ê¸°ë³¸ ì‚¬ìš©ë²•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Iceberg</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.extensions</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.spark_catalog</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.iceberg.spark.SparkCatalog</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.spark_catalog.type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">hadoop</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.spark_catalog.warehouse</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">s3://bucket/warehouse</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># 1. Iceberg í…Œì´ë¸” ìƒì„±
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE events (
        id INT,
        name STRING,
        amount DOUBLE,
        event_time TIMESTAMP
    )
    USING iceberg
    PARTITIONED BY (days(event_time))
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># 2. ë°ì´í„° ì“°ê¸°
</span><span class="n">df</span><span class="p">.</span><span class="nf">writeTo</span><span class="p">(</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">).</span><span class="nf">append</span><span class="p">()</span>

<span class="c1"># 3. ACID íŠ¸ëœì­ì…˜
# Merge (Upsert)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    MERGE INTO events t
    USING updates s
    ON t.id = s.id
    WHEN MATCHED THEN UPDATE SET *
    WHEN NOT MATCHED THEN INSERT *
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># Delete
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">DELETE FROM events WHERE amount &lt; 0</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Time Travel
# íŠ¹ì • ìŠ¤ëƒ…ìƒ·
</span><span class="n">df_snapshot</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">snapshot-id</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1234567890</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># íŠ¹ì • ì‹œê°„
</span><span class="n">df_timestamp</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">as-of-timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">1705305600000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 5. ìŠ¤í‚¤ë§ˆ ì§„í™”
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">ALTER TABLE events ADD COLUMN category STRING</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 6. Partition Evolution (ê¸°ì¡´ ë°ì´í„° ì¬ì‘ì„± ì—†ì´)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    ALTER TABLE events 
    REPLACE PARTITION FIELD days(event_time) 
    WITH hours(event_time)
</span><span class="sh">"""</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="iceberg-ìµœì í™”">Iceberg ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Expire Snapshots (ì˜¤ë˜ëœ ìŠ¤ëƒ…ìƒ· ì •ë¦¬)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">CALL spark_catalog.system.expire_snapshots(</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">, TIMESTAMP </span><span class="sh">'</span><span class="s">2024-01-01 00:00:00</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. Remove Orphan Files (ê³ ì•„ íŒŒì¼ ì‚­ì œ)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">CALL spark_catalog.system.remove_orphan_files(</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. Rewrite Data Files (ì‘ì€ íŒŒì¼ ë³‘í•©)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">CALL spark_catalog.system.rewrite_data_files(</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Rewrite Manifests (manifest ìµœì í™”)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">CALL spark_catalog.system.rewrite_manifests(</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="apache-hudi-ì•„í‚¤í…ì²˜">ğŸ”¹ Apache Hudi ì•„í‚¤í…ì²˜</h2>

<h3 id="í•µì‹¬-ê°œë…-2">í•µì‹¬ ê°œë…</h3>

<p>HudiëŠ” <strong>ì¦ë¶„ ì²˜ë¦¬ì™€ ë¹ ë¥¸ upsert</strong>ì— ìµœì í™”ëœ í…Œì´ë¸” í¬ë§·ì…ë‹ˆë‹¤.</p>

<h4 id="ì£¼ìš”-êµ¬ì„±ìš”ì†Œ-2"><strong>ì£¼ìš” êµ¬ì„±ìš”ì†Œ</strong></h4>
<ul>
  <li><strong>Timeline</strong>: í…Œì´ë¸”ì˜ ëª¨ë“  ì‘ì—… ì´ë ¥</li>
  <li><strong>Hoodie Metadata</strong>: .hoodie/ ë””ë ‰í† ë¦¬ì˜ ë©”íƒ€ë°ì´í„°</li>
  <li><strong>Base Files</strong>: Parquet íŒŒì¼</li>
  <li><strong>Log Files</strong>: ì¦ë¶„ ì—…ë°ì´íŠ¸ ë¡œê·¸</li>
</ul>

<h3 id="í…Œì´ë¸”-íƒ€ì…">í…Œì´ë¸” íƒ€ì…</h3>

<h4 id="copy-on-write-cow"><strong>Copy on Write (CoW)</strong></h4>
<ul>
  <li><strong>ì“°ê¸°</strong>: íŒŒì¼ ì „ì²´ ì¬ì‘ì„±</li>
  <li><strong>ì½ê¸°</strong>: ë¹ ë¦„ (Parquet ì§ì ‘ ì½ê¸°)</li>
  <li><strong>ì‚¬ìš©</strong>: ì½ê¸° ì¤‘ì‹¬ ì›Œí¬ë¡œë“œ</li>
</ul>

<h4 id="merge-on-read-mor"><strong>Merge on Read (MoR)</strong></h4>
<ul>
  <li><strong>ì“°ê¸°</strong>: ë¸íƒ€ ë¡œê·¸ì— ì¶”ê°€</li>
  <li><strong>ì½ê¸°</strong>: Base + Log ë³‘í•© í•„ìš”</li>
  <li><strong>ì‚¬ìš©</strong>: ì“°ê¸° ì¤‘ì‹¬ ì›Œí¬ë¡œë“œ</li>
</ul>

<h3 id="ë””ë ‰í† ë¦¬-êµ¬ì¡°-2">ë””ë ‰í† ë¦¬ êµ¬ì¡°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>s3://bucket/hudi-table/
â”œâ”€â”€ .hoodie/
â”‚   â”œâ”€â”€ hoodie.properties
â”‚   â”œâ”€â”€ 20240115120000.commit
â”‚   â”œâ”€â”€ 20240115130000.commit
â”‚   â”œâ”€â”€ 20240115120000.inflight
â”‚   â””â”€â”€ archived/
â”‚       â””â”€â”€ commits/
â”œâ”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-15/
â”‚   â”œâ”€â”€ abc123-0_0-1-0_20240115120000.parquet  <span class="c"># Base file (CoW)</span>
â”‚   â”œâ”€â”€ abc123-0_0-1-0_20240115130000.log      <span class="c"># Log file (MoR)</span>
â”‚   â””â”€â”€ .abc123-0_0-1-0_20240115120000.parquet.crc
â””â”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-16/
    â””â”€â”€ def456-0_0-1-0_20240116100000.parquet
</code></pre></div></div>

<h3 id="hudi-ê¸°ë³¸-ì‚¬ìš©ë²•">Hudi ê¸°ë³¸ ì‚¬ìš©ë²•</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.serializer</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.spark.serializer.KryoSerializer</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># 1. Hudi í…Œì´ë¸” ìƒì„± (Copy on Write)
</span><span class="n">hudi_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">hoodie.table.name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.recordkey.field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.precombine.field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">event_time</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.partitionpath.field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.table.type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">COPY_ON_WRITE</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.operation</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">upsert</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_options</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. Upsert (í•µì‹¬ ê¸°ëŠ¥)
</span><span class="n">updates_df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_options</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. Incremental Query (ì¦ë¶„ ì½ê¸°)
</span><span class="n">incremental_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.query.type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">incremental</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.read.begin.instanttime</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">20240115120000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.read.end.instanttime</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">20240115130000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Time Travel
# íŠ¹ì • ì‹œê°„ì˜ ë°ì´í„°
</span><span class="n">df_snapshot</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">as.of.instant</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">20240115120000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 5. Compaction (MoRì—ì„œ ì¤‘ìš”)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CALL run_compaction(
        table =&gt; </span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">,
        path =&gt; </span><span class="sh">'</span><span class="s">s3://bucket/hudi/events</span><span class="sh">'</span><span class="s">
    )
</span><span class="sh">"""</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="hudi-ìµœì í™”">Hudi ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Clustering (íŒŒì¼ ì¬êµ¬ì„±)
</span><span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.clustering.inline</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span>
<span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.clustering.inline.max.commits</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">4</span><span class="sh">'</span>

<span class="c1"># 2. Indexing
</span><span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.index.type</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">BLOOM</span><span class="sh">'</span>  <span class="c1"># BLOOM, SIMPLE, GLOBAL_BLOOM
</span>
<span class="c1"># 3. File Sizing
</span><span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.parquet.small.file.limit</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">104857600</span><span class="sh">'</span>  <span class="c1"># 100MB
</span><span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.parquet.max.file.size</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">134217728</span><span class="sh">'</span>     <span class="c1"># 128MB
</span>
<span class="c1"># 4. Async Compaction
</span><span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.compact.inline</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span>
<span class="n">hudi_options</span><span class="p">[</span><span class="sh">'</span><span class="s">hoodie.compact.schedule.inline</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span>
</code></pre></div></div>

<hr />

<h2 id="ê¸°ëŠ¥-ë¹„êµ">ğŸ“Š ê¸°ëŠ¥ ë¹„êµ</h2>

<h3 id="acid-íŠ¸ëœì­ì…˜">ACID íŠ¸ëœì­ì…˜</h3>

<table>
  <thead>
    <tr>
      <th><strong>ê¸°ëŠ¥</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Atomicity</strong></td>
      <td>âœ… íŠ¸ëœì­ì…˜ ë¡œê·¸</td>
      <td>âœ… ìŠ¤ëƒ…ìƒ· ê²©ë¦¬</td>
      <td>âœ… Timeline</td>
    </tr>
    <tr>
      <td><strong>Isolation Level</strong></td>
      <td>Serializable</td>
      <td>Snapshot</td>
      <td>Snapshot</td>
    </tr>
    <tr>
      <td><strong>Concurrent Writes</strong></td>
      <td>âœ… ì§€ì›</td>
      <td>âœ… ì§€ì›</td>
      <td>âš ï¸ ì œí•œì </td>
    </tr>
    <tr>
      <td><strong>Optimistic Concurrency</strong></td>
      <td>âœ…</td>
      <td>âœ…</td>
      <td>âš ï¸</td>
    </tr>
  </tbody>
</table>

<h3 id="time-travel">Time Travel</h3>

<table>
  <thead>
    <tr>
      <th><strong>ê¸°ëŠ¥</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë²„ì „ ê¸°ë°˜</strong></td>
      <td>âœ… versionAsOf</td>
      <td>âœ… snapshot-id</td>
      <td>âœ… as.of.instant</td>
    </tr>
    <tr>
      <td><strong>ì‹œê°„ ê¸°ë°˜</strong></td>
      <td>âœ… timestampAsOf</td>
      <td>âœ… as-of-timestamp</td>
      <td>âœ… as.of.instant</td>
    </tr>
    <tr>
      <td><strong>ë³´ì¡´ ê¸°ê°„</strong></td>
      <td>ì„¤ì • ê°€ëŠ¥</td>
      <td>ì„¤ì • ê°€ëŠ¥</td>
      <td>ì„¤ì • ê°€ëŠ¥</td>
    </tr>
    <tr>
      <td><strong>ì„±ëŠ¥</strong></td>
      <td>ë¹ ë¦„</td>
      <td>ë¹ ë¦„</td>
      <td>ë¹ ë¦„</td>
    </tr>
  </tbody>
</table>

<h3 id="schema-evolution">Schema Evolution</h3>

<table>
  <thead>
    <tr>
      <th><strong>ê¸°ëŠ¥</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì»¬ëŸ¼ ì¶”ê°€</strong></td>
      <td>âœ…</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td><strong>ì»¬ëŸ¼ ì‚­ì œ</strong></td>
      <td>âœ…</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td><strong>ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½</strong></td>
      <td>âš ï¸ ì¬ì‘ì„± í•„ìš”</td>
      <td>âœ…</td>
      <td>âš ï¸ ì¬ì‘ì„± í•„ìš”</td>
    </tr>
    <tr>
      <td><strong>íƒ€ì… ë³€ê²½</strong></td>
      <td>âš ï¸ í˜¸í™˜ ê°€ëŠ¥í•œ ê²ƒë§Œ</td>
      <td>âœ… Promotion ì§€ì›</td>
      <td>âš ï¸ ì œí•œì </td>
    </tr>
    <tr>
      <td><strong>ì¤‘ì²© ìŠ¤í‚¤ë§ˆ</strong></td>
      <td>âœ…</td>
      <td>âœ…</td>
      <td>âœ…</td>
    </tr>
  </tbody>
</table>

<h3 id="partition-evolution">Partition Evolution</h3>

<table>
  <thead>
    <tr>
      <th><strong>ê¸°ëŠ¥</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>íŒŒí‹°ì…˜ ë³€ê²½</strong></td>
      <td>âŒ ë¶ˆê°€ëŠ¥</td>
      <td>âœ… ê°€ëŠ¥</td>
      <td>âš ï¸ ì¬ì‘ì„± í•„ìš”</td>
    </tr>
    <tr>
      <td><strong>ê¸°ì¡´ ë°ì´í„°</strong></td>
      <td>ì¬ì‘ì„± í•„ìš”</td>
      <td>ì¬ì‘ì„± ë¶ˆí•„ìš”</td>
      <td>ì¬ì‘ì„± í•„ìš”</td>
    </tr>
    <tr>
      <td><strong>Hidden Partitioning</strong></td>
      <td>âŒ</td>
      <td>âœ…</td>
      <td>âŒ</td>
    </tr>
  </tbody>
</table>

<h3 id="updatedelete-ì„±ëŠ¥">Update/Delete ì„±ëŠ¥</h3>

<table>
  <thead>
    <tr>
      <th><strong>ì‘ì—…</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi (CoW)</strong></th>
      <th><strong>Hudi (MoR)</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Update</strong></td>
      <td>íŒŒí‹°ì…˜ ì¬ì‘ì„±</td>
      <td>íŒŒì¼ ì¬ì‘ì„±</td>
      <td>íŒŒì¼ ì¬ì‘ì„±</td>
      <td>ë¡œê·¸ ì¶”ê°€ âš¡</td>
    </tr>
    <tr>
      <td><strong>Delete</strong></td>
      <td>íŒŒí‹°ì…˜ ì¬ì‘ì„±</td>
      <td>íŒŒì¼ ì¬ì‘ì„±</td>
      <td>íŒŒì¼ ì¬ì‘ì„±</td>
      <td>ë¡œê·¸ ì¶”ê°€ âš¡</td>
    </tr>
    <tr>
      <td><strong>Merge</strong></td>
      <td>âœ… ì§€ì›</td>
      <td>âœ… ì§€ì›</td>
      <td>âœ… ìµœì í™”</td>
      <td>âœ… ìµœì í™”</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="ì‹¤ì œ-ë²¤ì¹˜ë§ˆí¬-ë¹„êµ">ğŸ”¬ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ë¹„êµ</h2>

<h3 id="í…ŒìŠ¤íŠ¸-í™˜ê²½">í…ŒìŠ¤íŠ¸ í™˜ê²½</h3>

<table>
  <thead>
    <tr>
      <th><strong>í•­ëª©</strong></th>
      <th><strong>ì„¤ì •</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë°ì´í„°ì…‹</strong></td>
      <td>TPC-DS 1TB</td>
    </tr>
    <tr>
      <td><strong>Spark ë²„ì „</strong></td>
      <td>3.4.0</td>
    </tr>
    <tr>
      <td><strong>ì¸ìŠ¤í„´ìŠ¤</strong></td>
      <td>r5.4xlarge Ã— 20</td>
    </tr>
    <tr>
      <td><strong>íŒŒì¼ í¬ë§·</strong></td>
      <td>Parquet (Snappy)</td>
    </tr>
    <tr>
      <td><strong>í…Œì´ë¸” ìˆ˜</strong></td>
      <td>10ê°œ ì£¼ìš” í…Œì´ë¸”</td>
    </tr>
  </tbody>
</table>

<h3 id="ë²¤ì¹˜ë§ˆí¬-1-ì´ˆê¸°-ë°ì´í„°-ì ì¬">ë²¤ì¹˜ë§ˆí¬ 1: ì´ˆê¸° ë°ì´í„° ì ì¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1TB ë°ì´í„°ë¥¼ ê° í¬ë§·ìœ¼ë¡œ ì ì¬
</span><span class="kn">import</span> <span class="n">time</span>

<span class="c1"># Delta Lake
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/</span><span class="sh">"</span><span class="p">)</span>
<span class="n">delta_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Iceberg
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="nf">writeTo</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg_table</span><span class="sh">"</span><span class="p">).</span><span class="nf">create</span><span class="p">()</span>
<span class="n">iceberg_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Hudi (CoW)
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">).</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_cow_options</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi_cow/</span><span class="sh">"</span><span class="p">)</span>
<span class="n">hudi_cow_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Hudi (MoR)
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">).</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_mor_options</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi_mor/</span><span class="sh">"</span><span class="p">)</span>
<span class="n">hudi_mor_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</code></pre></div></div>

<h4 id="ì´ˆê¸°-ì ì¬-ì„±ëŠ¥"><strong>ì´ˆê¸° ì ì¬ ì„±ëŠ¥</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì ì¬ ì‹œê°„</strong></th>
      <th><strong>ìŠ¤í† ë¦¬ì§€</strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>18ë¶„ 32ì´ˆ</td>
      <td>98.3 GB</td>
      <td>784</td>
    </tr>
    <tr>
      <td><strong>Delta Lake</strong></td>
      <td>19ë¶„ 47ì´ˆ</td>
      <td>98.5 GB</td>
      <td>784 + ë¡œê·¸</td>
    </tr>
    <tr>
      <td><strong>Iceberg</strong></td>
      <td>20ë¶„ 12ì´ˆ</td>
      <td>98.4 GB</td>
      <td>784 + ë©”íƒ€ë°ì´í„°</td>
    </tr>
    <tr>
      <td><strong>Hudi (CoW)</strong></td>
      <td>21ë¶„ 38ì´ˆ</td>
      <td>98.6 GB</td>
      <td>784 + .hoodie</td>
    </tr>
    <tr>
      <td><strong>Hudi (MoR)</strong></td>
      <td>19ë¶„ 54ì´ˆ</td>
      <td>98.5 GB</td>
      <td>784 + .hoodie</td>
    </tr>
  </tbody>
</table>

<h3 id="ë²¤ì¹˜ë§ˆí¬-2-update-ì„±ëŠ¥">ë²¤ì¹˜ë§ˆí¬ 2: Update ì„±ëŠ¥</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- 10% ë ˆì½”ë“œ ì—…ë°ì´íŠ¸</span>
<span class="k">UPDATE</span> <span class="n">events</span> 
<span class="k">SET</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">1</span> 
<span class="k">WHERE</span> <span class="nb">date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="update-ì„±ëŠ¥-ë¹„êµ"><strong>Update ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>Update ì‹œê°„</strong></th>
      <th><strong>ì˜í–¥ íŒŒì¼</strong></th>
      <th><strong>ì¬ì‘ì„± ë°ì´í„°</strong></th>
      <th><strong>ì½ê¸° ì„±ëŠ¥</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Lake</strong></td>
      <td>42.3ì´ˆ</td>
      <td>íŒŒí‹°ì…˜ ì „ì²´</td>
      <td>9.8 GB</td>
      <td>ë³€í™” ì—†ìŒ</td>
    </tr>
    <tr>
      <td><strong>Iceberg</strong></td>
      <td>38.7ì´ˆ</td>
      <td>ì˜í–¥ë°›ì€ íŒŒì¼ë§Œ</td>
      <td>2.1 GB</td>
      <td>ë³€í™” ì—†ìŒ</td>
    </tr>
    <tr>
      <td><strong>Hudi (CoW)</strong></td>
      <td>45.1ì´ˆ</td>
      <td>ì˜í–¥ë°›ì€ íŒŒì¼ë§Œ</td>
      <td>2.1 GB</td>
      <td>ë³€í™” ì—†ìŒ</td>
    </tr>
    <tr>
      <td><strong>Hudi (MoR)</strong></td>
      <td>8.2ì´ˆ âš¡</td>
      <td>ë¡œê·¸ íŒŒì¼ë§Œ</td>
      <td>210 MB</td>
      <td>ì•½ê°„ ëŠë¦¼</td>
    </tr>
  </tbody>
</table>

<h3 id="ë²¤ì¹˜ë§ˆí¬-3-merge-upsert-ì„±ëŠ¥">ë²¤ì¹˜ë§ˆí¬ 3: Merge (Upsert) ì„±ëŠ¥</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 100ë§Œ ë ˆì½”ë“œ upsert
</span><span class="n">updates_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/updates/</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Delta Lake
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">target</span><span class="sh">"</span><span class="p">).</span><span class="nf">merge</span><span class="p">(</span>
    <span class="n">updates_df</span><span class="p">.</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">source</span><span class="sh">"</span><span class="p">),</span>
    <span class="sh">"</span><span class="s">target.id = source.id</span><span class="sh">"</span>
<span class="p">).</span><span class="nf">whenMatchedUpdate</span><span class="p">(</span><span class="nb">set</span> <span class="o">=</span> <span class="p">{...}).</span><span class="nf">whenNotMatchedInsert</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="p">{...}).</span><span class="nf">execute</span><span class="p">()</span>

<span class="c1"># Iceberg
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"</span><span class="s">MERGE INTO events ...</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Hudi
</span><span class="n">updates_df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">).</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_options</span><span class="p">).</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(...)</span>
</code></pre></div></div>

<h4 id="merge-ì„±ëŠ¥-ë¹„êµ"><strong>Merge ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>Merge ì‹œê°„</strong></th>
      <th><strong>ì²˜ë¦¬ëŸ‰</strong></th>
      <th><strong>ë©”ëª¨ë¦¬ ì‚¬ìš©</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Lake</strong></td>
      <td>3ë¶„ 12ì´ˆ</td>
      <td>5,208 records/s</td>
      <td>24.3 GB</td>
    </tr>
    <tr>
      <td><strong>Iceberg</strong></td>
      <td>2ë¶„ 48ì´ˆ</td>
      <td>5,952 records/s</td>
      <td>22.1 GB</td>
    </tr>
    <tr>
      <td><strong>Hudi (CoW)</strong></td>
      <td>3ë¶„ 34ì´ˆ</td>
      <td>4,673 records/s</td>
      <td>26.8 GB</td>
    </tr>
    <tr>
      <td><strong>Hudi (MoR)</strong></td>
      <td>1ë¶„ 23ì´ˆ âš¡</td>
      <td>12,048 records/s</td>
      <td>18.4 GB</td>
    </tr>
  </tbody>
</table>

<h3 id="ë²¤ì¹˜ë§ˆí¬-4-time-travel-ì„±ëŠ¥">ë²¤ì¹˜ë§ˆí¬ 4: Time Travel ì„±ëŠ¥</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 7ì¼ ì „ ë°ì´í„° ì¡°íšŒ
</span><span class="kn">import</span> <span class="n">time</span>

<span class="c1"># Delta Lake
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">timestampAsOf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-08 00:00:00</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="n">delta_tt_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Iceberg
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">as-of-timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-08 00:00:00</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="n">iceberg_tt_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Hudi
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">as.of.instant</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">20240108000000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="n">hudi_tt_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>
</code></pre></div></div>

<h4 id="time-travel-ì„±ëŠ¥"><strong>Time Travel ì„±ëŠ¥</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ë©”íƒ€ë°ì´í„° ë¡œë“œ</strong></th>
      <th><strong>ë°ì´í„° ì½ê¸°</strong></th>
      <th><strong>ì´ ì‹œê°„</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Lake</strong></td>
      <td>1.2ì´ˆ</td>
      <td>18.4ì´ˆ</td>
      <td>19.6ì´ˆ</td>
    </tr>
    <tr>
      <td><strong>Iceberg</strong></td>
      <td>0.8ì´ˆ</td>
      <td>18.1ì´ˆ</td>
      <td>18.9ì´ˆ âš¡</td>
    </tr>
    <tr>
      <td><strong>Hudi</strong></td>
      <td>2.3ì´ˆ</td>
      <td>18.6ì´ˆ</td>
      <td>20.9ì´ˆ</td>
    </tr>
  </tbody>
</table>

<h3 id="ë²¤ì¹˜ë§ˆí¬-5-ì¦ë¶„-ì½ê¸°-incremental-read">ë²¤ì¹˜ë§ˆí¬ 5: ì¦ë¶„ ì½ê¸° (Incremental Read)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë§ˆì§€ë§‰ ì²˜ë¦¬ ì´í›„ ë³€ê²½ëœ ë°ì´í„°ë§Œ ì½ê¸°
# Hudiì˜ ê°•ë ¥í•œ ê¸°ëŠ¥
</span>
<span class="c1"># Hudi Incremental Query
</span><span class="n">incremental_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.query.type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">incremental</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.read.begin.instanttime</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">20240115120000</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Changed records: </span><span class="si">{</span><span class="n">incremental_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># ê²°ê³¼: Changed records: 145,234 (ì „ì²´ì˜ 0.14%)
</span></code></pre></div></div>

<h4 id="ì¦ë¶„-ì½ê¸°-ì„±ëŠ¥"><strong>ì¦ë¶„ ì½ê¸° ì„±ëŠ¥</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ë°©ë²•</strong></th>
      <th><strong>ì½ê¸° ì‹œê°„</strong></th>
      <th><strong>ìŠ¤ìº” ë°ì´í„°</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Delta Lake</strong></td>
      <td>Change Data Feed</td>
      <td>8.2ì´ˆ</td>
      <td>1.2 GB</td>
    </tr>
    <tr>
      <td><strong>Iceberg</strong></td>
      <td>Incremental Scan</td>
      <td>7.8ì´ˆ</td>
      <td>1.1 GB</td>
    </tr>
    <tr>
      <td><strong>Hudi</strong></td>
      <td>Incremental Query</td>
      <td>3.4ì´ˆ âš¡</td>
      <td>0.4 GB</td>
    </tr>
  </tbody>
</table>

<p><strong>í•µì‹¬</strong>: HudiëŠ” ì¦ë¶„ ì²˜ë¦¬ì— ìµœì í™”ë˜ì–´ CDC íŒŒì´í”„ë¼ì¸ì— ì í•©</p>

<hr />

<h2 id="ìƒí™©ë³„-ìµœì -ì„ íƒ">ğŸ¯ ìƒí™©ë³„ ìµœì  ì„ íƒ</h2>

<h3 id="ì„ íƒ-ê°€ì´ë“œ-ë§¤íŠ¸ë¦­ìŠ¤">ì„ íƒ ê°€ì´ë“œ ë§¤íŠ¸ë¦­ìŠ¤</h3>

<table>
  <thead>
    <tr>
      <th><strong>ìš”êµ¬ì‚¬í•­</strong></th>
      <th><strong>Delta Lake</strong></th>
      <th><strong>Iceberg</strong></th>
      <th><strong>Hudi</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Databricks ì‚¬ìš©</strong></td>
      <td>â­â­â­</td>
      <td>â­â­</td>
      <td>â­</td>
    </tr>
    <tr>
      <td><strong>AWS í™˜ê²½</strong></td>
      <td>â­â­</td>
      <td>â­â­â­</td>
      <td>â­â­</td>
    </tr>
    <tr>
      <td><strong>ë‹¤ì–‘í•œ ì—”ì§„ ì§€ì›</strong></td>
      <td>â­â­</td>
      <td>â­â­â­</td>
      <td>â­</td>
    </tr>
    <tr>
      <td><strong>ë¹ˆë²ˆí•œ Update</strong></td>
      <td>â­â­</td>
      <td>â­â­</td>
      <td>â­â­â­</td>
    </tr>
    <tr>
      <td><strong>CDC íŒŒì´í”„ë¼ì¸</strong></td>
      <td>â­â­</td>
      <td>â­â­</td>
      <td>â­â­â­</td>
    </tr>
    <tr>
      <td><strong>ì½ê¸° ì¤‘ì‹¬</strong></td>
      <td>â­â­â­</td>
      <td>â­â­â­</td>
      <td>â­â­</td>
    </tr>
    <tr>
      <td><strong>ì“°ê¸° ì¤‘ì‹¬</strong></td>
      <td>â­â­</td>
      <td>â­â­</td>
      <td>â­â­â­</td>
    </tr>
    <tr>
      <td><strong>Partition Evolution</strong></td>
      <td>â­</td>
      <td>â­â­â­</td>
      <td>â­</td>
    </tr>
    <tr>
      <td><strong>ì»¤ë®¤ë‹ˆí‹°</strong></td>
      <td>â­â­â­</td>
      <td>â­â­â­</td>
      <td>â­â­</td>
    </tr>
  </tbody>
</table>

<h3 id="use-case-1-databricks-ê¸°ë°˜-ë¶„ì„-í”Œë«í¼">Use Case 1: Databricks ê¸°ë°˜ ë¶„ì„ í”Œë«í¼</h3>

<h4 id="ì¶”ì²œ-delta-lake"><strong>ì¶”ì²œ: Delta Lake</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Databricksì—ì„œ Delta Lake ì‚¬ìš©
# 1. Unity Catalog í†µí•©
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE main.analytics.events
    USING DELTA
    PARTITIONED BY (date)
    LOCATION </span><span class="sh">'</span><span class="s">s3://bucket/delta/events</span><span class="sh">'</span><span class="s">
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># 2. Delta Live Tables (DLT)
</span><span class="nd">@dlt.table</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="sh">"</span><span class="s">events_gold</span><span class="sh">"</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="sh">"</span><span class="s">Cleansed events table</span><span class="sh">"</span>
<span class="p">)</span>
<span class="k">def</span> <span class="nf">events_gold</span><span class="p">():</span>
    <span class="nf">return </span><span class="p">(</span>
        <span class="n">dlt</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="sh">"</span><span class="s">events_silver</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="sh">"</span><span class="s">amount &gt; 0</span><span class="sh">"</span><span class="p">)</span>
        <span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span>
    <span class="p">)</span>

<span class="c1"># 3. Photon ì—”ì§„ ìµœì í™”
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.databricks.photon.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… Databricks ë„¤ì´í‹°ë¸Œ ì§€ì›</li>
  <li>âœ… Unity Catalog í†µí•©</li>
  <li>âœ… Photon ì—”ì§„ ìµœì í™”</li>
  <li>âœ… Delta Live Tables</li>
</ul>

<h3 id="use-case-2-ë©€í‹°-ì—”ì§„-ë°ì´í„°-ë ˆì´í¬í•˜ìš°ìŠ¤">Use Case 2: ë©€í‹° ì—”ì§„ ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤</h3>

<h4 id="ì¶”ì²œ-apache-iceberg"><strong>ì¶”ì²œ: Apache Iceberg</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Spark, Presto, Flink, Athena ëª¨ë‘ ì§€ì›
# 1. Sparkì—ì„œ ìƒì„±
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE iceberg_catalog.db.events (
        id INT,
        name STRING,
        amount DOUBLE
    )
    USING iceberg
    PARTITIONED BY (days(event_time))
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># 2. Prestoì—ì„œ ì¿¼ë¦¬
# SELECT * FROM iceberg.db.events WHERE date = DATE '2024-01-15'
</span>
<span class="c1"># 3. Flinkì—ì„œ ìŠ¤íŠ¸ë¦¬ë° ì“°ê¸°
</span><span class="n">tableEnv</span><span class="p">.</span><span class="nf">executeSql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE events (
        id INT,
        name STRING,
        amount DOUBLE,
        event_time TIMESTAMP(3)
    ) WITH (
        </span><span class="sh">'</span><span class="s">connector</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">iceberg</span><span class="sh">'</span><span class="s">,
        </span><span class="sh">'</span><span class="s">catalog-name</span><span class="sh">'</span><span class="s"> = </span><span class="sh">'</span><span class="s">iceberg_catalog</span><span class="sh">'</span><span class="s">
    )
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># 4. AWS Glue Catalog í†µí•©
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.glue_catalog</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.iceberg.spark.SparkCatalog</span><span class="sh">"</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.glue_catalog.warehouse</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">s3://bucket/warehouse</span><span class="sh">"</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.catalog.glue_catalog.catalog-impl</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">org.apache.iceberg.aws.glue.GlueCatalog</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… ê°€ì¥ ë§ì€ ì—”ì§„ ì§€ì›</li>
  <li>âœ… AWS Glue í†µí•©</li>
  <li>âœ… ë²¤ë” ì¤‘ë¦½ì </li>
  <li>âœ… Partition Evolution</li>
</ul>

<h3 id="use-case-3-cdc-ë°-ì‹¤ì‹œê°„-upsert">Use Case 3: CDC ë° ì‹¤ì‹œê°„ Upsert</h3>

<h4 id="ì¶”ì²œ-apache-hudi-mor"><strong>ì¶”ì²œ: Apache Hudi (MoR)</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Kafka CDC â†’ Hudi MoR íŒŒì´í”„ë¼ì¸
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">CDC to Hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># 1. Kafkaì—ì„œ CDC ì´ë²¤íŠ¸ ì½ê¸°
</span><span class="n">cdc_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">readStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">kafka.bootstrap.servers</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">localhost:9092</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">subscribe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">mysql.events</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">()</span>

<span class="c1"># 2. CDC ì´ë²¤íŠ¸ íŒŒì‹±
</span><span class="n">parsed_df</span> <span class="o">=</span> <span class="n">cdc_df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span>
    <span class="nf">from_json</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="p">),</span> <span class="n">cdc_schema</span><span class="p">).</span><span class="nf">alias</span><span class="p">(</span><span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">)</span>
<span class="p">).</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">data.*</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. Hudi MoRë¡œ ìŠ¤íŠ¸ë¦¬ë° ì“°ê¸°
</span><span class="n">hudi_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">hoodie.table.name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.table.type</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">MERGE_ON_READ</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.operation</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">upsert</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.recordkey.field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.datasource.write.precombine.field</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">updated_at</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.compact.inline</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">false</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">hoodie.compact.schedule.inline</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">true</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">parsed_df</span><span class="p">.</span><span class="n">writeStream</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_options</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">outputMode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">checkpointLocation</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">s3://bucket/checkpoints/</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. ì¦ë¶„ ì½ê¸°ë¡œ downstream ì²˜ë¦¬
</span><span class="n">incremental_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.query.type</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">incremental</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">hoodie.datasource.read.begin.instanttime</span><span class="sh">"</span><span class="p">,</span> <span class="n">last_commit_time</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… ë¹ ë¥¸ upsert ì„±ëŠ¥</li>
  <li>âœ… ì¦ë¶„ ì½ê¸° ìµœì í™”</li>
  <li>âœ… MoRë¡œ ì“°ê¸° ë¶€í•˜ ìµœì†Œí™”</li>
  <li>âœ… CDCì— íŠ¹í™”ëœ ê¸°ëŠ¥</li>
</ul>

<h3 id="use-case-4-ëŒ€ê·œëª¨-ë°°ì¹˜-ë¶„ì„">Use Case 4: ëŒ€ê·œëª¨ ë°°ì¹˜ ë¶„ì„</h3>

<h4 id="ì¶”ì²œ-delta-lake-ë˜ëŠ”-iceberg"><strong>ì¶”ì²œ: Delta Lake ë˜ëŠ” Iceberg</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ëŒ€ê·œëª¨ ë°°ì¹˜ ETL
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Batch Analytics</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># Delta Lake
</span><span class="n">delta_table</span> <span class="o">=</span> <span class="n">DeltaTable</span><span class="p">.</span><span class="nf">forPath</span><span class="p">(</span><span class="n">spark</span><span class="p">,</span> <span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Z-Orderingìœ¼ë¡œ ì¿¼ë¦¬ ìµœì í™”
</span><span class="n">delta_table</span><span class="p">.</span><span class="nf">optimize</span><span class="p">()</span> \
    <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="sh">"</span><span class="s">date &gt;= </span><span class="sh">'</span><span class="s">2024-01-01</span><span class="sh">'"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">executeZOrderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">product_id</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Iceberg
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CALL spark_catalog.system.rewrite_data_files(
        table =&gt; </span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="s">,
        strategy =&gt; </span><span class="sh">'</span><span class="s">sort</span><span class="sh">'</span><span class="s">,
        sort_order =&gt; </span><span class="sh">'</span><span class="s">user_id, product_id</span><span class="sh">'</span><span class="s">
    )
</span><span class="sh">"""</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… ì½ê¸° ì„±ëŠ¥ ìµœì í™”</li>
  <li>âœ… ëŒ€ê·œëª¨ ë°°ì¹˜ ì²˜ë¦¬ ì•ˆì •ì„±</li>
  <li>âœ… í†µê³„ ê¸°ë°˜ ìµœì í™”</li>
</ul>

<hr />

<h2 id="ë§ˆì´ê·¸ë ˆì´ì…˜-ê°€ì´ë“œ">ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</h2>

<h3 id="parquet--delta-lake">Parquet â†’ Delta Lake</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ê¸°ì¡´ Parquet í…Œì´ë¸”ì„ Delta Lakeë¡œ ë³€í™˜
</span><span class="kn">from</span> <span class="n">delta.tables</span> <span class="kn">import</span> <span class="n">DeltaTable</span>

<span class="c1"># 1. In-place ë³€í™˜
</span><span class="n">DeltaTable</span><span class="p">.</span><span class="nf">convertToDelta</span><span class="p">(</span>
    <span class="n">spark</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">parquet.`s3://bucket/events`</span><span class="sh">"</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">date STRING</span><span class="sh">"</span>
<span class="p">)</span>

<span class="c1"># 2. ìƒˆë¡œìš´ ìœ„ì¹˜ë¡œ ë³€í™˜
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/parquet/events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. ê²€ì¦
</span><span class="n">delta_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">parquet_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/parquet/events</span><span class="sh">"</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">delta_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">==</span> <span class="n">parquet_df</span><span class="p">.</span><span class="nf">count</span><span class="p">(),</span> <span class="sh">"</span><span class="s">Count mismatch!</span><span class="sh">"</span>
</code></pre></div></div>

<h3 id="parquet--iceberg">Parquet â†’ Iceberg</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Parquetë¥¼ Icebergë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜
# 1. ê¸°ì¡´ Parquet ìœ„ì¹˜ì— Iceberg ë©”íƒ€ë°ì´í„° ìƒì„±
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE iceberg_catalog.db.events
    USING iceberg
    LOCATION </span><span class="sh">'</span><span class="s">s3://bucket/parquet/events</span><span class="sh">'</span><span class="s">
    AS SELECT * FROM parquet.`s3://bucket/parquet/events`
</span><span class="sh">"""</span><span class="p">)</span>

<span class="c1"># 2. ë˜ëŠ” CTAS (Create Table As Select)
</span><span class="n">spark</span><span class="p">.</span><span class="nf">sql</span><span class="p">(</span><span class="sh">"""</span><span class="s">
    CREATE TABLE iceberg_catalog.db.events
    USING iceberg
    PARTITIONED BY (date)
    AS SELECT * FROM parquet.`s3://bucket/parquet/events`
</span><span class="sh">"""</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="delta-lake--iceberg-ìƒí˜¸-ë³€í™˜">Delta Lake â†” Iceberg ìƒí˜¸ ë³€í™˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Delta Lake â†’ Iceberg
</span><span class="n">delta_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">delta_df</span><span class="p">.</span><span class="nf">writeTo</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg_catalog.db.events</span><span class="sh">"</span><span class="p">).</span><span class="nf">create</span><span class="p">()</span>

<span class="c1"># Iceberg â†’ Delta Lake
</span><span class="n">iceberg_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">iceberg_catalog.db.events</span><span class="sh">"</span><span class="p">)</span>
<span class="n">iceberg_df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì ì§„ì -ë§ˆì´ê·¸ë ˆì´ì…˜-ì „ëµ">ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ëµ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># íŒŒí‹°ì…˜ë³„ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
</span><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="k">def</span> <span class="nf">migrate_partition</span><span class="p">(</span><span class="n">source_format</span><span class="p">,</span> <span class="n">target_format</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">íŠ¹ì • íŒŒí‹°ì…˜ì„ ìƒˆë¡œìš´ í¬ë§·ìœ¼ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜</span><span class="sh">"""</span>
    
    <span class="c1"># ì†ŒìŠ¤ ì½ê¸°
</span>    <span class="k">if</span> <span class="n">source_format</span> <span class="o">==</span> <span class="sh">"</span><span class="s">parquet</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/parquet/events/date=</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">source_format</span> <span class="o">==</span> <span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">delta</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/delta/events</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">where</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">date = </span><span class="sh">'</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="sh">'"</span><span class="p">)</span>
    
    <span class="c1"># íƒ€ê²Ÿ ì“°ê¸°
</span>    <span class="k">if</span> <span class="n">target_format</span> <span class="o">==</span> <span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">df</span><span class="p">.</span><span class="nf">writeTo</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">iceberg_catalog.db.events</span><span class="sh">"</span><span class="p">).</span><span class="nf">append</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">target_format</span> <span class="o">==</span> <span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">:</span>
        <span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">hudi</span><span class="sh">"</span><span class="p">).</span><span class="nf">options</span><span class="p">(</span><span class="o">**</span><span class="n">hudi_options</span><span class="p">).</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">append</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/hudi/events</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ“ Migrated: </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì „ì²´ ê¸°ê°„ ë§ˆì´ê·¸ë ˆì´ì…˜
</span><span class="n">start_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>

<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_date</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nf">migrate_partition</span><span class="p">(</span><span class="sh">"</span><span class="s">parquet</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">iceberg</span><span class="sh">"</span><span class="p">,</span> <span class="n">date_str</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ— Failed: </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">current_date</span> <span class="o">+=</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="í•µì‹¬-í¬ì¸íŠ¸">í•µì‹¬ í¬ì¸íŠ¸</h3>

<ol>
  <li><strong>í…Œì´ë¸” í¬ë§·ì˜ í•„ìš”ì„±</strong>
    <ul>
      <li>ACID íŠ¸ëœì­ì…˜ ë³´ì¥</li>
      <li>Time Travel ë° ë²„ì „ ê´€ë¦¬</li>
      <li>íš¨ìœ¨ì ì¸ Update/Delete/Merge</li>
      <li>ìŠ¤í‚¤ë§ˆ ì§„í™” ì§€ì›</li>
    </ul>
  </li>
  <li><strong>í¬ë§·ë³„ íŠ¹ì§•</strong>
    <ul>
      <li><strong>Delta Lake</strong>: Databricks ìµœì í™”, ì‰¬ìš´ ì‚¬ìš©</li>
      <li><strong>Iceberg</strong>: ë©€í‹° ì—”ì§„, Partition Evolution</li>
      <li><strong>Hudi</strong>: CDC ìµœì í™”, ë¹ ë¥¸ upsert</li>
    </ul>
  </li>
  <li><strong>ì„±ëŠ¥ ë¹„êµ ìš”ì•½</strong>
    <ul>
      <li><strong>ì´ˆê¸° ì ì¬</strong>: ë¹„ìŠ· (ì•½ 20ë¶„/1TB)</li>
      <li><strong>Update</strong>: Hudi MoR ì••ë„ì  (8.2ì´ˆ vs 40ì´ˆëŒ€)</li>
      <li><strong>Merge</strong>: Hudi MoR ê°€ì¥ ë¹ ë¦„ (1ë¶„ 23ì´ˆ)</li>
      <li><strong>ì¦ë¶„ ì½ê¸°</strong>: Hudi ìµœì í™” (3.4ì´ˆ)</li>
    </ul>
  </li>
  <li><strong>ì„ íƒ ê¸°ì¤€</strong>
    <ul>
      <li><strong>Databricks</strong>: Delta Lake</li>
      <li><strong>AWS + ë©€í‹° ì—”ì§„</strong>: Iceberg</li>
      <li><strong>CDC + Upsert ì¤‘ì‹¬</strong>: Hudi</li>
      <li><strong>ë²”ìš©</strong>: Delta Lake ë˜ëŠ” Iceberg</li>
    </ul>
  </li>
</ol>

<h3 id="ì‹¤ë¬´-ì²´í¬ë¦¬ìŠ¤íŠ¸">ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì‚¬ìš© í”Œë«í¼ í™•ì¸ (Databricks, AWS, On-prem)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì¿¼ë¦¬ ì—”ì§„ í™•ì¸ (Spark, Presto, Flink)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì›Œí¬ë¡œë“œ ë¶„ì„ (ì½ê¸°/ì“°ê¸° ë¹„ìœ¨)</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Update/Delete ë¹ˆë„ íŒŒì•…</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¹ˆë„ í™•ì¸</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì¦ë¶„ ì²˜ë¦¬ í•„ìš”ì„± í‰ê°€</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />POC ë²¤ì¹˜ë§ˆí¬ ìˆ˜í–‰</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½</li>
</ul>

<h3 id="ë‹¤ìŒ-ë‹¨ê³„">ë‹¤ìŒ ë‹¨ê³„</h3>

<ul>
  <li><strong>Lakehouse ì•„í‚¤í…ì²˜</strong>: Unity Catalog, Glue Catalog</li>
  <li><strong>ì„±ëŠ¥ íŠœë‹</strong>: Compaction, Z-Ordering, Clustering</li>
  <li><strong>ìš´ì˜ ìë™í™”</strong>: Vacuum, Expire snapshots</li>
  <li><strong>ê±°ë²„ë„ŒìŠ¤</strong>: ë°ì´í„° í’ˆì§ˆ, ì ‘ê·¼ ì œì–´</li>
</ul>

<hr />

<blockquote>
  <p><strong>â€œí…Œì´ë¸” í¬ë§·ì€ ë°ì´í„° ë ˆì´í¬ë¥¼ ë°ì´í„° ë ˆì´í¬í•˜ìš°ìŠ¤ë¡œ ì§„í™”ì‹œí‚¤ëŠ” í•µì‹¬ ê¸°ìˆ ì…ë‹ˆë‹¤.â€</strong></p>
</blockquote>

<p>Delta Lake, Iceberg, HudiëŠ” ê°ê°ì˜ ê°•ì ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ì™„ë²½í•œ ì •ë‹µì€ ì—†ìŠµë‹ˆë‹¤. ìì‹ ì˜ í™˜ê²½ê³¼ ìš”êµ¬ì‚¬í•­ì„ ì •í™•íˆ íŒŒì•…í•˜ê³ , ì‹¤ì œ POCë¥¼ í†µí•´ ê²€ì¦í•œ í›„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ì´ ê°€ì´ë“œê°€ ì˜¬ë°”ë¥¸ ì„ íƒì— ë„ì›€ì´ ë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤!</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/10/17/data-lake-file-format-comparison.html" class="nav-link prev">
          â† ì´ì „: Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ
        </a>
      
      
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
