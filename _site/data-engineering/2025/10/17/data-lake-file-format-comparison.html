<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="ë°ì´í„° ë ˆì´í¬ì˜ í•µì‹¬ íŒŒì¼ í¬ë§·ì¸ Parquet, ORC, Avroë¥¼ ë‚´ë¶€ êµ¬ì¡°ë¶€í„° ì„±ëŠ¥, ì••ì¶•ë¥ , í˜¸í™˜ì„±ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">



<title>Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ">
<meta property="og:description" content="ë°ì´í„° ë ˆì´í¬ì˜ í•µì‹¬ íŒŒì¼ í¬ë§·ì¸ Parquet, ORC, Avroë¥¼ ë‚´ë¶€ êµ¬ì¡°ë¶€í„° ì„±ëŠ¥, ì••ì¶•ë¥ , í˜¸í™˜ì„±ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">
<meta property="og:url" content="http://localhost:4000/data-engineering/2025/10/17/data-lake-file-format-comparison.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ">
<meta name="twitter:description" content="ë°ì´í„° ë ˆì´í¬ì˜ í•µì‹¬ íŒŒì¼ í¬ë§·ì¸ Parquet, ORC, Avroë¥¼ ë‚´ë¶€ êµ¬ì¡°ë¶€í„° ì„±ëŠ¥, ì••ì¶•ë¥ , í˜¸í™˜ì„±ê¹Œì§€ ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ë¡œ ì™„ì „ ë¹„êµí•©ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/10/17/data-lake-file-format-comparison.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-10-17-data-lake-file-format-comparison.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 10ì›” 17ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">Parquet</span>
      
        <span class="tag">ORC</span>
      
        <span class="tag">Avro</span>
      
        <span class="tag">DataLake</span>
      
        <span class="tag">FileFormat</span>
      
        <span class="tag">Performance</span>
      
        <span class="tag">Compression</span>
      
        <span class="tag">Spark</span>
      
        <span class="tag">Hive</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Cloud data architecture ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 3</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 55ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ì¤‘ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="ï¸-parquet-vs-orc-vs-avro-ì‹¤ì „-ë¹„êµ---ë°ì´í„°-ë ˆì´í¬-íŒŒì¼-í¬ë§·-ì™„ì „-ì •ë³µ">ğŸ—„ï¸ Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ</h1>

<blockquote>
  <p><strong>â€œì˜¬ë°”ë¥¸ íŒŒì¼ í¬ë§· ì„ íƒì€ ì„±ëŠ¥ê³¼ ë¹„ìš©ì˜ ì°¨ì´ë¥¼ 10ë°° ì´ìƒ ë§Œë“¤ ìˆ˜ ìˆë‹¤â€</strong> - ë°ì´í„° ë ˆì´í¬ êµ¬ì¶•ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²°ì • ì¤‘ í•˜ë‚˜</p>
</blockquote>

<p>ë°ì´í„° ë ˆì´í¬ë¥¼ êµ¬ì¶•í•  ë•Œ ê°€ì¥ ë¨¼ì € ë§ˆì£¼í•˜ëŠ” ì§ˆë¬¸ì€ â€œì–´ë–¤ íŒŒì¼ í¬ë§·ì„ ì‚¬ìš©í•  ê²ƒì¸ê°€?â€ì…ë‹ˆë‹¤. Parquet, ORC, AvroëŠ” ê°ê° ê³ ìœ í•œ íŠ¹ì„±ê³¼ ì¥ë‹¨ì ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ì˜ëª»ëœ ì„ íƒì€ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ì™€ ë¹„ìš© ì¦ê°€ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” ì„¸ ê°€ì§€ í¬ë§·ì˜ ë‚´ë¶€ êµ¬ì¡°, ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼, ê·¸ë¦¬ê³  ìƒí™©ë³„ ìµœì  ì„ íƒ ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="-ëª©ì°¨">ğŸ“š ëª©ì°¨</h2>

<ul>
  <li><a href="#íŒŒì¼-í¬ë§·-ê°œìš”">íŒŒì¼ í¬ë§· ê°œìš”</a></li>
  <li><a href="#parquet-ë‚´ë¶€-êµ¬ì¡°">Parquet ë‚´ë¶€ êµ¬ì¡°</a></li>
  <li><a href="#orc-ë‚´ë¶€-êµ¬ì¡°">ORC ë‚´ë¶€ êµ¬ì¡°</a></li>
  <li><a href="#avro-ë‚´ë¶€-êµ¬ì¡°">Avro ë‚´ë¶€ êµ¬ì¡°</a></li>
  <li><a href="#ì‹¤ì œ-ë²¤ì¹˜ë§ˆí¬-ë¹„êµ">ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ë¹„êµ</a></li>
  <li><a href="#ìƒí™©ë³„-ìµœì -í¬ë§·-ì„ íƒ">ìƒí™©ë³„ ìµœì  í¬ë§· ì„ íƒ</a></li>
  <li><a href="#í¬ë§·-ì „í™˜-ê°€ì´ë“œ">í¬ë§· ì „í™˜ ê°€ì´ë“œ</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ul>

<hr />

<h2 id="íŒŒì¼-í¬ë§·-ê°œìš”">ğŸ“‹ íŒŒì¼ í¬ë§· ê°œìš”</h2>

<h3 id="ì£¼ìš”-íŒŒì¼-í¬ë§·-ë¹„êµ">ì£¼ìš” íŒŒì¼ í¬ë§· ë¹„êµ</h3>

<table>
  <thead>
    <tr>
      <th><strong>íŠ¹ì„±</strong></th>
      <th><strong>Parquet</strong></th>
      <th><strong>ORC</strong></th>
      <th><strong>Avro</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì €ì¥ ë°©ì‹</strong></td>
      <td>ì—´ ê¸°ë°˜ (Columnar)</td>
      <td>ì—´ ê¸°ë°˜ (Columnar)</td>
      <td>í–‰ ê¸°ë°˜ (Row-based)</td>
    </tr>
    <tr>
      <td><strong>ì••ì¶•ë¥ </strong></td>
      <td>ë†’ìŒ (4-10x)</td>
      <td>ë§¤ìš° ë†’ìŒ (5-12x)</td>
      <td>ì¤‘ê°„ (2-4x)</td>
    </tr>
    <tr>
      <td><strong>ì½ê¸° ì„±ëŠ¥</strong></td>
      <td>ë§¤ìš° ë¹ ë¦„</td>
      <td>ë§¤ìš° ë¹ ë¦„</td>
      <td>ëŠë¦¼</td>
    </tr>
    <tr>
      <td><strong>ì“°ê¸° ì„±ëŠ¥</strong></td>
      <td>ì¤‘ê°„</td>
      <td>ì¤‘ê°„</td>
      <td>ë¹ ë¦„</td>
    </tr>
    <tr>
      <td><strong>ìŠ¤í‚¤ë§ˆ ì§„í™”</strong></td>
      <td>ì œí•œì </td>
      <td>ì œí•œì </td>
      <td>ìš°ìˆ˜</td>
    </tr>
    <tr>
      <td><strong>ìƒíƒœê³„</strong></td>
      <td>Spark, Presto, Athena</td>
      <td>Hive, Presto</td>
      <td>Kafka, Streaming</td>
    </tr>
    <tr>
      <td><strong>íŒŒì¼ í¬ê¸°</strong></td>
      <td>ì‘ìŒ</td>
      <td>ë” ì‘ìŒ</td>
      <td>í¼</td>
    </tr>
  </tbody>
</table>

<h3 id="ì–¸ì œ-ì–´ë–¤-í¬ë§·ì„-ì‚¬ìš©í• ê¹Œ">ì–¸ì œ ì–´ë–¤ í¬ë§·ì„ ì‚¬ìš©í• ê¹Œ?</h3>

<table>
  <thead>
    <tr>
      <th><strong>ì‚¬ìš© ì¼€ì´ìŠ¤</strong></th>
      <th><strong>ì¶”ì²œ í¬ë§·</strong></th>
      <th><strong>ì´ìœ </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë¶„ì„ìš© ë°ì´í„° ë ˆì´í¬</strong></td>
      <td>Parquet</td>
      <td>ë²”ìš©ì„±, Spark/Athena ìµœì í™”</td>
    </tr>
    <tr>
      <td><strong>Hive ì¤‘ì‹¬ í™˜ê²½</strong></td>
      <td>ORC</td>
      <td>Hiveì™€ ì™„ë²½í•œ í†µí•©</td>
    </tr>
    <tr>
      <td><strong>ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°</strong></td>
      <td>Avro</td>
      <td>ë¹ ë¥¸ ì“°ê¸°, ìŠ¤í‚¤ë§ˆ ì§„í™”</td>
    </tr>
    <tr>
      <td><strong>ë¡œê·¸ ìˆ˜ì§‘</strong></td>
      <td>Parquet</td>
      <td>ì••ì¶•ë¥ , ë¶„ì„ ì„±ëŠ¥</td>
    </tr>
    <tr>
      <td><strong>CDC íŒŒì´í”„ë¼ì¸</strong></td>
      <td>Avro â†’ Parquet</td>
      <td>ìŠ¤íŠ¸ë¦¬ë° + ë°°ì¹˜ ë³€í™˜</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="parquet-ë‚´ë¶€-êµ¬ì¡°">ğŸ”· Parquet ë‚´ë¶€ êµ¬ì¡°</h2>

<h3 id="ì„¤ê³„-ì² í•™">ì„¤ê³„ ì² í•™</h3>

<p>ParquetëŠ” <strong>ì¤‘ì²©ëœ ë°ì´í„° êµ¬ì¡°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì €ì¥</strong>í•˜ê¸° ìœ„í•´ Google Dremel ë…¼ë¬¸ì„ ê¸°ë°˜ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<h4 id="í•µì‹¬-íŠ¹ì§•"><strong>í•µì‹¬ íŠ¹ì§•</strong></h4>
<ul>
  <li><strong>Columnar Storage</strong>: ì»¬ëŸ¼ë³„ë¡œ ë°ì´í„° ì €ì¥</li>
  <li><strong>Nested Data Support</strong>: ë³µì¡í•œ ì¤‘ì²© êµ¬ì¡° ì§€ì›</li>
  <li><strong>Efficient Compression</strong>: ì»¬ëŸ¼ íƒ€ì…ì— ë”°ë¥¸ ìµœì  ì••ì¶•</li>
  <li><strong>Predicate Pushdown</strong>: íŒŒì¼ ìˆ˜ì¤€ í†µê³„ë¡œ ë¶ˆí•„ìš”í•œ ì½ê¸° ìŠ¤í‚µ</li>
</ul>

<h3 id="íŒŒì¼-êµ¬ì¡°">íŒŒì¼ êµ¬ì¡°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Parquet File Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header (Magic: PAR1)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Row Group 1                     â”‚
â”‚  â”œâ”€â”€ Column Chunk A             â”‚
â”‚  â”‚   â”œâ”€â”€ Page 1 (compressed)    â”‚
â”‚  â”‚   â”œâ”€â”€ Page 2 (compressed)    â”‚
â”‚  â”‚   â””â”€â”€ Page 3 (compressed)    â”‚
â”‚  â”œâ”€â”€ Column Chunk B             â”‚
â”‚  â””â”€â”€ Column Chunk C             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Row Group 2                     â”‚
â”‚  â”œâ”€â”€ Column Chunk A             â”‚
â”‚  â”œâ”€â”€ Column Chunk B             â”‚
â”‚  â””â”€â”€ Column Chunk C             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Footer Metadata                 â”‚
â”‚  â”œâ”€â”€ Schema                     â”‚
â”‚  â”œâ”€â”€ Row Group Metadata         â”‚
â”‚  â”œâ”€â”€ Column Statistics          â”‚
â”‚  â””â”€â”€ Compression Codec          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ Footer Size (4 bytes)           â”‚
â”‚ Magic: PAR1 (4 bytes)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="row-groupê³¼-page">Row Groupê³¼ Page</h3>

<h4 id="row-group"><strong>Row Group</strong></h4>
<ul>
  <li><strong>ì •ì˜</strong>: í–‰ì˜ ë…¼ë¦¬ì  ê·¸ë£¹ (ê¸°ë³¸ 128MB)</li>
  <li><strong>ëª©ì </strong>: ë³‘ë ¬ ì²˜ë¦¬ ë‹¨ìœ„</li>
  <li><strong>í†µê³„</strong>: Min/Max/Null count per column</li>
</ul>

<h4 id="page"><strong>Page</strong></h4>
<ul>
  <li><strong>ì •ì˜</strong>: ì••ì¶• ë° ì¸ì½”ë”© ë‹¨ìœ„ (ê¸°ë³¸ 1MB)</li>
  <li><strong>ì¸ì½”ë”©</strong>: Dictionary, RLE, Delta encoding</li>
  <li><strong>ì••ì¶•</strong>: Snappy, GZIP, LZO, ZSTD</li>
</ul>

<h3 id="parquet-ìƒì„±-ì˜ˆì œ">Parquet ìƒì„± ì˜ˆì œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.types</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Parquet Example</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ë°ì´í„° ìƒì„±
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">,</span> <span class="mf">100.5</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-15</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="sh">"</span><span class="s">Bob</span><span class="sh">"</span><span class="p">,</span> <span class="mf">200.3</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-15</span><span class="sh">"</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="sh">"</span><span class="s">Charlie</span><span class="sh">"</span><span class="p">,</span> <span class="mf">150.7</span><span class="p">,</span> <span class="sh">"</span><span class="s">2024-01-15</span><span class="sh">"</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">schema</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">(),</span> <span class="bp">False</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">False</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="nc">DoubleType</span><span class="p">(),</span> <span class="bp">False</span><span class="p">),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">(),</span> <span class="bp">False</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="nf">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

<span class="c1"># Parquet ì„¤ì • ìµœì í™”
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.block.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">134217728</span><span class="p">)</span>  <span class="c1"># 128MB
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.page.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1048576</span><span class="p">)</span>     <span class="c1"># 1MB
</span>
<span class="c1"># ì €ì¥
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events.parquet</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="parquet-ë©”íƒ€ë°ì´í„°-ë¶„ì„">Parquet ë©”íƒ€ë°ì´í„° ë¶„ì„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Parquet íŒŒì¼ ë©”íƒ€ë°ì´í„° ì½ê¸°
</span><span class="kn">import</span> <span class="n">pyarrow.parquet</span> <span class="k">as</span> <span class="n">pq</span>

<span class="n">parquet_file</span> <span class="o">=</span> <span class="n">pq</span><span class="p">.</span><span class="nc">ParquetFile</span><span class="p">(</span><span class="sh">'</span><span class="s">events.parquet</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># ìŠ¤í‚¤ë§ˆ í™•ì¸
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Schema:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">.</span><span class="n">schema</span><span class="p">)</span>

<span class="c1"># Row Group ì •ë³´
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Row Groups: </span><span class="si">{</span><span class="n">parquet_file</span><span class="p">.</span><span class="n">num_row_groups</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Row Groupë³„ í†µê³„
</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">parquet_file</span><span class="p">.</span><span class="n">num_row_groups</span><span class="p">):</span>
    <span class="n">rg</span> <span class="o">=</span> <span class="n">parquet_file</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="nf">row_group</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Row Group </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Rows: </span><span class="si">{</span><span class="n">rg</span><span class="p">.</span><span class="n">num_rows</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Total Size: </span><span class="si">{</span><span class="n">rg</span><span class="p">.</span><span class="n">total_byte_size</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> MB</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># ì»¬ëŸ¼ë³„ í†µê³„
</span>    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">rg</span><span class="p">.</span><span class="n">num_columns</span><span class="p">):</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">rg</span><span class="p">.</span><span class="nf">column</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">  Column </span><span class="si">{</span><span class="n">col</span><span class="p">.</span><span class="n">path_in_schema</span><span class="si">}</span><span class="s">:</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    Compressed: </span><span class="si">{</span><span class="n">col</span><span class="p">.</span><span class="n">total_compressed_size</span> <span class="o">/</span> <span class="mi">1024</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> KB</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    Uncompressed: </span><span class="si">{</span><span class="n">col</span><span class="p">.</span><span class="n">total_uncompressed_size</span> <span class="o">/</span> <span class="mi">1024</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s"> KB</span><span class="sh">"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">    Compression Ratio: </span><span class="si">{</span><span class="n">col</span><span class="p">.</span><span class="n">total_uncompressed_size</span> <span class="o">/</span> <span class="n">col</span><span class="p">.</span><span class="n">total_compressed_size</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">x</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="orc-ë‚´ë¶€-êµ¬ì¡°">ğŸ”¶ ORC ë‚´ë¶€ êµ¬ì¡°</h2>

<h3 id="ì„¤ê³„-ì² í•™-1">ì„¤ê³„ ì² í•™</h3>

<p>ORCëŠ” <strong>Hive ì›Œí¬ë¡œë“œì— ìµœì í™”</strong>ëœ í¬ë§·ìœ¼ë¡œ, Parquetë³´ë‹¤ ë” ê³µê²©ì ì¸ ì••ì¶•ì„ ì œê³µí•©ë‹ˆë‹¤.</p>

<h4 id="í•µì‹¬-íŠ¹ì§•-1"><strong>í•µì‹¬ íŠ¹ì§•</strong></h4>
<ul>
  <li><strong>High Compression</strong>: ZLIB ê¸°ë³¸, ë§¤ìš° ë†’ì€ ì••ì¶•ë¥ </li>
  <li><strong>Built-in Indexes</strong>: Row group, bloom filter, column statistics</li>
  <li><strong>ACID Support</strong>: Hive ACID íŠ¸ëœì­ì…˜ ì§€ì›</li>
  <li><strong>Predicate Pushdown</strong>: ë‹¤ì¸µ ì¸ë±ìŠ¤ë¡œ ê°•ë ¥í•œ í•„í„°ë§</li>
</ul>

<h3 id="íŒŒì¼-êµ¬ì¡°-1">íŒŒì¼ êµ¬ì¡°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ORC File Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Postscript                      â”‚
â”‚  â”œâ”€â”€ Compression                â”‚
â”‚  â”œâ”€â”€ Footer Length              â”‚
â”‚  â””â”€â”€ Version                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ File Footer                     â”‚
â”‚  â”œâ”€â”€ Schema                     â”‚
â”‚  â”œâ”€â”€ Statistics                 â”‚
â”‚  â”œâ”€â”€ Stripe Information         â”‚
â”‚  â””â”€â”€ User Metadata              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stripe 1                        â”‚
â”‚  â”œâ”€â”€ Index Data                 â”‚
â”‚  â”‚   â”œâ”€â”€ Row Index              â”‚
â”‚  â”‚   â”œâ”€â”€ Bloom Filter           â”‚
â”‚  â”‚   â””â”€â”€ Column Statistics      â”‚
â”‚  â”œâ”€â”€ Data (Compressed)          â”‚
â”‚  â”‚   â”œâ”€â”€ Column A Stream        â”‚
â”‚  â”‚   â”œâ”€â”€ Column B Stream        â”‚
â”‚  â”‚   â””â”€â”€ Column C Stream        â”‚
â”‚  â””â”€â”€ Stripe Footer              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Stripe 2                        â”‚
â”‚  â””â”€â”€ ...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="stripeì™€-index">Stripeì™€ Index</h3>

<h4 id="stripe"><strong>Stripe</strong></h4>
<ul>
  <li><strong>ì •ì˜</strong>: ORCì˜ ê¸°ë³¸ ì²˜ë¦¬ ë‹¨ìœ„ (ê¸°ë³¸ 64MB)</li>
  <li><strong>êµ¬ì„±</strong>: Index Data + Actual Data + Footer</li>
  <li><strong>ë³‘ë ¬ ì²˜ë¦¬</strong>: Stripe ë‹¨ìœ„ë¡œ ë¶„ì‚° ì²˜ë¦¬</li>
</ul>

<h4 id="index-types"><strong>Index Types</strong></h4>
<ul>
  <li><strong>Row Index</strong>: 10,000í–‰ë§ˆë‹¤ min/max/sum/count</li>
  <li><strong>Bloom Filter</strong>: íŠ¹ì • ê°’ ì¡´ì¬ ì—¬ë¶€ ë¹ ë¥¸ ì²´í¬</li>
  <li><strong>Column Statistics</strong>: Stripe ìˆ˜ì¤€ í†µê³„</li>
</ul>

<h3 id="orc-ìƒì„±-ì˜ˆì œ">ORC ìƒì„± ì˜ˆì œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sparkì—ì„œ ORC ìƒì„±
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">compression</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">zlib</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.stripe.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">67108864</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.compress.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">262144</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.bloom.filter.columns</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user_id,product_id</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events.orc</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="orc-ë©”íƒ€ë°ì´í„°-ë¶„ì„">ORC ë©”íƒ€ë°ì´í„° ë¶„ì„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ORC íŒŒì¼ ë¶„ì„ (PyArrow ì‚¬ìš©)
</span><span class="kn">import</span> <span class="n">pyarrow.orc</span> <span class="k">as</span> <span class="n">orc</span>

<span class="n">orc_file</span> <span class="o">=</span> <span class="n">orc</span><span class="p">.</span><span class="nc">ORCFile</span><span class="p">(</span><span class="sh">'</span><span class="s">events.orc</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># ìŠ¤í‚¤ë§ˆ
</span><span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Schema:</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">orc_file</span><span class="p">.</span><span class="n">schema</span><span class="p">)</span>

<span class="c1"># Stripe ì •ë³´
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="se">\n</span><span class="s">Stripes: </span><span class="si">{</span><span class="n">orc_file</span><span class="p">.</span><span class="n">nstripes</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rows: </span><span class="si">{</span><span class="n">orc_file</span><span class="p">.</span><span class="n">nrows</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ë©”íƒ€ë°ì´í„°
</span><span class="n">metadata</span> <span class="o">=</span> <span class="n">orc_file</span><span class="p">.</span><span class="n">metadata</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Compression: </span><span class="si">{</span><span class="n">metadata</span><span class="p">.</span><span class="n">compression</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Writer Version: </span><span class="si">{</span><span class="n">metadata</span><span class="p">.</span><span class="n">writer_version</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="avro-ë‚´ë¶€-êµ¬ì¡°">ğŸ”¹ Avro ë‚´ë¶€ êµ¬ì¡°</h2>

<h3 id="ì„¤ê³„-ì² í•™-2">ì„¤ê³„ ì² í•™</h3>

<p>AvroëŠ” <strong>ìŠ¤í‚¤ë§ˆ ì§„í™”ì™€ ë¹ ë¥¸ ì§ë ¬í™”</strong>ì— ìµœì í™”ëœ í–‰ ê¸°ë°˜ í¬ë§·ì…ë‹ˆë‹¤.</p>

<h4 id="í•µì‹¬-íŠ¹ì§•-2"><strong>í•µì‹¬ íŠ¹ì§•</strong></h4>
<ul>
  <li><strong>Row-based</strong>: ì „ì²´ ë ˆì½”ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ì €ì¥</li>
  <li><strong>Self-describing</strong>: íŒŒì¼ ë‚´ ìŠ¤í‚¤ë§ˆ í¬í•¨</li>
  <li><strong>Schema Evolution</strong>: ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì™„ë²½ ì§€ì›</li>
  <li><strong>Compact Binary</strong>: íš¨ìœ¨ì ì¸ ë°”ì´ë„ˆë¦¬ ì¸ì½”ë”©</li>
</ul>

<h3 id="íŒŒì¼-êµ¬ì¡°-2">íŒŒì¼ êµ¬ì¡°</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Avro File Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header                          â”‚
â”‚  â”œâ”€â”€ Magic: Obj\x01             â”‚
â”‚  â”œâ”€â”€ File Metadata              â”‚
â”‚  â”‚   â”œâ”€â”€ Schema (JSON)          â”‚
â”‚  â”‚   â””â”€â”€ Codec (snappy/deflate) â”‚
â”‚  â””â”€â”€ Sync Marker (16 bytes)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Block 1                    â”‚
â”‚  â”œâ”€â”€ Record Count               â”‚
â”‚  â”œâ”€â”€ Block Size (compressed)    â”‚
â”‚  â”œâ”€â”€ Records (compressed)       â”‚
â”‚  â”‚   â”œâ”€â”€ Record 1 (all fields)  â”‚
â”‚  â”‚   â”œâ”€â”€ Record 2 (all fields)  â”‚
â”‚  â”‚   â””â”€â”€ Record N (all fields)  â”‚
â”‚  â””â”€â”€ Sync Marker                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Data Block 2                    â”‚
â”‚  â””â”€â”€ ...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="ìŠ¤í‚¤ë§ˆ-ì •ì˜">ìŠ¤í‚¤ë§ˆ ì •ì˜</h3>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"record"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"namespace"</span><span class="p">:</span><span class="w"> </span><span class="s2">"com.example"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"fields"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"int"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"amount"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"date"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="nl">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"metadata"</span><span class="p">,</span><span class="w"> </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"null"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"map"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"values"</span><span class="p">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w">
    </span><span class="p">}],</span><span class="w"> </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="avro-ìƒì„±-ì˜ˆì œ">Avro ìƒì„± ì˜ˆì œ</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sparkì—ì„œ Avro ìƒì„±
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">avro</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">compression</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events.avro</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Kafkaì—ì„œ Avro ì‚¬ìš©
</span><span class="kn">from</span> <span class="n">confluent_kafka</span> <span class="kn">import</span> <span class="n">avro</span>
<span class="kn">from</span> <span class="n">confluent_kafka.avro</span> <span class="kn">import</span> <span class="n">AvroProducer</span>

<span class="n">value_schema_str</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
{
   </span><span class="sh">"</span><span class="s">namespace</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">com.example</span><span class="sh">"</span><span class="s">,
   </span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">record</span><span class="sh">"</span><span class="s">,
   </span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="s">,
   </span><span class="sh">"</span><span class="s">fields</span><span class="sh">"</span><span class="s"> : [
     {</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">int</span><span class="sh">"</span><span class="s">},
     {</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">, </span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">string</span><span class="sh">"</span><span class="s">}
   ]
}
</span><span class="sh">"""</span>

<span class="n">value_schema</span> <span class="o">=</span> <span class="n">avro</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">value_schema_str</span><span class="p">)</span>

<span class="n">avroProducer</span> <span class="o">=</span> <span class="nc">AvroProducer</span><span class="p">({</span>
    <span class="sh">'</span><span class="s">bootstrap.servers</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">localhost:9092</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">schema.registry.url</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">http://localhost:8081</span><span class="sh">'</span>
<span class="p">},</span> <span class="n">default_value_schema</span><span class="o">=</span><span class="n">value_schema</span><span class="p">)</span>

<span class="c1"># ë©”ì‹œì§€ ì „ì†¡
</span><span class="n">avroProducer</span><span class="p">.</span><span class="nf">produce</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="p">})</span>
<span class="n">avroProducer</span><span class="p">.</span><span class="nf">flush</span><span class="p">()</span>
</code></pre></div></div>

<hr />

<h2 id="ì‹¤ì œ-ë²¤ì¹˜ë§ˆí¬-ë¹„êµ">ğŸ“Š ì‹¤ì œ ë²¤ì¹˜ë§ˆí¬ ë¹„êµ</h2>

<h3 id="í…ŒìŠ¤íŠ¸-í™˜ê²½">í…ŒìŠ¤íŠ¸ í™˜ê²½</h3>

<table>
  <thead>
    <tr>
      <th><strong>í•­ëª©</strong></th>
      <th><strong>ì„¤ì •</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë°ì´í„°ì…‹</strong></td>
      <td>NYC Taxi (1ì–µ ë ˆì½”ë“œ, 100GB CSV)</td>
    </tr>
    <tr>
      <td><strong>Spark ë²„ì „</strong></td>
      <td>3.4.0</td>
    </tr>
    <tr>
      <td><strong>ì¸ìŠ¤í„´ìŠ¤</strong></td>
      <td>r5.4xlarge Ã— 10</td>
    </tr>
    <tr>
      <td><strong>ì••ì¶• ì½”ë±</strong></td>
      <td>Snappy (Parquet/Avro), ZLIB (ORC)</td>
    </tr>
    <tr>
      <td><strong>Row Group/Stripe</strong></td>
      <td>128MB</td>
    </tr>
  </tbody>
</table>

<h3 id="í…ŒìŠ¤íŠ¸-1-íŒŒì¼-í¬ê¸°-ë°-ì••ì¶•ë¥ ">í…ŒìŠ¤íŠ¸ 1: íŒŒì¼ í¬ê¸° ë° ì••ì¶•ë¥ </h3>

<h4 id="ì›ë³¸-ë°ì´í„°-100gb-csv"><strong>ì›ë³¸ ë°ì´í„°: 100GB CSV</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì••ì¶• ì½”ë±</strong></th>
      <th><strong>íŒŒì¼ í¬ê¸°</strong></th>
      <th><strong>ì••ì¶•ë¥ </strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>CSV</strong></td>
      <td>None</td>
      <td>100 GB</td>
      <td>1.0x</td>
      <td>1,000</td>
    </tr>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>Snappy</td>
      <td>12.3 GB</td>
      <td><strong>8.1x</strong></td>
      <td>97</td>
    </tr>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>GZIP</td>
      <td>8.9 GB</td>
      <td><strong>11.2x</strong></td>
      <td>70</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>ZLIB</td>
      <td>9.1 GB</td>
      <td><strong>11.0x</strong></td>
      <td>72</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>Snappy</td>
      <td>11.8 GB</td>
      <td><strong>8.5x</strong></td>
      <td>93</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>Snappy</td>
      <td>28.4 GB</td>
      <td><strong>3.5x</strong></td>
      <td>224</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>Deflate</td>
      <td>24.1 GB</td>
      <td><strong>4.1x</strong></td>
      <td>190</td>
    </tr>
  </tbody>
</table>

<h4 id="ì••ì¶•-ì‹œê°„-ë¹„êµ"><strong>ì••ì¶• ì‹œê°„ ë¹„êµ</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">time</span>

<span class="c1"># Parquet ì“°ê¸°
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">).</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">output.parquet</span><span class="sh">"</span><span class="p">)</span>
<span class="n">parquet_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># ORC ì“°ê¸°
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">).</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">output.orc</span><span class="sh">"</span><span class="p">)</span>
<span class="n">orc_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Avro ì“°ê¸°
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">avro</span><span class="sh">"</span><span class="p">).</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">output.avro</span><span class="sh">"</span><span class="p">)</span>
<span class="n">avro_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Parquet: </span><span class="si">{</span><span class="n">parquet_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ê²°ê³¼: 142.3s
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ORC: </span><span class="si">{</span><span class="n">orc_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>          <span class="c1"># ê²°ê³¼: 156.8s
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Avro: </span><span class="si">{</span><span class="n">avro_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>        <span class="c1"># ê²°ê³¼: 98.4s
</span></code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì“°ê¸° ì‹œê°„</strong></th>
      <th><strong>ì²˜ë¦¬ ì†ë„</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet (Snappy)</strong></td>
      <td>142.3ì´ˆ</td>
      <td>703 MB/s</td>
    </tr>
    <tr>
      <td><strong>ORC (ZLIB)</strong></td>
      <td>156.8ì´ˆ</td>
      <td>638 MB/s</td>
    </tr>
    <tr>
      <td><strong>Avro (Snappy)</strong></td>
      <td>98.4ì´ˆ</td>
      <td>1,016 MB/s</td>
    </tr>
  </tbody>
</table>

<h3 id="í…ŒìŠ¤íŠ¸-2-ì½ê¸°-ì„±ëŠ¥-ì „ì²´-ìŠ¤ìº”">í…ŒìŠ¤íŠ¸ 2: ì½ê¸° ì„±ëŠ¥ (ì „ì²´ ìŠ¤ìº”)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: ì „ì²´ ë°ì´í„° ì§‘ê³„</span>
<span class="k">SELECT</span> 
    <span class="n">pickup_date</span><span class="p">,</span>
    <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">as</span> <span class="n">trip_count</span><span class="p">,</span>
    <span class="k">AVG</span><span class="p">(</span><span class="n">fare_amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">avg_fare</span><span class="p">,</span>
    <span class="k">SUM</span><span class="p">(</span><span class="n">tip_amount</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_tips</span>
<span class="k">FROM</span> <span class="n">trips</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">pickup_date</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ì½ê¸°-ì„±ëŠ¥-ë¹„êµ"><strong>ì½ê¸° ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì••ì¶•</strong></th>
      <th><strong>ìŠ¤ìº” ì‹œê°„</strong></th>
      <th><strong>ì²˜ë¦¬ ì†ë„</strong></th>
      <th><strong>ë©”ëª¨ë¦¬ ì‚¬ìš©</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>Snappy</td>
      <td>23.4ì´ˆ</td>
      <td>4.3 GB/s</td>
      <td>18.2 GB</td>
    </tr>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>GZIP</td>
      <td>31.2ì´ˆ</td>
      <td>3.2 GB/s</td>
      <td>16.8 GB</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>ZLIB</td>
      <td>28.7ì´ˆ</td>
      <td>3.5 GB/s</td>
      <td>17.1 GB</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>Snappy</td>
      <td>24.1ì´ˆ</td>
      <td>4.1 GB/s</td>
      <td>18.5 GB</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>Snappy</td>
      <td>87.3ì´ˆ</td>
      <td>1.1 GB/s</td>
      <td>32.4 GB</td>
    </tr>
  </tbody>
</table>

<h3 id="í…ŒìŠ¤íŠ¸-3-ì»¬ëŸ¼-ì„ íƒ-ì¿¼ë¦¬-projection-pushdown">í…ŒìŠ¤íŠ¸ 3: ì»¬ëŸ¼ ì„ íƒ ì¿¼ë¦¬ (Projection Pushdown)</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: íŠ¹ì • ì»¬ëŸ¼ë§Œ ì„ íƒ</span>
<span class="k">SELECT</span> <span class="n">pickup_date</span><span class="p">,</span> <span class="n">fare_amount</span>
<span class="k">FROM</span> <span class="n">trips</span>
<span class="k">WHERE</span> <span class="n">pickup_date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ì»¬ëŸ¼-ì„ íƒ-ì„±ëŠ¥"><strong>ì»¬ëŸ¼ ì„ íƒ ì„±ëŠ¥</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì „ì²´ ì»¬ëŸ¼</strong></th>
      <th><strong>2ê°œ ì»¬ëŸ¼</strong></th>
      <th><strong>ê°œì„ ìœ¨</strong></th>
      <th><strong>ìŠ¤ìº” ë°ì´í„°</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>23.4ì´ˆ</td>
      <td>2.8ì´ˆ</td>
      <td><strong>8.4x</strong></td>
      <td>1.2 GB</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>28.7ì´ˆ</td>
      <td>3.1ì´ˆ</td>
      <td><strong>9.3x</strong></td>
      <td>1.1 GB</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>87.3ì´ˆ</td>
      <td>84.2ì´ˆ</td>
      <td><strong>1.0x</strong></td>
      <td>28.4 GB (ì „ì²´)</td>
    </tr>
  </tbody>
</table>

<p><strong>í•µì‹¬</strong>: Columnar í¬ë§·ì€ íŠ¹ì • ì»¬ëŸ¼ë§Œ ì½ì–´ì„œ ì—„ì²­ë‚œ ì„±ëŠ¥ í–¥ìƒ, AvroëŠ” ì „ì²´ ë ˆì½”ë“œë¥¼ ì½ì–´ì•¼ í•¨</p>

<h3 id="í…ŒìŠ¤íŠ¸-4-predicate-pushdown">í…ŒìŠ¤íŠ¸ 4: Predicate Pushdown</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: í•„í„°ë§ ì¡°ê±´</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">trips</span>
<span class="k">WHERE</span> <span class="n">fare_amount</span> <span class="o">&gt;</span> <span class="mi">50</span> <span class="k">AND</span> <span class="n">tip_amount</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="predicate-pushdown-íš¨ê³¼"><strong>Predicate Pushdown íš¨ê³¼</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ìŠ¤ìº” ë°ì´í„°</strong></th>
      <th><strong>ì‹¤ì œ ì½ì€ ë°ì´í„°</strong></th>
      <th><strong>ê±´ë„ˆë›´ ë¹„ìœ¨</strong></th>
      <th><strong>ì¿¼ë¦¬ ì‹œê°„</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>12.3 GB</td>
      <td>3.2 GB</td>
      <td><strong>74%</strong></td>
      <td>8.4ì´ˆ</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>9.1 GB</td>
      <td>2.1 GB</td>
      <td><strong>77%</strong></td>
      <td>7.2ì´ˆ</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>28.4 GB</td>
      <td>28.4 GB</td>
      <td><strong>0%</strong></td>
      <td>72.1ì´ˆ</td>
    </tr>
  </tbody>
</table>

<p><strong>í•µì‹¬</strong>: ORCì˜ Row Indexì™€ Bloom Filterê°€ ê°€ì¥ íš¨ê³¼ì </p>

<h3 id="í…ŒìŠ¤íŠ¸-5-ìŠ¤í‚¤ë§ˆ-ì§„í™”">í…ŒìŠ¤íŠ¸ 5: ìŠ¤í‚¤ë§ˆ ì§„í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìŠ¤í‚¤ë§ˆ ë³€ê²½ í…ŒìŠ¤íŠ¸
# 1. ê¸°ì¡´ ìŠ¤í‚¤ë§ˆë¡œ ë°ì´í„° ì €ì¥
</span><span class="n">schema_v1</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">()),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">()),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="nc">DoubleType</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">df_v1</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">format_type</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">format_type</span><span class="si">}</span><span class="s">_v1</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. ìƒˆ ì»¬ëŸ¼ ì¶”ê°€ëœ ìŠ¤í‚¤ë§ˆ
</span><span class="n">schema_v2</span> <span class="o">=</span> <span class="nc">StructType</span><span class="p">([</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">,</span> <span class="nc">IntegerType</span><span class="p">()),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">()),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="nc">DoubleType</span><span class="p">()),</span>
    <span class="nc">StructField</span><span class="p">(</span><span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">,</span> <span class="nc">StringType</span><span class="p">())</span>  <span class="c1"># ìƒˆ ì»¬ëŸ¼
</span><span class="p">])</span>

<span class="n">df_v2</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">format_type</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">format_type</span><span class="si">}</span><span class="s">_v2</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. ë‘ ë²„ì „ ë™ì‹œ ì½ê¸°
</span><span class="n">df_merged</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">format_type</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">data_</span><span class="si">{</span><span class="n">format_type</span><span class="si">}</span><span class="s">_*</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="ìŠ¤í‚¤ë§ˆ-ì§„í™”-ì§€ì›"><strong>ìŠ¤í‚¤ë§ˆ ì§„í™” ì§€ì›</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í¬ë§·</strong></th>
      <th><strong>ì»¬ëŸ¼ ì¶”ê°€</strong></th>
      <th><strong>ì»¬ëŸ¼ ì‚­ì œ</strong></th>
      <th><strong>íƒ€ì… ë³€ê²½</strong></th>
      <th><strong>ì»¬ëŸ¼ ì´ë¦„ ë³€ê²½</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Parquet</strong></td>
      <td>âœ… ê°€ëŠ¥</td>
      <td>âš ï¸ ì£¼ì˜ í•„ìš”</td>
      <td>âŒ ë¶ˆê°€ëŠ¥</td>
      <td>âŒ ë¶ˆê°€ëŠ¥</td>
    </tr>
    <tr>
      <td><strong>ORC</strong></td>
      <td>âœ… ê°€ëŠ¥</td>
      <td>âš ï¸ ì£¼ì˜ í•„ìš”</td>
      <td>âŒ ë¶ˆê°€ëŠ¥</td>
      <td>âŒ ë¶ˆê°€ëŠ¥</td>
    </tr>
    <tr>
      <td><strong>Avro</strong></td>
      <td>âœ… ì™„ë²½ ì§€ì›</td>
      <td>âœ… ì™„ë²½ ì§€ì›</td>
      <td>âœ… ì¼ë¶€ ê°€ëŠ¥</td>
      <td>âœ… Alias ì§€ì›</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="ìƒí™©ë³„-ìµœì -í¬ë§·-ì„ íƒ">ğŸ¯ ìƒí™©ë³„ ìµœì  í¬ë§· ì„ íƒ</h2>

<h3 id="use-case-1-ëŒ€ê·œëª¨-ë¶„ì„ìš©-ë°ì´í„°-ë ˆì´í¬">Use Case 1: ëŒ€ê·œëª¨ ë¶„ì„ìš© ë°ì´í„° ë ˆì´í¬</h3>

<h4 id="ì‹œë‚˜ë¦¬ì˜¤"><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></h4>
<ul>
  <li>1ì¼ 10TB ë°ì´í„° ìˆ˜ì§‘</li>
  <li>Athena, Sparkë¡œ ì• ë“œí˜¹ ì¿¼ë¦¬</li>
  <li>ì£¼ë¡œ ì§‘ê³„ ì¿¼ë¦¬ ì‹¤í–‰</li>
</ul>

<h4 id="ì¶”ì²œ-parquet-snappy"><strong>ì¶”ì²œ: Parquet (Snappy)</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìµœì  ì„¤ì •
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.block.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">134217728</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.page.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1048576</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.enableVectorizedReader</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>

<span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/analytics/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… Athena ì™„ë²½ ì§€ì›</li>
  <li>âœ… ë¹ ë¥¸ ì½ê¸° ì„±ëŠ¥</li>
  <li>âœ… ì¢‹ì€ ì••ì¶•ë¥ </li>
  <li>âœ… ë²”ìš©ì„±</li>
</ul>

<h3 id="use-case-2-hive-ì¤‘ì‹¬-ë°ì´í„°-ì›¨ì–´í•˜ìš°ìŠ¤">Use Case 2: Hive ì¤‘ì‹¬ ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤</h3>

<h4 id="ì‹œë‚˜ë¦¬ì˜¤-1"><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></h4>
<ul>
  <li>Hive ë©”íƒ€ìŠ¤í† ì–´ ì‚¬ìš©</li>
  <li>ACID íŠ¸ëœì­ì…˜ í•„ìš”</li>
  <li>UPDATE/DELETE ì‘ì—… ë¹ˆë²ˆ</li>
</ul>

<h4 id="ì¶”ì²œ-orc-zlib"><strong>ì¶”ì²œ: ORC (ZLIB)</strong></h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Hiveì—ì„œ ORC í…Œì´ë¸” ìƒì„±</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">events</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">INT</span><span class="p">,</span>
    <span class="n">name</span> <span class="n">STRING</span><span class="p">,</span>
    <span class="n">amount</span> <span class="nb">DOUBLE</span><span class="p">,</span>
    <span class="n">event_date</span> <span class="n">STRING</span>
<span class="p">)</span>
<span class="n">PARTITIONED</span> <span class="k">BY</span> <span class="p">(</span><span class="nb">date</span> <span class="n">STRING</span><span class="p">)</span>
<span class="n">STORED</span> <span class="k">AS</span> <span class="n">ORC</span>
<span class="n">TBLPROPERTIES</span> <span class="p">(</span>
    <span class="nv">"orc.compress"</span><span class="o">=</span><span class="nv">"ZLIB"</span><span class="p">,</span>
    <span class="nv">"orc.create.index"</span><span class="o">=</span><span class="nv">"true"</span><span class="p">,</span>
    <span class="nv">"orc.bloom.filter.columns"</span><span class="o">=</span><span class="nv">"id,name"</span>
<span class="p">);</span>

<span class="c1">-- ACID íŠ¸ëœì­ì…˜</span>
<span class="k">UPDATE</span> <span class="n">events</span> <span class="k">SET</span> <span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span> <span class="o">*</span> <span class="mi">1</span><span class="p">.</span><span class="mi">1</span> <span class="k">WHERE</span> <span class="nb">date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… Hive ìµœì í™”</li>
  <li>âœ… ACID ì§€ì›</li>
  <li>âœ… ìµœê³  ì••ì¶•ë¥ </li>
  <li>âœ… ê°•ë ¥í•œ ì¸ë±ìŠ¤</li>
</ul>

<h3 id="use-case-3-ì‹¤ì‹œê°„-ìŠ¤íŠ¸ë¦¬ë°-íŒŒì´í”„ë¼ì¸">Use Case 3: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° íŒŒì´í”„ë¼ì¸</h3>

<h4 id="ì‹œë‚˜ë¦¬ì˜¤-2"><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></h4>
<ul>
  <li>Kafkaë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘</li>
  <li>Schema Registry ì‚¬ìš©</li>
  <li>ìŠ¤í‚¤ë§ˆ ë³€ê²½ ë¹ˆë²ˆ</li>
</ul>

<h4 id="ì¶”ì²œ-avro--parquet-í•˜ì´ë¸Œë¦¬ë“œ"><strong>ì¶”ì²œ: Avro â†’ Parquet í•˜ì´ë¸Œë¦¬ë“œ</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì‹¤ì‹œê°„: Kafka + Avro
</span><span class="kn">from</span> <span class="n">confluent_kafka</span> <span class="kn">import</span> <span class="n">avro</span>

<span class="c1"># Avroë¡œ Kafkaì— ì €ì¥
</span><span class="n">avro_producer</span><span class="p">.</span><span class="nf">produce</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="sh">'</span><span class="s">events</span><span class="sh">'</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">event_data</span><span class="p">)</span>

<span class="c1"># ë°°ì¹˜: Avro â†’ Parquet ë³€í™˜
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">avro</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/streaming/avro/</span><span class="sh">"</span><span class="p">)</span>

<span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/analytics/parquet/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… Avro: ë¹ ë¥¸ ì“°ê¸°, ìŠ¤í‚¤ë§ˆ ì§„í™”</li>
  <li>âœ… Parquet: ë¶„ì„ ìµœì í™”</li>
  <li>âœ… ë‘ ê°€ì§€ ì¥ì  í™œìš©</li>
</ul>

<h3 id="use-case-4-ë¡œê·¸-ë°ì´í„°-ì¥ê¸°-ë³´ê´€">Use Case 4: ë¡œê·¸ ë°ì´í„° ì¥ê¸° ë³´ê´€</h3>

<h4 id="ì‹œë‚˜ë¦¬ì˜¤-3"><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></h4>
<ul>
  <li>1ì¼ 50TB ë¡œê·¸ ë°ì´í„°</li>
  <li>ëŒ€ë¶€ë¶„ cold storage</li>
  <li>ê°€ë” íŠ¹ì • ê¸°ê°„ ë¶„ì„</li>
</ul>

<h4 id="ì¶”ì²œ-parquet-gzip-ë˜ëŠ”-zstd"><strong>ì¶”ì²œ: Parquet (GZIP ë˜ëŠ” ZSTD)</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìµœëŒ€ ì••ì¶•ë¥  ì„¤ì •
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">gzip</span><span class="sh">"</span><span class="p">)</span>  <span class="c1"># ë˜ëŠ” zstd
</span>
<span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/logs/</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Lifecycle policyë¡œ ìë™ ì „í™˜
</span><span class="kn">import</span> <span class="n">boto3</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
<span class="n">s3</span><span class="p">.</span><span class="nf">put_bucket_lifecycle_configuration</span><span class="p">(</span>
    <span class="n">Bucket</span><span class="o">=</span><span class="sh">'</span><span class="s">bucket</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">LifecycleConfiguration</span><span class="o">=</span><span class="p">{</span>
        <span class="sh">'</span><span class="s">Rules</span><span class="sh">'</span><span class="p">:</span> <span class="p">[{</span>
            <span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">TransitionLogs</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Enabled</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Prefix</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">logs/</span><span class="sh">'</span><span class="p">,</span>
            <span class="sh">'</span><span class="s">Transitions</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="sh">'</span><span class="s">Days</span><span class="sh">'</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="sh">'</span><span class="s">StorageClass</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">STANDARD_IA</span><span class="sh">'</span><span class="p">},</span>
                <span class="p">{</span><span class="sh">'</span><span class="s">Days</span><span class="sh">'</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="sh">'</span><span class="s">StorageClass</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">GLACIER</span><span class="sh">'</span><span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}]</span>
    <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… ë†’ì€ ì••ì¶•ë¥  (ìŠ¤í† ë¦¬ì§€ ë¹„ìš© ì ˆê°)</li>
  <li>âœ… S3 Glacier í˜¸í™˜</li>
  <li>âœ… í•„ìš”ì‹œ ë¹ ë¥¸ ë¶„ì„ ê°€ëŠ¥</li>
</ul>

<h3 id="use-case-5-ë³µì¡í•œ-ì¤‘ì²©-ë°ì´í„°">Use Case 5: ë³µì¡í•œ ì¤‘ì²© ë°ì´í„°</h3>

<h4 id="ì‹œë‚˜ë¦¬ì˜¤-4"><strong>ì‹œë‚˜ë¦¬ì˜¤</strong></h4>
<ul>
  <li>JSON ì´ë²¤íŠ¸ ë°ì´í„°</li>
  <li>ê¹Šì€ ì¤‘ì²© êµ¬ì¡°</li>
  <li>íŠ¹ì • í•„ë“œë§Œ ìì£¼ ì¡°íšŒ</li>
</ul>

<h4 id="ì¶”ì²œ-parquet"><strong>ì¶”ì²œ: Parquet</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì¤‘ì²© JSON ë°ì´í„°
</span><span class="n">json_data</span> <span class="o">=</span> <span class="sh">"""</span><span class="s">
{
  </span><span class="sh">"</span><span class="s">user</span><span class="sh">"</span><span class="s">: {
    </span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="s">: 123,
    </span><span class="sh">"</span><span class="s">profile</span><span class="sh">"</span><span class="s">: {
      </span><span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">Alice</span><span class="sh">"</span><span class="s">,
      </span><span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">alice@example.com</span><span class="sh">"</span><span class="s">
    }
  },
  </span><span class="sh">"</span><span class="s">event</span><span class="sh">"</span><span class="s">: {
    </span><span class="sh">"</span><span class="s">type</span><span class="sh">"</span><span class="s">: </span><span class="sh">"</span><span class="s">purchase</span><span class="sh">"</span><span class="s">,
    </span><span class="sh">"</span><span class="s">items</span><span class="sh">"</span><span class="s">: [
      {</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="s">: 1, </span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="s">: 100.5},
      {</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="s">: 2, </span><span class="sh">"</span><span class="s">price</span><span class="sh">"</span><span class="s">: 50.3}
    ]
  }
}
</span><span class="sh">"""</span>

<span class="c1"># Sparkì—ì„œ ì¤‘ì²© êµ¬ì¡° ì²˜ë¦¬
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">json</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/raw/events.json</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Parquetë¡œ ì €ì¥ (ì¤‘ì²© êµ¬ì¡° ìœ ì§€)
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/processed/events.parquet</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># íŠ¹ì • í•„ë“œë§Œ íš¨ìœ¨ì ìœ¼ë¡œ ì½ê¸°
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/processed/events.parquet</span><span class="sh">"</span><span class="p">)</span>
<span class="n">df</span><span class="p">.</span><span class="nf">select</span><span class="p">(</span><span class="sh">"</span><span class="s">user.profile.name</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">event.type</span><span class="sh">"</span><span class="p">).</span><span class="nf">show</span><span class="p">()</span>
<span class="c1"># ParquetëŠ” í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì½ìŒ (nested column pruning)
</span></code></pre></div></div>

<p><strong>ì´ìœ </strong>:</p>
<ul>
  <li>âœ… ì¤‘ì²© êµ¬ì¡° ì™„ë²½ ì§€ì›</li>
  <li>âœ… Nested column pruning</li>
  <li>âœ… ë©”ëª¨ë¦¬ íš¨ìœ¨ì </li>
</ul>

<hr />

<h2 id="í¬ë§·-ì „í™˜-ê°€ì´ë“œ">ğŸ”„ í¬ë§· ì „í™˜ ê°€ì´ë“œ</h2>

<h3 id="csv--parquet-ë§ˆì´ê·¸ë ˆì´ì…˜">CSV â†’ Parquet ë§ˆì´ê·¸ë ˆì´ì…˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">CSV to Parquet</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.adaptive.enabled</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># CSV ì½ê¸° (ìŠ¤í‚¤ë§ˆ ì¶”ë¡ )
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">header</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">inferSchema</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">csv</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/raw/csv/*.csv</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ë°ì´í„° íƒ€ì… ìµœì í™”
</span><span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">col</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span> \
    <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">amount</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">decimal(10,2)</span><span class="sh">"</span><span class="p">))</span> \
    <span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">).</span><span class="nf">cast</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">))</span>

<span class="c1"># Parquetë¡œ ë³€í™˜
</span><span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">compression</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/processed/parquet/</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Original CSV: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="nf">inputFiles</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Rows: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="ë§ˆì´ê·¸ë ˆì´ì…˜-ê²°ê³¼"><strong>ë§ˆì´ê·¸ë ˆì´ì…˜ ê²°ê³¼</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í•­ëª©</strong></th>
      <th><strong>CSV</strong></th>
      <th><strong>Parquet</strong></th>
      <th><strong>ê°œì„ </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>íŒŒì¼ í¬ê¸°</strong></td>
      <td>100 GB</td>
      <td>12.3 GB</td>
      <td><strong>87% ê°ì†Œ</strong></td>
    </tr>
    <tr>
      <td><strong>ì¿¼ë¦¬ ì‹œê°„</strong></td>
      <td>245ì´ˆ</td>
      <td>23.4ì´ˆ</td>
      <td><strong>10.5x ë¹ ë¦„</strong></td>
    </tr>
    <tr>
      <td><strong>S3 ë¹„ìš©</strong></td>
      <td>$2,300/ì›”</td>
      <td>$283/ì›”</td>
      <td><strong>87% ì ˆê°</strong></td>
    </tr>
    <tr>
      <td><strong>Athena ìŠ¤ìº”</strong></td>
      <td>$512/ì¿¼ë¦¬</td>
      <td>$62/ì¿¼ë¦¬</td>
      <td><strong>88% ì ˆê°</strong></td>
    </tr>
  </tbody>
</table>

<h3 id="avro--parquet-ë°°ì¹˜-ë³€í™˜">Avro â†’ Parquet ë°°ì¹˜ ë³€í™˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ìŠ¤íŠ¸ë¦¬ë°ì—ì„œ ìˆ˜ì§‘ëœ Avroë¥¼ ë¶„ì„ìš© Parquetë¡œ ë³€í™˜
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">Avro to Parquet Batch</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ì–´ì œ ë‚ ì§œ ë°ì´í„° ì²˜ë¦¬
</span><span class="n">yesterday</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)).</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Avro ì½ê¸°
</span><span class="n">avro_path</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/streaming/avro/date=</span><span class="si">{</span><span class="n">yesterday</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">avro</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="n">avro_path</span><span class="p">)</span>

<span class="c1"># ë°ì´í„° í’ˆì§ˆ ì²´í¬
</span><span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Records: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Duplicates: </span><span class="si">{</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">.</span><span class="nf">dropDuplicates</span><span class="p">().</span><span class="nf">count</span><span class="p">()</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì¤‘ë³µ ì œê±° ë° ì •ë ¬
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">dropDuplicates</span><span class="p">([</span><span class="sh">"</span><span class="s">id</span><span class="sh">"</span><span class="p">])</span> \
    <span class="p">.</span><span class="nf">orderBy</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Parquetë¡œ ì €ì¥
</span><span class="n">parquet_path</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/analytics/parquet/date=</span><span class="si">{</span><span class="n">yesterday</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span>
<span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>

<span class="c1"># ê²€ì¦
</span><span class="n">parquet_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">==</span> <span class="n">parquet_df</span><span class="p">.</span><span class="nf">count</span><span class="p">(),</span> <span class="sh">"</span><span class="s">Record count mismatch!</span><span class="sh">"</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ“ Migration completed: </span><span class="si">{</span><span class="n">yesterday</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="orc--parquet-ìƒí˜¸-ë³€í™˜">ORC â†” Parquet ìƒí˜¸ ë³€í™˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ORC â†’ Parquet
</span><span class="n">orc_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.orc</span><span class="sh">"</span><span class="p">)</span>
<span class="n">orc_df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.parquet</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># Parquet â†’ ORC
</span><span class="n">parquet_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.parquet</span><span class="sh">"</span><span class="p">)</span>
<span class="n">parquet_df</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">).</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.orc</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì„±ëŠ¥ ë¹„êµ
</span><span class="kn">import</span> <span class="n">time</span>

<span class="c1"># ORC ì½ê¸°
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">orc_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">).</span><span class="nf">load</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/large_data.orc</span><span class="sh">"</span><span class="p">)</span>
<span class="n">orc_count</span> <span class="o">=</span> <span class="n">orc_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="n">orc_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="c1"># Parquet ì½ê¸°
</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">parquet_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/large_data.parquet</span><span class="sh">"</span><span class="p">)</span>
<span class="n">parquet_count</span> <span class="o">=</span> <span class="n">parquet_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
<span class="n">parquet_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span>

<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">ORC: </span><span class="si">{</span><span class="n">orc_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s, </span><span class="si">{</span><span class="n">orc_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s"> rows</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Parquet: </span><span class="si">{</span><span class="n">parquet_time</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s, </span><span class="si">{</span><span class="n">parquet_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s"> rows</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="ì‹¤ë¬´-ìµœì í™”-íŒ">ğŸ› ï¸ ì‹¤ë¬´ ìµœì í™” íŒ</h2>

<h3 id="parquet-ìµœì í™”">Parquet ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. ì••ì¶• ì½”ë± ì„ íƒ
# - Snappy: ë¹ ë¥¸ ì••ì¶•/í•´ì œ (ì‹¤ì‹œê°„ ë¶„ì„)
# - GZIP: ë†’ì€ ì••ì¶•ë¥  (ì¥ê¸° ë³´ê´€)
# - ZSTD: ê· í˜•ì¡íŒ ì„±ëŠ¥ (ê¶Œì¥)
</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">zstd</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. Row Group í¬ê¸° ì¡°ì •
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.block.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">268435456</span><span class="p">)</span>  <span class="c1"># 256MB
</span>
<span class="c1"># 3. Dictionary encoding í™œìš©
# ì¹´ë””ë„ë¦¬í‹° ë‚®ì€ ì»¬ëŸ¼ì— ìë™ ì ìš©
# ìˆ˜ë™ìœ¼ë¡œ ë¹„í™œì„±í™”í•˜ë ¤ë©´:
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.enableDictionaryEncoding</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">false</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Vectorized reader í™œì„±í™”
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.enableVectorizedReader</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 5. Binary as string ìµœì í™”
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.parquet.binaryAsString</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">false</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="orc-ìµœì í™”">ORC ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. Stripe í¬ê¸° ì¡°ì •
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.orc.stripe.size</span><span class="sh">"</span><span class="p">,</span> <span class="mi">67108864</span><span class="p">)</span>  <span class="c1"># 64MB
</span>
<span class="c1"># 2. Bloom filter ì„¤ì •
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">orc</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.bloom.filter.columns</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">user_id,product_id</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.bloom.filter.fpp</span><span class="sh">"</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.orc</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 3. ì••ì¶• ì„ íƒ
# - ZLIB: ìµœê³  ì••ì¶•ë¥  (ê¸°ë³¸ê°’)
# - SNAPPY: ë¹ ë¥¸ ì„±ëŠ¥
# - LZO: ê· í˜•
</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.orc.compression.codec</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">zlib</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 4. Index stride (row index ê°„ê²©)
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">orc.row.index.stride</span><span class="sh">"</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="avro-ìµœì í™”">Avro ìµœì í™”</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 1. ì••ì¶• ì„¤ì •
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="sh">"</span><span class="s">avro</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">option</span><span class="p">(</span><span class="sh">"</span><span class="s">compression</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">snappy</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data.avro</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># 2. ìŠ¤í‚¤ë§ˆ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ì—°ë™
</span><span class="kn">from</span> <span class="n">confluent_kafka</span> <span class="kn">import</span> <span class="n">avro</span>
<span class="kn">from</span> <span class="n">confluent_kafka.avro</span> <span class="kn">import</span> <span class="n">AvroProducer</span>

<span class="n">producer_config</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">bootstrap.servers</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">localhost:9092</span><span class="sh">'</span><span class="p">,</span>
    <span class="sh">'</span><span class="s">schema.registry.url</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">http://localhost:8081</span><span class="sh">'</span>
<span class="p">}</span>

<span class="n">producer</span> <span class="o">=</span> <span class="nc">AvroProducer</span><span class="p">(</span><span class="n">producer_config</span><span class="p">,</span> <span class="n">default_value_schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="í¬ë§·-ì„ íƒ-ì˜ì‚¬ê²°ì •-íŠ¸ë¦¬">í¬ë§· ì„ íƒ ì˜ì‚¬ê²°ì • íŠ¸ë¦¬</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">choose_format</span><span class="p">(</span><span class="n">use_case</span><span class="p">):</span>
    <span class="sh">"""</span><span class="s">í¬ë§· ì„ íƒ ë„ìš°ë¯¸ í•¨ìˆ˜</span><span class="sh">"""</span>
    
    <span class="c1"># ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°?
</span>    <span class="k">if</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">schema_changes</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Avro</span><span class="sh">"</span>
    
    <span class="c1"># Hive ì¤‘ì‹¬ í™˜ê²½?
</span>    <span class="k">if</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">hive</span><span class="sh">"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">acid</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">ORC</span><span class="sh">"</span>
    
    <span class="c1"># ìµœëŒ€ ì••ì¶•ë¥  í•„ìš”?
</span>    <span class="k">if</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">storage_critical</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">ORC with ZLIB</span><span class="sh">"</span>
    
    <span class="c1"># ë²”ìš© ë¶„ì„?
</span>    <span class="k">if</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">analytics</span><span class="sh">"</span><span class="p">]</span> <span class="ow">and</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">athena</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Parquet with Snappy</span><span class="sh">"</span>
    
    <span class="c1"># ë¹ ë¥¸ ì“°ê¸° í•„ìš”?
</span>    <span class="k">if</span> <span class="n">use_case</span><span class="p">[</span><span class="sh">"</span><span class="s">write_heavy</span><span class="sh">"</span><span class="p">]:</span>
        <span class="k">return</span> <span class="sh">"</span><span class="s">Avro</span><span class="sh">"</span>
    
    <span class="c1"># ê¸°ë³¸ê°’
</span>    <span class="k">return</span> <span class="sh">"</span><span class="s">Parquet</span><span class="sh">"</span>

<span class="c1"># ì‚¬ìš© ì˜ˆì‹œ
</span><span class="n">use_case</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">schema_changes</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">hive</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">acid</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">storage_critical</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">analytics</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">athena</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
    <span class="sh">"</span><span class="s">write_heavy</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span>
<span class="p">}</span>

<span class="n">recommended</span> <span class="o">=</span> <span class="nf">choose_format</span><span class="p">(</span><span class="n">use_case</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Recommended format: </span><span class="si">{</span><span class="n">recommended</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># ì¶œë ¥: Recommended format: Parquet with Snappy
</span></code></pre></div></div>

<hr />

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="í•µì‹¬-í¬ì¸íŠ¸">í•µì‹¬ í¬ì¸íŠ¸</h3>

<ol>
  <li><strong>í¬ë§·ë³„ íŠ¹ì„± ì´í•´</strong>
    <ul>
      <li><strong>Parquet</strong>: ë²”ìš© ë¶„ì„, Athena/Spark ìµœì í™”</li>
      <li><strong>ORC</strong>: Hive ìµœì í™”, ìµœê³  ì••ì¶•ë¥ , ACID ì§€ì›</li>
      <li><strong>Avro</strong>: ìŠ¤íŠ¸ë¦¬ë°, ìŠ¤í‚¤ë§ˆ ì§„í™”, ë¹ ë¥¸ ì“°ê¸°</li>
    </ul>
  </li>
  <li><strong>ì„±ëŠ¥ ë¹„êµ ìš”ì•½</strong>
    <ul>
      <li><strong>ì••ì¶•ë¥ </strong>: ORC &gt; Parquet &gt; Avro</li>
      <li><strong>ì½ê¸° ì„±ëŠ¥</strong>: Parquet â‰ˆ ORCÂ Â» Avro</li>
      <li><strong>ì“°ê¸° ì„±ëŠ¥</strong>: Avro &gt; Parquet â‰ˆ ORC</li>
      <li><strong>ì»¬ëŸ¼ ì„ íƒ</strong>: Parquet/ORC 8-9x ë¹ ë¦„</li>
    </ul>
  </li>
  <li><strong>ì‹¤ë¬´ ì„ íƒ ê°€ì´ë“œ</strong>
    <ul>
      <li><strong>ë¶„ì„ ì¤‘ì‹¬</strong>: Parquet (Snappy)</li>
      <li><strong>Hive í™˜ê²½</strong>: ORC (ZLIB)</li>
      <li><strong>ìŠ¤íŠ¸ë¦¬ë°</strong>: Avro â†’ Parquet í•˜ì´ë¸Œë¦¬ë“œ</li>
      <li><strong>ì¥ê¸° ë³´ê´€</strong>: Parquet (GZIP/ZSTD)</li>
    </ul>
  </li>
  <li><strong>ìµœì í™” ì „ëµ</strong>
    <ul>
      <li>íŒŒì¼ í¬ê¸°: 64-256MB ìœ ì§€</li>
      <li>ì••ì¶• ì½”ë±: ìš©ë„ì— ë§ê²Œ ì„ íƒ</li>
      <li>íŒŒí‹°ì…”ë‹: ë‹¨ìˆœí•˜ê³  ì–•ê²Œ</li>
      <li>ìŠ¤í‚¤ë§ˆ ì„¤ê³„: ë°ì´í„° íƒ€ì… ìµœì í™”</li>
    </ul>
  </li>
</ol>

<h3 id="ì‹¤ë¬´-ì²´í¬ë¦¬ìŠ¤íŠ¸">ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì‚¬ìš© ì¼€ì´ìŠ¤ ë¶„ì„ ì™„ë£Œ</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />í˜„ì¬ í¬ë§· ì„±ëŠ¥ ì¸¡ì •</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë²¤ì¹˜ë§ˆí¬ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />í¬ë§· ì„ íƒ ë° ì„¤ì • ìµœì í™”</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ì •ì˜</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë¹„ìš© ì˜í–¥ë„ ë¶„ì„</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</li>
</ul>

<h3 id="ë‹¤ìŒ-ë‹¨ê³„">ë‹¤ìŒ ë‹¨ê³„</h3>

<ul>
  <li><strong>Apache Iceberg/Delta Lake</strong>: í…Œì´ë¸” í¬ë§·ìœ¼ë¡œ íŒŒì¼ í¬ë§· ì¶”ìƒí™”</li>
  <li><strong>Parquet ê³ ê¸‰ ìµœì í™”</strong>: Bloom filter, Column index</li>
  <li><strong>ì••ì¶• ì•Œê³ ë¦¬ì¦˜ ë¹„êµ</strong>: ZSTD vs LZ4 vs Brotli</li>
  <li><strong>ìŠ¤í‚¤ë§ˆ ì§„í™” ì „ëµ</strong>: í˜¸í™˜ì„± ê´€ë¦¬</li>
</ul>

<hr />

<blockquote>
  <p><strong>â€œíŒŒì¼ í¬ë§· ì„ íƒì€ ë‹¨ìˆœí•œ ê¸°ìˆ  ê²°ì •ì´ ì•„ë‹Œ, ë¹„ì¦ˆë‹ˆìŠ¤ ì„±ê³¼ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì „ëµì  ì„ íƒì…ë‹ˆë‹¤.â€</strong></p>
</blockquote>

<p>ë°ì´í„° ë ˆì´í¬ì˜ íŒŒì¼ í¬ë§·ì€ í•œ ë²ˆ ê²°ì •í•˜ë©´ ë°”ê¾¸ê¸° ì–´ë µìŠµë‹ˆë‹¤. ê° í¬ë§·ì˜ íŠ¹ì„±ì„ ì •í™•íˆ ì´í•´í•˜ê³ , ìì‹ ì˜ ì‚¬ìš© ì¼€ì´ìŠ¤ì— ë§ëŠ” ìµœì ì˜ í¬ë§·ì„ ì„ íƒí•˜ëŠ” ê²ƒì´ ì„±ê³µì ì¸ ë°ì´í„° ë ˆì´í¬ êµ¬ì¶•ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ì´ ê°€ì´ë“œë¥¼ í†µí•´ ì˜¬ë°”ë¥¸ ì„ íƒì„ í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤!</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
      
        
          
          
      
      
        
        
        <a href="/data-engineering/2025/10/12/s3-hdfs-partitioning-strategy.html" class="nav-link prev">
          â† ì´ì „: S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™”
        </a>
      
      
      
        
        
        <a href="/data-engineering/2025/10/21/delta-lake-iceberg-hudi-comparison.html" class="nav-link next">
          ë‹¤ìŒ: Delta Lake vs Iceberg vs Hudi ì‹¤ì „ ë¹„êµ - í…Œì´ë¸” í¬ë§· ì™„ì „ ì •ë³µ â†’
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
