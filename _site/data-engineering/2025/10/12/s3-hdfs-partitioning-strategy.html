<!DOCTYPE html>
<html lang="ko">
<head>
  <link rel="stylesheet" href="/assets/css/style.css">
  <!-- Head includes for Jekyll -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SEO -->

<meta name="description" content="HDFS ì‹œì ˆì˜ yyyy/mm/dd íŒŒí‹°ì…”ë‹ì´ S3ì—ì„œëŠ” ì™œ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ”ì§€, ê·¸ë¦¬ê³  S3ì— ìµœì í™”ëœ íŒŒí‹°ì…”ë‹ ì „ëµê³¼ ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.">



<title>S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™” - Data Droid Blog</title>


<!-- Open Graph -->
<meta property="og:title" content="S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™”">
<meta property="og:description" content="HDFS ì‹œì ˆì˜ yyyy/mm/dd íŒŒí‹°ì…”ë‹ì´ S3ì—ì„œëŠ” ì™œ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ”ì§€, ê·¸ë¦¬ê³  S3ì— ìµœì í™”ëœ íŒŒí‹°ì…”ë‹ ì „ëµê³¼ ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.">
<meta property="og:url" content="http://localhost:4000/data-engineering/2025/10/12/s3-hdfs-partitioning-strategy.html">
<meta property="og:type" content="website">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™”">
<meta name="twitter:description" content="HDFS ì‹œì ˆì˜ yyyy/mm/dd íŒŒí‹°ì…”ë‹ì´ S3ì—ì„œëŠ” ì™œ ì„±ëŠ¥ ë¬¸ì œë¥¼ ì¼ìœ¼í‚¤ëŠ”ì§€, ê·¸ë¦¬ê³  S3ì— ìµœì í™”ëœ íŒŒí‹°ì…”ë‹ ì „ëµê³¼ ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
<link rel="icon" type="image/x-icon" href="/favicon.ico">

<!-- RSS Feed -->
<link rel="alternate" type="application/rss+xml" title="Data Droid Blog" href="/feed.xml">

<!-- Google Analytics -->

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GP9LT745PP"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-GP9LT745PP');
</script>


</head>
<body>
  <header class="site-header">
  <div class="container">
    <div class="site-title">
      <a href="/">Data Droid Blog</a>
    </div>
    
    <!-- Mobile menu toggle button -->
    <button class="mobile-menu-toggle" aria-label="ë©”ë‰´ ì—´ê¸°/ë‹«ê¸°">
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
      <span class="hamburger-line"></span>
    </button>
    
    <nav class="site-nav">
      <ul class="nav-list">
        <li><a href="/">í™ˆ</a></li>
                  <li class="dropdown">
            <a href="#" class="dropdown-toggle">ì¹´í…Œê³ ë¦¬</a>
            <ul class="dropdown-menu">

              <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
              <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
              <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
              <li><a href="/categories/data-ai/">Data AI</a></li>
            </ul>
          </li>
        <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
        <li><a href="/about/">ì†Œê°œ</a></li>
      </ul>
    </nav>
    
    <div class="language-switcher">
      
        <!-- í¬ìŠ¤íŠ¸ìš© ì–¸ì–´ ì „í™˜ -->
        
          <a href="/data-engineering/2025/10/12/s3-hdfs-partitioning-strategy.html" class="lang-btn active">í•œêµ­ì–´</a>
          
          <a href="/en_posts/2025-10-12-s3-hdfs-partitioning-strategy.html" class="lang-btn">English</a>
        
      
    </div>
  </div>
</header>

  
  <main class="site-main">
    <div class="container">
      <article class="post">
  <header class="post-header">
    <div class="post-meta">
      <span class="post-category">Data engineering</span>
      <span class="post-date">2025ë…„ 10ì›” 12ì¼</span>
      <span class="post-author">Data Droid</span>
    </div>
    
    <h1 class="post-title">S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™”</h1>
    
    
    <div class="post-tags">
      
        <span class="tag">S3</span>
      
        <span class="tag">HDFS</span>
      
        <span class="tag">Partitioning</span>
      
        <span class="tag">DataLake</span>
      
        <span class="tag">CloudStorage</span>
      
        <span class="tag">Spark</span>
      
        <span class="tag">Athena</span>
      
        <span class="tag">Performance</span>
      
        <span class="tag">Optimization</span>
      
    </div>
    
    
    
    <div class="post-series">
      <span class="series-badge">ğŸ“š Cloud data architecture ì‹œë¦¬ì¦ˆ</span>
      <span class="series-order">Part 2</span>
    </div>
    
    
    
    <div class="post-info">
      
        <span class="reading-time">â±ï¸ 50ë¶„</span>
      
      
        <span class="difficulty">ğŸ“Š ì¤‘ê¸‰</span>
      
    </div>
    
  </header>

  <div class="post-content">
    <h1 id="ï¸-s3-vs-hdfs-íŒŒí‹°ì…”ë‹-ì „ëµ---í´ë¼ìš°ë“œ-ì‹œëŒ€ì˜-ë°ì´í„°-ë ˆì´í¬-ìµœì í™”">ğŸ—„ï¸ S3 vs HDFS íŒŒí‹°ì…”ë‹ ì „ëµ - í´ë¼ìš°ë“œ ì‹œëŒ€ì˜ ë°ì´í„° ë ˆì´í¬ ìµœì í™”</h1>

<blockquote>
  <p><strong>â€œê³¼ê±°ì˜ ëª¨ë²” ì‚¬ë¡€ê°€ í˜„ì¬ì˜ ì•ˆí‹°íŒ¨í„´ì´ ë  ìˆ˜ ìˆë‹¤â€</strong> - HDFSì—ì„œ S3ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•  ë•Œ ë°˜ë“œì‹œ ì•Œì•„ì•¼ í•  íŒŒí‹°ì…”ë‹ ì „ëµì˜ ë³€í™”</p>
</blockquote>

<p>ë°ì´í„° ë ˆì´í¬ë¥¼ ì˜¨í”„ë ˆë¯¸ìŠ¤ HDFSì—ì„œ í´ë¼ìš°ë“œ S3ë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜í•˜ë©´ì„œ ë§ì€ íŒ€ë“¤ì´ ê¸°ì¡´ì˜ <code class="language-plaintext highlighter-rouge">yyyy/mm/dd</code> íŒŒí‹°ì…”ë‹ êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ìœ ì§€í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŠ” S3ì˜ ì•„í‚¤í…ì²˜ íŠ¹ì„±ìƒ ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ë¥¼ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” HDFSì™€ S3ì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ì ì„ ì´í•´í•˜ê³ , S3ì— ìµœì í™”ëœ íŒŒí‹°ì…”ë‹ ì „ëµê³¼ ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµë¥¼ í†µí•´ ì‹¤ë¬´ì— ë°”ë¡œ ì ìš©í•  ìˆ˜ ìˆëŠ” ê°€ì´ë“œë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>

<hr />

<h2 id="-ëª©ì°¨">ğŸ“š ëª©ì°¨</h2>

<ul>
  <li><a href="#hdfs-ì‹œëŒ€ì˜-íŒŒí‹°ì…”ë‹-ì „ëµ">HDFS ì‹œëŒ€ì˜ íŒŒí‹°ì…”ë‹ ì „ëµ</a></li>
  <li><a href="#s3ì˜-ê·¼ë³¸ì ì¸-ì°¨ì´ì ">S3ì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ì </a></li>
  <li><a href="#s3-íŒŒí‹°ì…”ë‹-ì•ˆí‹°íŒ¨í„´">S3 íŒŒí‹°ì…”ë‹ ì•ˆí‹°íŒ¨í„´</a></li>
  <li><a href="#s3-ìµœì í™”-íŒŒí‹°ì…”ë‹-ì „ëµ">S3 ìµœì í™” íŒŒí‹°ì…”ë‹ ì „ëµ</a></li>
  <li><a href="#ì‹¤ì œ-ì¿¼ë¦¬-ì„±ëŠ¥-ë¹„êµ">ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµ</a></li>
  <li><a href="#ì‹¤ë¬´-ë§ˆì´ê·¸ë ˆì´ì…˜-ê°€ì´ë“œ">ì‹¤ë¬´ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</a></li>
  <li><a href="#í•™ìŠµ-ìš”ì•½">í•™ìŠµ ìš”ì•½</a></li>
</ul>

<hr />

<h2 id="hdfs-ì‹œëŒ€ì˜-íŒŒí‹°ì…”ë‹-ì „ëµ">ğŸ›ï¸ HDFS ì‹œëŒ€ì˜ íŒŒí‹°ì…”ë‹ ì „ëµ</h2>

<h3 id="hdfs-ì•„í‚¤í…ì²˜-ì´í•´">HDFS ì•„í‚¤í…ì²˜ ì´í•´</h3>

<p>HDFSëŠ” <strong>ê³„ì¸µì  íŒŒì¼ ì‹œìŠ¤í…œ</strong>ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<table>
  <thead>
    <tr>
      <th><strong>êµ¬ì„±ìš”ì†Œ</strong></th>
      <th><strong>ì—­í• </strong></th>
      <th><strong>íŠ¹ì§•</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>NameNode</strong></td>
      <td>ë©”íƒ€ë°ì´í„° ê´€ë¦¬</td>
      <td>ë””ë ‰í† ë¦¬ êµ¬ì¡°ë¥¼ ë©”ëª¨ë¦¬ì— ì €ì¥</td>
    </tr>
    <tr>
      <td><strong>DataNode</strong></td>
      <td>ì‹¤ì œ ë°ì´í„° ì €ì¥</td>
      <td>ë¡œì»¬ ë””ìŠ¤í¬ ê¸°ë°˜ ë¸”ë¡ ìŠ¤í† ë¦¬ì§€</td>
    </tr>
    <tr>
      <td><strong>Block</strong></td>
      <td>ë°ì´í„° ë‹¨ìœ„</td>
      <td>128MB ê¸°ë³¸ í¬ê¸°, ë³µì œë³¸ ìœ ì§€</td>
    </tr>
  </tbody>
</table>

<h3 id="yyyymmddê°€-ì í•©í–ˆë˜-ì´ìœ ">yyyy/mm/ddê°€ ì í•©í–ˆë˜ ì´ìœ </h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># HDFSì˜ ì „í˜•ì ì¸ íŒŒí‹°ì…˜ êµ¬ì¡°</span>
/data/events/
  â””â”€â”€ <span class="nv">year</span><span class="o">=</span>2024/
      â””â”€â”€ <span class="nv">month</span><span class="o">=</span>01/
          â””â”€â”€ <span class="nv">day</span><span class="o">=</span>15/
              â”œâ”€â”€ part-00000.parquet
              â”œâ”€â”€ part-00001.parquet
              â””â”€â”€ part-00002.parquet
</code></pre></div></div>

<h4 id="1-namenode-ë©”íƒ€ë°ì´í„°-íš¨ìœ¨ì„±"><strong>1. NameNode ë©”íƒ€ë°ì´í„° íš¨ìœ¨ì„±</strong></h4>
<ul>
  <li><strong>ë””ë ‰í† ë¦¬ êµ¬ì¡°</strong>: íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ë©”íƒ€ë°ì´í„° ê´€ë¦¬</li>
  <li><strong>ë©”ëª¨ë¦¬ ì‚¬ìš©</strong>: ê° ë””ë ‰í† ë¦¬/íŒŒì¼ë‹¹ ~150 bytes</li>
  <li><strong>ê³„ì¸µ íƒìƒ‰</strong>: O(log n) ì‹œê°„ ë³µì¡ë„ë¡œ ë¹ ë¥¸ ê²€ìƒ‰</li>
</ul>

<h4 id="2-hive-íŒŒí‹°ì…˜-í”„ë£¨ë‹"><strong>2. Hive íŒŒí‹°ì…˜ í”„ë£¨ë‹</strong></h4>
<ul>
  <li><strong>ë™ì  íŒŒí‹°ì…˜</strong>: ë‚ ì§œë³„ ìë™ íŒŒí‹°ì…”ë‹</li>
  <li><strong>ë©”íƒ€ìŠ¤í† ì–´</strong>: íŒŒí‹°ì…˜ ë©”íƒ€ë°ì´í„° ìºì‹±</li>
  <li><strong>ì¿¼ë¦¬ ìµœì í™”</strong>: WHERE ì ˆë¡œ ë¶ˆí•„ìš”í•œ íŒŒí‹°ì…˜ ì œì™¸</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Hiveì—ì„œ íš¨ìœ¨ì ì¸ ì¿¼ë¦¬</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">events</span>
<span class="k">WHERE</span> <span class="nb">year</span> <span class="o">=</span> <span class="mi">2024</span> <span class="k">AND</span> <span class="k">month</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="k">day</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
<span class="c1">-- NameNodeëŠ” ì¦‰ì‹œ í•´ë‹¹ ë””ë ‰í† ë¦¬ë¡œ ì´ë™ ê°€ëŠ¥</span>
</code></pre></div></div>

<h4 id="3-ë¡œì»¬-ë””ìŠ¤í¬-íŠ¹ì„±"><strong>3. ë¡œì»¬ ë””ìŠ¤í¬ íŠ¹ì„±</strong></h4>
<ul>
  <li><strong>ìˆœì°¨ ì½ê¸°</strong>: ë””ë ‰í† ë¦¬ êµ¬ì¡° ìˆœíšŒê°€ ë¹ ë¦„</li>
  <li><strong>ë¸”ë¡ ì§€ì—­ì„±</strong>: DataNodeê°€ ë¡œì»¬ ë°ì´í„° ìš°ì„  ì²˜ë¦¬</li>
  <li><strong>ë„¤íŠ¸ì›Œí¬ ë¹„ìš©</strong>: ìµœì†Œí™”</li>
</ul>

<h3 id="hdfs-íŒŒí‹°ì…”ë‹-ëª¨ë²”-ì‚¬ë¡€">HDFS íŒŒí‹°ì…”ë‹ ëª¨ë²” ì‚¬ë¡€</h3>

<table>
  <thead>
    <tr>
      <th><strong>ì „ëµ</strong></th>
      <th><strong>ì„¤ëª…</strong></th>
      <th><strong>ì¥ì </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì‹œê°„ ê¸°ë°˜</strong></td>
      <td>yyyy/mm/dd ë˜ëŠ” yyyy/mm/dd/hh</td>
      <td>ì‹œê³„ì—´ ë°ì´í„° íš¨ìœ¨ì  ì²˜ë¦¬</td>
    </tr>
    <tr>
      <td><strong>ê³„ì¸µì  êµ¬ì¡°</strong></td>
      <td>ì¹´í…Œê³ ë¦¬ë³„ ì¤‘ì²© ë””ë ‰í† ë¦¬</td>
      <td>ë©”íƒ€ë°ì´í„° êµ¬ì¡°í™”</td>
    </tr>
    <tr>
      <td><strong>íŒŒí‹°ì…˜ ìˆ˜</strong></td>
      <td>ìˆ˜ì²œ~ìˆ˜ë§Œ ê°œë„ ê°€ëŠ¥</td>
      <td>NameNode ë©”ëª¨ë¦¬ë§Œ ì¶©ë¶„í•˜ë©´ OK</td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="s3ì˜-ê·¼ë³¸ì ì¸-ì°¨ì´ì ">â˜ï¸ S3ì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ì </h2>

<h3 id="s3ëŠ”-ê°ì²´-ìŠ¤í† ë¦¬ì§€ë‹¤">S3ëŠ” ê°ì²´ ìŠ¤í† ë¦¬ì§€ë‹¤</h3>

<p>S3ëŠ” <strong>íŒŒì¼ ì‹œìŠ¤í…œì´ ì•„ë‹Œ Key-Value ê°ì²´ ìŠ¤í† ë¦¬ì§€</strong>ì…ë‹ˆë‹¤.</p>

<table>
  <thead>
    <tr>
      <th><strong>íŠ¹ì„±</strong></th>
      <th><strong>HDFS</strong></th>
      <th><strong>S3</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ì €ì¥ ë°©ì‹</strong></td>
      <td>ê³„ì¸µì  íŒŒì¼ ì‹œìŠ¤í…œ</td>
      <td>Flat namespace (Key-Value)</td>
    </tr>
    <tr>
      <td><strong>ë””ë ‰í† ë¦¬</strong></td>
      <td>ì‹¤ì œ ë””ë ‰í† ë¦¬ ì¡´ì¬</td>
      <td>ë””ë ‰í† ë¦¬ëŠ” ê°œë…ì  (Keyì˜ ì¼ë¶€)</td>
    </tr>
    <tr>
      <td><strong>ë©”íƒ€ë°ì´í„°</strong></td>
      <td>NameNode ë©”ëª¨ë¦¬</td>
      <td>ë¶„ì‚° ë©”íƒ€ë°ì´í„° ìŠ¤í† ì–´</td>
    </tr>
    <tr>
      <td><strong>ì ‘ê·¼ ë°©ì‹</strong></td>
      <td>íŒŒì¼ ê²½ë¡œ</td>
      <td>Object Key</td>
    </tr>
    <tr>
      <td><strong>List ì—°ì‚°</strong></td>
      <td>ë¹ ë¦„ (ë¡œì»¬ ë””ìŠ¤í¬)</td>
      <td>ëŠë¦¼ (ë„¤íŠ¸ì›Œí¬ API í˜¸ì¶œ)</td>
    </tr>
  </tbody>
</table>

<h3 id="s3ì˜-ë‚´ë¶€-êµ¬ì¡°">S3ì˜ ë‚´ë¶€ êµ¬ì¡°</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># S3ì—ì„œëŠ” "ë””ë ‰í† ë¦¬"ê°€ ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•ŠìŒ
# ëª¨ë“  ê²ƒì´ Key-Value ìŒ
</span><span class="n">s3</span><span class="p">:</span><span class="o">//</span><span class="n">bucket</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">events</span><span class="o">/</span><span class="n">year</span><span class="o">=</span><span class="mi">2024</span><span class="o">/</span><span class="n">month</span><span class="o">=</span><span class="mi">01</span><span class="o">/</span><span class="n">day</span><span class="o">=</span><span class="mi">15</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="mf">00000.</span><span class="n">parquet</span>
<span class="c1"># ìœ„ëŠ” ì‹¤ì œë¡œ í•˜ë‚˜ì˜ ê¸´ Keyì¼ ë¿
</span></code></pre></div></div>

<h4 id="s3-list-ì—°ì‚°ì˜-ë¹„ìš©"><strong>S3 List ì—°ì‚°ì˜ ë¹„ìš©</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">boto3</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># yyyy/mm/dd êµ¬ì¡°ì—ì„œ íŠ¹ì • ë‚ ì§œ ë°ì´í„° ì°¾ê¸°
# 1. year=2024 ë¦¬ìŠ¤íŠ¸ -&gt; API í˜¸ì¶œ 1íšŒ
# 2. month=01 ë¦¬ìŠ¤íŠ¸ -&gt; API í˜¸ì¶œ 1íšŒ  
# 3. day=15 ë¦¬ìŠ¤íŠ¸ -&gt; API í˜¸ì¶œ 1íšŒ
# ì´ 3ë²ˆì˜ API í˜¸ì¶œ + ë„¤íŠ¸ì›Œí¬ ë ˆì´í„´ì‹œ
</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">s3</span><span class="p">.</span><span class="nf">list_objects_v2</span><span class="p">(</span>
    <span class="n">Bucket</span><span class="o">=</span><span class="sh">'</span><span class="s">my-bucket</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">Prefix</span><span class="o">=</span><span class="sh">'</span><span class="s">data/events/year=2024/month=01/day=15/</span><span class="sh">'</span>
<span class="p">)</span>
</code></pre></div></div>

<h3 id="s3-ì„±ëŠ¥-íŠ¹ì„±">S3 ì„±ëŠ¥ íŠ¹ì„±</h3>

<h4 id="1-request-rate-ì œí•œ"><strong>1. Request Rate ì œí•œ</strong></h4>
<ul>
  <li><strong>Prefixë‹¹ ì²˜ë¦¬ëŸ‰</strong>: 3,500 PUT/COPY/POST/DELETE, 5,500 GET/HEAD ìš”ì²­/ì´ˆ</li>
  <li><strong>ê¹Šì€ ë””ë ‰í† ë¦¬ êµ¬ì¡°</strong>: ë™ì¼ Prefixë¡œ ì§‘ì¤‘ë˜ì–´ ë³‘ëª© ë°œìƒ</li>
  <li><strong>ì„±ëŠ¥ ì €í•˜</strong>: ë§ì€ List ì—°ì‚° ì‹œ ê¸‰ê²©í•œ ì‘ë‹µ ì‹œê°„ ì¦ê°€</li>
</ul>

<h4 id="2-list-ì—°ì‚°-ì˜¤ë²„í—¤ë“œ"><strong>2. List ì—°ì‚° ì˜¤ë²„í—¤ë“œ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>ì—°ì‚°</strong></th>
      <th><strong>HDFS</strong></th>
      <th><strong>S3</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë‹¨ì¼ ë””ë ‰í† ë¦¬ List</strong></td>
      <td>~1ms (ë¡œì»¬)</td>
      <td>~100-300ms (ë„¤íŠ¸ì›Œí¬)</td>
    </tr>
    <tr>
      <td><strong>ê¹Šì´ 3 íƒìƒ‰</strong></td>
      <td>~3ms</td>
      <td>~300-900ms</td>
    </tr>
    <tr>
      <td><strong>1,000ê°œ ê°ì²´ List</strong></td>
      <td>~10ms</td>
      <td>~1-2ì´ˆ</td>
    </tr>
  </tbody>
</table>

<h4 id="3-eventually-consistent-íŠ¹ì„±"><strong>3. Eventually Consistent íŠ¹ì„±</strong></h4>
<ul>
  <li><strong>ì“°ê¸° í›„ ì½ê¸°</strong>: ìƒˆ ê°ì²´ëŠ” ì¦‰ì‹œ ì¼ê´€ì„± ë³´ì¥ (2020ë…„ 12ì›” ì´í›„)</li>
  <li><strong>ë®ì–´ì“°ê¸°/ì‚­ì œ</strong>: ìµœì¢… ì¼ê´€ì„± (ì•½ê°„ì˜ ì§€ì—° ê°€ëŠ¥)</li>
  <li><strong>List ì—°ì‚°</strong>: ìµœì‹  ë³€ê²½ì‚¬í•­ì´ ì¦‰ì‹œ ë°˜ì˜ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ</li>
</ul>

<hr />

<h2 id="s3-íŒŒí‹°ì…”ë‹-ì•ˆí‹°íŒ¨í„´">âš ï¸ S3 íŒŒí‹°ì…”ë‹ ì•ˆí‹°íŒ¨í„´</h2>

<h3 id="ì•ˆí‹°íŒ¨í„´-1-ê³¼ë„í•˜ê²Œ-ê¹Šì€-ê³„ì¸µ-êµ¬ì¡°">ì•ˆí‹°íŒ¨í„´ #1: ê³¼ë„í•˜ê²Œ ê¹Šì€ ê³„ì¸µ êµ¬ì¡°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì•ˆí‹°íŒ¨í„´: HDFS ìŠ¤íƒ€ì¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©</span>
s3://bucket/data/events/
  â””â”€â”€ <span class="nv">year</span><span class="o">=</span>2024/
      â””â”€â”€ <span class="nv">month</span><span class="o">=</span>01/
          â””â”€â”€ <span class="nv">day</span><span class="o">=</span>15/
              â””â”€â”€ <span class="nv">hour</span><span class="o">=</span>10/
                  â”œâ”€â”€ part-00000.parquet
                  â””â”€â”€ part-00001.parquet
</code></pre></div></div>

<h4 id="ë¬¸ì œì "><strong>ë¬¸ì œì </strong></h4>
<ul>
  <li><strong>List ì—°ì‚° í­ì¦</strong>: ê° ë ˆë²¨ë§ˆë‹¤ API í˜¸ì¶œ í•„ìš”</li>
  <li><strong>ë„¤íŠ¸ì›Œí¬ ë ˆì´í„´ì‹œ</strong>: 4-5ë²ˆì˜ ì™•ë³µ ì‹œê°„ ëˆ„ì </li>
  <li><strong>ì¿¼ë¦¬ ì§€ì—°</strong>: Spark/Athenaê°€ íŒŒí‹°ì…˜ íƒìƒ‰ì— ê³¼ë„í•œ ì‹œê°„ ì†Œë¹„</li>
</ul>

<h4 id="ì‹¤ì œ-ì˜í–¥"><strong>ì‹¤ì œ ì˜í–¥</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sparkì—ì„œ íŒŒí‹°ì…˜ íƒìƒ‰ ì‹œê°„ ì¸¡ì •
</span><span class="kn">import</span> <span class="n">time</span>

<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/year=2024/month=01/day=15/</span><span class="sh">"</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Partition discovery: </span><span class="si">{</span><span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>
<span class="c1"># ê²°ê³¼: Partition discovery: 5.43s (ê¹Šì€ êµ¬ì¡°)
# vs
# ê²°ê³¼: Partition discovery: 0.87s (ë‹¨ìˆœ êµ¬ì¡°)
</span></code></pre></div></div>

<h3 id="ì•ˆí‹°íŒ¨í„´-2-small-files-ë¬¸ì œ">ì•ˆí‹°íŒ¨í„´ #2: Small Files ë¬¸ì œ</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì•ˆí‹°íŒ¨í„´: ì‹œê°„ë³„ë¡œ ì‘ì€ íŒŒì¼ë“¤ ìƒì„±</span>
s3://bucket/data/events/date<span class="o">=</span>2024-01-15/
  â”œâ”€â”€ <span class="nv">hour</span><span class="o">=</span>00/
  â”‚   â”œâ”€â”€ part-00000.parquet <span class="o">(</span>2MB<span class="o">)</span>
  â”‚   â”œâ”€â”€ part-00001.parquet <span class="o">(</span>1.5MB<span class="o">)</span>
  â”‚   â””â”€â”€ part-00002.parquet <span class="o">(</span>3MB<span class="o">)</span>
  â”œâ”€â”€ <span class="nv">hour</span><span class="o">=</span>01/
  â”‚   â”œâ”€â”€ part-00000.parquet <span class="o">(</span>2.3MB<span class="o">)</span>
  â”‚   â””â”€â”€ part-00001.parquet <span class="o">(</span>1.8MB<span class="o">)</span>
  ...
</code></pre></div></div>

<h4 id="ë¬¸ì œì -1"><strong>ë¬¸ì œì </strong></h4>
<ul>
  <li><strong>GET ìš”ì²­ í­ì¦</strong>: ì‘ì€ íŒŒì¼ë§ˆë‹¤ ë³„ë„ HTTP ìš”ì²­</li>
  <li><strong>I/O ì˜¤ë²„í—¤ë“œ</strong>: íŒŒì¼ ì˜¤í”ˆ/í´ë¡œì¦ˆ ë°˜ë³µ</li>
  <li><strong>ë©”íƒ€ë°ì´í„° ë¹„ìš©</strong>: íŒŒì¼ ìˆ˜ Ã— ë©”íƒ€ë°ì´í„° í¬ê¸°</li>
  <li><strong>ì¿¼ë¦¬ ì„±ëŠ¥</strong>: Spark executorê°€ ìˆ˜ë§ì€ íŒŒì¼ ì²˜ë¦¬</li>
</ul>

<h4 id="small-filesì˜-ì˜í–¥"><strong>Small Filesì˜ ì˜í–¥</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒì¼ í¬ê¸°</strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
      <th><strong>ì´ ë°ì´í„°</strong></th>
      <th><strong>Spark ì½ê¸° ì‹œê°„</strong></th>
      <th><strong>S3 ë¹„ìš©</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>128MB</td>
      <td>1,000ê°œ</td>
      <td>128GB</td>
      <td>45ì´ˆ</td>
      <td>ê¸°ì¤€</td>
    </tr>
    <tr>
      <td>10MB</td>
      <td>13,000ê°œ</td>
      <td>128GB</td>
      <td>4ë¶„ 20ì´ˆ</td>
      <td>1.8x</td>
    </tr>
    <tr>
      <td>1MB</td>
      <td>130,000ê°œ</td>
      <td>128GB</td>
      <td>12ë¶„ 35ì´ˆ</td>
      <td>3.2x</td>
    </tr>
  </tbody>
</table>

<h3 id="ì•ˆí‹°íŒ¨í„´-3-prefix-hotspot">ì•ˆí‹°íŒ¨í„´ #3: Prefix Hotspot</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ì•ˆí‹°íŒ¨í„´: ë™ì¼ prefixì— ì§‘ì¤‘</span>
s3://bucket/data/events/2024-01-15/
  â”œâ”€â”€ event-000001.parquet
  â”œâ”€â”€ event-000002.parquet
  â”œâ”€â”€ event-000003.parquet
  ...
  â””â”€â”€ event-999999.parquet
</code></pre></div></div>

<h4 id="ë¬¸ì œì -2"><strong>ë¬¸ì œì </strong></h4>
<ul>
  <li><strong>Request Rate ì œí•œ</strong>: ë™ì¼ prefixë¡œ ìš”ì²­ ì§‘ì¤‘</li>
  <li><strong>ì„±ëŠ¥ ì €í•˜</strong>: 3,500/5,500 RPS í•œê³„ ë„ë‹¬</li>
  <li><strong>ë³‘ë ¬ ì²˜ë¦¬ ì œí•œ</strong>: ë¶„ì‚° ì½ê¸° ì„±ëŠ¥ ì €í•˜</li>
</ul>

<hr />

<h2 id="s3-ìµœì í™”-íŒŒí‹°ì…”ë‹-ì „ëµ">ğŸš€ S3 ìµœì í™” íŒŒí‹°ì…”ë‹ ì „ëµ</h2>

<h3 id="ì „ëµ-1-ë‹¨ìˆœí•˜ê³ -ì–•ì€-êµ¬ì¡°">ì „ëµ #1: ë‹¨ìˆœí•˜ê³  ì–•ì€ êµ¬ì¡°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìµœì í™”: yyyy-mm-dd ë˜ëŠ” yyyymmdd ë‹¨ì¼ ë ˆë²¨</span>
s3://bucket/data/events/date<span class="o">=</span>2024-01-15/
  â”œâ”€â”€ part-00000-uuid.snappy.parquet <span class="o">(</span>128MB<span class="o">)</span>
  â”œâ”€â”€ part-00001-uuid.snappy.parquet <span class="o">(</span>128MB<span class="o">)</span>
  â””â”€â”€ part-00002-uuid.snappy.parquet <span class="o">(</span>128MB<span class="o">)</span>
</code></pre></div></div>

<h4 id="ì¥ì "><strong>ì¥ì </strong></h4>
<ul>
  <li><strong>List ì—°ì‚° ìµœì†Œí™”</strong>: 1-2ë²ˆì˜ API í˜¸ì¶œ</li>
  <li><strong>ë¹ ë¥¸ íŒŒí‹°ì…˜ íƒìƒ‰</strong>: ë„¤íŠ¸ì›Œí¬ ì™•ë³µ ê°ì†Œ</li>
  <li><strong>ì˜ˆì¸¡ ê°€ëŠ¥í•œ ì„±ëŠ¥</strong>: ì¼ê´€ëœ ì‘ë‹µ ì‹œê°„</li>
</ul>

<h4 id="spark-ì„¤ì •"><strong>Spark ì„¤ì •</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sparkì—ì„œ ë‹¨ìˆœ íŒŒí‹°ì…˜ êµ¬ì¡° ìƒì„±
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># date ì»¬ëŸ¼ì„ yyyy-mm-dd í˜•ì‹ìœ¼ë¡œ ì¤€ë¹„
</span><span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">date_format</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nf">date_format</span><span class="p">(</span><span class="sh">"</span><span class="s">timestamp</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">yyyy-MM-dd</span><span class="sh">"</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="ì „ëµ-2-ì ì ˆí•œ-íŒŒì¼-í¬ê¸°-ìœ ì§€">ì „ëµ #2: ì ì ˆí•œ íŒŒì¼ í¬ê¸° ìœ ì§€</h3>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒì¼ í¬ê¸°</strong></th>
      <th><strong>ê¶Œì¥ ì‚¬í•­</strong></th>
      <th><strong>ì´ìœ </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>&lt; 10MB</strong></td>
      <td>âŒ ë„ˆë¬´ ì‘ìŒ</td>
      <td>Small files ë¬¸ì œ</td>
    </tr>
    <tr>
      <td><strong>10-64MB</strong></td>
      <td>âš ï¸ ì‘ìŒ</td>
      <td>ê°€ëŠ¥í•˜ë©´ ë” í¬ê²Œ</td>
    </tr>
    <tr>
      <td><strong>64-256MB</strong></td>
      <td>âœ… ìµœì </td>
      <td>ê¶Œì¥ ë²”ìœ„</td>
    </tr>
    <tr>
      <td><strong>256-512MB</strong></td>
      <td>âœ… ì¢‹ìŒ</td>
      <td>ëŒ€ìš©ëŸ‰ ì²˜ë¦¬ ì í•©</td>
    </tr>
    <tr>
      <td><strong>&gt; 512MB</strong></td>
      <td>âš ï¸ í¼</td>
      <td>íŒŒì¼ë‹¹ ì²˜ë¦¬ ì‹œê°„ ì¦ê°€</td>
    </tr>
  </tbody>
</table>

<h4 id="íŒŒì¼-í¬ê¸°-ìµœì í™”"><strong>íŒŒì¼ í¬ê¸° ìµœì í™”</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Sparkì—ì„œ íŒŒì¼ í¬ê¸° ì œì–´
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.files.maxRecordsPerFile</span><span class="sh">"</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">)</span>
<span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.files.maxPartitionBytes</span><span class="sh">"</span><span class="p">,</span> <span class="mi">134217728</span><span class="p">)</span>  <span class="c1"># 128MB
</span>
<span class="c1"># repartitionìœ¼ë¡œ íŒŒì¼ ìˆ˜ ì¡°ì •
</span><span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="compaction-ì‘ì—…"><strong>Compaction ì‘ì—…</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Small filesë¥¼ í° íŒŒì¼ë¡œ ë³‘í•©
</span><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">S3 Compaction</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ê¸°ì¡´ ì‘ì€ íŒŒì¼ë“¤ ì½ê¸°
</span><span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/date=2024-01-15/</span><span class="sh">"</span><span class="p">)</span>

<span class="c1"># ì ì ˆí•œ íŒŒí‹°ì…˜ ìˆ˜ë¡œ ì¬ì‘ì„±
</span><span class="n">num_partitions</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># íŒŒí‹°ì…˜ë‹¹ 100ë§Œ ë ˆì½”ë“œ
</span>
<span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events-compacted/date=2024-01-15/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì „ëµ-3-prefix-ë¶„ì‚°">ì „ëµ #3: Prefix ë¶„ì‚°</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># ìµœì í™”: Prefixë¥¼ ë¶„ì‚°í•˜ì—¬ ë³‘ë ¬ ì²˜ë¦¬ ê°œì„ </span>
s3://bucket/data/events/
  â”œâ”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-15/shard<span class="o">=</span>0/
  â”‚   â”œâ”€â”€ part-00000.parquet
  â”‚   â””â”€â”€ part-00001.parquet
  â”œâ”€â”€ <span class="nb">date</span><span class="o">=</span>2024-01-15/shard<span class="o">=</span>1/
  â”‚   â”œâ”€â”€ part-00000.parquet
  â”‚   â””â”€â”€ part-00001.parquet
  ...
</code></pre></div></div>

<h4 id="shard-ê¸°ë°˜-íŒŒí‹°ì…”ë‹"><strong>Shard ê¸°ë°˜ íŒŒí‹°ì…”ë‹</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># hash ê¸°ë°˜ shard ìƒì„±
</span><span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="nb">hash</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">col</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">shard</span><span class="sh">"</span><span class="p">,</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">hash</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">)))</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">shard</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="ì „ëµ-4-ë‚ ì§œ-í˜•ì‹-ì„ íƒ">ì „ëµ #4: ë‚ ì§œ í˜•ì‹ ì„ íƒ</h3>

<table>
  <thead>
    <tr>
      <th><strong>í˜•ì‹</strong></th>
      <th><strong>ì˜ˆì‹œ</strong></th>
      <th><strong>ì¥ë‹¨ì </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>yyyy/mm/dd</strong></td>
      <td><code class="language-plaintext highlighter-rouge">2024/01/15</code></td>
      <td>âŒ 3ë ˆë²¨, List ì—°ì‚° ë§ìŒ</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd</strong></td>
      <td><code class="language-plaintext highlighter-rouge">2024-01-15</code></td>
      <td>âœ… 1ë ˆë²¨, ê°€ë…ì„± ì¢‹ìŒ</td>
    </tr>
    <tr>
      <td><strong>yyyymmdd</strong></td>
      <td><code class="language-plaintext highlighter-rouge">20240115</code></td>
      <td>âœ… 1ë ˆë²¨, ê°„ê²°í•¨</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm</strong></td>
      <td><code class="language-plaintext highlighter-rouge">2024-01</code></td>
      <td>âš ï¸ ì›”ë³„ ì§‘ê³„ìš©</td>
    </tr>
  </tbody>
</table>

<h4 id="ë‚ ì§œ-íŒŒí‹°ì…˜-ìƒì„±"><strong>ë‚ ì§œ íŒŒí‹°ì…˜ ìƒì„±</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">date_format</span>

<span class="c1"># yyyy-mm-dd í˜•ì‹ (ê¶Œì¥)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nf">date_format</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">yyyy-MM-dd</span><span class="sh">"</span><span class="p">))</span>

<span class="c1"># yyyymmdd í˜•ì‹ (ë” ê°„ê²°)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nf">date_format</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">yyyyMMdd</span><span class="sh">"</span><span class="p">))</span>

<span class="c1"># íŒŒí‹°ì…”ë‹
</span><span class="n">df</span><span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="ì‹¤ì œ-ì¿¼ë¦¬-ì„±ëŠ¥-ë¹„êµ">ğŸ“Š ì‹¤ì œ ì¿¼ë¦¬ ì„±ëŠ¥ ë¹„êµ</h2>

<h3 id="í…ŒìŠ¤íŠ¸-í™˜ê²½">í…ŒìŠ¤íŠ¸ í™˜ê²½</h3>

<table>
  <thead>
    <tr>
      <th><strong>í•­ëª©</strong></th>
      <th><strong>ì„¤ì •</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ë°ì´í„° í¬ê¸°</strong></td>
      <td>1TB (10ì–µ ë ˆì½”ë“œ)</td>
    </tr>
    <tr>
      <td><strong>ê¸°ê°„</strong></td>
      <td>365ì¼</td>
    </tr>
    <tr>
      <td><strong>Spark ë²„ì „</strong></td>
      <td>3.4.0</td>
    </tr>
    <tr>
      <td><strong>ì¸ìŠ¤í„´ìŠ¤</strong></td>
      <td>r5.4xlarge Ã— 10</td>
    </tr>
    <tr>
      <td><strong>íŒŒì¼ í˜•ì‹</strong></td>
      <td>Parquet (Snappy ì••ì¶•)</td>
    </tr>
  </tbody>
</table>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-1-ë‹¨ì¼-ë‚ ì§œ-ì¡°íšŒ">ì‹œë‚˜ë¦¬ì˜¤ 1: ë‹¨ì¼ ë‚ ì§œ ì¡°íšŒ</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: íŠ¹ì • ë‚ ì§œì˜ ë°ì´í„° ì¡°íšŒ</span>
<span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">AVG</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">events</span>
<span class="k">WHERE</span> <span class="nb">date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ì„±ëŠ¥-ë¹„êµ"><strong>ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒí‹°ì…˜ êµ¬ì¡°</strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
      <th><strong>íŒŒí‹°ì…˜ íƒìƒ‰</strong></th>
      <th><strong>ë°ì´í„° ì½ê¸°</strong></th>
      <th><strong>ì´ ì‹œê°„</strong></th>
      <th><strong>ê°œì„ ìœ¨</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>yyyy/mm/dd</strong></td>
      <td>720ê°œ (2MB)</td>
      <td>5.4ì´ˆ</td>
      <td>48.3ì´ˆ</td>
      <td><strong>53.7ì´ˆ</strong></td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd</strong></td>
      <td>24ê°œ (128MB)</td>
      <td>0.9ì´ˆ</td>
      <td>12.1ì´ˆ</td>
      <td><strong>13.0ì´ˆ</strong></td>
      <td><strong>4.1x</strong></td>
    </tr>
    <tr>
      <td><strong>yyyymmdd</strong></td>
      <td>24ê°œ (128MB)</td>
      <td>0.8ì´ˆ</td>
      <td>12.2ì´ˆ</td>
      <td><strong>13.0ì´ˆ</strong></td>
      <td><strong>4.1x</strong></td>
    </tr>
  </tbody>
</table>

<h4 id="ìƒì„¸-ë©”íŠ¸ë¦­"><strong>ìƒì„¸ ë©”íŠ¸ë¦­</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># yyyy/mm/dd êµ¬ì¡° (ì•ˆí‹°íŒ¨í„´)
</span><span class="p">{</span>
  <span class="sh">"</span><span class="s">partition_discovery_ms</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5430</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">s3_list_calls</span><span class="sh">"</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">s3_get_calls</span><span class="sh">"</span><span class="p">:</span> <span class="mi">720</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">network_latency_ms</span><span class="sh">"</span><span class="p">:</span> <span class="mi">18200</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">data_read_mb</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2880</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">executor_time_s</span><span class="sh">"</span><span class="p">:</span> <span class="mf">48.3</span>
<span class="p">}</span>

<span class="c1"># yyyy-mm-dd êµ¬ì¡° (ìµœì í™”)
</span><span class="p">{</span>
  <span class="sh">"</span><span class="s">partition_discovery_ms</span><span class="sh">"</span><span class="p">:</span> <span class="mi">870</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">s3_list_calls</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">s3_get_calls</span><span class="sh">"</span><span class="p">:</span> <span class="mi">24</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">network_latency_ms</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2400</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">data_read_mb</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3072</span><span class="p">,</span>
  <span class="sh">"</span><span class="s">executor_time_s</span><span class="sh">"</span><span class="p">:</span> <span class="mf">12.1</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-2-7ì¼-ë²”ìœ„-ì¡°íšŒ">ì‹œë‚˜ë¦¬ì˜¤ 2: 7ì¼ ë²”ìœ„ ì¡°íšŒ</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: ìµœê·¼ 7ì¼ ë°ì´í„° ë¶„ì„</span>
<span class="k">SELECT</span> <span class="nb">date</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">),</span> <span class="k">SUM</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">events</span>
<span class="k">WHERE</span> <span class="nb">date</span> <span class="k">BETWEEN</span> <span class="s1">'2024-01-15'</span> <span class="k">AND</span> <span class="s1">'2024-01-21'</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="nb">date</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ì„±ëŠ¥-ë¹„êµ-1"><strong>ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒí‹°ì…˜ êµ¬ì¡°</strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
      <th><strong>íŒŒí‹°ì…˜ íƒìƒ‰</strong></th>
      <th><strong>ë°ì´í„° ì½ê¸°</strong></th>
      <th><strong>ì´ ì‹œê°„</strong></th>
      <th><strong>ê°œì„ ìœ¨</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>yyyy/mm/dd</strong></td>
      <td>5,040ê°œ</td>
      <td>38.2ì´ˆ</td>
      <td>4ë¶„ 23ì´ˆ</td>
      <td><strong>5ë¶„ 1ì´ˆ</strong></td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd</strong></td>
      <td>168ê°œ</td>
      <td>6.1ì´ˆ</td>
      <td>1ë¶„ 24ì´ˆ</td>
      <td><strong>1ë¶„ 30ì´ˆ</strong></td>
      <td><strong>3.3x</strong></td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd + shard</strong></td>
      <td>168ê°œ</td>
      <td>5.9ì´ˆ</td>
      <td>58.2ì´ˆ</td>
      <td><strong>1ë¶„ 4ì´ˆ</strong></td>
      <td><strong>4.7x</strong></td>
    </tr>
  </tbody>
</table>

<h3 id="ì‹œë‚˜ë¦¬ì˜¤-3-ì „ì²´-í…Œì´ë¸”-ìŠ¤ìº”">ì‹œë‚˜ë¦¬ì˜¤ 3: ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ì¿¼ë¦¬: ì „ì²´ ë°ì´í„° ì§‘ê³„ (íŒŒí‹°ì…˜ í”„ë£¨ë‹ ì—†ìŒ)</span>
<span class="k">SELECT</span> <span class="n">user_id</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">events</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">user_id</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="ì„±ëŠ¥-ë¹„êµ-2"><strong>ì„±ëŠ¥ ë¹„êµ</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒí‹°ì…˜ êµ¬ì¡°</strong></th>
      <th><strong>íŒŒì¼ ìˆ˜</strong></th>
      <th><strong>íŒŒí‹°ì…˜ íƒìƒ‰</strong></th>
      <th><strong>ë°ì´í„° ì½ê¸°</strong></th>
      <th><strong>ì´ ì‹œê°„</strong></th>
      <th><strong>ê°œì„ ìœ¨</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>yyyy/mm/dd</strong></td>
      <td>262,800ê°œ</td>
      <td>6ë¶„ 32ì´ˆ</td>
      <td>24ë¶„ 18ì´ˆ</td>
      <td><strong>30ë¶„ 50ì´ˆ</strong></td>
      <td>-</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd</strong></td>
      <td>8,760ê°œ</td>
      <td>1ë¶„ 48ì´ˆ</td>
      <td>18ë¶„ 52ì´ˆ</td>
      <td><strong>20ë¶„ 40ì´ˆ</strong></td>
      <td><strong>1.5x</strong></td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd (compacted)</strong></td>
      <td>4,380ê°œ</td>
      <td>52.3ì´ˆ</td>
      <td>15ë¶„ 23ì´ˆ</td>
      <td><strong>16ë¶„ 15ì´ˆ</strong></td>
      <td><strong>1.9x</strong></td>
    </tr>
  </tbody>
</table>

<h3 id="athena-ì¿¼ë¦¬-ë¹„ìš©-ë¹„êµ">Athena ì¿¼ë¦¬ ë¹„ìš© ë¹„êµ</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Athenaì—ì„œ ë™ì¼ ì¿¼ë¦¬ ì‹¤í–‰</span>
<span class="k">SELECT</span> <span class="o">*</span>
<span class="k">FROM</span> <span class="n">events</span>
<span class="k">WHERE</span> <span class="nb">date</span> <span class="o">=</span> <span class="s1">'2024-01-15'</span><span class="p">;</span>
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>íŒŒí‹°ì…˜ êµ¬ì¡°</strong></th>
      <th><strong>ìŠ¤ìº” ë°ì´í„°</strong></th>
      <th><strong>ì‹¤í–‰ ì‹œê°„</strong></th>
      <th><strong>ë¹„ìš© (per query)</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>yyyy/mm/dd</strong></td>
      <td>3.2 GB</td>
      <td>8.3ì´ˆ</td>
      <td>$0.016</td>
    </tr>
    <tr>
      <td><strong>yyyy-mm-dd</strong></td>
      <td>3.0 GB</td>
      <td>2.1ì´ˆ</td>
      <td>$0.015</td>
    </tr>
    <tr>
      <td><strong>íŒŒí‹°ì…˜ ì—†ìŒ</strong></td>
      <td>1,024 GB</td>
      <td>1ë¶„ 34ì´ˆ</td>
      <td>$5.12</td>
    </tr>
  </tbody>
</table>

<p><strong>ê°œì„  íš¨ê³¼</strong>: íŒŒí‹°ì…˜ ìµœì í™”ë¡œ <strong>74% ë¹„ìš© ì ˆê°</strong> (íŒŒí‹°ì…˜ ì—†ìŒ ëŒ€ë¹„)</p>

<hr />

<h2 id="ì‹¤ë¬´-ë§ˆì´ê·¸ë ˆì´ì…˜-ê°€ì´ë“œ">ğŸ”§ ì‹¤ë¬´ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ</h2>

<h3 id="1ë‹¨ê³„-í˜„ì¬-ìƒíƒœ-ë¶„ì„">1ë‹¨ê³„: í˜„ì¬ ìƒíƒœ ë¶„ì„</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ê¸°ì¡´ íŒŒí‹°ì…˜ êµ¬ì¡° ë¶„ì„
</span><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>
<span class="n">paginator</span> <span class="o">=</span> <span class="n">s3</span><span class="p">.</span><span class="nf">get_paginator</span><span class="p">(</span><span class="sh">'</span><span class="s">list_objects_v2</span><span class="sh">'</span><span class="p">)</span>

<span class="n">bucket</span> <span class="o">=</span> <span class="sh">'</span><span class="s">my-bucket</span><span class="sh">'</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="sh">'</span><span class="s">data/events/</span><span class="sh">'</span>

<span class="c1"># íŒŒí‹°ì…˜ë³„ íŒŒì¼ ìˆ˜ì™€ í¬ê¸° ì§‘ê³„
</span><span class="n">stats</span> <span class="o">=</span> <span class="nf">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">paginator</span><span class="p">.</span><span class="nf">paginate</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span> <span class="n">Prefix</span><span class="o">=</span><span class="n">prefix</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">page</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">Contents</span><span class="sh">'</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="c1"># íŒŒí‹°ì…˜ ì¶”ì¶œ (ì˜ˆ: year=2024/month=01/day=15)
</span>        <span class="n">parts</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="sh">'</span><span class="s">Key</span><span class="sh">'</span><span class="p">].</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span>
        <span class="n">partition</span> <span class="o">=</span> <span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="n">stats</span><span class="p">[</span><span class="n">partition</span><span class="p">][</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">stats</span><span class="p">[</span><span class="n">partition</span><span class="p">][</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">]</span> <span class="o">+=</span> <span class="n">obj</span><span class="p">[</span><span class="sh">'</span><span class="s">Size</span><span class="sh">'</span><span class="p">]</span>

<span class="c1"># í†µê³„ ì¶œë ¥
</span><span class="k">for</span> <span class="n">partition</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">stats</span><span class="p">.</span><span class="nf">items</span><span class="p">()):</span>
    <span class="n">avg_size_mb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="sh">"</span><span class="s">count</span><span class="sh">"</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">partition</span><span class="si">}</span><span class="s">: </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s"> files, avg </span><span class="si">{</span><span class="n">avg_size_mb</span><span class="si">:</span><span class="p">.</span><span class="mi">1</span><span class="n">f</span><span class="si">}</span><span class="s">MB</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="ë¶„ì„-ê²°ê³¼-ì˜ˆì‹œ"><strong>ë¶„ì„ ê²°ê³¼ ì˜ˆì‹œ</strong></h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>year=2024/month=01/day=15: 720 files, avg 2.3MB  âŒ Small files ë¬¸ì œ
year=2024/month=01/day=16: 680 files, avg 2.5MB  âŒ
year=2024/month=01/day=17: 740 files, avg 2.1MB  âŒ

ê¶Œì¥: 128MB íŒŒì¼ë¡œ consolidation í•„ìš”
</code></pre></div></div>

<h3 id="2ë‹¨ê³„-ë§ˆì´ê·¸ë ˆì´ì…˜-ê³„íš">2ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš</h3>

<table>
  <thead>
    <tr>
      <th><strong>ì‘ì—…</strong></th>
      <th><strong>ì†Œìš” ì‹œê°„</strong></th>
      <th><strong>ë‹¤ìš´íƒ€ì„</strong></th>
      <th><strong>ìš°ì„ ìˆœìœ„</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>íŒŒí‹°ì…˜ êµ¬ì¡° ì¬ì„¤ê³„</strong></td>
      <td>1-2ì£¼</td>
      <td>ì—†ìŒ</td>
      <td>ë†’ìŒ</td>
    </tr>
    <tr>
      <td><strong>Compaction ì‘ì—…</strong></td>
      <td>ë°ì´í„° ì–‘ì— ë”°ë¼</td>
      <td>ì—†ìŒ</td>
      <td>ë†’ìŒ</td>
    </tr>
    <tr>
      <td><strong>ë³‘ë ¬ ë§ˆì´ê·¸ë ˆì´ì…˜</strong></td>
      <td>3-4ì£¼</td>
      <td>ì—†ìŒ</td>
      <td>ì¤‘ê°„</td>
    </tr>
    <tr>
      <td><strong>ì¿¼ë¦¬/ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì •</strong></td>
      <td>2-3ì£¼</td>
      <td>ê³„íšëœ ë°°í¬</td>
      <td>ë†’ìŒ</td>
    </tr>
    <tr>
      <td><strong>ê²€ì¦ ë° ëª¨ë‹ˆí„°ë§</strong></td>
      <td>1-2ì£¼</td>
      <td>ì—†ìŒ</td>
      <td>ë†’ìŒ</td>
    </tr>
  </tbody>
</table>

<h3 id="3ë‹¨ê³„-ë§ˆì´ê·¸ë ˆì´ì…˜-ìŠ¤í¬ë¦½íŠ¸">3ë‹¨ê³„: ë§ˆì´ê·¸ë ˆì´ì…˜ ìŠ¤í¬ë¦½íŠ¸</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="n">pyspark.sql.functions</span> <span class="kn">import</span> <span class="n">date_format</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="nb">hash</span><span class="p">,</span> <span class="n">col</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">.</span><span class="n">builder</span> \
    <span class="p">.</span><span class="nf">appName</span><span class="p">(</span><span class="sh">"</span><span class="s">S3 Partition Migration</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">config</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.sources.partitionOverwriteMode</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">dynamic</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">getOrCreate</span><span class="p">()</span>

<span class="c1"># ê¸°ì¡´ ë°ì´í„° ì½ê¸°
</span><span class="n">source_path</span> <span class="o">=</span> <span class="sh">"</span><span class="s">s3://bucket/data/events-old/year=*/month=*/day=*/</span><span class="sh">"</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="n">source_path</span><span class="p">)</span>

<span class="c1"># ìƒˆë¡œìš´ date ì»¬ëŸ¼ ìƒì„±
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nf">date_format</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">event_time</span><span class="sh">"</span><span class="p">),</span> <span class="sh">"</span><span class="s">yyyy-MM-dd</span><span class="sh">"</span><span class="p">))</span>

<span class="c1"># Shard ì¶”ê°€ (ì„ íƒì‚¬í•­)
</span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">shard</span><span class="sh">"</span><span class="p">,</span> <span class="nf">abs</span><span class="p">(</span><span class="nf">hash</span><span class="p">(</span><span class="nf">col</span><span class="p">(</span><span class="sh">"</span><span class="s">user_id</span><span class="sh">"</span><span class="p">)))</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1"># íŒŒì¼ í¬ê¸° ìµœì í™”
</span><span class="n">spark</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="sh">"</span><span class="s">spark.sql.files.maxPartitionBytes</span><span class="sh">"</span><span class="p">,</span> <span class="mi">134217728</span><span class="p">)</span>  <span class="c1"># 128MB
</span>
<span class="c1"># ì ì ˆí•œ íŒŒí‹°ì…˜ ìˆ˜ ê³„ì‚°
</span><span class="n">total_size_gb</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">*</span> <span class="mi">500</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>  <span class="c1"># ë ˆì½”ë“œë‹¹ ~500 bytes
</span><span class="n">num_partitions</span> <span class="o">=</span> <span class="nf">int</span><span class="p">(</span><span class="n">total_size_gb</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># 128MB íŒŒì¼ ê¸°ì¤€
</span>
<span class="c1"># ìƒˆë¡œìš´ êµ¬ì¡°ë¡œ ì €ì¥
</span><span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">num_partitions</span><span class="p">,</span> <span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="n">write</span> \
    <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">partitionBy</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">)</span> \
    <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sh">"</span><span class="s">s3://bucket/data/events-new/</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="4ë‹¨ê³„-ì ì§„ì -ë§ˆì´ê·¸ë ˆì´ì…˜">4ë‹¨ê³„: ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë‚ ì§œë³„ë¡œ ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜
</span><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>

<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">current_date</span><span class="p">.</span><span class="n">year</span>
    <span class="n">month</span> <span class="o">=</span> <span class="n">current_date</span><span class="p">.</span><span class="n">month</span>
    <span class="n">day</span> <span class="o">=</span> <span class="n">current_date</span><span class="p">.</span><span class="n">day</span>
    <span class="n">date_str</span> <span class="o">=</span> <span class="n">current_date</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Processing </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s">...</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="c1"># íŠ¹ì • ë‚ ì§œ ë°ì´í„° ì½ê¸°
</span>    <span class="n">old_path</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/data/events-old/year=</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s">/month=</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">/day=</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span>
    
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="n">old_path</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">withColumn</span><span class="p">(</span><span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">,</span> <span class="nf">lit</span><span class="p">(</span><span class="n">date_str</span><span class="p">))</span>
        
        <span class="c1"># íŒŒì¼ í¬ê¸° ìµœì í™”
</span>        <span class="n">num_files</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nf">int</span><span class="p">(</span><span class="n">df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span> <span class="o">/</span> <span class="mi">1000000</span><span class="p">))</span>  <span class="c1"># íŒŒì¼ë‹¹ 100ë§Œ ë ˆì½”ë“œ
</span>        
        <span class="n">df</span><span class="p">.</span><span class="nf">repartition</span><span class="p">(</span><span class="n">num_files</span><span class="p">)</span> \
            <span class="p">.</span><span class="n">write</span> \
            <span class="p">.</span><span class="nf">mode</span><span class="p">(</span><span class="sh">"</span><span class="s">overwrite</span><span class="sh">"</span><span class="p">)</span> \
            <span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">s3://bucket/data/events-new/date=</span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
        
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ“ </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s"> completed</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ— </span><span class="si">{</span><span class="n">date_str</span><span class="si">}</span><span class="s"> failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">current_date</span> <span class="o">+=</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="5ë‹¨ê³„-ê²€ì¦">5ë‹¨ê³„: ê²€ì¦</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ë§ˆì´ê·¸ë ˆì´ì…˜ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸
</span><span class="k">def</span> <span class="nf">validate_migration</span><span class="p">(</span><span class="n">old_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">,</span> <span class="n">date</span><span class="p">):</span>
    <span class="c1"># ë ˆì½”ë“œ ìˆ˜ ë¹„êµ
</span>    <span class="n">old_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">old_path</span><span class="si">}</span><span class="s">/year=</span><span class="si">{</span><span class="n">date</span><span class="p">.</span><span class="n">year</span><span class="si">}</span><span class="s">/month=</span><span class="si">{</span><span class="n">date</span><span class="p">.</span><span class="n">month</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">/day=</span><span class="si">{</span><span class="n">date</span><span class="p">.</span><span class="n">day</span><span class="si">:</span><span class="mi">02</span><span class="n">d</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">new_df</span> <span class="o">=</span> <span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="nf">parquet</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">new_path</span><span class="si">}</span><span class="s">/date=</span><span class="si">{</span><span class="n">date</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">'</span><span class="s">%Y-%m-%d</span><span class="sh">'</span><span class="p">)</span><span class="si">}</span><span class="s">/</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">old_count</span> <span class="o">=</span> <span class="n">old_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
    <span class="n">new_count</span> <span class="o">=</span> <span class="n">new_df</span><span class="p">.</span><span class="nf">count</span><span class="p">()</span>
    
    <span class="c1"># ì²´í¬ì„¬ ë¹„êµ (ìƒ˜í”Œë§)
</span>    <span class="n">old_checksum</span> <span class="o">=</span> <span class="n">old_df</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="mf">0.01</span><span class="p">).</span><span class="nf">selectExpr</span><span class="p">(</span><span class="sh">"</span><span class="s">sum(hash(*))</span><span class="sh">"</span><span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">new_checksum</span> <span class="o">=</span> <span class="n">new_df</span><span class="p">.</span><span class="nf">sample</span><span class="p">(</span><span class="mf">0.01</span><span class="p">).</span><span class="nf">selectExpr</span><span class="p">(</span><span class="sh">"</span><span class="s">sum(hash(*))</span><span class="sh">"</span><span class="p">).</span><span class="nf">collect</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># ê²°ê³¼
</span>    <span class="k">if</span> <span class="n">old_count</span> <span class="o">==</span> <span class="n">new_count</span> <span class="ow">and</span> <span class="n">old_checksum</span> <span class="o">==</span> <span class="n">new_checksum</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ“ </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">: Valid (</span><span class="si">{</span><span class="n">old_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s"> records)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ— </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s">: Invalid (old: </span><span class="si">{</span><span class="n">old_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s">, new: </span><span class="si">{</span><span class="n">new_count</span><span class="si">:</span><span class="p">,</span><span class="si">}</span><span class="s">)</span><span class="sh">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="c1"># ì „ì²´ ê¸°ê°„ ê²€ì¦
</span><span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">start_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="nf">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>

<span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span><span class="p">:</span>
    <span class="nf">validate_migration</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">s3://bucket/data/events-old</span><span class="sh">"</span><span class="p">,</span>
        <span class="sh">"</span><span class="s">s3://bucket/data/events-new</span><span class="sh">"</span><span class="p">,</span>
        <span class="n">current_date</span>
    <span class="p">)</span>
    <span class="n">current_date</span> <span class="o">+=</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="6ë‹¨ê³„-ì¿¼ë¦¬-ì„±ëŠ¥-ëª¨ë‹ˆí„°ë§">6ë‹¨ê³„: ì¿¼ë¦¬ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># CloudWatch ë©”íŠ¸ë¦­ ìˆ˜ì§‘
</span><span class="kn">import</span> <span class="n">boto3</span>
<span class="kn">from</span> <span class="n">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">cloudwatch</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">cloudwatch</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># Athena ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ëª¨ë‹ˆí„°ë§
</span><span class="n">response</span> <span class="o">=</span> <span class="n">cloudwatch</span><span class="p">.</span><span class="nf">get_metric_statistics</span><span class="p">(</span>
    <span class="n">Namespace</span><span class="o">=</span><span class="sh">'</span><span class="s">AWS/Athena</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">MetricName</span><span class="o">=</span><span class="sh">'</span><span class="s">EngineExecutionTime</span><span class="sh">'</span><span class="p">,</span>
    <span class="n">Dimensions</span><span class="o">=</span><span class="p">[</span>
        <span class="p">{</span><span class="sh">'</span><span class="s">Name</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">WorkGroup</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Value</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">primary</span><span class="sh">'</span><span class="p">}</span>
    <span class="p">],</span>
    <span class="n">StartTime</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">7</span><span class="p">),</span>
    <span class="n">EndTime</span><span class="o">=</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">(),</span>
    <span class="n">Period</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span>
    <span class="n">Statistics</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">Average</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">Maximum</span><span class="sh">'</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># ê²°ê³¼ ë¶„ì„
</span><span class="k">for</span> <span class="n">datapoint</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">Datapoints</span><span class="sh">'</span><span class="p">]:</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">datapoint</span><span class="p">[</span><span class="sh">'</span><span class="s">Timestamp</span><span class="sh">'</span><span class="p">]</span><span class="si">}</span><span class="s">: </span><span class="sh">"</span>
          <span class="sa">f</span><span class="sh">"</span><span class="s">Avg=</span><span class="si">{</span><span class="n">datapoint</span><span class="p">[</span><span class="sh">'</span><span class="s">Average</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s, </span><span class="sh">"</span>
          <span class="sa">f</span><span class="sh">"</span><span class="s">Max=</span><span class="si">{</span><span class="n">datapoint</span><span class="p">[</span><span class="sh">'</span><span class="s">Maximum</span><span class="sh">'</span><span class="p">]</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">f</span><span class="si">}</span><span class="s">s</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="7ë‹¨ê³„-ë¹„ìš©-ìµœì í™”">7ë‹¨ê³„: ë¹„ìš© ìµœì í™”</h3>

<h4 id="s3-storage-class-ì „í™˜"><strong>S3 Storage Class ì „í™˜</strong></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ì˜¤ë˜ëœ íŒŒí‹°ì…˜ì„ Intelligent-Tieringìœ¼ë¡œ ì „í™˜
</span><span class="kn">import</span> <span class="n">boto3</span>

<span class="n">s3</span> <span class="o">=</span> <span class="n">boto3</span><span class="p">.</span><span class="nf">client</span><span class="p">(</span><span class="sh">'</span><span class="s">s3</span><span class="sh">'</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">transition_old_partitions</span><span class="p">(</span><span class="n">bucket</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">days_old</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
    <span class="n">cutoff_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">-</span> <span class="nf">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days_old</span><span class="p">)</span>
    
    <span class="c1"># Lifecycle policy ìƒì„±
</span>    <span class="n">lifecycle_config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">Rules</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="sh">'</span><span class="s">Id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">TransitionOldData</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Status</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">Enabled</span><span class="sh">'</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Prefix</span><span class="sh">'</span><span class="p">:</span> <span class="n">prefix</span><span class="p">,</span>
                <span class="sh">'</span><span class="s">Transitions</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="sh">'</span><span class="s">Days</span><span class="sh">'</span><span class="p">:</span> <span class="n">days_old</span><span class="p">,</span>
                        <span class="sh">'</span><span class="s">StorageClass</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">INTELLIGENT_TIERING</span><span class="sh">'</span>
                    <span class="p">}</span>
                <span class="p">]</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
    
    <span class="n">s3</span><span class="p">.</span><span class="nf">put_bucket_lifecycle_configuration</span><span class="p">(</span>
        <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="p">,</span>
        <span class="n">LifecycleConfiguration</span><span class="o">=</span><span class="n">lifecycle_config</span>
    <span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">âœ“ Lifecycle policy applied: </span><span class="si">{</span><span class="n">days_old</span><span class="si">}</span><span class="s">+ days â†’ INTELLIGENT_TIERING</span><span class="sh">"</span><span class="p">)</span>

<span class="nf">transition_old_partitions</span><span class="p">(</span><span class="sh">'</span><span class="s">my-bucket</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">data/events/</span><span class="sh">'</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="ë¹„ìš©-ì ˆê°-íš¨ê³¼"><strong>ë¹„ìš© ì ˆê° íš¨ê³¼</strong></h4>

<table>
  <thead>
    <tr>
      <th><strong>í•­ëª©</strong></th>
      <th><strong>ë§ˆì´ê·¸ë ˆì´ì…˜ ì „</strong></th>
      <th><strong>ë§ˆì´ê·¸ë ˆì´ì…˜ í›„</strong></th>
      <th><strong>ì ˆê°ë¥ </strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>S3 Storage</strong></td>
      <td>$23,040/ì›” (1TB, Standard)</td>
      <td>$20,736/ì›” (Intelligent-Tiering)</td>
      <td>10%</td>
    </tr>
    <tr>
      <td><strong>S3 API ë¹„ìš©</strong></td>
      <td>$1,200/ì›” (LIST/GET)</td>
      <td>$360/ì›”</td>
      <td>70%</td>
    </tr>
    <tr>
      <td><strong>Athena ìŠ¤ìº”</strong></td>
      <td>$512/ì›”</td>
      <td>$128/ì›”</td>
      <td>75%</td>
    </tr>
    <tr>
      <td><strong>Spark ì»´í“¨íŒ…</strong></td>
      <td>$4,800/ì›”</td>
      <td>$3,200/ì›”</td>
      <td>33%</td>
    </tr>
    <tr>
      <td><strong>ì´ ë¹„ìš©</strong></td>
      <td><strong>$29,552/ì›”</strong></td>
      <td><strong>$24,424/ì›”</strong></td>
      <td><strong>17%</strong></td>
    </tr>
  </tbody>
</table>

<hr />

<h2 id="í•™ìŠµ-ìš”ì•½">ğŸ“š í•™ìŠµ ìš”ì•½</h2>

<h3 id="í•µì‹¬-í¬ì¸íŠ¸">í•µì‹¬ í¬ì¸íŠ¸</h3>

<ol>
  <li><strong>ì•„í‚¤í…ì²˜ ì´í•´ê°€ í•µì‹¬</strong>
    <ul>
      <li>HDFS: ê³„ì¸µì  íŒŒì¼ ì‹œìŠ¤í…œ, NameNode ë©”íƒ€ë°ì´í„°</li>
      <li>S3: Flat namespace ê°ì²´ ìŠ¤í† ë¦¬ì§€, List ì—°ì‚° ë¹„ìš©</li>
    </ul>
  </li>
  <li><strong>S3 ìµœì í™” ì „ëµ</strong>
    <ul>
      <li><strong>ì–•ì€ êµ¬ì¡°</strong>: yyyy-mm-dd ë‹¨ì¼ ë ˆë²¨</li>
      <li><strong>í° íŒŒì¼</strong>: 64-256MB ê¶Œì¥</li>
      <li><strong>Prefix ë¶„ì‚°</strong>: Request rate ì œí•œ íšŒí”¼</li>
    </ul>
  </li>
  <li><strong>ì„±ëŠ¥ ê°œì„  íš¨ê³¼</strong>
    <ul>
      <li><strong>ë‹¨ì¼ ë‚ ì§œ ì¡°íšŒ</strong>: 4.1x ë¹ ë¦„</li>
      <li><strong>7ì¼ ë²”ìœ„ ì¡°íšŒ</strong>: 4.7x ë¹ ë¦„ (shard ì‚¬ìš©)</li>
      <li><strong>ë¹„ìš© ì ˆê°</strong>: 17% ì ˆê°</li>
    </ul>
  </li>
  <li><strong>ë§ˆì´ê·¸ë ˆì´ì…˜ ëª¨ë²” ì‚¬ë¡€</strong>
    <ul>
      <li>ì ì§„ì  ë§ˆì´ê·¸ë ˆì´ì…˜</li>
      <li>ì² ì €í•œ ê²€ì¦</li>
      <li>ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</li>
    </ul>
  </li>
</ol>

<h3 id="ì‹¤ë¬´-ì²´í¬ë¦¬ìŠ¤íŠ¸">ì‹¤ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>

<ul class="task-list">
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />í˜„ì¬ íŒŒí‹°ì…˜ êµ¬ì¡° ë¶„ì„ ì™„ë£Œ</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Small files ë¬¸ì œ íŒŒì•…</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë§ˆì´ê·¸ë ˆì´ì…˜ ê³„íš ìˆ˜ë¦½</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />Compaction ìŠ¤í¬ë¦½íŠ¸ ì¤€ë¹„</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ê²€ì¦ í”„ë¡œì„¸ìŠ¤ ì •ì˜</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì¿¼ë¦¬/ì• í”Œë¦¬ì¼€ì´ì…˜ ìˆ˜ì •</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•</li>
  <li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled="disabled" />ë¹„ìš© ìµœì í™” ì ìš©</li>
</ul>

<h3 id="ì¶”ê°€-í•™ìŠµ-ìë£Œ">ì¶”ê°€ í•™ìŠµ ìë£Œ</h3>

<ul>
  <li><strong>AWS ê³µì‹ ë¬¸ì„œ</strong>: S3 Performance Best Practices</li>
  <li><strong>Spark ìµœì í™”</strong>: Adaptive Query Execution (AQE)</li>
  <li><strong>Parquet ìµœì í™”</strong>: Row Group í¬ê¸°, Compression</li>
  <li><strong>Iceberg/Delta Lake</strong>: í…Œì´ë¸” í¬ë§·ìœ¼ë¡œ íŒŒí‹°ì…”ë‹ ì¶”ìƒí™”</li>
</ul>

<hr />

<blockquote>
  <p><strong>â€œì˜¬ë°”ë¥¸ íŒŒí‹°ì…”ë‹ ì „ëµì€ ë‹¨ìˆœíˆ ì„±ëŠ¥ í–¥ìƒì´ ì•„ë‹Œ, ë¹„ìš© ì ˆê°ê³¼ ìš´ì˜ íš¨ìœ¨ì„±ê¹Œì§€ ê°œì„ í•©ë‹ˆë‹¤.â€</strong></p>
</blockquote>

<p>HDFSì—ì„œ S3ë¡œì˜ ì „í™˜ì€ ë‹¨ìˆœí•œ ìŠ¤í† ë¦¬ì§€ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì•„ë‹™ë‹ˆë‹¤. ì•„í‚¤í…ì²˜ì˜ ê·¼ë³¸ì ì¸ ì°¨ì´ë¥¼ ì´í•´í•˜ê³  ê·¸ì— ë§ëŠ” ìµœì í™” ì „ëµì„ ì ìš©í•  ë•Œ, ì§„ì •í•œ í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ë°ì´í„° ë ˆì´í¬ì˜ ê°€ì¹˜ë¥¼ ì‹¤í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

  </div>

  
  <div class="post-navigation">
    <div class="nav-links">
      
      
      
        
          
          
      
      
      
      
        
        
        <a href="/data-engineering/2025/10/17/data-lake-file-format-comparison.html" class="nav-link next">
          ë‹¤ìŒ: Parquet vs ORC vs Avro ì‹¤ì „ ë¹„êµ - ë°ì´í„° ë ˆì´í¬ íŒŒì¼ í¬ë§· ì™„ì „ ì •ë³µ â†’
        </a>
      
    </div>
    
    <div class="series-overview">
      <a href="/categories/data-engineering/" class="btn btn-secondary">
        ğŸ“š ì‹œë¦¬ì¦ˆ ì „ì²´ ë³´ê¸°
      </a>
    </div>
  </div>
  
</article>

    </div>
  </main>
  
  
  <footer class="site-footer">
  <div class="container">
    <div class="footer-content">
      <div class="footer-section">
        <h3>Data Droid Blog</h3>
        <p>ë°ì´í„° ì—”ì§€ë‹ˆì–´ê°€ ë‹¤ë£¨ëŠ” ê¸°ìˆ  ë¸”ë¡œê·¸</p>
      </div>
      
      <div class="footer-section">
        <h4>ì¹´í…Œê³ ë¦¬</h4>
        <ul>
          <li><a href="/categories/data-engineering/">ë°ì´í„° ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/bi-engineering/">BI ì—”ì§€ë‹ˆì–´ë§</a></li>
          <li><a href="/categories/infrastructure-tools/">ì¸í”„ë¼ & ë„êµ¬</a></li>
          <li><a href="/categories/data-quality/">ë°ì´í„° í’ˆì§ˆ</a></li>
          <li><a href="/categories/data-ai/">Data AI</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ë§í¬</h4>
        <ul>
          <li><a href="/">í™ˆ</a></li>
          <li><a href="/blog/">ë¸”ë¡œê·¸</a></li>
          <li><a href="/about/">ì†Œê°œ</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4>ì†Œì…œ</h4>
        <ul>
          
          <li><a href="https://github.com/data-droid">GitHub</a></li>
          
          <li><a href="https://www.linkedin.com/in/jaekyung-lee/">LinkedIn</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2026 Data Droid Blog. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ </p>
    </div>
  </div>
</footer>



  
  <script src="/assets/js/main.js"></script>
</body>
</html>
